'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:no-object-literal-type-assertion

const vscode_1 = require("vscode");

const constants = require("../../common/constants");

const constants_1 = require("../common/constants");

const types_1 = require("../common/types");

class TestFileCodeLensProvider {
  // tslint:disable-next-line:variable-name
  constructor(_onDidChange, symbolProvider, testCollectionStorage) {
    this._onDidChange = _onDidChange;
    this.symbolProvider = symbolProvider;
    this.testCollectionStorage = testCollectionStorage;
  }

  get onDidChangeCodeLenses() {
    return this._onDidChange.event;
  }

  provideCodeLenses(document, token) {
    return __awaiter(this, void 0, void 0, function* () {
      const wkspace = vscode_1.workspace.getWorkspaceFolder(document.uri);

      if (!wkspace) {
        return [];
      }

      const testItems = this.testCollectionStorage.getTests(wkspace.uri);

      if (!testItems || testItems.testFiles.length === 0 || testItems.testFunctions.length === 0) {
        return [];
      }

      const cancelTokenSrc = new vscode_1.CancellationTokenSource();
      token.onCancellationRequested(() => {
        cancelTokenSrc.cancel();
      }); // Strop trying to build the code lenses if unable to get a list of
      // symbols in this file afrer x time.

      setTimeout(() => {
        if (!cancelTokenSrc.token.isCancellationRequested) {
          cancelTokenSrc.cancel();
        }
      }, constants.Delays.MaxUnitTestCodeLensDelay);
      return this.getCodeLenses(document, cancelTokenSrc.token, this.symbolProvider);
    });
  }

  resolveCodeLens(codeLens, token) {
    codeLens.command = {
      command: 'python.runtests',
      title: 'Test'
    };
    return Promise.resolve(codeLens);
  }

  getCodeLenses(document, token, symbolProvider) {
    return __awaiter(this, void 0, void 0, function* () {
      const wkspace = vscode_1.workspace.getWorkspaceFolder(document.uri);

      if (!wkspace) {
        return [];
      }

      const tests = this.testCollectionStorage.getTests(wkspace.uri);

      if (!tests) {
        return [];
      }

      const file = tests.testFiles.find(item => item.fullPath === document.uri.fsPath);

      if (!file) {
        return [];
      }

      const allFuncsAndSuites = getAllTestSuitesAndFunctionsPerFile(file);

      try {
        const symbols = yield symbolProvider.provideDocumentSymbols(document, token);

        if (!symbols) {
          return [];
        }

        return symbols.filter(symbol => symbol.kind === vscode_1.SymbolKind.Function || symbol.kind === vscode_1.SymbolKind.Method || symbol.kind === vscode_1.SymbolKind.Class).map(symbol => {
          // This is bloody crucial, if the start and end columns are the same
          // then vscode goes bonkers when ever you edit a line (start scrolling magically).
          const range = new vscode_1.Range(symbol.location.range.start, new vscode_1.Position(symbol.location.range.end.line, symbol.location.range.end.character + 1));
          return this.getCodeLens(document.uri, allFuncsAndSuites, range, symbol.name, symbol.kind, symbol.containerName);
        }).reduce((previous, current) => previous.concat(current), []).filter(codeLens => codeLens !== null);
      } catch (reason) {
        if (token.isCancellationRequested) {
          return [];
        }

        return Promise.reject(reason);
      }
    });
  }

  getCodeLens(file, allFuncsAndSuites, range, symbolName, symbolKind, symbolContainer) {
    switch (symbolKind) {
      case vscode_1.SymbolKind.Function:
      case vscode_1.SymbolKind.Method:
        {
          return getFunctionCodeLens(file, allFuncsAndSuites, symbolName, range, symbolContainer);
        }

      case vscode_1.SymbolKind.Class:
        {
          const cls = allFuncsAndSuites.suites.find(item => item.name === symbolName);

          if (!cls) {
            return [];
          }

          return [new vscode_1.CodeLens(range, {
            title: getTestStatusIcon(cls.status) + constants.Text.CodeLensRunUnitTest,
            command: constants.Commands.Tests_Run,
            arguments: [undefined, constants_1.CommandSource.codelens, file, {
              testSuite: [cls]
            }]
          }), new vscode_1.CodeLens(range, {
            title: getTestStatusIcon(cls.status) + constants.Text.CodeLensDebugUnitTest,
            command: constants.Commands.Tests_Debug,
            arguments: [undefined, constants_1.CommandSource.codelens, file, {
              testSuite: [cls]
            }]
          })];
        }

      default:
        {
          return [];
        }
    }
  }

}

exports.TestFileCodeLensProvider = TestFileCodeLensProvider;

function getTestStatusIcon(status) {
  switch (status) {
    case types_1.TestStatus.Pass:
      {
        return '✔ ';
      }

    case types_1.TestStatus.Error:
    case types_1.TestStatus.Fail:
      {
        return '✘ ';
      }

    case types_1.TestStatus.Skipped:
      {
        return '⃠ ';
      }

    default:
      {
        return '';
      }
  }
}

function getTestStatusIcons(fns) {
  const statuses = [];
  let count = fns.filter(fn => fn.status === types_1.TestStatus.Pass).length;

  if (count > 0) {
    statuses.push(`✔ ${count}`);
  }

  count = fns.filter(fn => fn.status === types_1.TestStatus.Error || fn.status === types_1.TestStatus.Fail).length;

  if (count > 0) {
    statuses.push(`✘ ${count}`);
  }

  count = fns.filter(fn => fn.status === types_1.TestStatus.Skipped).length;

  if (count > 0) {
    statuses.push(`⃠ ${count}`);
  }

  return statuses.join(' ');
}

function getFunctionCodeLens(file, functionsAndSuites, symbolName, range, symbolContainer) {
  let fn;

  if (symbolContainer.length === 0) {
    fn = functionsAndSuites.functions.find(func => func.name === symbolName);
  } else {
    // Assume single levels for now.
    functionsAndSuites.suites.filter(s => s.name === symbolContainer).forEach(s => {
      const f = s.functions.find(item => item.name === symbolName);

      if (f) {
        fn = f;
      }
    });
  }

  if (fn) {
    return [new vscode_1.CodeLens(range, {
      title: getTestStatusIcon(fn.status) + constants.Text.CodeLensRunUnitTest,
      command: constants.Commands.Tests_Run,
      arguments: [undefined, constants_1.CommandSource.codelens, file, {
        testFunction: [fn]
      }]
    }), new vscode_1.CodeLens(range, {
      title: getTestStatusIcon(fn.status) + constants.Text.CodeLensDebugUnitTest,
      command: constants.Commands.Tests_Debug,
      arguments: [undefined, constants_1.CommandSource.codelens, file, {
        testFunction: [fn]
      }]
    })];
  } // Ok, possible we're dealing with parameterized unit tests.
  // If we have [ in the name, then this is a parameterized function.


  const functions = functionsAndSuites.functions.filter(func => func.name.startsWith(`${symbolName}[`) && func.name.endsWith(']'));

  if (functions.length === 0) {
    return [];
  }

  if (functions.length === 0) {
    return [new vscode_1.CodeLens(range, {
      title: constants.Text.CodeLensRunUnitTest,
      command: constants.Commands.Tests_Run,
      arguments: [undefined, constants_1.CommandSource.codelens, file, {
        testFunction: functions
      }]
    }), new vscode_1.CodeLens(range, {
      title: constants.Text.CodeLensDebugUnitTest,
      command: constants.Commands.Tests_Debug,
      arguments: [undefined, constants_1.CommandSource.codelens, file, {
        testFunction: functions
      }]
    })];
  } // Find all flattened functions.


  return [new vscode_1.CodeLens(range, {
    title: `${getTestStatusIcons(functions)}${constants.Text.CodeLensRunUnitTest} (Multiple)`,
    command: constants.Commands.Tests_Picker_UI,
    arguments: [undefined, constants_1.CommandSource.codelens, file, functions]
  }), new vscode_1.CodeLens(range, {
    title: `${getTestStatusIcons(functions)}${constants.Text.CodeLensDebugUnitTest} (Multiple)`,
    command: constants.Commands.Tests_Picker_UI_Debug,
    arguments: [undefined, constants_1.CommandSource.codelens, file, functions]
  })];
}

function getAllTestSuitesAndFunctionsPerFile(testFile) {
  // tslint:disable-next-line:prefer-type-cast
  const all = {
    functions: testFile.functions,
    suites: []
  };
  testFile.suites.forEach(suite => {
    all.suites.push(suite);
    const allChildItems = getAllTestSuitesAndFunctions(suite);
    all.functions.push(...allChildItems.functions);
    all.suites.push(...allChildItems.suites);
  });
  return all;
}

function getAllTestSuitesAndFunctions(testSuite) {
  const all = {
    functions: [],
    suites: []
  };
  testSuite.functions.forEach(fn => {
    all.functions.push(fn);
  });
  testSuite.suites.forEach(suite => {
    all.suites.push(suite);
    const allChildItems = getAllTestSuitesAndFunctions(suite);
    all.functions.push(...allChildItems.functions);
    all.suites.push(...allChildItems.suites);
  });
  return all;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3RGaWxlcy5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidnNjb2RlXzEiLCJyZXF1aXJlIiwiY29uc3RhbnRzIiwiY29uc3RhbnRzXzEiLCJ0eXBlc18xIiwiVGVzdEZpbGVDb2RlTGVuc1Byb3ZpZGVyIiwiY29uc3RydWN0b3IiLCJfb25EaWRDaGFuZ2UiLCJzeW1ib2xQcm92aWRlciIsInRlc3RDb2xsZWN0aW9uU3RvcmFnZSIsIm9uRGlkQ2hhbmdlQ29kZUxlbnNlcyIsImV2ZW50IiwicHJvdmlkZUNvZGVMZW5zZXMiLCJkb2N1bWVudCIsInRva2VuIiwid2tzcGFjZSIsIndvcmtzcGFjZSIsImdldFdvcmtzcGFjZUZvbGRlciIsInVyaSIsInRlc3RJdGVtcyIsImdldFRlc3RzIiwidGVzdEZpbGVzIiwibGVuZ3RoIiwidGVzdEZ1bmN0aW9ucyIsImNhbmNlbFRva2VuU3JjIiwiQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UiLCJvbkNhbmNlbGxhdGlvblJlcXVlc3RlZCIsImNhbmNlbCIsInNldFRpbWVvdXQiLCJpc0NhbmNlbGxhdGlvblJlcXVlc3RlZCIsIkRlbGF5cyIsIk1heFVuaXRUZXN0Q29kZUxlbnNEZWxheSIsImdldENvZGVMZW5zZXMiLCJyZXNvbHZlQ29kZUxlbnMiLCJjb2RlTGVucyIsImNvbW1hbmQiLCJ0aXRsZSIsInRlc3RzIiwiZmlsZSIsImZpbmQiLCJpdGVtIiwiZnVsbFBhdGgiLCJmc1BhdGgiLCJhbGxGdW5jc0FuZFN1aXRlcyIsImdldEFsbFRlc3RTdWl0ZXNBbmRGdW5jdGlvbnNQZXJGaWxlIiwic3ltYm9scyIsInByb3ZpZGVEb2N1bWVudFN5bWJvbHMiLCJmaWx0ZXIiLCJzeW1ib2wiLCJraW5kIiwiU3ltYm9sS2luZCIsIkZ1bmN0aW9uIiwiTWV0aG9kIiwiQ2xhc3MiLCJtYXAiLCJyYW5nZSIsIlJhbmdlIiwibG9jYXRpb24iLCJzdGFydCIsIlBvc2l0aW9uIiwiZW5kIiwibGluZSIsImNoYXJhY3RlciIsImdldENvZGVMZW5zIiwibmFtZSIsImNvbnRhaW5lck5hbWUiLCJyZWR1Y2UiLCJwcmV2aW91cyIsImN1cnJlbnQiLCJjb25jYXQiLCJyZWFzb24iLCJzeW1ib2xOYW1lIiwic3ltYm9sS2luZCIsInN5bWJvbENvbnRhaW5lciIsImdldEZ1bmN0aW9uQ29kZUxlbnMiLCJjbHMiLCJzdWl0ZXMiLCJDb2RlTGVucyIsImdldFRlc3RTdGF0dXNJY29uIiwic3RhdHVzIiwiVGV4dCIsIkNvZGVMZW5zUnVuVW5pdFRlc3QiLCJDb21tYW5kcyIsIlRlc3RzX1J1biIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsIkNvbW1hbmRTb3VyY2UiLCJjb2RlbGVucyIsInRlc3RTdWl0ZSIsIkNvZGVMZW5zRGVidWdVbml0VGVzdCIsIlRlc3RzX0RlYnVnIiwiVGVzdFN0YXR1cyIsIlBhc3MiLCJFcnJvciIsIkZhaWwiLCJTa2lwcGVkIiwiZ2V0VGVzdFN0YXR1c0ljb25zIiwiZm5zIiwic3RhdHVzZXMiLCJjb3VudCIsImZuIiwicHVzaCIsImpvaW4iLCJmdW5jdGlvbnNBbmRTdWl0ZXMiLCJmdW5jdGlvbnMiLCJmdW5jIiwicyIsImZvckVhY2giLCJmIiwidGVzdEZ1bmN0aW9uIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwiVGVzdHNfUGlja2VyX1VJIiwiVGVzdHNfUGlja2VyX1VJX0RlYnVnIiwidGVzdEZpbGUiLCJhbGwiLCJzdWl0ZSIsImFsbENoaWxkSXRlbXMiLCJnZXRBbGxUZXN0U3VpdGVzQW5kRnVuY3Rpb25zIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFyQixHQUFzQyxJQUFJTixDQUFKLENBQU0sVUFBVUcsT0FBVixFQUFtQjtBQUFFQSxRQUFBQSxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFQO0FBQXdCLE9BQW5ELEVBQXFETyxJQUFyRCxDQUEwRFIsU0FBMUQsRUFBcUVLLFFBQXJFLENBQXRDO0FBQXVIOztBQUMvSUgsSUFBQUEsSUFBSSxDQUFDLENBQUNOLFNBQVMsR0FBR0EsU0FBUyxDQUFDYSxLQUFWLENBQWdCaEIsT0FBaEIsRUFBeUJDLFVBQVUsSUFBSSxFQUF2QyxDQUFiLEVBQXlEUyxJQUF6RCxFQUFELENBQUo7QUFDSCxHQUxNLENBQVA7QUFNSCxDQVBEOztBQVFBTyxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVYLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDLEUsQ0FDQTs7QUFDQSxNQUFNWSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQXhCOztBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLHdCQUFELENBQXpCOztBQUNBLE1BQU1FLFdBQVcsR0FBR0YsT0FBTyxDQUFDLHFCQUFELENBQTNCOztBQUNBLE1BQU1HLE9BQU8sR0FBR0gsT0FBTyxDQUFDLGlCQUFELENBQXZCOztBQUNBLE1BQU1JLHdCQUFOLENBQStCO0FBQzNCO0FBQ0FDLEVBQUFBLFdBQVcsQ0FBQ0MsWUFBRCxFQUFlQyxjQUFmLEVBQStCQyxxQkFBL0IsRUFBc0Q7QUFDN0QsU0FBS0YsWUFBTCxHQUFvQkEsWUFBcEI7QUFDQSxTQUFLQyxjQUFMLEdBQXNCQSxjQUF0QjtBQUNBLFNBQUtDLHFCQUFMLEdBQTZCQSxxQkFBN0I7QUFDSDs7QUFDRCxNQUFJQyxxQkFBSixHQUE0QjtBQUN4QixXQUFPLEtBQUtILFlBQUwsQ0FBa0JJLEtBQXpCO0FBQ0g7O0FBQ0RDLEVBQUFBLGlCQUFpQixDQUFDQyxRQUFELEVBQVdDLEtBQVgsRUFBa0I7QUFDL0IsV0FBT25DLFNBQVMsQ0FBQyxJQUFELEVBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ2hELFlBQU1vQyxPQUFPLEdBQUdmLFFBQVEsQ0FBQ2dCLFNBQVQsQ0FBbUJDLGtCQUFuQixDQUFzQ0osUUFBUSxDQUFDSyxHQUEvQyxDQUFoQjs7QUFDQSxVQUFJLENBQUNILE9BQUwsRUFBYztBQUNWLGVBQU8sRUFBUDtBQUNIOztBQUNELFlBQU1JLFNBQVMsR0FBRyxLQUFLVixxQkFBTCxDQUEyQlcsUUFBM0IsQ0FBb0NMLE9BQU8sQ0FBQ0csR0FBNUMsQ0FBbEI7O0FBQ0EsVUFBSSxDQUFDQyxTQUFELElBQWNBLFNBQVMsQ0FBQ0UsU0FBVixDQUFvQkMsTUFBcEIsS0FBK0IsQ0FBN0MsSUFBa0RILFNBQVMsQ0FBQ0ksYUFBVixDQUF3QkQsTUFBeEIsS0FBbUMsQ0FBekYsRUFBNEY7QUFDeEYsZUFBTyxFQUFQO0FBQ0g7O0FBQ0QsWUFBTUUsY0FBYyxHQUFHLElBQUl4QixRQUFRLENBQUN5Qix1QkFBYixFQUF2QjtBQUNBWCxNQUFBQSxLQUFLLENBQUNZLHVCQUFOLENBQThCLE1BQU07QUFBRUYsUUFBQUEsY0FBYyxDQUFDRyxNQUFmO0FBQTBCLE9BQWhFLEVBVmdELENBV2hEO0FBQ0E7O0FBQ0FDLE1BQUFBLFVBQVUsQ0FBQyxNQUFNO0FBQ2IsWUFBSSxDQUFDSixjQUFjLENBQUNWLEtBQWYsQ0FBcUJlLHVCQUExQixFQUFtRDtBQUMvQ0wsVUFBQUEsY0FBYyxDQUFDRyxNQUFmO0FBQ0g7QUFDSixPQUpTLEVBSVB6QixTQUFTLENBQUM0QixNQUFWLENBQWlCQyx3QkFKVixDQUFWO0FBS0EsYUFBTyxLQUFLQyxhQUFMLENBQW1CbkIsUUFBbkIsRUFBNkJXLGNBQWMsQ0FBQ1YsS0FBNUMsRUFBbUQsS0FBS04sY0FBeEQsQ0FBUDtBQUNILEtBbkJlLENBQWhCO0FBb0JIOztBQUNEeUIsRUFBQUEsZUFBZSxDQUFDQyxRQUFELEVBQVdwQixLQUFYLEVBQWtCO0FBQzdCb0IsSUFBQUEsUUFBUSxDQUFDQyxPQUFULEdBQW1CO0FBQUVBLE1BQUFBLE9BQU8sRUFBRSxpQkFBWDtBQUE4QkMsTUFBQUEsS0FBSyxFQUFFO0FBQXJDLEtBQW5CO0FBQ0EsV0FBT3BELE9BQU8sQ0FBQ0MsT0FBUixDQUFnQmlELFFBQWhCLENBQVA7QUFDSDs7QUFDREYsRUFBQUEsYUFBYSxDQUFDbkIsUUFBRCxFQUFXQyxLQUFYLEVBQWtCTixjQUFsQixFQUFrQztBQUMzQyxXQUFPN0IsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEQsWUFBTW9DLE9BQU8sR0FBR2YsUUFBUSxDQUFDZ0IsU0FBVCxDQUFtQkMsa0JBQW5CLENBQXNDSixRQUFRLENBQUNLLEdBQS9DLENBQWhCOztBQUNBLFVBQUksQ0FBQ0gsT0FBTCxFQUFjO0FBQ1YsZUFBTyxFQUFQO0FBQ0g7O0FBQ0QsWUFBTXNCLEtBQUssR0FBRyxLQUFLNUIscUJBQUwsQ0FBMkJXLFFBQTNCLENBQW9DTCxPQUFPLENBQUNHLEdBQTVDLENBQWQ7O0FBQ0EsVUFBSSxDQUFDbUIsS0FBTCxFQUFZO0FBQ1IsZUFBTyxFQUFQO0FBQ0g7O0FBQ0QsWUFBTUMsSUFBSSxHQUFHRCxLQUFLLENBQUNoQixTQUFOLENBQWdCa0IsSUFBaEIsQ0FBcUJDLElBQUksSUFBSUEsSUFBSSxDQUFDQyxRQUFMLEtBQWtCNUIsUUFBUSxDQUFDSyxHQUFULENBQWF3QixNQUE1RCxDQUFiOztBQUNBLFVBQUksQ0FBQ0osSUFBTCxFQUFXO0FBQ1AsZUFBTyxFQUFQO0FBQ0g7O0FBQ0QsWUFBTUssaUJBQWlCLEdBQUdDLG1DQUFtQyxDQUFDTixJQUFELENBQTdEOztBQUNBLFVBQUk7QUFDQSxjQUFNTyxPQUFPLEdBQUksTUFBTXJDLGNBQWMsQ0FBQ3NDLHNCQUFmLENBQXNDakMsUUFBdEMsRUFBZ0RDLEtBQWhELENBQXZCOztBQUNBLFlBQUksQ0FBQytCLE9BQUwsRUFBYztBQUNWLGlCQUFPLEVBQVA7QUFDSDs7QUFDRCxlQUFPQSxPQUFPLENBQ1RFLE1BREUsQ0FDS0MsTUFBTSxJQUFJQSxNQUFNLENBQUNDLElBQVAsS0FBZ0JqRCxRQUFRLENBQUNrRCxVQUFULENBQW9CQyxRQUFwQyxJQUNsQkgsTUFBTSxDQUFDQyxJQUFQLEtBQWdCakQsUUFBUSxDQUFDa0QsVUFBVCxDQUFvQkUsTUFEbEIsSUFFbEJKLE1BQU0sQ0FBQ0MsSUFBUCxLQUFnQmpELFFBQVEsQ0FBQ2tELFVBQVQsQ0FBb0JHLEtBSGpDLEVBSUZDLEdBSkUsQ0FJRU4sTUFBTSxJQUFJO0FBQ2Y7QUFDQTtBQUNBLGdCQUFNTyxLQUFLLEdBQUcsSUFBSXZELFFBQVEsQ0FBQ3dELEtBQWIsQ0FBbUJSLE1BQU0sQ0FBQ1MsUUFBUCxDQUFnQkYsS0FBaEIsQ0FBc0JHLEtBQXpDLEVBQWdELElBQUkxRCxRQUFRLENBQUMyRCxRQUFiLENBQXNCWCxNQUFNLENBQUNTLFFBQVAsQ0FBZ0JGLEtBQWhCLENBQXNCSyxHQUF0QixDQUEwQkMsSUFBaEQsRUFBc0RiLE1BQU0sQ0FBQ1MsUUFBUCxDQUFnQkYsS0FBaEIsQ0FBc0JLLEdBQXRCLENBQTBCRSxTQUExQixHQUFzQyxDQUE1RixDQUFoRCxDQUFkO0FBQ0EsaUJBQU8sS0FBS0MsV0FBTCxDQUFpQmxELFFBQVEsQ0FBQ0ssR0FBMUIsRUFBK0J5QixpQkFBL0IsRUFBa0RZLEtBQWxELEVBQXlEUCxNQUFNLENBQUNnQixJQUFoRSxFQUFzRWhCLE1BQU0sQ0FBQ0MsSUFBN0UsRUFBbUZELE1BQU0sQ0FBQ2lCLGFBQTFGLENBQVA7QUFDSCxTQVRNLEVBVUZDLE1BVkUsQ0FVSyxDQUFDQyxRQUFELEVBQVdDLE9BQVgsS0FBdUJELFFBQVEsQ0FBQ0UsTUFBVCxDQUFnQkQsT0FBaEIsQ0FWNUIsRUFVc0QsRUFWdEQsRUFXRnJCLE1BWEUsQ0FXS2IsUUFBUSxJQUFJQSxRQUFRLEtBQUssSUFYOUIsQ0FBUDtBQVlILE9BakJELENBa0JBLE9BQU9vQyxNQUFQLEVBQWU7QUFDWCxZQUFJeEQsS0FBSyxDQUFDZSx1QkFBVixFQUFtQztBQUMvQixpQkFBTyxFQUFQO0FBQ0g7O0FBQ0QsZUFBTzdDLE9BQU8sQ0FBQ0UsTUFBUixDQUFlb0YsTUFBZixDQUFQO0FBQ0g7QUFDSixLQXRDZSxDQUFoQjtBQXVDSDs7QUFDRFAsRUFBQUEsV0FBVyxDQUFDekIsSUFBRCxFQUFPSyxpQkFBUCxFQUEwQlksS0FBMUIsRUFBaUNnQixVQUFqQyxFQUE2Q0MsVUFBN0MsRUFBeURDLGVBQXpELEVBQTBFO0FBQ2pGLFlBQVFELFVBQVI7QUFDSSxXQUFLeEUsUUFBUSxDQUFDa0QsVUFBVCxDQUFvQkMsUUFBekI7QUFDQSxXQUFLbkQsUUFBUSxDQUFDa0QsVUFBVCxDQUFvQkUsTUFBekI7QUFBaUM7QUFDN0IsaUJBQU9zQixtQkFBbUIsQ0FBQ3BDLElBQUQsRUFBT0ssaUJBQVAsRUFBMEI0QixVQUExQixFQUFzQ2hCLEtBQXRDLEVBQTZDa0IsZUFBN0MsQ0FBMUI7QUFDSDs7QUFDRCxXQUFLekUsUUFBUSxDQUFDa0QsVUFBVCxDQUFvQkcsS0FBekI7QUFBZ0M7QUFDNUIsZ0JBQU1zQixHQUFHLEdBQUdoQyxpQkFBaUIsQ0FBQ2lDLE1BQWxCLENBQXlCckMsSUFBekIsQ0FBOEJDLElBQUksSUFBSUEsSUFBSSxDQUFDd0IsSUFBTCxLQUFjTyxVQUFwRCxDQUFaOztBQUNBLGNBQUksQ0FBQ0ksR0FBTCxFQUFVO0FBQ04sbUJBQU8sRUFBUDtBQUNIOztBQUNELGlCQUFPLENBQ0gsSUFBSTNFLFFBQVEsQ0FBQzZFLFFBQWIsQ0FBc0J0QixLQUF0QixFQUE2QjtBQUN6Qm5CLFlBQUFBLEtBQUssRUFBRTBDLGlCQUFpQixDQUFDSCxHQUFHLENBQUNJLE1BQUwsQ0FBakIsR0FBZ0M3RSxTQUFTLENBQUM4RSxJQUFWLENBQWVDLG1CQUQ3QjtBQUV6QjlDLFlBQUFBLE9BQU8sRUFBRWpDLFNBQVMsQ0FBQ2dGLFFBQVYsQ0FBbUJDLFNBRkg7QUFHekJDLFlBQUFBLFNBQVMsRUFBRSxDQUFDQyxTQUFELEVBQVlsRixXQUFXLENBQUNtRixhQUFaLENBQTBCQyxRQUF0QyxFQUFnRGpELElBQWhELEVBQXNEO0FBQUVrRCxjQUFBQSxTQUFTLEVBQUUsQ0FBQ2IsR0FBRDtBQUFiLGFBQXREO0FBSGMsV0FBN0IsQ0FERyxFQU1ILElBQUkzRSxRQUFRLENBQUM2RSxRQUFiLENBQXNCdEIsS0FBdEIsRUFBNkI7QUFDekJuQixZQUFBQSxLQUFLLEVBQUUwQyxpQkFBaUIsQ0FBQ0gsR0FBRyxDQUFDSSxNQUFMLENBQWpCLEdBQWdDN0UsU0FBUyxDQUFDOEUsSUFBVixDQUFlUyxxQkFEN0I7QUFFekJ0RCxZQUFBQSxPQUFPLEVBQUVqQyxTQUFTLENBQUNnRixRQUFWLENBQW1CUSxXQUZIO0FBR3pCTixZQUFBQSxTQUFTLEVBQUUsQ0FBQ0MsU0FBRCxFQUFZbEYsV0FBVyxDQUFDbUYsYUFBWixDQUEwQkMsUUFBdEMsRUFBZ0RqRCxJQUFoRCxFQUFzRDtBQUFFa0QsY0FBQUEsU0FBUyxFQUFFLENBQUNiLEdBQUQ7QUFBYixhQUF0RDtBQUhjLFdBQTdCLENBTkcsQ0FBUDtBQVlIOztBQUNEO0FBQVM7QUFDTCxpQkFBTyxFQUFQO0FBQ0g7QUF6Qkw7QUEyQkg7O0FBekcwQjs7QUEyRy9CNUUsT0FBTyxDQUFDTSx3QkFBUixHQUFtQ0Esd0JBQW5DOztBQUNBLFNBQVN5RSxpQkFBVCxDQUEyQkMsTUFBM0IsRUFBbUM7QUFDL0IsVUFBUUEsTUFBUjtBQUNJLFNBQUszRSxPQUFPLENBQUN1RixVQUFSLENBQW1CQyxJQUF4QjtBQUE4QjtBQUMxQixlQUFPLElBQVA7QUFDSDs7QUFDRCxTQUFLeEYsT0FBTyxDQUFDdUYsVUFBUixDQUFtQkUsS0FBeEI7QUFDQSxTQUFLekYsT0FBTyxDQUFDdUYsVUFBUixDQUFtQkcsSUFBeEI7QUFBOEI7QUFDMUIsZUFBTyxJQUFQO0FBQ0g7O0FBQ0QsU0FBSzFGLE9BQU8sQ0FBQ3VGLFVBQVIsQ0FBbUJJLE9BQXhCO0FBQWlDO0FBQzdCLGVBQU8sSUFBUDtBQUNIOztBQUNEO0FBQVM7QUFDTCxlQUFPLEVBQVA7QUFDSDtBQWJMO0FBZUg7O0FBQ0QsU0FBU0Msa0JBQVQsQ0FBNEJDLEdBQTVCLEVBQWlDO0FBQzdCLFFBQU1DLFFBQVEsR0FBRyxFQUFqQjtBQUNBLE1BQUlDLEtBQUssR0FBR0YsR0FBRyxDQUFDbEQsTUFBSixDQUFXcUQsRUFBRSxJQUFJQSxFQUFFLENBQUNyQixNQUFILEtBQWMzRSxPQUFPLENBQUN1RixVQUFSLENBQW1CQyxJQUFsRCxFQUF3RHRFLE1BQXBFOztBQUNBLE1BQUk2RSxLQUFLLEdBQUcsQ0FBWixFQUFlO0FBQ1hELElBQUFBLFFBQVEsQ0FBQ0csSUFBVCxDQUFlLEtBQUlGLEtBQU0sRUFBekI7QUFDSDs7QUFDREEsRUFBQUEsS0FBSyxHQUFHRixHQUFHLENBQUNsRCxNQUFKLENBQVdxRCxFQUFFLElBQUlBLEVBQUUsQ0FBQ3JCLE1BQUgsS0FBYzNFLE9BQU8sQ0FBQ3VGLFVBQVIsQ0FBbUJFLEtBQWpDLElBQTBDTyxFQUFFLENBQUNyQixNQUFILEtBQWMzRSxPQUFPLENBQUN1RixVQUFSLENBQW1CRyxJQUE1RixFQUFrR3hFLE1BQTFHOztBQUNBLE1BQUk2RSxLQUFLLEdBQUcsQ0FBWixFQUFlO0FBQ1hELElBQUFBLFFBQVEsQ0FBQ0csSUFBVCxDQUFlLEtBQUlGLEtBQU0sRUFBekI7QUFDSDs7QUFDREEsRUFBQUEsS0FBSyxHQUFHRixHQUFHLENBQUNsRCxNQUFKLENBQVdxRCxFQUFFLElBQUlBLEVBQUUsQ0FBQ3JCLE1BQUgsS0FBYzNFLE9BQU8sQ0FBQ3VGLFVBQVIsQ0FBbUJJLE9BQWxELEVBQTJEekUsTUFBbkU7O0FBQ0EsTUFBSTZFLEtBQUssR0FBRyxDQUFaLEVBQWU7QUFDWEQsSUFBQUEsUUFBUSxDQUFDRyxJQUFULENBQWUsS0FBSUYsS0FBTSxFQUF6QjtBQUNIOztBQUNELFNBQU9ELFFBQVEsQ0FBQ0ksSUFBVCxDQUFjLEdBQWQsQ0FBUDtBQUNIOztBQUNELFNBQVM1QixtQkFBVCxDQUE2QnBDLElBQTdCLEVBQW1DaUUsa0JBQW5DLEVBQXVEaEMsVUFBdkQsRUFBbUVoQixLQUFuRSxFQUEwRWtCLGVBQTFFLEVBQTJGO0FBQ3ZGLE1BQUkyQixFQUFKOztBQUNBLE1BQUkzQixlQUFlLENBQUNuRCxNQUFoQixLQUEyQixDQUEvQixFQUFrQztBQUM5QjhFLElBQUFBLEVBQUUsR0FBR0csa0JBQWtCLENBQUNDLFNBQW5CLENBQTZCakUsSUFBN0IsQ0FBa0NrRSxJQUFJLElBQUlBLElBQUksQ0FBQ3pDLElBQUwsS0FBY08sVUFBeEQsQ0FBTDtBQUNILEdBRkQsTUFHSztBQUNEO0FBQ0FnQyxJQUFBQSxrQkFBa0IsQ0FBQzNCLE1BQW5CLENBQ0s3QixNQURMLENBQ1kyRCxDQUFDLElBQUlBLENBQUMsQ0FBQzFDLElBQUYsS0FBV1MsZUFENUIsRUFFS2tDLE9BRkwsQ0FFYUQsQ0FBQyxJQUFJO0FBQ2QsWUFBTUUsQ0FBQyxHQUFHRixDQUFDLENBQUNGLFNBQUYsQ0FBWWpFLElBQVosQ0FBaUJDLElBQUksSUFBSUEsSUFBSSxDQUFDd0IsSUFBTCxLQUFjTyxVQUF2QyxDQUFWOztBQUNBLFVBQUlxQyxDQUFKLEVBQU87QUFDSFIsUUFBQUEsRUFBRSxHQUFHUSxDQUFMO0FBQ0g7QUFDSixLQVBEO0FBUUg7O0FBQ0QsTUFBSVIsRUFBSixFQUFRO0FBQ0osV0FBTyxDQUNILElBQUlwRyxRQUFRLENBQUM2RSxRQUFiLENBQXNCdEIsS0FBdEIsRUFBNkI7QUFDekJuQixNQUFBQSxLQUFLLEVBQUUwQyxpQkFBaUIsQ0FBQ3NCLEVBQUUsQ0FBQ3JCLE1BQUosQ0FBakIsR0FBK0I3RSxTQUFTLENBQUM4RSxJQUFWLENBQWVDLG1CQUQ1QjtBQUV6QjlDLE1BQUFBLE9BQU8sRUFBRWpDLFNBQVMsQ0FBQ2dGLFFBQVYsQ0FBbUJDLFNBRkg7QUFHekJDLE1BQUFBLFNBQVMsRUFBRSxDQUFDQyxTQUFELEVBQVlsRixXQUFXLENBQUNtRixhQUFaLENBQTBCQyxRQUF0QyxFQUFnRGpELElBQWhELEVBQXNEO0FBQUV1RSxRQUFBQSxZQUFZLEVBQUUsQ0FBQ1QsRUFBRDtBQUFoQixPQUF0RDtBQUhjLEtBQTdCLENBREcsRUFNSCxJQUFJcEcsUUFBUSxDQUFDNkUsUUFBYixDQUFzQnRCLEtBQXRCLEVBQTZCO0FBQ3pCbkIsTUFBQUEsS0FBSyxFQUFFMEMsaUJBQWlCLENBQUNzQixFQUFFLENBQUNyQixNQUFKLENBQWpCLEdBQStCN0UsU0FBUyxDQUFDOEUsSUFBVixDQUFlUyxxQkFENUI7QUFFekJ0RCxNQUFBQSxPQUFPLEVBQUVqQyxTQUFTLENBQUNnRixRQUFWLENBQW1CUSxXQUZIO0FBR3pCTixNQUFBQSxTQUFTLEVBQUUsQ0FBQ0MsU0FBRCxFQUFZbEYsV0FBVyxDQUFDbUYsYUFBWixDQUEwQkMsUUFBdEMsRUFBZ0RqRCxJQUFoRCxFQUFzRDtBQUFFdUUsUUFBQUEsWUFBWSxFQUFFLENBQUNULEVBQUQ7QUFBaEIsT0FBdEQ7QUFIYyxLQUE3QixDQU5HLENBQVA7QUFZSCxHQTdCc0YsQ0E4QnZGO0FBQ0E7OztBQUNBLFFBQU1JLFNBQVMsR0FBR0Qsa0JBQWtCLENBQUNDLFNBQW5CLENBQTZCekQsTUFBN0IsQ0FBb0MwRCxJQUFJLElBQUlBLElBQUksQ0FBQ3pDLElBQUwsQ0FBVThDLFVBQVYsQ0FBc0IsR0FBRXZDLFVBQVcsR0FBbkMsS0FBMENrQyxJQUFJLENBQUN6QyxJQUFMLENBQVUrQyxRQUFWLENBQW1CLEdBQW5CLENBQXRGLENBQWxCOztBQUNBLE1BQUlQLFNBQVMsQ0FBQ2xGLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFDeEIsV0FBTyxFQUFQO0FBQ0g7O0FBQ0QsTUFBSWtGLFNBQVMsQ0FBQ2xGLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFDeEIsV0FBTyxDQUNILElBQUl0QixRQUFRLENBQUM2RSxRQUFiLENBQXNCdEIsS0FBdEIsRUFBNkI7QUFDekJuQixNQUFBQSxLQUFLLEVBQUVsQyxTQUFTLENBQUM4RSxJQUFWLENBQWVDLG1CQURHO0FBRXpCOUMsTUFBQUEsT0FBTyxFQUFFakMsU0FBUyxDQUFDZ0YsUUFBVixDQUFtQkMsU0FGSDtBQUd6QkMsTUFBQUEsU0FBUyxFQUFFLENBQUNDLFNBQUQsRUFBWWxGLFdBQVcsQ0FBQ21GLGFBQVosQ0FBMEJDLFFBQXRDLEVBQWdEakQsSUFBaEQsRUFBc0Q7QUFBRXVFLFFBQUFBLFlBQVksRUFBRUw7QUFBaEIsT0FBdEQ7QUFIYyxLQUE3QixDQURHLEVBTUgsSUFBSXhHLFFBQVEsQ0FBQzZFLFFBQWIsQ0FBc0J0QixLQUF0QixFQUE2QjtBQUN6Qm5CLE1BQUFBLEtBQUssRUFBRWxDLFNBQVMsQ0FBQzhFLElBQVYsQ0FBZVMscUJBREc7QUFFekJ0RCxNQUFBQSxPQUFPLEVBQUVqQyxTQUFTLENBQUNnRixRQUFWLENBQW1CUSxXQUZIO0FBR3pCTixNQUFBQSxTQUFTLEVBQUUsQ0FBQ0MsU0FBRCxFQUFZbEYsV0FBVyxDQUFDbUYsYUFBWixDQUEwQkMsUUFBdEMsRUFBZ0RqRCxJQUFoRCxFQUFzRDtBQUFFdUUsUUFBQUEsWUFBWSxFQUFFTDtBQUFoQixPQUF0RDtBQUhjLEtBQTdCLENBTkcsQ0FBUDtBQVlILEdBakRzRixDQWtEdkY7OztBQUNBLFNBQU8sQ0FDSCxJQUFJeEcsUUFBUSxDQUFDNkUsUUFBYixDQUFzQnRCLEtBQXRCLEVBQTZCO0FBQ3pCbkIsSUFBQUEsS0FBSyxFQUFHLEdBQUU0RCxrQkFBa0IsQ0FBQ1EsU0FBRCxDQUFZLEdBQUV0RyxTQUFTLENBQUM4RSxJQUFWLENBQWVDLG1CQUFvQixhQURwRDtBQUV6QjlDLElBQUFBLE9BQU8sRUFBRWpDLFNBQVMsQ0FBQ2dGLFFBQVYsQ0FBbUI4QixlQUZIO0FBR3pCNUIsSUFBQUEsU0FBUyxFQUFFLENBQUNDLFNBQUQsRUFBWWxGLFdBQVcsQ0FBQ21GLGFBQVosQ0FBMEJDLFFBQXRDLEVBQWdEakQsSUFBaEQsRUFBc0RrRSxTQUF0RDtBQUhjLEdBQTdCLENBREcsRUFNSCxJQUFJeEcsUUFBUSxDQUFDNkUsUUFBYixDQUFzQnRCLEtBQXRCLEVBQTZCO0FBQ3pCbkIsSUFBQUEsS0FBSyxFQUFHLEdBQUU0RCxrQkFBa0IsQ0FBQ1EsU0FBRCxDQUFZLEdBQUV0RyxTQUFTLENBQUM4RSxJQUFWLENBQWVTLHFCQUFzQixhQUR0RDtBQUV6QnRELElBQUFBLE9BQU8sRUFBRWpDLFNBQVMsQ0FBQ2dGLFFBQVYsQ0FBbUIrQixxQkFGSDtBQUd6QjdCLElBQUFBLFNBQVMsRUFBRSxDQUFDQyxTQUFELEVBQVlsRixXQUFXLENBQUNtRixhQUFaLENBQTBCQyxRQUF0QyxFQUFnRGpELElBQWhELEVBQXNEa0UsU0FBdEQ7QUFIYyxHQUE3QixDQU5HLENBQVA7QUFZSDs7QUFDRCxTQUFTNUQsbUNBQVQsQ0FBNkNzRSxRQUE3QyxFQUF1RDtBQUNuRDtBQUNBLFFBQU1DLEdBQUcsR0FBRztBQUFFWCxJQUFBQSxTQUFTLEVBQUVVLFFBQVEsQ0FBQ1YsU0FBdEI7QUFBaUM1QixJQUFBQSxNQUFNLEVBQUU7QUFBekMsR0FBWjtBQUNBc0MsRUFBQUEsUUFBUSxDQUFDdEMsTUFBVCxDQUFnQitCLE9BQWhCLENBQXdCUyxLQUFLLElBQUk7QUFDN0JELElBQUFBLEdBQUcsQ0FBQ3ZDLE1BQUosQ0FBV3lCLElBQVgsQ0FBZ0JlLEtBQWhCO0FBQ0EsVUFBTUMsYUFBYSxHQUFHQyw0QkFBNEIsQ0FBQ0YsS0FBRCxDQUFsRDtBQUNBRCxJQUFBQSxHQUFHLENBQUNYLFNBQUosQ0FBY0gsSUFBZCxDQUFtQixHQUFHZ0IsYUFBYSxDQUFDYixTQUFwQztBQUNBVyxJQUFBQSxHQUFHLENBQUN2QyxNQUFKLENBQVd5QixJQUFYLENBQWdCLEdBQUdnQixhQUFhLENBQUN6QyxNQUFqQztBQUNILEdBTEQ7QUFNQSxTQUFPdUMsR0FBUDtBQUNIOztBQUNELFNBQVNHLDRCQUFULENBQXNDOUIsU0FBdEMsRUFBaUQ7QUFDN0MsUUFBTTJCLEdBQUcsR0FBRztBQUFFWCxJQUFBQSxTQUFTLEVBQUUsRUFBYjtBQUFpQjVCLElBQUFBLE1BQU0sRUFBRTtBQUF6QixHQUFaO0FBQ0FZLEVBQUFBLFNBQVMsQ0FBQ2dCLFNBQVYsQ0FBb0JHLE9BQXBCLENBQTRCUCxFQUFFLElBQUk7QUFDOUJlLElBQUFBLEdBQUcsQ0FBQ1gsU0FBSixDQUFjSCxJQUFkLENBQW1CRCxFQUFuQjtBQUNILEdBRkQ7QUFHQVosRUFBQUEsU0FBUyxDQUFDWixNQUFWLENBQWlCK0IsT0FBakIsQ0FBeUJTLEtBQUssSUFBSTtBQUM5QkQsSUFBQUEsR0FBRyxDQUFDdkMsTUFBSixDQUFXeUIsSUFBWCxDQUFnQmUsS0FBaEI7QUFDQSxVQUFNQyxhQUFhLEdBQUdDLDRCQUE0QixDQUFDRixLQUFELENBQWxEO0FBQ0FELElBQUFBLEdBQUcsQ0FBQ1gsU0FBSixDQUFjSCxJQUFkLENBQW1CLEdBQUdnQixhQUFhLENBQUNiLFNBQXBDO0FBQ0FXLElBQUFBLEdBQUcsQ0FBQ3ZDLE1BQUosQ0FBV3lCLElBQVgsQ0FBZ0IsR0FBR2dCLGFBQWEsQ0FBQ3pDLE1BQWpDO0FBQ0gsR0FMRDtBQU1BLFNBQU91QyxHQUFQO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gdHNsaW50OmRpc2FibGU6bm8tb2JqZWN0LWxpdGVyYWwtdHlwZS1hc3NlcnRpb25cclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCBjb25zdGFudHMgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vdHlwZXNcIik7XHJcbmNsYXNzIFRlc3RGaWxlQ29kZUxlbnNQcm92aWRlciB7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxyXG4gICAgY29uc3RydWN0b3IoX29uRGlkQ2hhbmdlLCBzeW1ib2xQcm92aWRlciwgdGVzdENvbGxlY3Rpb25TdG9yYWdlKSB7XHJcbiAgICAgICAgdGhpcy5fb25EaWRDaGFuZ2UgPSBfb25EaWRDaGFuZ2U7XHJcbiAgICAgICAgdGhpcy5zeW1ib2xQcm92aWRlciA9IHN5bWJvbFByb3ZpZGVyO1xyXG4gICAgICAgIHRoaXMudGVzdENvbGxlY3Rpb25TdG9yYWdlID0gdGVzdENvbGxlY3Rpb25TdG9yYWdlO1xyXG4gICAgfVxyXG4gICAgZ2V0IG9uRGlkQ2hhbmdlQ29kZUxlbnNlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb25EaWRDaGFuZ2UuZXZlbnQ7XHJcbiAgICB9XHJcbiAgICBwcm92aWRlQ29kZUxlbnNlcyhkb2N1bWVudCwgdG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCB3a3NwYWNlID0gdnNjb2RlXzEud29ya3NwYWNlLmdldFdvcmtzcGFjZUZvbGRlcihkb2N1bWVudC51cmkpO1xyXG4gICAgICAgICAgICBpZiAoIXdrc3BhY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0ZXN0SXRlbXMgPSB0aGlzLnRlc3RDb2xsZWN0aW9uU3RvcmFnZS5nZXRUZXN0cyh3a3NwYWNlLnVyaSk7XHJcbiAgICAgICAgICAgIGlmICghdGVzdEl0ZW1zIHx8IHRlc3RJdGVtcy50ZXN0RmlsZXMubGVuZ3RoID09PSAwIHx8IHRlc3RJdGVtcy50ZXN0RnVuY3Rpb25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbmNlbFRva2VuU3JjID0gbmV3IHZzY29kZV8xLkNhbmNlbGxhdGlvblRva2VuU291cmNlKCk7XHJcbiAgICAgICAgICAgIHRva2VuLm9uQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKCgpID0+IHsgY2FuY2VsVG9rZW5TcmMuY2FuY2VsKCk7IH0pO1xyXG4gICAgICAgICAgICAvLyBTdHJvcCB0cnlpbmcgdG8gYnVpbGQgdGhlIGNvZGUgbGVuc2VzIGlmIHVuYWJsZSB0byBnZXQgYSBsaXN0IG9mXHJcbiAgICAgICAgICAgIC8vIHN5bWJvbHMgaW4gdGhpcyBmaWxlIGFmcmVyIHggdGltZS5cclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNhbmNlbFRva2VuU3JjLnRva2VuLmlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVG9rZW5TcmMuY2FuY2VsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGNvbnN0YW50cy5EZWxheXMuTWF4VW5pdFRlc3RDb2RlTGVuc0RlbGF5KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29kZUxlbnNlcyhkb2N1bWVudCwgY2FuY2VsVG9rZW5TcmMudG9rZW4sIHRoaXMuc3ltYm9sUHJvdmlkZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmVzb2x2ZUNvZGVMZW5zKGNvZGVMZW5zLCB0b2tlbikge1xyXG4gICAgICAgIGNvZGVMZW5zLmNvbW1hbmQgPSB7IGNvbW1hbmQ6ICdweXRob24ucnVudGVzdHMnLCB0aXRsZTogJ1Rlc3QnIH07XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb2RlTGVucyk7XHJcbiAgICB9XHJcbiAgICBnZXRDb2RlTGVuc2VzKGRvY3VtZW50LCB0b2tlbiwgc3ltYm9sUHJvdmlkZXIpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCB3a3NwYWNlID0gdnNjb2RlXzEud29ya3NwYWNlLmdldFdvcmtzcGFjZUZvbGRlcihkb2N1bWVudC51cmkpO1xyXG4gICAgICAgICAgICBpZiAoIXdrc3BhY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0ZXN0cyA9IHRoaXMudGVzdENvbGxlY3Rpb25TdG9yYWdlLmdldFRlc3RzKHdrc3BhY2UudXJpKTtcclxuICAgICAgICAgICAgaWYgKCF0ZXN0cykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0ZXN0cy50ZXN0RmlsZXMuZmluZChpdGVtID0+IGl0ZW0uZnVsbFBhdGggPT09IGRvY3VtZW50LnVyaS5mc1BhdGgpO1xyXG4gICAgICAgICAgICBpZiAoIWZpbGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBhbGxGdW5jc0FuZFN1aXRlcyA9IGdldEFsbFRlc3RTdWl0ZXNBbmRGdW5jdGlvbnNQZXJGaWxlKGZpbGUpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3ltYm9scyA9ICh5aWVsZCBzeW1ib2xQcm92aWRlci5wcm92aWRlRG9jdW1lbnRTeW1ib2xzKGRvY3VtZW50LCB0b2tlbikpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzeW1ib2xzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN5bWJvbHNcclxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKHN5bWJvbCA9PiBzeW1ib2wua2luZCA9PT0gdnNjb2RlXzEuU3ltYm9sS2luZC5GdW5jdGlvbiB8fFxyXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbC5raW5kID09PSB2c2NvZGVfMS5TeW1ib2xLaW5kLk1ldGhvZCB8fFxyXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbC5raW5kID09PSB2c2NvZGVfMS5TeW1ib2xLaW5kLkNsYXNzKVxyXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoc3ltYm9sID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGJsb29keSBjcnVjaWFsLCBpZiB0aGUgc3RhcnQgYW5kIGVuZCBjb2x1bW5zIGFyZSB0aGUgc2FtZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gdnNjb2RlIGdvZXMgYm9ua2VycyB3aGVuIGV2ZXIgeW91IGVkaXQgYSBsaW5lIChzdGFydCBzY3JvbGxpbmcgbWFnaWNhbGx5KS5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IG5ldyB2c2NvZGVfMS5SYW5nZShzeW1ib2wubG9jYXRpb24ucmFuZ2Uuc3RhcnQsIG5ldyB2c2NvZGVfMS5Qb3NpdGlvbihzeW1ib2wubG9jYXRpb24ucmFuZ2UuZW5kLmxpbmUsIHN5bWJvbC5sb2NhdGlvbi5yYW5nZS5lbmQuY2hhcmFjdGVyICsgMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldENvZGVMZW5zKGRvY3VtZW50LnVyaSwgYWxsRnVuY3NBbmRTdWl0ZXMsIHJhbmdlLCBzeW1ib2wubmFtZSwgc3ltYm9sLmtpbmQsIHN5bWJvbC5jb250YWluZXJOYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnJlZHVjZSgocHJldmlvdXMsIGN1cnJlbnQpID0+IHByZXZpb3VzLmNvbmNhdChjdXJyZW50KSwgW10pXHJcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihjb2RlTGVucyA9PiBjb2RlTGVucyAhPT0gbnVsbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRva2VuLmlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGdldENvZGVMZW5zKGZpbGUsIGFsbEZ1bmNzQW5kU3VpdGVzLCByYW5nZSwgc3ltYm9sTmFtZSwgc3ltYm9sS2luZCwgc3ltYm9sQ29udGFpbmVyKSB7XHJcbiAgICAgICAgc3dpdGNoIChzeW1ib2xLaW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgdnNjb2RlXzEuU3ltYm9sS2luZC5GdW5jdGlvbjpcclxuICAgICAgICAgICAgY2FzZSB2c2NvZGVfMS5TeW1ib2xLaW5kLk1ldGhvZDoge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEZ1bmN0aW9uQ29kZUxlbnMoZmlsZSwgYWxsRnVuY3NBbmRTdWl0ZXMsIHN5bWJvbE5hbWUsIHJhbmdlLCBzeW1ib2xDb250YWluZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgdnNjb2RlXzEuU3ltYm9sS2luZC5DbGFzczoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2xzID0gYWxsRnVuY3NBbmRTdWl0ZXMuc3VpdGVzLmZpbmQoaXRlbSA9PiBpdGVtLm5hbWUgPT09IHN5bWJvbE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjbHMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAgICAgIG5ldyB2c2NvZGVfMS5Db2RlTGVucyhyYW5nZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZ2V0VGVzdFN0YXR1c0ljb24oY2xzLnN0YXR1cykgKyBjb25zdGFudHMuVGV4dC5Db2RlTGVuc1J1blVuaXRUZXN0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kOiBjb25zdGFudHMuQ29tbWFuZHMuVGVzdHNfUnVuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IFt1bmRlZmluZWQsIGNvbnN0YW50c18xLkNvbW1hbmRTb3VyY2UuY29kZWxlbnMsIGZpbGUsIHsgdGVzdFN1aXRlOiBbY2xzXSB9XVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyB2c2NvZGVfMS5Db2RlTGVucyhyYW5nZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZ2V0VGVzdFN0YXR1c0ljb24oY2xzLnN0YXR1cykgKyBjb25zdGFudHMuVGV4dC5Db2RlTGVuc0RlYnVnVW5pdFRlc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQ6IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19EZWJ1ZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBbdW5kZWZpbmVkLCBjb25zdGFudHNfMS5Db21tYW5kU291cmNlLmNvZGVsZW5zLCBmaWxlLCB7IHRlc3RTdWl0ZTogW2Nsc10gfV1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5UZXN0RmlsZUNvZGVMZW5zUHJvdmlkZXIgPSBUZXN0RmlsZUNvZGVMZW5zUHJvdmlkZXI7XHJcbmZ1bmN0aW9uIGdldFRlc3RTdGF0dXNJY29uKHN0YXR1cykge1xyXG4gICAgc3dpdGNoIChzdGF0dXMpIHtcclxuICAgICAgICBjYXNlIHR5cGVzXzEuVGVzdFN0YXR1cy5QYXNzOiB7XHJcbiAgICAgICAgICAgIHJldHVybiAn4pyUICc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhc2UgdHlwZXNfMS5UZXN0U3RhdHVzLkVycm9yOlxyXG4gICAgICAgIGNhc2UgdHlwZXNfMS5UZXN0U3RhdHVzLkZhaWw6IHtcclxuICAgICAgICAgICAgcmV0dXJuICfinJggJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSB0eXBlc18xLlRlc3RTdGF0dXMuU2tpcHBlZDoge1xyXG4gICAgICAgICAgICByZXR1cm4gJ+KDoCAnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0VGVzdFN0YXR1c0ljb25zKGZucykge1xyXG4gICAgY29uc3Qgc3RhdHVzZXMgPSBbXTtcclxuICAgIGxldCBjb3VudCA9IGZucy5maWx0ZXIoZm4gPT4gZm4uc3RhdHVzID09PSB0eXBlc18xLlRlc3RTdGF0dXMuUGFzcykubGVuZ3RoO1xyXG4gICAgaWYgKGNvdW50ID4gMCkge1xyXG4gICAgICAgIHN0YXR1c2VzLnB1c2goYOKclCAke2NvdW50fWApO1xyXG4gICAgfVxyXG4gICAgY291bnQgPSBmbnMuZmlsdGVyKGZuID0+IGZuLnN0YXR1cyA9PT0gdHlwZXNfMS5UZXN0U3RhdHVzLkVycm9yIHx8IGZuLnN0YXR1cyA9PT0gdHlwZXNfMS5UZXN0U3RhdHVzLkZhaWwpLmxlbmd0aDtcclxuICAgIGlmIChjb3VudCA+IDApIHtcclxuICAgICAgICBzdGF0dXNlcy5wdXNoKGDinJggJHtjb3VudH1gKTtcclxuICAgIH1cclxuICAgIGNvdW50ID0gZm5zLmZpbHRlcihmbiA9PiBmbi5zdGF0dXMgPT09IHR5cGVzXzEuVGVzdFN0YXR1cy5Ta2lwcGVkKS5sZW5ndGg7XHJcbiAgICBpZiAoY291bnQgPiAwKSB7XHJcbiAgICAgICAgc3RhdHVzZXMucHVzaChg4oOgICR7Y291bnR9YCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RhdHVzZXMuam9pbignICcpO1xyXG59XHJcbmZ1bmN0aW9uIGdldEZ1bmN0aW9uQ29kZUxlbnMoZmlsZSwgZnVuY3Rpb25zQW5kU3VpdGVzLCBzeW1ib2xOYW1lLCByYW5nZSwgc3ltYm9sQ29udGFpbmVyKSB7XHJcbiAgICBsZXQgZm47XHJcbiAgICBpZiAoc3ltYm9sQ29udGFpbmVyLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGZuID0gZnVuY3Rpb25zQW5kU3VpdGVzLmZ1bmN0aW9ucy5maW5kKGZ1bmMgPT4gZnVuYy5uYW1lID09PSBzeW1ib2xOYW1lKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIEFzc3VtZSBzaW5nbGUgbGV2ZWxzIGZvciBub3cuXHJcbiAgICAgICAgZnVuY3Rpb25zQW5kU3VpdGVzLnN1aXRlc1xyXG4gICAgICAgICAgICAuZmlsdGVyKHMgPT4gcy5uYW1lID09PSBzeW1ib2xDb250YWluZXIpXHJcbiAgICAgICAgICAgIC5mb3JFYWNoKHMgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmID0gcy5mdW5jdGlvbnMuZmluZChpdGVtID0+IGl0ZW0ubmFtZSA9PT0gc3ltYm9sTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChmKSB7XHJcbiAgICAgICAgICAgICAgICBmbiA9IGY7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChmbikge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgIG5ldyB2c2NvZGVfMS5Db2RlTGVucyhyYW5nZSwge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldFRlc3RTdGF0dXNJY29uKGZuLnN0YXR1cykgKyBjb25zdGFudHMuVGV4dC5Db2RlTGVuc1J1blVuaXRUZXN0LFxyXG4gICAgICAgICAgICAgICAgY29tbWFuZDogY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX1J1bixcclxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czogW3VuZGVmaW5lZCwgY29uc3RhbnRzXzEuQ29tbWFuZFNvdXJjZS5jb2RlbGVucywgZmlsZSwgeyB0ZXN0RnVuY3Rpb246IFtmbl0gfV1cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIG5ldyB2c2NvZGVfMS5Db2RlTGVucyhyYW5nZSwge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldFRlc3RTdGF0dXNJY29uKGZuLnN0YXR1cykgKyBjb25zdGFudHMuVGV4dC5Db2RlTGVuc0RlYnVnVW5pdFRlc3QsXHJcbiAgICAgICAgICAgICAgICBjb21tYW5kOiBjb25zdGFudHMuQ29tbWFuZHMuVGVzdHNfRGVidWcsXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IFt1bmRlZmluZWQsIGNvbnN0YW50c18xLkNvbW1hbmRTb3VyY2UuY29kZWxlbnMsIGZpbGUsIHsgdGVzdEZ1bmN0aW9uOiBbZm5dIH1dXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuICAgIC8vIE9rLCBwb3NzaWJsZSB3ZSdyZSBkZWFsaW5nIHdpdGggcGFyYW1ldGVyaXplZCB1bml0IHRlc3RzLlxyXG4gICAgLy8gSWYgd2UgaGF2ZSBbIGluIHRoZSBuYW1lLCB0aGVuIHRoaXMgaXMgYSBwYXJhbWV0ZXJpemVkIGZ1bmN0aW9uLlxyXG4gICAgY29uc3QgZnVuY3Rpb25zID0gZnVuY3Rpb25zQW5kU3VpdGVzLmZ1bmN0aW9ucy5maWx0ZXIoZnVuYyA9PiBmdW5jLm5hbWUuc3RhcnRzV2l0aChgJHtzeW1ib2xOYW1lfVtgKSAmJiBmdW5jLm5hbWUuZW5kc1dpdGgoJ10nKSk7XHJcbiAgICBpZiAoZnVuY3Rpb25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGlmIChmdW5jdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgbmV3IHZzY29kZV8xLkNvZGVMZW5zKHJhbmdlLCB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogY29uc3RhbnRzLlRleHQuQ29kZUxlbnNSdW5Vbml0VGVzdCxcclxuICAgICAgICAgICAgICAgIGNvbW1hbmQ6IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19SdW4sXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IFt1bmRlZmluZWQsIGNvbnN0YW50c18xLkNvbW1hbmRTb3VyY2UuY29kZWxlbnMsIGZpbGUsIHsgdGVzdEZ1bmN0aW9uOiBmdW5jdGlvbnMgfV1cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIG5ldyB2c2NvZGVfMS5Db2RlTGVucyhyYW5nZSwge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6IGNvbnN0YW50cy5UZXh0LkNvZGVMZW5zRGVidWdVbml0VGVzdCxcclxuICAgICAgICAgICAgICAgIGNvbW1hbmQ6IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19EZWJ1ZyxcclxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czogW3VuZGVmaW5lZCwgY29uc3RhbnRzXzEuQ29tbWFuZFNvdXJjZS5jb2RlbGVucywgZmlsZSwgeyB0ZXN0RnVuY3Rpb246IGZ1bmN0aW9ucyB9XVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcbiAgICAvLyBGaW5kIGFsbCBmbGF0dGVuZWQgZnVuY3Rpb25zLlxyXG4gICAgcmV0dXJuIFtcclxuICAgICAgICBuZXcgdnNjb2RlXzEuQ29kZUxlbnMocmFuZ2UsIHtcclxuICAgICAgICAgICAgdGl0bGU6IGAke2dldFRlc3RTdGF0dXNJY29ucyhmdW5jdGlvbnMpfSR7Y29uc3RhbnRzLlRleHQuQ29kZUxlbnNSdW5Vbml0VGVzdH0gKE11bHRpcGxlKWAsXHJcbiAgICAgICAgICAgIGNvbW1hbmQ6IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19QaWNrZXJfVUksXHJcbiAgICAgICAgICAgIGFyZ3VtZW50czogW3VuZGVmaW5lZCwgY29uc3RhbnRzXzEuQ29tbWFuZFNvdXJjZS5jb2RlbGVucywgZmlsZSwgZnVuY3Rpb25zXVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIG5ldyB2c2NvZGVfMS5Db2RlTGVucyhyYW5nZSwge1xyXG4gICAgICAgICAgICB0aXRsZTogYCR7Z2V0VGVzdFN0YXR1c0ljb25zKGZ1bmN0aW9ucyl9JHtjb25zdGFudHMuVGV4dC5Db2RlTGVuc0RlYnVnVW5pdFRlc3R9IChNdWx0aXBsZSlgLFxyXG4gICAgICAgICAgICBjb21tYW5kOiBjb25zdGFudHMuQ29tbWFuZHMuVGVzdHNfUGlja2VyX1VJX0RlYnVnLFxyXG4gICAgICAgICAgICBhcmd1bWVudHM6IFt1bmRlZmluZWQsIGNvbnN0YW50c18xLkNvbW1hbmRTb3VyY2UuY29kZWxlbnMsIGZpbGUsIGZ1bmN0aW9uc11cclxuICAgICAgICB9KVxyXG4gICAgXTtcclxufVxyXG5mdW5jdGlvbiBnZXRBbGxUZXN0U3VpdGVzQW5kRnVuY3Rpb25zUGVyRmlsZSh0ZXN0RmlsZSkge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci10eXBlLWNhc3RcclxuICAgIGNvbnN0IGFsbCA9IHsgZnVuY3Rpb25zOiB0ZXN0RmlsZS5mdW5jdGlvbnMsIHN1aXRlczogW10gfTtcclxuICAgIHRlc3RGaWxlLnN1aXRlcy5mb3JFYWNoKHN1aXRlID0+IHtcclxuICAgICAgICBhbGwuc3VpdGVzLnB1c2goc3VpdGUpO1xyXG4gICAgICAgIGNvbnN0IGFsbENoaWxkSXRlbXMgPSBnZXRBbGxUZXN0U3VpdGVzQW5kRnVuY3Rpb25zKHN1aXRlKTtcclxuICAgICAgICBhbGwuZnVuY3Rpb25zLnB1c2goLi4uYWxsQ2hpbGRJdGVtcy5mdW5jdGlvbnMpO1xyXG4gICAgICAgIGFsbC5zdWl0ZXMucHVzaCguLi5hbGxDaGlsZEl0ZW1zLnN1aXRlcyk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBhbGw7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QWxsVGVzdFN1aXRlc0FuZEZ1bmN0aW9ucyh0ZXN0U3VpdGUpIHtcclxuICAgIGNvbnN0IGFsbCA9IHsgZnVuY3Rpb25zOiBbXSwgc3VpdGVzOiBbXSB9O1xyXG4gICAgdGVzdFN1aXRlLmZ1bmN0aW9ucy5mb3JFYWNoKGZuID0+IHtcclxuICAgICAgICBhbGwuZnVuY3Rpb25zLnB1c2goZm4pO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0U3VpdGUuc3VpdGVzLmZvckVhY2goc3VpdGUgPT4ge1xyXG4gICAgICAgIGFsbC5zdWl0ZXMucHVzaChzdWl0ZSk7XHJcbiAgICAgICAgY29uc3QgYWxsQ2hpbGRJdGVtcyA9IGdldEFsbFRlc3RTdWl0ZXNBbmRGdW5jdGlvbnMoc3VpdGUpO1xyXG4gICAgICAgIGFsbC5mdW5jdGlvbnMucHVzaCguLi5hbGxDaGlsZEl0ZW1zLmZ1bmN0aW9ucyk7XHJcbiAgICAgICAgYWxsLnN1aXRlcy5wdXNoKC4uLmFsbENoaWxkSXRlbXMuc3VpdGVzKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGFsbDtcclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD10ZXN0RmlsZXMuanMubWFwIl19