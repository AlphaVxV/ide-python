// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const types_1 = require("../../../ioc/types");

const types_2 = require("../../types");

const OptionsWithArguments = ['-k', '-p', '-s', '-t', '--pattern', '--start-directory', '--top-level-directory'];
const OptionsWithoutArguments = ['-b', '-c', '-f', '-h', '-q', '-v', '--buffer', '--catch', '--failfast', '--help', '--locals', '--quiet', '--verbose'];
let ArgumentsService = class ArgumentsService {
  constructor(serviceContainer) {
    this.helper = serviceContainer.get(types_2.IArgumentsHelper);
  }

  getKnownOptions() {
    return {
      withArgs: OptionsWithArguments,
      withoutArgs: OptionsWithoutArguments
    };
  }

  getOptionValue(args, option) {
    return this.helper.getOptionValues(args, option);
  }

  filterArguments(args, argumentToRemoveOrFilter) {
    const optionsWithoutArgsToRemove = [];
    const optionsWithArgsToRemove = []; // Positional arguments in pytest positional args are test directories and files.
    // So if we want to run a specific test, then remove positional args.

    let removePositionalArgs = false;

    if (Array.isArray(argumentToRemoveOrFilter)) {
      argumentToRemoveOrFilter.forEach(item => {
        if (OptionsWithArguments.indexOf(item) >= 0) {
          optionsWithArgsToRemove.push(item);
        }

        if (OptionsWithoutArguments.indexOf(item) >= 0) {
          optionsWithoutArgsToRemove.push(item);
        }
      });
    } else {
      removePositionalArgs = true;
    }

    let filteredArgs = args.slice();

    if (removePositionalArgs) {
      const positionalArgs = this.helper.getPositionalArguments(filteredArgs, OptionsWithArguments, OptionsWithoutArguments);
      filteredArgs = filteredArgs.filter(item => positionalArgs.indexOf(item) === -1);
    }

    return this.helper.filterArguments(filteredArgs, optionsWithArgsToRemove, optionsWithoutArgsToRemove);
  }

  getTestFolders(args) {
    const shortValue = this.helper.getOptionValues(args, '-s');

    if (typeof shortValue === 'string') {
      return [shortValue];
    }

    const longValue = this.helper.getOptionValues(args, '--start-directory');

    if (typeof longValue === 'string') {
      return [longValue];
    }

    return ['.'];
  }

};
ArgumentsService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_1.IServiceContainer))], ArgumentsService);
exports.ArgumentsService = ArgumentsService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFyZ3NTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIl9fZGVjb3JhdGUiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJyIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZCIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fcGFyYW0iLCJwYXJhbUluZGV4IiwiZGVjb3JhdG9yIiwiZXhwb3J0cyIsInZhbHVlIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwidHlwZXNfMSIsInR5cGVzXzIiLCJPcHRpb25zV2l0aEFyZ3VtZW50cyIsIk9wdGlvbnNXaXRob3V0QXJndW1lbnRzIiwiQXJndW1lbnRzU2VydmljZSIsImNvbnN0cnVjdG9yIiwic2VydmljZUNvbnRhaW5lciIsImhlbHBlciIsImdldCIsIklBcmd1bWVudHNIZWxwZXIiLCJnZXRLbm93bk9wdGlvbnMiLCJ3aXRoQXJncyIsIndpdGhvdXRBcmdzIiwiZ2V0T3B0aW9uVmFsdWUiLCJhcmdzIiwib3B0aW9uIiwiZ2V0T3B0aW9uVmFsdWVzIiwiZmlsdGVyQXJndW1lbnRzIiwiYXJndW1lbnRUb1JlbW92ZU9yRmlsdGVyIiwib3B0aW9uc1dpdGhvdXRBcmdzVG9SZW1vdmUiLCJvcHRpb25zV2l0aEFyZ3NUb1JlbW92ZSIsInJlbW92ZVBvc2l0aW9uYWxBcmdzIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsIml0ZW0iLCJpbmRleE9mIiwicHVzaCIsImZpbHRlcmVkQXJncyIsInNsaWNlIiwicG9zaXRpb25hbEFyZ3MiLCJnZXRQb3NpdGlvbmFsQXJndW1lbnRzIiwiZmlsdGVyIiwiZ2V0VGVzdEZvbGRlcnMiLCJzaG9ydFZhbHVlIiwibG9uZ1ZhbHVlIiwiaW5qZWN0YWJsZSIsImluamVjdCIsIklTZXJ2aWNlQ29udGFpbmVyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FB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QjtBQUNBeUIsTUFBQUEsWUFBWSxHQUFHQSxZQUFZLENBQUNJLE1BQWIsQ0FBb0JQLElBQUksSUFBSUssY0FBYyxDQUFDSixPQUFmLENBQXVCRCxJQUF2QixNQUFpQyxDQUFDLENBQTlELENBQWY7QUFDSDs7QUFDRCxXQUFPLEtBQUtsQixNQUFMLENBQVlVLGVBQVosQ0FBNEJXLFlBQTVCLEVBQTBDUix1QkFBMUMsRUFBbUVELDBCQUFuRSxDQUFQO0FBQ0g7O0FBQ0RjLEVBQUFBLGNBQWMsQ0FBQ25CLElBQUQsRUFBTztBQUNqQixVQUFNb0IsVUFBVSxHQUFHLEtBQUszQixNQUFMLENBQVlTLGVBQVosQ0FBNEJGLElBQTVCLEVBQWtDLElBQWxDLENBQW5COztBQUNBLFFBQUksT0FBT29CLFVBQVAsS0FBc0IsUUFBMUIsRUFBb0M7QUFDaEMsYUFBTyxDQUFDQSxVQUFELENBQVA7QUFDSDs7QUFDRCxVQUFNQyxTQUFTLEdBQUcsS0FBSzVCLE1BQUwsQ0FBWVMsZUFBWixDQUE0QkYsSUFBNUIsRUFBa0MsbUJBQWxDLENBQWxCOztBQUNBLFFBQUksT0FBT3FCLFNBQVAsS0FBcUIsUUFBekIsRUFBbUM7QUFDL0IsYUFBTyxDQUFDQSxTQUFELENBQVA7QUFDSDs7QUFDRCxXQUFPLENBQUMsR0FBRCxDQUFQO0FBQ0g7O0FBakR5QyxDQUE5QztBQW1EQS9CLGdCQUFnQixHQUFHM0IsVUFBVSxDQUFDLENBQzFCcUIsV0FBVyxDQUFDc0MsVUFBWixFQUQwQixFQUUxQjNDLE9BQU8sQ0FBQyxDQUFELEVBQUlLLFdBQVcsQ0FBQ3VDLE1BQVosQ0FBbUJyQyxPQUFPLENBQUNzQyxpQkFBM0IsQ0FBSixDQUZtQixDQUFELEVBRzFCbEMsZ0JBSDBCLENBQTdCO0FBSUFSLE9BQU8sQ0FBQ1EsZ0JBQVIsR0FBMkJBLGdCQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9pb2MvdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vdHlwZXNcIik7XHJcbmNvbnN0IE9wdGlvbnNXaXRoQXJndW1lbnRzID0gWyctaycsICctcCcsICctcycsICctdCcsICctLXBhdHRlcm4nLFxyXG4gICAgJy0tc3RhcnQtZGlyZWN0b3J5JywgJy0tdG9wLWxldmVsLWRpcmVjdG9yeSddO1xyXG5jb25zdCBPcHRpb25zV2l0aG91dEFyZ3VtZW50cyA9IFsnLWInLCAnLWMnLCAnLWYnLCAnLWgnLCAnLXEnLCAnLXYnLFxyXG4gICAgJy0tYnVmZmVyJywgJy0tY2F0Y2gnLCAnLS1mYWlsZmFzdCcsICctLWhlbHAnLCAnLS1sb2NhbHMnLFxyXG4gICAgJy0tcXVpZXQnLCAnLS12ZXJib3NlJ107XHJcbmxldCBBcmd1bWVudHNTZXJ2aWNlID0gY2xhc3MgQXJndW1lbnRzU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5oZWxwZXIgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklBcmd1bWVudHNIZWxwZXIpO1xyXG4gICAgfVxyXG4gICAgZ2V0S25vd25PcHRpb25zKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHdpdGhBcmdzOiBPcHRpb25zV2l0aEFyZ3VtZW50cyxcclxuICAgICAgICAgICAgd2l0aG91dEFyZ3M6IE9wdGlvbnNXaXRob3V0QXJndW1lbnRzXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGdldE9wdGlvblZhbHVlKGFyZ3MsIG9wdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhlbHBlci5nZXRPcHRpb25WYWx1ZXMoYXJncywgb3B0aW9uKTtcclxuICAgIH1cclxuICAgIGZpbHRlckFyZ3VtZW50cyhhcmdzLCBhcmd1bWVudFRvUmVtb3ZlT3JGaWx0ZXIpIHtcclxuICAgICAgICBjb25zdCBvcHRpb25zV2l0aG91dEFyZ3NUb1JlbW92ZSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnNXaXRoQXJnc1RvUmVtb3ZlID0gW107XHJcbiAgICAgICAgLy8gUG9zaXRpb25hbCBhcmd1bWVudHMgaW4gcHl0ZXN0IHBvc2l0aW9uYWwgYXJncyBhcmUgdGVzdCBkaXJlY3RvcmllcyBhbmQgZmlsZXMuXHJcbiAgICAgICAgLy8gU28gaWYgd2Ugd2FudCB0byBydW4gYSBzcGVjaWZpYyB0ZXN0LCB0aGVuIHJlbW92ZSBwb3NpdGlvbmFsIGFyZ3MuXHJcbiAgICAgICAgbGV0IHJlbW92ZVBvc2l0aW9uYWxBcmdzID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJndW1lbnRUb1JlbW92ZU9yRmlsdGVyKSkge1xyXG4gICAgICAgICAgICBhcmd1bWVudFRvUmVtb3ZlT3JGaWx0ZXIuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChPcHRpb25zV2l0aEFyZ3VtZW50cy5pbmRleE9mKGl0ZW0pID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zV2l0aEFyZ3NUb1JlbW92ZS5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKE9wdGlvbnNXaXRob3V0QXJndW1lbnRzLmluZGV4T2YoaXRlbSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNXaXRob3V0QXJnc1RvUmVtb3ZlLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVtb3ZlUG9zaXRpb25hbEFyZ3MgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZmlsdGVyZWRBcmdzID0gYXJncy5zbGljZSgpO1xyXG4gICAgICAgIGlmIChyZW1vdmVQb3NpdGlvbmFsQXJncykge1xyXG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbmFsQXJncyA9IHRoaXMuaGVscGVyLmdldFBvc2l0aW9uYWxBcmd1bWVudHMoZmlsdGVyZWRBcmdzLCBPcHRpb25zV2l0aEFyZ3VtZW50cywgT3B0aW9uc1dpdGhvdXRBcmd1bWVudHMpO1xyXG4gICAgICAgICAgICBmaWx0ZXJlZEFyZ3MgPSBmaWx0ZXJlZEFyZ3MuZmlsdGVyKGl0ZW0gPT4gcG9zaXRpb25hbEFyZ3MuaW5kZXhPZihpdGVtKSA9PT0gLTEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5oZWxwZXIuZmlsdGVyQXJndW1lbnRzKGZpbHRlcmVkQXJncywgb3B0aW9uc1dpdGhBcmdzVG9SZW1vdmUsIG9wdGlvbnNXaXRob3V0QXJnc1RvUmVtb3ZlKTtcclxuICAgIH1cclxuICAgIGdldFRlc3RGb2xkZXJzKGFyZ3MpIHtcclxuICAgICAgICBjb25zdCBzaG9ydFZhbHVlID0gdGhpcy5oZWxwZXIuZ2V0T3B0aW9uVmFsdWVzKGFyZ3MsICctcycpO1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc2hvcnRWYWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtzaG9ydFZhbHVlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbG9uZ1ZhbHVlID0gdGhpcy5oZWxwZXIuZ2V0T3B0aW9uVmFsdWVzKGFyZ3MsICctLXN0YXJ0LWRpcmVjdG9yeScpO1xyXG4gICAgICAgIGlmICh0eXBlb2YgbG9uZ1ZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gW2xvbmdWYWx1ZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbJy4nXTtcclxuICAgIH1cclxufTtcclxuQXJndW1lbnRzU2VydmljZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxyXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMS5JU2VydmljZUNvbnRhaW5lcikpXHJcbl0sIEFyZ3VtZW50c1NlcnZpY2UpO1xyXG5leHBvcnRzLkFyZ3VtZW50c1NlcnZpY2UgPSBBcmd1bWVudHNTZXJ2aWNlO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcmdzU2VydmljZS5qcy5tYXAiXX0=