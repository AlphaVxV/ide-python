// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const types_1 = require("../../../ioc/types");

const types_2 = require("../../types");

const OptionsWithArguments = ['--attr', '--config', '--cover-html-dir', '--cover-min-percentage', '--cover-package', '--cover-xml-file', '--debug', '--debug-log', '--doctest-extension', '--doctest-fixtures', '--doctest-options', '--doctest-result-variable', '--eval-attr', '--exclude', '--id-file', '--ignore-files', '--include', '--log-config', '--logging-config', '--logging-datefmt', '--logging-filter', '--logging-format', '--logging-level', '--match', '--process-timeout', '--processes', '--py3where', '--testmatch', '--tests', '--verbosity', '--where', '--xunit-file', '--xunit-testsuite-name', '-A', '-a', '-c', '-e', '-i', '-I', '-l', '-m', '-w', '--profile-restrict', '--profile-sort', '--profile-stats-file'];
const OptionsWithoutArguments = ['-h', '--help', '-V', '--version', '-p', '--plugins', '-v', '--verbose', '--quiet', '-x', '--stop', '-P', '--no-path-adjustment', '--exe', '--noexe', '--traverse-namespace', '--first-package-wins', '--first-pkg-wins', '--1st-pkg-wins', '--no-byte-compile', '-s', '--nocapture', '--nologcapture', '--logging-clear-handlers', '--with-coverage', '--cover-erase', '--cover-tests', '--cover-inclusive', '--cover-html', '--cover-branches', '--cover-xml', '--pdb', '--pdb-failures', '--pdb-errors', '--no-deprecated', '--with-doctest', '--doctest-tests', '--with-isolation', '-d', '--detailed-errors', '--failure-detail', '--no-skip', '--with-id', '--failed', '--process-restartworker', '--with-xunit', '--all-modules', '--collect-only', '--with-profile'];
let ArgumentsService = class ArgumentsService {
  constructor(serviceContainer) {
    this.helper = serviceContainer.get(types_2.IArgumentsHelper);
  }

  getKnownOptions() {
    return {
      withArgs: OptionsWithArguments,
      withoutArgs: OptionsWithoutArguments
    };
  }

  getOptionValue(args, option) {
    return this.helper.getOptionValues(args, option);
  } // tslint:disable-next-line:max-func-body-length


  filterArguments(args, argumentToRemoveOrFilter) {
    const optionsWithoutArgsToRemove = [];
    const optionsWithArgsToRemove = []; // Positional arguments in nosetest are test directories and files.
    // So if we want to run a specific test, then remove positional args.

    let removePositionalArgs = false;

    if (Array.isArray(argumentToRemoveOrFilter)) {
      argumentToRemoveOrFilter.forEach(item => {
        if (OptionsWithArguments.indexOf(item) >= 0) {
          optionsWithArgsToRemove.push(item);
        }

        if (OptionsWithoutArguments.indexOf(item) >= 0) {
          optionsWithoutArgsToRemove.push(item);
        }
      });
    } else {
      switch (argumentToRemoveOrFilter) {
        case types_2.TestFilter.removeTests:
          {
            removePositionalArgs = true;
            break;
          }

        case types_2.TestFilter.discovery:
          {
            optionsWithoutArgsToRemove.push(...['-v', '--verbose', '-q', '--quiet', '-x', '--stop', '--with-coverage', ...OptionsWithoutArguments.filter(item => item.startsWith('--cover')), ...OptionsWithoutArguments.filter(item => item.startsWith('--logging')), ...OptionsWithoutArguments.filter(item => item.startsWith('--pdb')), ...OptionsWithoutArguments.filter(item => item.indexOf('xunit') >= 0)]);
            optionsWithArgsToRemove.push(...['--verbosity', '-l', '--debug', '--cover-package', ...OptionsWithoutArguments.filter(item => item.startsWith('--cover')), ...OptionsWithArguments.filter(item => item.startsWith('--logging')), ...OptionsWithoutArguments.filter(item => item.indexOf('xunit') >= 0)]);
            break;
          }

        case types_2.TestFilter.debugAll:
        case types_2.TestFilter.runAll:
          {
            break;
          }

        case types_2.TestFilter.debugSpecific:
        case types_2.TestFilter.runSpecific:
          {
            removePositionalArgs = true;
            break;
          }

        default:
          {
            throw new Error(`Unsupported Filter '${argumentToRemoveOrFilter}'`);
          }
      }
    }

    let filteredArgs = args.slice();

    if (removePositionalArgs) {
      const positionalArgs = this.helper.getPositionalArguments(filteredArgs, OptionsWithArguments, OptionsWithoutArguments);
      filteredArgs = filteredArgs.filter(item => positionalArgs.indexOf(item) === -1);
    }

    return this.helper.filterArguments(filteredArgs, optionsWithArgsToRemove, optionsWithoutArgsToRemove);
  }

  getTestFolders(args) {
    return this.helper.getPositionalArguments(args, OptionsWithArguments, OptionsWithoutArguments);
  }

};
ArgumentsService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_1.IServiceContainer))], ArgumentsService);
exports.ArgumentsService = ArgumentsService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFyZ3NTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIl9fZGVjb3JhdGUiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJyIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZCIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fcGFyYW0iLCJwYXJhbUluZGV4IiwiZGVjb3JhdG9yIiwiZXhwb3J0cyIsInZhbHVlIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwidHlwZXNfMSIsInR5cGVzXzIiLCJPcHRpb25zV2l0aEFyZ3VtZW50cyIsIk9wdGlvbnNXaXRob3V0QXJndW1lbnRzIiwiQXJndW1lbnRzU2VydmljZSIsImNvbnN0cnVjdG9yIiwic2VydmljZUNvbnRhaW5lciIsImhlbHBlciIsImdldCIsIklBcmd1bWVudHNIZWxwZXIiLCJnZXRLbm93bk9wdGlvbnMiLCJ3aXRoQXJncyIsIndpdGhvdXRBcmdzIiwiZ2V0T3B0aW9uVmFsdWUiLCJhcmdzIiwib3B0aW9uIiwiZ2V0T3B0aW9uVmFsdWVzIiwiZmlsdGVyQXJndW1lbnRzIiwiYXJndW1lbnRUb1JlbW92ZU9yRmlsdGVyIiwib3B0aW9uc1dpdGhvdXRBcmdzVG9SZW1vdmUiLCJvcHRpb25zV2l0aEFyZ3NUb1JlbW92ZSIsInJlbW92ZVBvc2l0aW9uYWxBcmdzIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsIml0ZW0iLCJpbmRleE9mIiwicHVzaCIsIlRlc3RGaWx0ZXIiLCJyZW1vdmVUZXN0cyIsImRpc2NvdmVyeSIsImZpbHRlciIsInN0YXJ0c1dpdGgiLCJkZWJ1Z0FsbCIsInJ1bkFsbCIsImRlYnVnU3BlY2lmaWMiLCJydW5TcGVjaWZpYyIsIkVycm9yIiwiZmlsdGVyZWRBcmdzIiwic2xpY2UiLCJwb3NpdGlvbmFsQXJncyIsImdldFBvc2l0aW9uYWxBcmd1bWVudHMiLCJnZXRU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QUFDLENBQUQsRUFBSUssV0FBVyxDQUFDOEMsTUFBWixDQUFtQjVDLE9BQU8sQ0FBQzZDLGlCQUEzQixDQUFKLENBRm1CLENBQUQsRUFHMUJ6QyxnQkFIMEIsQ0FBN0I7QUFJQVIsT0FBTyxDQUFDUSxnQkFBUixHQUEyQkEsZ0JBQTNCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2lvYy90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi90eXBlc1wiKTtcclxuY29uc3QgT3B0aW9uc1dpdGhBcmd1bWVudHMgPSBbJy0tYXR0cicsICctLWNvbmZpZycsICctLWNvdmVyLWh0bWwtZGlyJywgJy0tY292ZXItbWluLXBlcmNlbnRhZ2UnLFxyXG4gICAgJy0tY292ZXItcGFja2FnZScsICctLWNvdmVyLXhtbC1maWxlJywgJy0tZGVidWcnLCAnLS1kZWJ1Zy1sb2cnLCAnLS1kb2N0ZXN0LWV4dGVuc2lvbicsXHJcbiAgICAnLS1kb2N0ZXN0LWZpeHR1cmVzJywgJy0tZG9jdGVzdC1vcHRpb25zJywgJy0tZG9jdGVzdC1yZXN1bHQtdmFyaWFibGUnLCAnLS1ldmFsLWF0dHInLFxyXG4gICAgJy0tZXhjbHVkZScsICctLWlkLWZpbGUnLCAnLS1pZ25vcmUtZmlsZXMnLCAnLS1pbmNsdWRlJywgJy0tbG9nLWNvbmZpZycsICctLWxvZ2dpbmctY29uZmlnJyxcclxuICAgICctLWxvZ2dpbmctZGF0ZWZtdCcsICctLWxvZ2dpbmctZmlsdGVyJywgJy0tbG9nZ2luZy1mb3JtYXQnLCAnLS1sb2dnaW5nLWxldmVsJywgJy0tbWF0Y2gnLFxyXG4gICAgJy0tcHJvY2Vzcy10aW1lb3V0JywgJy0tcHJvY2Vzc2VzJywgJy0tcHkzd2hlcmUnLCAnLS10ZXN0bWF0Y2gnLCAnLS10ZXN0cycsICctLXZlcmJvc2l0eScsXHJcbiAgICAnLS13aGVyZScsICctLXh1bml0LWZpbGUnLCAnLS14dW5pdC10ZXN0c3VpdGUtbmFtZScsXHJcbiAgICAnLUEnLCAnLWEnLCAnLWMnLCAnLWUnLCAnLWknLCAnLUknLCAnLWwnLCAnLW0nLCAnLXcnLFxyXG4gICAgJy0tcHJvZmlsZS1yZXN0cmljdCcsICctLXByb2ZpbGUtc29ydCcsICctLXByb2ZpbGUtc3RhdHMtZmlsZSddO1xyXG5jb25zdCBPcHRpb25zV2l0aG91dEFyZ3VtZW50cyA9IFsnLWgnLCAnLS1oZWxwJywgJy1WJywgJy0tdmVyc2lvbicsICctcCcsICctLXBsdWdpbnMnLFxyXG4gICAgJy12JywgJy0tdmVyYm9zZScsICctLXF1aWV0JywgJy14JywgJy0tc3RvcCcsICctUCcsICctLW5vLXBhdGgtYWRqdXN0bWVudCcsXHJcbiAgICAnLS1leGUnLCAnLS1ub2V4ZScsICctLXRyYXZlcnNlLW5hbWVzcGFjZScsICctLWZpcnN0LXBhY2thZ2Utd2lucycsICctLWZpcnN0LXBrZy13aW5zJyxcclxuICAgICctLTFzdC1wa2ctd2lucycsICctLW5vLWJ5dGUtY29tcGlsZScsICctcycsICctLW5vY2FwdHVyZScsICctLW5vbG9nY2FwdHVyZScsXHJcbiAgICAnLS1sb2dnaW5nLWNsZWFyLWhhbmRsZXJzJywgJy0td2l0aC1jb3ZlcmFnZScsICctLWNvdmVyLWVyYXNlJywgJy0tY292ZXItdGVzdHMnLFxyXG4gICAgJy0tY292ZXItaW5jbHVzaXZlJywgJy0tY292ZXItaHRtbCcsICctLWNvdmVyLWJyYW5jaGVzJywgJy0tY292ZXIteG1sJywgJy0tcGRiJyxcclxuICAgICctLXBkYi1mYWlsdXJlcycsICctLXBkYi1lcnJvcnMnLCAnLS1uby1kZXByZWNhdGVkJywgJy0td2l0aC1kb2N0ZXN0JywgJy0tZG9jdGVzdC10ZXN0cycsXHJcbiAgICAnLS13aXRoLWlzb2xhdGlvbicsICctZCcsICctLWRldGFpbGVkLWVycm9ycycsICctLWZhaWx1cmUtZGV0YWlsJywgJy0tbm8tc2tpcCcsXHJcbiAgICAnLS13aXRoLWlkJywgJy0tZmFpbGVkJywgJy0tcHJvY2Vzcy1yZXN0YXJ0d29ya2VyJywgJy0td2l0aC14dW5pdCcsXHJcbiAgICAnLS1hbGwtbW9kdWxlcycsICctLWNvbGxlY3Qtb25seScsICctLXdpdGgtcHJvZmlsZSddO1xyXG5sZXQgQXJndW1lbnRzU2VydmljZSA9IGNsYXNzIEFyZ3VtZW50c1NlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuaGVscGVyID0gc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JQXJndW1lbnRzSGVscGVyKTtcclxuICAgIH1cclxuICAgIGdldEtub3duT3B0aW9ucygpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB3aXRoQXJnczogT3B0aW9uc1dpdGhBcmd1bWVudHMsXHJcbiAgICAgICAgICAgIHdpdGhvdXRBcmdzOiBPcHRpb25zV2l0aG91dEFyZ3VtZW50c1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBnZXRPcHRpb25WYWx1ZShhcmdzLCBvcHRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oZWxwZXIuZ2V0T3B0aW9uVmFsdWVzKGFyZ3MsIG9wdGlvbik7XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuICAgIGZpbHRlckFyZ3VtZW50cyhhcmdzLCBhcmd1bWVudFRvUmVtb3ZlT3JGaWx0ZXIpIHtcclxuICAgICAgICBjb25zdCBvcHRpb25zV2l0aG91dEFyZ3NUb1JlbW92ZSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnNXaXRoQXJnc1RvUmVtb3ZlID0gW107XHJcbiAgICAgICAgLy8gUG9zaXRpb25hbCBhcmd1bWVudHMgaW4gbm9zZXRlc3QgYXJlIHRlc3QgZGlyZWN0b3JpZXMgYW5kIGZpbGVzLlxyXG4gICAgICAgIC8vIFNvIGlmIHdlIHdhbnQgdG8gcnVuIGEgc3BlY2lmaWMgdGVzdCwgdGhlbiByZW1vdmUgcG9zaXRpb25hbCBhcmdzLlxyXG4gICAgICAgIGxldCByZW1vdmVQb3NpdGlvbmFsQXJncyA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50VG9SZW1vdmVPckZpbHRlcikpIHtcclxuICAgICAgICAgICAgYXJndW1lbnRUb1JlbW92ZU9yRmlsdGVyLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoT3B0aW9uc1dpdGhBcmd1bWVudHMuaW5kZXhPZihpdGVtKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1dpdGhBcmdzVG9SZW1vdmUucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChPcHRpb25zV2l0aG91dEFyZ3VtZW50cy5pbmRleE9mKGl0ZW0pID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zV2l0aG91dEFyZ3NUb1JlbW92ZS5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoYXJndW1lbnRUb1JlbW92ZU9yRmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVzdEZpbHRlci5yZW1vdmVUZXN0czoge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVBvc2l0aW9uYWxBcmdzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXN0RmlsdGVyLmRpc2NvdmVyeToge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNXaXRob3V0QXJnc1RvUmVtb3ZlLnB1c2goLi4uW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnLXYnLCAnLS12ZXJib3NlJywgJy1xJywgJy0tcXVpZXQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnLXgnLCAnLS1zdG9wJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJy0td2l0aC1jb3ZlcmFnZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk9wdGlvbnNXaXRob3V0QXJndW1lbnRzLmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnLS1jb3ZlcicpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uT3B0aW9uc1dpdGhvdXRBcmd1bWVudHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zdGFydHNXaXRoKCctLWxvZ2dpbmcnKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk9wdGlvbnNXaXRob3V0QXJndW1lbnRzLmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnLS1wZGInKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk9wdGlvbnNXaXRob3V0QXJndW1lbnRzLmZpbHRlcihpdGVtID0+IGl0ZW0uaW5kZXhPZigneHVuaXQnKSA+PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNXaXRoQXJnc1RvUmVtb3ZlLnB1c2goLi4uW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnLS12ZXJib3NpdHknLCAnLWwnLCAnLS1kZWJ1ZycsICctLWNvdmVyLXBhY2thZ2UnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5PcHRpb25zV2l0aG91dEFyZ3VtZW50cy5maWx0ZXIoaXRlbSA9PiBpdGVtLnN0YXJ0c1dpdGgoJy0tY292ZXInKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLk9wdGlvbnNXaXRoQXJndW1lbnRzLmZpbHRlcihpdGVtID0+IGl0ZW0uc3RhcnRzV2l0aCgnLS1sb2dnaW5nJykpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5PcHRpb25zV2l0aG91dEFyZ3VtZW50cy5maWx0ZXIoaXRlbSA9PiBpdGVtLmluZGV4T2YoJ3h1bml0JykgPj0gMClcclxuICAgICAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXN0RmlsdGVyLmRlYnVnQWxsOlxyXG4gICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlc3RGaWx0ZXIucnVuQWxsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVzdEZpbHRlci5kZWJ1Z1NwZWNpZmljOlxyXG4gICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlc3RGaWx0ZXIucnVuU3BlY2lmaWM6IHtcclxuICAgICAgICAgICAgICAgICAgICByZW1vdmVQb3NpdGlvbmFsQXJncyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBGaWx0ZXIgJyR7YXJndW1lbnRUb1JlbW92ZU9yRmlsdGVyfSdgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZmlsdGVyZWRBcmdzID0gYXJncy5zbGljZSgpO1xyXG4gICAgICAgIGlmIChyZW1vdmVQb3NpdGlvbmFsQXJncykge1xyXG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvbmFsQXJncyA9IHRoaXMuaGVscGVyLmdldFBvc2l0aW9uYWxBcmd1bWVudHMoZmlsdGVyZWRBcmdzLCBPcHRpb25zV2l0aEFyZ3VtZW50cywgT3B0aW9uc1dpdGhvdXRBcmd1bWVudHMpO1xyXG4gICAgICAgICAgICBmaWx0ZXJlZEFyZ3MgPSBmaWx0ZXJlZEFyZ3MuZmlsdGVyKGl0ZW0gPT4gcG9zaXRpb25hbEFyZ3MuaW5kZXhPZihpdGVtKSA9PT0gLTEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5oZWxwZXIuZmlsdGVyQXJndW1lbnRzKGZpbHRlcmVkQXJncywgb3B0aW9uc1dpdGhBcmdzVG9SZW1vdmUsIG9wdGlvbnNXaXRob3V0QXJnc1RvUmVtb3ZlKTtcclxuICAgIH1cclxuICAgIGdldFRlc3RGb2xkZXJzKGFyZ3MpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oZWxwZXIuZ2V0UG9zaXRpb25hbEFyZ3VtZW50cyhhcmdzLCBPcHRpb25zV2l0aEFyZ3VtZW50cywgT3B0aW9uc1dpdGhvdXRBcmd1bWVudHMpO1xyXG4gICAgfVxyXG59O1xyXG5Bcmd1bWVudHNTZXJ2aWNlID0gX19kZWNvcmF0ZShbXHJcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXHJcbiAgICBfX3BhcmFtKDAsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc18xLklTZXJ2aWNlQ29udGFpbmVyKSlcclxuXSwgQXJndW1lbnRzU2VydmljZSk7XHJcbmV4cG9ydHMuQXJndW1lbnRzU2VydmljZSA9IEFyZ3VtZW50c1NlcnZpY2U7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFyZ3NTZXJ2aWNlLmpzLm1hcCJdfQ==