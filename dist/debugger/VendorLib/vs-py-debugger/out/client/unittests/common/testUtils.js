"use strict";

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const path = require("path");

const vscode_1 = require("vscode");

const types_1 = require("../../common/application/types");

const constants = require("../../common/constants");

const types_2 = require("../../common/types");

const types_3 = require("../../ioc/types");

const constants_1 = require("./constants");

const types_4 = require("./types");

function selectTestWorkspace() {
  return __awaiter(this, void 0, void 0, function* () {
    if (!Array.isArray(vscode_1.workspace.workspaceFolders) || vscode_1.workspace.workspaceFolders.length === 0) {
      return undefined;
    } else if (vscode_1.workspace.workspaceFolders.length === 1) {
      return vscode_1.workspace.workspaceFolders[0].uri;
    } else {
      // tslint:disable-next-line:no-any prefer-type-cast
      const workspaceFolder = yield vscode_1.window.showWorkspaceFolderPick({
        placeHolder: 'Select a workspace'
      });
      return workspaceFolder ? workspaceFolder.uri : undefined;
    }
  });
}

exports.selectTestWorkspace = selectTestWorkspace;

function extractBetweenDelimiters(content, startDelimiter, endDelimiter) {
  content = content.substring(content.indexOf(startDelimiter) + startDelimiter.length);
  return content.substring(0, content.lastIndexOf(endDelimiter));
}

exports.extractBetweenDelimiters = extractBetweenDelimiters;

function convertFileToPackage(filePath) {
  const lastIndex = filePath.lastIndexOf('.');
  return filePath.substring(0, lastIndex).replace(/\//g, '.').replace(/\\/g, '.');
}

exports.convertFileToPackage = convertFileToPackage;
let TestsHelper = class TestsHelper {
  constructor(flatteningVisitor, serviceContainer) {
    this.flatteningVisitor = flatteningVisitor;
    this.appShell = serviceContainer.get(types_1.IApplicationShell);
    this.commandManager = serviceContainer.get(types_1.ICommandManager);
  }

  parseProviderName(product) {
    switch (product) {
      case types_2.Product.nosetest:
        return 'nosetest';

      case types_2.Product.pytest:
        return 'pytest';

      case types_2.Product.unittest:
        return 'unittest';

      default:
        {
          throw new Error(`Unknown Test Product ${product}`);
        }
    }
  }

  parseProduct(provider) {
    switch (provider) {
      case 'nosetest':
        return types_2.Product.nosetest;

      case 'pytest':
        return types_2.Product.pytest;

      case 'unittest':
        return types_2.Product.unittest;

      default:
        {
          throw new Error(`Unknown Test Provider ${provider}`);
        }
    }
  }

  getSettingsPropertyNames(product) {
    const id = this.parseProviderName(product);

    switch (id) {
      case 'pytest':
        {
          return {
            argsName: 'pyTestArgs',
            pathName: 'pyTestPath',
            enabledName: 'pyTestEnabled'
          };
        }

      case 'nosetest':
        {
          return {
            argsName: 'nosetestArgs',
            pathName: 'nosetestPath',
            enabledName: 'nosetestsEnabled'
          };
        }

      case 'unittest':
        {
          return {
            argsName: 'unittestArgs',
            enabledName: 'unittestEnabled'
          };
        }

      default:
        {
          throw new Error(`Unknown Test Provider '${product}'`);
        }
    }
  }

  flattenTestFiles(testFiles) {
    testFiles.forEach(testFile => this.flatteningVisitor.visitTestFile(testFile)); // tslint:disable-next-line:no-object-literal-type-assertion

    const tests = {
      testFiles: testFiles,
      testFunctions: this.flatteningVisitor.flattenedTestFunctions,
      testSuites: this.flatteningVisitor.flattenedTestSuites,
      testFolders: [],
      rootTestFolders: [],
      summary: {
        passed: 0,
        failures: 0,
        errors: 0,
        skipped: 0
      }
    };
    this.placeTestFilesIntoFolders(tests);
    return tests;
  }

  placeTestFilesIntoFolders(tests) {
    // First get all the unique folders
    const folders = [];
    tests.testFiles.forEach(file => {
      const dir = path.dirname(file.name);

      if (folders.indexOf(dir) === -1) {
        folders.push(dir);
      }
    });
    tests.testFolders = [];
    const folderMap = new Map();
    folders.sort();
    folders.forEach(dir => {
      dir.split(path.sep).reduce((parentPath, currentName, index, values) => {
        let newPath = currentName;
        let parentFolder;

        if (parentPath.length > 0) {
          parentFolder = folderMap.get(parentPath);
          newPath = path.join(parentPath, currentName);
        }

        if (!folderMap.has(newPath)) {
          const testFolder = {
            name: newPath,
            testFiles: [],
            folders: [],
            nameToRun: newPath,
            time: 0
          };
          folderMap.set(newPath, testFolder);

          if (parentFolder) {
            parentFolder.folders.push(testFolder);
          } else {
            tests.rootTestFolders.push(testFolder);
          }

          tests.testFiles.filter(fl => path.dirname(fl.name) === newPath).forEach(testFile => {
            testFolder.testFiles.push(testFile);
          });
          tests.testFolders.push(testFolder);
        }

        return newPath;
      }, '');
    });
  }

  parseTestName(name, rootDirectory, tests) {
    // tslint:disable-next-line:no-suspicious-comment
    // TODO: We need a better way to match (currently we have raw name, name, xmlname, etc = which one do we.
    // Use to identify a file given the full file name, similarly for a folder and function.
    // Perhaps something like a parser or methods like TestFunction.fromString()... something).
    if (!tests) {
      return undefined;
    }

    const absolutePath = path.isAbsolute(name) ? name : path.resolve(rootDirectory, name);
    const testFolders = tests.testFolders.filter(folder => folder.nameToRun === name || folder.name === name || folder.name === absolutePath);

    if (testFolders.length > 0) {
      return {
        testFolder: testFolders
      };
    }

    const testFiles = tests.testFiles.filter(file => file.nameToRun === name || file.name === name || file.fullPath === absolutePath);

    if (testFiles.length > 0) {
      return {
        testFile: testFiles
      };
    }

    const testFns = tests.testFunctions.filter(fn => fn.testFunction.nameToRun === name || fn.testFunction.name === name).map(fn => fn.testFunction);

    if (testFns.length > 0) {
      return {
        testFunction: testFns
      };
    } // Just return this as a test file.
    // tslint:disable-next-line:no-object-literal-type-assertion


    return {
      testFile: [{
        name: name,
        nameToRun: name,
        functions: [],
        suites: [],
        xmlName: name,
        fullPath: '',
        time: 0
      }]
    };
  }

  displayTestErrorMessage(message) {
    this.appShell.showErrorMessage(message, constants.Button_Text_Tests_View_Output).then(action => {
      if (action === constants.Button_Text_Tests_View_Output) {
        this.commandManager.executeCommand(constants.Commands.Tests_ViewOutput, undefined, constants_1.CommandSource.ui);
      }
    });
  }

  mergeTests(items) {
    return items.reduce((tests, otherTests, index) => {
      if (index === 0) {
        return tests;
      }

      tests.summary.errors += otherTests.summary.errors;
      tests.summary.failures += otherTests.summary.failures;
      tests.summary.passed += otherTests.summary.passed;
      tests.summary.skipped += otherTests.summary.skipped;
      tests.rootTestFolders.push(...otherTests.rootTestFolders);
      tests.testFiles.push(...otherTests.testFiles);
      tests.testFolders.push(...otherTests.testFolders);
      tests.testFunctions.push(...otherTests.testFunctions);
      tests.testSuites.push(...otherTests.testSuites);
      return tests;
    }, items[0]);
  }

  shouldRunAllTests(testsToRun) {
    if (!testsToRun) {
      return true;
    }

    if (Array.isArray(testsToRun.testFile) && testsToRun.testFile.length > 0 || Array.isArray(testsToRun.testFolder) && testsToRun.testFolder.length > 0 || Array.isArray(testsToRun.testFunction) && testsToRun.testFunction.length > 0 || Array.isArray(testsToRun.testSuite) && testsToRun.testSuite.length > 0) {
      return false;
    }

    return true;
  }

};
TestsHelper = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_4.ITestVisitor)), __param(0, inversify_1.named('TestFlatteningVisitor')), __param(1, inversify_1.inject(types_3.IServiceContainer))], TestsHelper);
exports.TestsHelper = TestsHelper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3RVdGlscy5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX3BhcmFtIiwicGFyYW1JbmRleCIsImRlY29yYXRvciIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJleHBvcnRzIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwicGF0aCIsInZzY29kZV8xIiwidHlwZXNfMSIsImNvbnN0YW50cyIsInR5cGVzXzIiLCJ0eXBlc18zIiwiY29uc3RhbnRzXzEiLCJ0eXBlc180Iiwic2VsZWN0VGVzdFdvcmtzcGFjZSIsIkFycmF5IiwiaXNBcnJheSIsIndvcmtzcGFjZSIsIndvcmtzcGFjZUZvbGRlcnMiLCJ1bmRlZmluZWQiLCJ1cmkiLCJ3b3Jrc3BhY2VGb2xkZXIiLCJ3aW5kb3ciLCJzaG93V29ya3NwYWNlRm9sZGVyUGljayIsInBsYWNlSG9sZGVyIiwiZXh0cmFjdEJldHdlZW5EZWxpbWl0ZXJzIiwiY29udGVudCIsInN0YXJ0RGVsaW1pdGVyIiwiZW5kRGVsaW1pdGVyIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImxhc3RJbmRleE9mIiwiY29udmVydEZpbGVUb1BhY2thZ2UiLCJmaWxlUGF0aCIsImxhc3RJbmRleCIsInJlcGxhY2UiLCJUZXN0c0hlbHBlciIsImNvbnN0cnVjdG9yIiwiZmxhdHRlbmluZ1Zpc2l0b3IiLCJzZXJ2aWNlQ29udGFpbmVyIiwiYXBwU2hlbGwiLCJnZXQiLCJJQXBwbGljYXRpb25TaGVsbCIsImNvbW1hbmRNYW5hZ2VyIiwiSUNvbW1hbmRNYW5hZ2VyIiwicGFyc2VQcm92aWRlck5hbWUiLCJwcm9kdWN0IiwiUHJvZHVjdCIsIm5vc2V0ZXN0IiwicHl0ZXN0IiwidW5pdHRlc3QiLCJFcnJvciIsInBhcnNlUHJvZHVjdCIsInByb3ZpZGVyIiwiZ2V0U2V0dGluZ3NQcm9wZXJ0eU5hbWVzIiwiaWQiLCJhcmdzTmFtZSIsInBhdGhOYW1lIiwiZW5hYmxlZE5hbWUiLCJmbGF0dGVuVGVzdEZpbGVzIiwidGVzdEZpbGVzIiwiZm9yRWFjaCIsInRlc3RGaWxlIiwidmlzaXRUZXN0RmlsZSIsInRlc3RzIiwidGVzdEZ1bmN0aW9ucyIsImZsYXR0ZW5lZFRlc3RGdW5jdGlvbnMiLCJ0ZXN0U3VpdGVzIiwiZmxhdHRlbmVkVGVzdFN1aXRlcyIsInRlc3RGb2xkZXJzIiwicm9vdFRlc3RGb2xkZXJzIiwic3VtbWFyeSIsInBhc3NlZCIsImZhaWx1cmVzIiwiZXJyb3JzIiwic2tpcHBlZCIsInBsYWNlVGVzdEZpbGVzSW50b0ZvbGRlcnMiLCJmb2xkZXJzIiwiZmlsZSIsImRpciIsImRpcm5hbWUiLCJuYW1lIiwicHVzaCIsImZvbGRlck1hcCIsIk1hcCIsInNvcnQiLCJzcGxpdCIsInNlcCIsInJlZHVjZSIsInBhcmVudFBhdGgiLCJjdXJyZW50TmFtZSIsImluZGV4IiwidmFsdWVzIiwibmV3UGF0aCIsInBhcmVudEZvbGRlciIsImpvaW4iLCJoYXMiLCJ0ZXN0Rm9sZGVyIiwibmFtZVRvUnVuIiwidGltZSIsInNldCIsImZpbHRlciIsImZsIiwicGFyc2VUZXN0TmFtZSIsInJvb3REaXJlY3RvcnkiLCJhYnNvbHV0ZVBhdGgiLCJpc0Fic29sdXRlIiwiZm9sZGVyIiwiZnVsbFBhdGgiLCJ0ZXN0Rm5zIiwiZm4iLCJ0ZXN0RnVuY3Rpb24iLCJtYXAiLCJmdW5jdGlvbnMiLCJzdWl0ZXMiLCJ4bWxOYW1lIiwiZGlzcGxheVRlc3RFcnJvck1lc3NhZ2UiLCJtZXNzYWdlIiwic2hvd0Vycm9yTWVzc2FnZSIsIkJ1dHRvbl9UZXh0X1Rlc3RzX1ZpZXdfT3V0cHV0IiwiYWN0aW9uIiwiZXhlY3V0ZUNvbW1hbmQiLCJDb21tYW5kcyIsIlRlc3RzX1ZpZXdPdXRwdXQiLCJDb21tYW5kU291cmNlIiwidWkiLCJtZXJnZVRlc3RzIiwiaXRlbXMiLCJvdGhlclRlc3RzIiwic2hvdWxkUnVuQWxsVGVzdHMiLCJ0ZXN0c1RvUnVuIiwidGVzdFN1aXRlIiwiaW5qZWN0YWJsZSIsImluamVjdCIsIklUZXN0VmlzaXRvciIsIm5hbWVkIiwiSVNlcnZpY2VDb250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFVBQVUsR0FBSSxVQUFRLFNBQUtBLFVBQWQsSUFBNkIsVUFBVUMsVUFBVixFQUFzQkMsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUNuRixNQUFJQyxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsTUFBbEI7QUFBQSxNQUEwQkMsQ0FBQyxHQUFHSCxDQUFDLEdBQUcsQ0FBSixHQUFRSCxNQUFSLEdBQWlCRSxJQUFJLEtBQUssSUFBVCxHQUFnQkEsSUFBSSxHQUFHSyxNQUFNLENBQUNDLHdCQUFQLENBQWdDUixNQUFoQyxFQUF3Q0MsR0FBeEMsQ0FBdkIsR0FBc0VDLElBQXJIO0FBQUEsTUFBMkhPLENBQTNIO0FBQ0EsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFFBQW5CLElBQStCLE9BQU9BLE9BQU8sQ0FBQ0MsUUFBZixLQUE0QixVQUEvRCxFQUEyRUwsQ0FBQyxHQUFHSSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJaLFVBQWpCLEVBQTZCQyxNQUE3QixFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLENBQUosQ0FBM0UsS0FDSyxLQUFLLElBQUlVLENBQUMsR0FBR2IsVUFBVSxDQUFDTSxNQUFYLEdBQW9CLENBQWpDLEVBQW9DTyxDQUFDLElBQUksQ0FBekMsRUFBNENBLENBQUMsRUFBN0MsRUFBaUQsSUFBSUgs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QzFFLGFBQU8sS0FBUDtBQUNIOztBQUNELFdBQU8sSUFBUDtBQUNIOztBQXRLK0IsQ0FBcEM7QUF3S0ErRCxXQUFXLEdBQUd0RSxVQUFVLENBQUMsQ0FDckJzQyxXQUFXLENBQUNnSSxVQUFaLEVBRHFCLEVBRXJCdEosT0FBTyxDQUFDLENBQUQsRUFBSXNCLFdBQVcsQ0FBQ2lJLE1BQVosQ0FBbUJ4SCxPQUFPLENBQUN5SCxZQUEzQixDQUFKLENBRmMsRUFFaUN4SixPQUFPLENBQUMsQ0FBRCxFQUFJc0IsV0FBVyxDQUFDbUksS0FBWixDQUFrQix1QkFBbEIsQ0FBSixDQUZ4QyxFQUdyQnpKLE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUNpSSxNQUFaLENBQW1CMUgsT0FBTyxDQUFDNkgsaUJBQTNCLENBQUosQ0FIYyxDQUFELEVBSXJCcEcsV0FKcUIsQ0FBeEI7QUFLQWpDLE9BQU8sQ0FBQ2lDLFdBQVIsR0FBc0JBLFdBQXRCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX3BhcmFtID0gKHRoaXMgJiYgdGhpcy5fX3BhcmFtKSB8fCBmdW5jdGlvbiAocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufTtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBpbnZlcnNpZnlfMSA9IHJlcXVpcmUoXCJpbnZlcnNpZnlcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcclxuY29uc3QgY29uc3RhbnRzID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uL2lvYy90eXBlc1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi90eXBlc1wiKTtcclxuZnVuY3Rpb24gc2VsZWN0VGVzdFdvcmtzcGFjZSgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZzY29kZV8xLndvcmtzcGFjZS53b3Jrc3BhY2VGb2xkZXJzKSB8fCB2c2NvZGVfMS53b3Jrc3BhY2Uud29ya3NwYWNlRm9sZGVycy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodnNjb2RlXzEud29ya3NwYWNlLndvcmtzcGFjZUZvbGRlcnMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2c2NvZGVfMS53b3Jrc3BhY2Uud29ya3NwYWNlRm9sZGVyc1swXS51cmk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55IHByZWZlci10eXBlLWNhc3RcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyID0geWllbGQgdnNjb2RlXzEud2luZG93LnNob3dXb3Jrc3BhY2VGb2xkZXJQaWNrKHsgcGxhY2VIb2xkZXI6ICdTZWxlY3QgYSB3b3Jrc3BhY2UnIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gd29ya3NwYWNlRm9sZGVyID8gd29ya3NwYWNlRm9sZGVyLnVyaSA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLnNlbGVjdFRlc3RXb3Jrc3BhY2UgPSBzZWxlY3RUZXN0V29ya3NwYWNlO1xyXG5mdW5jdGlvbiBleHRyYWN0QmV0d2VlbkRlbGltaXRlcnMoY29udGVudCwgc3RhcnREZWxpbWl0ZXIsIGVuZERlbGltaXRlcikge1xyXG4gICAgY29udGVudCA9IGNvbnRlbnQuc3Vic3RyaW5nKGNvbnRlbnQuaW5kZXhPZihzdGFydERlbGltaXRlcikgKyBzdGFydERlbGltaXRlci5sZW5ndGgpO1xyXG4gICAgcmV0dXJuIGNvbnRlbnQuc3Vic3RyaW5nKDAsIGNvbnRlbnQubGFzdEluZGV4T2YoZW5kRGVsaW1pdGVyKSk7XHJcbn1cclxuZXhwb3J0cy5leHRyYWN0QmV0d2VlbkRlbGltaXRlcnMgPSBleHRyYWN0QmV0d2VlbkRlbGltaXRlcnM7XHJcbmZ1bmN0aW9uIGNvbnZlcnRGaWxlVG9QYWNrYWdlKGZpbGVQYXRoKSB7XHJcbiAgICBjb25zdCBsYXN0SW5kZXggPSBmaWxlUGF0aC5sYXN0SW5kZXhPZignLicpO1xyXG4gICAgcmV0dXJuIGZpbGVQYXRoLnN1YnN0cmluZygwLCBsYXN0SW5kZXgpLnJlcGxhY2UoL1xcLy9nLCAnLicpLnJlcGxhY2UoL1xcXFwvZywgJy4nKTtcclxufVxyXG5leHBvcnRzLmNvbnZlcnRGaWxlVG9QYWNrYWdlID0gY29udmVydEZpbGVUb1BhY2thZ2U7XHJcbmxldCBUZXN0c0hlbHBlciA9IGNsYXNzIFRlc3RzSGVscGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKGZsYXR0ZW5pbmdWaXNpdG9yLCBzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5mbGF0dGVuaW5nVmlzaXRvciA9IGZsYXR0ZW5pbmdWaXNpdG9yO1xyXG4gICAgICAgIHRoaXMuYXBwU2hlbGwgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklBcHBsaWNhdGlvblNoZWxsKTtcclxuICAgICAgICB0aGlzLmNvbW1hbmRNYW5hZ2VyID0gc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JQ29tbWFuZE1hbmFnZXIpO1xyXG4gICAgfVxyXG4gICAgcGFyc2VQcm92aWRlck5hbWUocHJvZHVjdCkge1xyXG4gICAgICAgIHN3aXRjaCAocHJvZHVjdCkge1xyXG4gICAgICAgICAgICBjYXNlIHR5cGVzXzIuUHJvZHVjdC5ub3NldGVzdDogcmV0dXJuICdub3NldGVzdCc7XHJcbiAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5Qcm9kdWN0LnB5dGVzdDogcmV0dXJuICdweXRlc3QnO1xyXG4gICAgICAgICAgICBjYXNlIHR5cGVzXzIuUHJvZHVjdC51bml0dGVzdDogcmV0dXJuICd1bml0dGVzdCc7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBUZXN0IFByb2R1Y3QgJHtwcm9kdWN0fWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcGFyc2VQcm9kdWN0KHByb3ZpZGVyKSB7XHJcbiAgICAgICAgc3dpdGNoIChwcm92aWRlcikge1xyXG4gICAgICAgICAgICBjYXNlICdub3NldGVzdCc6IHJldHVybiB0eXBlc18yLlByb2R1Y3Qubm9zZXRlc3Q7XHJcbiAgICAgICAgICAgIGNhc2UgJ3B5dGVzdCc6IHJldHVybiB0eXBlc18yLlByb2R1Y3QucHl0ZXN0O1xyXG4gICAgICAgICAgICBjYXNlICd1bml0dGVzdCc6IHJldHVybiB0eXBlc18yLlByb2R1Y3QudW5pdHRlc3Q7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBUZXN0IFByb3ZpZGVyICR7cHJvdmlkZXJ9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMocHJvZHVjdCkge1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5wYXJzZVByb3ZpZGVyTmFtZShwcm9kdWN0KTtcclxuICAgICAgICBzd2l0Y2ggKGlkKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3B5dGVzdCc6IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJnc05hbWU6ICdweVRlc3RBcmdzJyxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoTmFtZTogJ3B5VGVzdFBhdGgnLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWROYW1lOiAncHlUZXN0RW5hYmxlZCdcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAnbm9zZXRlc3QnOiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyZ3NOYW1lOiAnbm9zZXRlc3RBcmdzJyxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoTmFtZTogJ25vc2V0ZXN0UGF0aCcsXHJcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZE5hbWU6ICdub3NldGVzdHNFbmFibGVkJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlICd1bml0dGVzdCc6IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJnc05hbWU6ICd1bml0dGVzdEFyZ3MnLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWROYW1lOiAndW5pdHRlc3RFbmFibGVkJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gVGVzdCBQcm92aWRlciAnJHtwcm9kdWN0fSdgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZsYXR0ZW5UZXN0RmlsZXModGVzdEZpbGVzKSB7XHJcbiAgICAgICAgdGVzdEZpbGVzLmZvckVhY2godGVzdEZpbGUgPT4gdGhpcy5mbGF0dGVuaW5nVmlzaXRvci52aXNpdFRlc3RGaWxlKHRlc3RGaWxlKSk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW9iamVjdC1saXRlcmFsLXR5cGUtYXNzZXJ0aW9uXHJcbiAgICAgICAgY29uc3QgdGVzdHMgPSB7XHJcbiAgICAgICAgICAgIHRlc3RGaWxlczogdGVzdEZpbGVzLFxyXG4gICAgICAgICAgICB0ZXN0RnVuY3Rpb25zOiB0aGlzLmZsYXR0ZW5pbmdWaXNpdG9yLmZsYXR0ZW5lZFRlc3RGdW5jdGlvbnMsXHJcbiAgICAgICAgICAgIHRlc3RTdWl0ZXM6IHRoaXMuZmxhdHRlbmluZ1Zpc2l0b3IuZmxhdHRlbmVkVGVzdFN1aXRlcyxcclxuICAgICAgICAgICAgdGVzdEZvbGRlcnM6IFtdLFxyXG4gICAgICAgICAgICByb290VGVzdEZvbGRlcnM6IFtdLFxyXG4gICAgICAgICAgICBzdW1tYXJ5OiB7IHBhc3NlZDogMCwgZmFpbHVyZXM6IDAsIGVycm9yczogMCwgc2tpcHBlZDogMCB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnBsYWNlVGVzdEZpbGVzSW50b0ZvbGRlcnModGVzdHMpO1xyXG4gICAgICAgIHJldHVybiB0ZXN0cztcclxuICAgIH1cclxuICAgIHBsYWNlVGVzdEZpbGVzSW50b0ZvbGRlcnModGVzdHMpIHtcclxuICAgICAgICAvLyBGaXJzdCBnZXQgYWxsIHRoZSB1bmlxdWUgZm9sZGVyc1xyXG4gICAgICAgIGNvbnN0IGZvbGRlcnMgPSBbXTtcclxuICAgICAgICB0ZXN0cy50ZXN0RmlsZXMuZm9yRWFjaChmaWxlID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGlyID0gcGF0aC5kaXJuYW1lKGZpbGUubmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChmb2xkZXJzLmluZGV4T2YoZGlyKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGZvbGRlcnMucHVzaChkaXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGVzdHMudGVzdEZvbGRlcnMgPSBbXTtcclxuICAgICAgICBjb25zdCBmb2xkZXJNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgZm9sZGVycy5zb3J0KCk7XHJcbiAgICAgICAgZm9sZGVycy5mb3JFYWNoKGRpciA9PiB7XHJcbiAgICAgICAgICAgIGRpci5zcGxpdChwYXRoLnNlcCkucmVkdWNlKChwYXJlbnRQYXRoLCBjdXJyZW50TmFtZSwgaW5kZXgsIHZhbHVlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1BhdGggPSBjdXJyZW50TmFtZTtcclxuICAgICAgICAgICAgICAgIGxldCBwYXJlbnRGb2xkZXI7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyZW50UGF0aC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Rm9sZGVyID0gZm9sZGVyTWFwLmdldChwYXJlbnRQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICBuZXdQYXRoID0gcGF0aC5qb2luKHBhcmVudFBhdGgsIGN1cnJlbnROYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghZm9sZGVyTWFwLmhhcyhuZXdQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlc3RGb2xkZXIgPSB7IG5hbWU6IG5ld1BhdGgsIHRlc3RGaWxlczogW10sIGZvbGRlcnM6IFtdLCBuYW1lVG9SdW46IG5ld1BhdGgsIHRpbWU6IDAgfTtcclxuICAgICAgICAgICAgICAgICAgICBmb2xkZXJNYXAuc2V0KG5ld1BhdGgsIHRlc3RGb2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRGb2xkZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Rm9sZGVyLmZvbGRlcnMucHVzaCh0ZXN0Rm9sZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RzLnJvb3RUZXN0Rm9sZGVycy5wdXNoKHRlc3RGb2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0ZXN0cy50ZXN0RmlsZXMuZmlsdGVyKGZsID0+IHBhdGguZGlybmFtZShmbC5uYW1lKSA9PT0gbmV3UGF0aCkuZm9yRWFjaCh0ZXN0RmlsZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RGb2xkZXIudGVzdEZpbGVzLnB1c2godGVzdEZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3RzLnRlc3RGb2xkZXJzLnB1c2godGVzdEZvbGRlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3UGF0aDtcclxuICAgICAgICAgICAgfSwgJycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcGFyc2VUZXN0TmFtZShuYW1lLCByb290RGlyZWN0b3J5LCB0ZXN0cykge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1zdXNwaWNpb3VzLWNvbW1lbnRcclxuICAgICAgICAvLyBUT0RPOiBXZSBuZWVkIGEgYmV0dGVyIHdheSB0byBtYXRjaCAoY3VycmVudGx5IHdlIGhhdmUgcmF3IG5hbWUsIG5hbWUsIHhtbG5hbWUsIGV0YyA9IHdoaWNoIG9uZSBkbyB3ZS5cclxuICAgICAgICAvLyBVc2UgdG8gaWRlbnRpZnkgYSBmaWxlIGdpdmVuIHRoZSBmdWxsIGZpbGUgbmFtZSwgc2ltaWxhcmx5IGZvciBhIGZvbGRlciBhbmQgZnVuY3Rpb24uXHJcbiAgICAgICAgLy8gUGVyaGFwcyBzb21ldGhpbmcgbGlrZSBhIHBhcnNlciBvciBtZXRob2RzIGxpa2UgVGVzdEZ1bmN0aW9uLmZyb21TdHJpbmcoKS4uLiBzb21ldGhpbmcpLlxyXG4gICAgICAgIGlmICghdGVzdHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgYWJzb2x1dGVQYXRoID0gcGF0aC5pc0Fic29sdXRlKG5hbWUpID8gbmFtZSA6IHBhdGgucmVzb2x2ZShyb290RGlyZWN0b3J5LCBuYW1lKTtcclxuICAgICAgICBjb25zdCB0ZXN0Rm9sZGVycyA9IHRlc3RzLnRlc3RGb2xkZXJzLmZpbHRlcihmb2xkZXIgPT4gZm9sZGVyLm5hbWVUb1J1biA9PT0gbmFtZSB8fCBmb2xkZXIubmFtZSA9PT0gbmFtZSB8fCBmb2xkZXIubmFtZSA9PT0gYWJzb2x1dGVQYXRoKTtcclxuICAgICAgICBpZiAodGVzdEZvbGRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4geyB0ZXN0Rm9sZGVyOiB0ZXN0Rm9sZGVycyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0ZXN0RmlsZXMgPSB0ZXN0cy50ZXN0RmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS5uYW1lVG9SdW4gPT09IG5hbWUgfHwgZmlsZS5uYW1lID09PSBuYW1lIHx8IGZpbGUuZnVsbFBhdGggPT09IGFic29sdXRlUGF0aCk7XHJcbiAgICAgICAgaWYgKHRlc3RGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHRlc3RGaWxlOiB0ZXN0RmlsZXMgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdGVzdEZucyA9IHRlc3RzLnRlc3RGdW5jdGlvbnMuZmlsdGVyKGZuID0+IGZuLnRlc3RGdW5jdGlvbi5uYW1lVG9SdW4gPT09IG5hbWUgfHwgZm4udGVzdEZ1bmN0aW9uLm5hbWUgPT09IG5hbWUpLm1hcChmbiA9PiBmbi50ZXN0RnVuY3Rpb24pO1xyXG4gICAgICAgIGlmICh0ZXN0Rm5zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdGVzdEZ1bmN0aW9uOiB0ZXN0Rm5zIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEp1c3QgcmV0dXJuIHRoaXMgYXMgYSB0ZXN0IGZpbGUuXHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW9iamVjdC1saXRlcmFsLXR5cGUtYXNzZXJ0aW9uXHJcbiAgICAgICAgcmV0dXJuIHsgdGVzdEZpbGU6IFt7IG5hbWU6IG5hbWUsIG5hbWVUb1J1bjogbmFtZSwgZnVuY3Rpb25zOiBbXSwgc3VpdGVzOiBbXSwgeG1sTmFtZTogbmFtZSwgZnVsbFBhdGg6ICcnLCB0aW1lOiAwIH1dIH07XHJcbiAgICB9XHJcbiAgICBkaXNwbGF5VGVzdEVycm9yTWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy5hcHBTaGVsbC5zaG93RXJyb3JNZXNzYWdlKG1lc3NhZ2UsIGNvbnN0YW50cy5CdXR0b25fVGV4dF9UZXN0c19WaWV3X091dHB1dCkudGhlbihhY3Rpb24gPT4ge1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSBjb25zdGFudHMuQnV0dG9uX1RleHRfVGVzdHNfVmlld19PdXRwdXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tbWFuZE1hbmFnZXIuZXhlY3V0ZUNvbW1hbmQoY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX1ZpZXdPdXRwdXQsIHVuZGVmaW5lZCwgY29uc3RhbnRzXzEuQ29tbWFuZFNvdXJjZS51aSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG1lcmdlVGVzdHMoaXRlbXMpIHtcclxuICAgICAgICByZXR1cm4gaXRlbXMucmVkdWNlKCh0ZXN0cywgb3RoZXJUZXN0cywgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVzdHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGVzdHMuc3VtbWFyeS5lcnJvcnMgKz0gb3RoZXJUZXN0cy5zdW1tYXJ5LmVycm9ycztcclxuICAgICAgICAgICAgdGVzdHMuc3VtbWFyeS5mYWlsdXJlcyArPSBvdGhlclRlc3RzLnN1bW1hcnkuZmFpbHVyZXM7XHJcbiAgICAgICAgICAgIHRlc3RzLnN1bW1hcnkucGFzc2VkICs9IG90aGVyVGVzdHMuc3VtbWFyeS5wYXNzZWQ7XHJcbiAgICAgICAgICAgIHRlc3RzLnN1bW1hcnkuc2tpcHBlZCArPSBvdGhlclRlc3RzLnN1bW1hcnkuc2tpcHBlZDtcclxuICAgICAgICAgICAgdGVzdHMucm9vdFRlc3RGb2xkZXJzLnB1c2goLi4ub3RoZXJUZXN0cy5yb290VGVzdEZvbGRlcnMpO1xyXG4gICAgICAgICAgICB0ZXN0cy50ZXN0RmlsZXMucHVzaCguLi5vdGhlclRlc3RzLnRlc3RGaWxlcyk7XHJcbiAgICAgICAgICAgIHRlc3RzLnRlc3RGb2xkZXJzLnB1c2goLi4ub3RoZXJUZXN0cy50ZXN0Rm9sZGVycyk7XHJcbiAgICAgICAgICAgIHRlc3RzLnRlc3RGdW5jdGlvbnMucHVzaCguLi5vdGhlclRlc3RzLnRlc3RGdW5jdGlvbnMpO1xyXG4gICAgICAgICAgICB0ZXN0cy50ZXN0U3VpdGVzLnB1c2goLi4ub3RoZXJUZXN0cy50ZXN0U3VpdGVzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRlc3RzO1xyXG4gICAgICAgIH0sIGl0ZW1zWzBdKTtcclxuICAgIH1cclxuICAgIHNob3VsZFJ1bkFsbFRlc3RzKHRlc3RzVG9SdW4pIHtcclxuICAgICAgICBpZiAoIXRlc3RzVG9SdW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoQXJyYXkuaXNBcnJheSh0ZXN0c1RvUnVuLnRlc3RGaWxlKSAmJiB0ZXN0c1RvUnVuLnRlc3RGaWxlLmxlbmd0aCA+IDApIHx8XHJcbiAgICAgICAgICAgIChBcnJheS5pc0FycmF5KHRlc3RzVG9SdW4udGVzdEZvbGRlcikgJiYgdGVzdHNUb1J1bi50ZXN0Rm9sZGVyLmxlbmd0aCA+IDApIHx8XHJcbiAgICAgICAgICAgIChBcnJheS5pc0FycmF5KHRlc3RzVG9SdW4udGVzdEZ1bmN0aW9uKSAmJiB0ZXN0c1RvUnVuLnRlc3RGdW5jdGlvbi5sZW5ndGggPiAwKSB8fFxyXG4gICAgICAgICAgICAoQXJyYXkuaXNBcnJheSh0ZXN0c1RvUnVuLnRlc3RTdWl0ZSkgJiYgdGVzdHNUb1J1bi50ZXN0U3VpdGUubGVuZ3RoID4gMCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufTtcclxuVGVzdHNIZWxwZXIgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzQuSVRlc3RWaXNpdG9yKSksIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEubmFtZWQoJ1Rlc3RGbGF0dGVuaW5nVmlzaXRvcicpKSxcclxuICAgIF9fcGFyYW0oMSwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzMuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBUZXN0c0hlbHBlcik7XHJcbmV4cG9ydHMuVGVzdHNIZWxwZXIgPSBUZXN0c0hlbHBlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGVzdFV0aWxzLmpzLm1hcCJdfQ==