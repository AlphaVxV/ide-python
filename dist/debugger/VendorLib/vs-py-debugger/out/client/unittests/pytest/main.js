'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const types_1 = require("../../common/types");

const constants_1 = require("../common/constants");

const baseTestManager_1 = require("../common/managers/baseTestManager");

const types_2 = require("../common/types");

const types_3 = require("../types");

class TestManager extends baseTestManager_1.BaseTestManager {
  get enabled() {
    return this.settings.unitTest.pyTestEnabled;
  }

  constructor(workspaceFolder, rootDirectory, serviceContainer) {
    super(constants_1.PYTEST_PROVIDER, types_1.Product.pytest, workspaceFolder, rootDirectory, serviceContainer);
    this.argsService = this.serviceContainer.get(types_3.IArgumentsService, this.testProvider);
    this.helper = this.serviceContainer.get(types_2.ITestsHelper);
    this.runner = this.serviceContainer.get(types_3.ITestManagerRunner, this.testProvider);
  }

  getDiscoveryOptions(ignoreCache) {
    const args = this.settings.unitTest.pyTestArgs.slice(0);
    return {
      workspaceFolder: this.workspaceFolder,
      cwd: this.rootDirectory,
      args,
      token: this.testDiscoveryCancellationToken,
      ignoreCache,
      outChannel: this.outputChannel
    };
  }

  runTestImpl(tests, testsToRun, runFailedTests, debug) {
    return __awaiter(this, void 0, void 0, function* () {
      let args;
      const runAllTests = this.helper.shouldRunAllTests(testsToRun);

      if (debug) {
        args = this.argsService.filterArguments(this.settings.unitTest.pyTestArgs, runAllTests ? types_3.TestFilter.debugAll : types_3.TestFilter.debugSpecific);
      } else {
        args = this.argsService.filterArguments(this.settings.unitTest.pyTestArgs, runAllTests ? types_3.TestFilter.runAll : types_3.TestFilter.runSpecific);
      }

      if (runFailedTests === true && args.indexOf('--lf') === -1 && args.indexOf('--last-failed') === -1) {
        args.splice(0, 0, '--last-failed');
      }

      const options = {
        workspaceFolder: this.workspaceFolder,
        cwd: this.rootDirectory,
        tests,
        args,
        testsToRun,
        debug,
        token: this.testRunnerCancellationToken,
        outChannel: this.outputChannel
      };
      return this.runner.runTest(this.testResultsService, options, this);
    });
  }

}

exports.TestManager = TestManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInR5cGVzXzEiLCJyZXF1aXJlIiwiY29uc3RhbnRzXzEiLCJiYXNlVGVzdE1hbmFnZXJfMSIsInR5cGVzXzIiLCJ0eXBlc18zIiwiVGVzdE1hbmFnZXIiLCJCYXNlVGVzdE1hbmFnZXIiLCJlbmFibGVkIiwic2V0dGluZ3MiLCJ1bml0VGVzdCIsInB5VGVzdEVuYWJsZWQiLCJjb25zdHJ1Y3RvciIsIndvcmtzcGFjZUZvbGRlciIsInJvb3REaXJlY3RvcnkiLCJzZXJ2aWNlQ29udGFpbmVyIiwiUFlURVNUX1BST1ZJREVSIiwiUHJvZHVjdCIsInB5dGVzdCIsImFyZ3NTZXJ2aWNlIiwiZ2V0IiwiSUFyZ3VtZW50c1NlcnZpY2UiLCJ0ZXN0UHJvdmlkZXIiLCJoZWxwZXIiLCJJVGVzdHNIZWxwZXIiLCJydW5uZXIiLCJJVGVzdE1hbmFnZXJSdW5uZXIiLCJnZXREaXNjb3ZlcnlPcHRpb25zIiwiaWdub3JlQ2FjaGUiLCJhcmdzIiwicHlUZXN0QXJncyIsInNsaWNlIiwiY3dkIiwidG9rZW4iLCJ0ZXN0RGlzY292ZXJ5Q2FuY2VsbGF0aW9uVG9rZW4iLCJvdXRDaGFubmVsIiwib3V0cHV0Q2hhbm5lbCIsInJ1blRlc3RJbXBsIiwidGVzdHMiLCJ0ZXN0c1RvUnVuIiwicnVuRmFpbGVkVGVzdHMiLCJkZWJ1ZyIsInJ1bkFsbFRlc3RzIiwic2hvdWxkUnVuQWxsVGVzdHMiLCJmaWx0ZXJBcmd1bWVudHMiLCJUZXN0RmlsdGVyIiwiZGVidWdBbGwiLCJkZWJ1Z1NwZWNpZmljIiwicnVuQWxsIiwicnVuU3BlY2lmaWMiLCJpbmRleE9mIiwic3BsaWNlIiwib3B0aW9ucyIsInRlc3RSdW5uZXJDYW5jZWxsYXRpb25Ub2tlbiIsInJ1blRlc3QiLCJ0ZXN0UmVzdWx0c1NlcnZpY2UiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzNGLGFBQVNDLFFBQVQsQ0FBa0JKLEtBQWxCLEVBQXlCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQyxPQUFELENBQVQsQ0FBbUJLLEtBQW5CLENBQUQsQ0FBSjtBQUFrQyxPQUF4QyxDQUF5QyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUM5RixhQUFTRixJQUFULENBQWNJLE1BQWQsRUFBc0I7QUFBRUEsTUFBQUEsTUFBTSxDQUFDQyxJQUFQLEdBQWNULE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQXJCLEdBQXNDLElBQUlOLENBQUosQ0FBTSxVQUFVRyxPQUFWLEVBQW1CO0FBQUVBLFFBQUFBLE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQVA7QUFBd0IsT0FBbkQsRUFBcURPLElBQXJELENB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QW5JLENBQVA7QUFDSCxPQUZELE1BR0s7QUFDRGxCLFFBQUFBLElBQUksR0FBRyxLQUFLVixXQUFMLENBQWlCeUIsZUFBakIsQ0FBaUMsS0FBS25DLFFBQUwsQ0FBY0MsUUFBZCxDQUF1Qm9CLFVBQXhELEVBQW9FWSxXQUFXLEdBQUdyQyxPQUFPLENBQUN3QyxVQUFSLENBQW1CRyxNQUF0QixHQUErQjNDLE9BQU8sQ0FBQ3dDLFVBQVIsQ0FBbUJJLFdBQWpJLENBQVA7QUFDSDs7QUFDRCxVQUFJVCxjQUFjLEtBQUssSUFBbkIsSUFBMkJYLElBQUksQ0FBQ3FCLE9BQUwsQ0FBYSxNQUFiLE1BQXlCLENBQUMsQ0FBckQsSUFBMERyQixJQUFJLENBQUNxQixPQUFMLENBQWEsZUFBYixNQUFrQyxDQUFDLENBQWpHLEVBQW9HO0FBQ2hHckIsUUFBQUEsSUFBSSxDQUFDc0IsTUFBTCxDQUFZLENBQVosRUFBZSxDQUFmLEVBQWtCLGVBQWxCO0FBQ0g7O0FBQ0QsWUFBTUMsT0FBTyxHQUFHO0FBQ1p2QyxRQUFBQSxlQUFlLEVBQUUsS0FBS0EsZUFEVjtBQUVabUIsUUFBQUEsR0FBRyxFQUFFLEtBQUtsQixhQUZFO0FBR1p3QixRQUFBQSxLQUhZO0FBR0xULFFBQUFBLElBSEs7QUFHQ1UsUUFBQUEsVUFIRDtBQUdhRSxRQUFBQSxLQUhiO0FBSVpSLFFBQUFBLEtBQUssRUFBRSxLQUFLb0IsMkJBSkE7QUFLWmxCLFFBQUFBLFVBQVUsRUFBRSxLQUFLQztBQUxMLE9BQWhCO0FBT0EsYUFBTyxLQUFLWCxNQUFMLENBQVk2QixPQUFaLENBQW9CLEtBQUtDLGtCQUF6QixFQUE2Q0gsT0FBN0MsRUFBc0QsSUFBdEQsQ0FBUDtBQUNILEtBcEJlLENBQWhCO0FBcUJIOztBQXpDdUQ7O0FBMkM1RHJELE9BQU8sQ0FBQ08sV0FBUixHQUFzQkEsV0FBdEIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IGJhc2VUZXN0TWFuYWdlcl8xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9tYW5hZ2Vycy9iYXNlVGVzdE1hbmFnZXJcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uL3R5cGVzXCIpO1xyXG5jbGFzcyBUZXN0TWFuYWdlciBleHRlbmRzIGJhc2VUZXN0TWFuYWdlcl8xLkJhc2VUZXN0TWFuYWdlciB7XHJcbiAgICBnZXQgZW5hYmxlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy51bml0VGVzdC5weVRlc3RFbmFibGVkO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3Iod29ya3NwYWNlRm9sZGVyLCByb290RGlyZWN0b3J5LCBzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgc3VwZXIoY29uc3RhbnRzXzEuUFlURVNUX1BST1ZJREVSLCB0eXBlc18xLlByb2R1Y3QucHl0ZXN0LCB3b3Jrc3BhY2VGb2xkZXIsIHJvb3REaXJlY3RvcnksIHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgICAgIHRoaXMuYXJnc1NlcnZpY2UgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzMuSUFyZ3VtZW50c1NlcnZpY2UsIHRoaXMudGVzdFByb3ZpZGVyKTtcclxuICAgICAgICB0aGlzLmhlbHBlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JVGVzdHNIZWxwZXIpO1xyXG4gICAgICAgIHRoaXMucnVubmVyID0gdGhpcy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18zLklUZXN0TWFuYWdlclJ1bm5lciwgdGhpcy50ZXN0UHJvdmlkZXIpO1xyXG4gICAgfVxyXG4gICAgZ2V0RGlzY292ZXJ5T3B0aW9ucyhpZ25vcmVDYWNoZSkge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSB0aGlzLnNldHRpbmdzLnVuaXRUZXN0LnB5VGVzdEFyZ3Muc2xpY2UoMCk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgd29ya3NwYWNlRm9sZGVyOiB0aGlzLndvcmtzcGFjZUZvbGRlcixcclxuICAgICAgICAgICAgY3dkOiB0aGlzLnJvb3REaXJlY3RvcnksIGFyZ3MsXHJcbiAgICAgICAgICAgIHRva2VuOiB0aGlzLnRlc3REaXNjb3ZlcnlDYW5jZWxsYXRpb25Ub2tlbiwgaWdub3JlQ2FjaGUsXHJcbiAgICAgICAgICAgIG91dENoYW5uZWw6IHRoaXMub3V0cHV0Q2hhbm5lbFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBydW5UZXN0SW1wbCh0ZXN0cywgdGVzdHNUb1J1biwgcnVuRmFpbGVkVGVzdHMsIGRlYnVnKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgbGV0IGFyZ3M7XHJcbiAgICAgICAgICAgIGNvbnN0IHJ1bkFsbFRlc3RzID0gdGhpcy5oZWxwZXIuc2hvdWxkUnVuQWxsVGVzdHModGVzdHNUb1J1bik7XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Zykge1xyXG4gICAgICAgICAgICAgICAgYXJncyA9IHRoaXMuYXJnc1NlcnZpY2UuZmlsdGVyQXJndW1lbnRzKHRoaXMuc2V0dGluZ3MudW5pdFRlc3QucHlUZXN0QXJncywgcnVuQWxsVGVzdHMgPyB0eXBlc18zLlRlc3RGaWx0ZXIuZGVidWdBbGwgOiB0eXBlc18zLlRlc3RGaWx0ZXIuZGVidWdTcGVjaWZpYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhcmdzID0gdGhpcy5hcmdzU2VydmljZS5maWx0ZXJBcmd1bWVudHModGhpcy5zZXR0aW5ncy51bml0VGVzdC5weVRlc3RBcmdzLCBydW5BbGxUZXN0cyA/IHR5cGVzXzMuVGVzdEZpbHRlci5ydW5BbGwgOiB0eXBlc18zLlRlc3RGaWx0ZXIucnVuU3BlY2lmaWMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChydW5GYWlsZWRUZXN0cyA9PT0gdHJ1ZSAmJiBhcmdzLmluZGV4T2YoJy0tbGYnKSA9PT0gLTEgJiYgYXJncy5pbmRleE9mKCctLWxhc3QtZmFpbGVkJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBhcmdzLnNwbGljZSgwLCAwLCAnLS1sYXN0LWZhaWxlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VGb2xkZXI6IHRoaXMud29ya3NwYWNlRm9sZGVyLFxyXG4gICAgICAgICAgICAgICAgY3dkOiB0aGlzLnJvb3REaXJlY3RvcnksXHJcbiAgICAgICAgICAgICAgICB0ZXN0cywgYXJncywgdGVzdHNUb1J1biwgZGVidWcsXHJcbiAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy50ZXN0UnVubmVyQ2FuY2VsbGF0aW9uVG9rZW4sXHJcbiAgICAgICAgICAgICAgICBvdXRDaGFubmVsOiB0aGlzLm91dHB1dENoYW5uZWxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucnVubmVyLnJ1blRlc3QodGhpcy50ZXN0UmVzdWx0c1NlcnZpY2UsIG9wdGlvbnMsIHRoaXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuVGVzdE1hbmFnZXIgPSBUZXN0TWFuYWdlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWFpbi5qcy5tYXAiXX0=