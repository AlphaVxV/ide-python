'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const vscode_1 = require("vscode");

const types_1 = require("../../common/application/types");

const constants = require("../../common/constants");

const helpers_1 = require("../../common/helpers");

const types_2 = require("../../common/types");

const misc_1 = require("../../common/utils/misc");

const types_3 = require("../../ioc/types");

const constants_1 = require("../common/constants");

const types_4 = require("../common/types");

let TestResultDisplay = class TestResultDisplay {
  // tslint:disable-next-line:no-any
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
    this.discoverCounter = 0;
    this.ticker = ['|', '/', '-', '|', '/', '-', '\\'];
    this._enabled = false;
    this.didChange = new vscode_1.EventEmitter();
    this.appShell = serviceContainer.get(types_1.IApplicationShell);
    this.statusBar = this.appShell.createStatusBarItem(vscode_1.StatusBarAlignment.Left);
    this.testsHelper = serviceContainer.get(types_4.ITestsHelper);
  }

  get onDidChange() {
    return this.didChange.event;
  }

  dispose() {
    this.clearProgressTicker();
    this.statusBar.dispose();
  }

  get enabled() {
    return this._enabled;
  }

  set enabled(enable) {
    this._enabled = enable;

    if (enable) {
      this.statusBar.show();
    } else {
      this.statusBar.hide();
    }
  }

  displayProgressStatus(testRunResult, debug = false) {
    this.displayProgress('Running Tests', 'Running Tests (Click to Stop)', constants.Commands.Tests_Ask_To_Stop_Test);
    testRunResult.then(tests => this.updateTestRunWithSuccess(tests, debug)).catch(this.updateTestRunWithFailure.bind(this)) // We don't care about any other exceptions returned by updateTestRunWithFailure
    .catch(misc_1.noop);
  }

  displayDiscoverStatus(testDiscovery, quietMode = false) {
    this.displayProgress('Discovering Tests', 'Discovering tests (click to stop)', constants.Commands.Tests_Ask_To_Stop_Discovery);
    return testDiscovery.then(tests => {
      this.updateWithDiscoverSuccess(tests, quietMode);
      return tests;
    }).catch(reason => {
      this.updateWithDiscoverFailure(reason);
      return Promise.reject(reason);
    });
  }

  updateTestRunWithSuccess(tests, debug = false) {
    this.clearProgressTicker(); // Treat errors as a special case, as we generally wouldn't have any errors

    const statusText = [];
    const toolTip = [];
    let foreColor = '';

    if (tests.summary.passed > 0) {
      statusText.push(`${constants.Octicons.Test_Pass} ${tests.summary.passed}`);
      toolTip.push(`${tests.summary.passed} Passed`);
      foreColor = '#66ff66';
    }

    if (tests.summary.skipped > 0) {
      statusText.push(`${constants.Octicons.Test_Skip} ${tests.summary.skipped}`);
      toolTip.push(`${tests.summary.skipped} Skipped`);
      foreColor = '#66ff66';
    }

    if (tests.summary.failures > 0) {
      statusText.push(`${constants.Octicons.Test_Fail} ${tests.summary.failures}`);
      toolTip.push(`${tests.summary.failures} Failed`);
      foreColor = 'yellow';
    }

    if (tests.summary.errors > 0) {
      statusText.push(`${constants.Octicons.Test_Error} ${tests.summary.errors}`);
      toolTip.push(`${tests.summary.errors} Error${tests.summary.errors > 1 ? 's' : ''}`);
      foreColor = 'yellow';
    }

    this.statusBar.tooltip = toolTip.length === 0 ? 'No Tests Ran' : `${toolTip.join(', ')} (Tests)`;
    this.statusBar.text = statusText.length === 0 ? 'No Tests Ran' : statusText.join(' ');
    this.statusBar.color = foreColor;
    this.statusBar.command = constants.Commands.Tests_View_UI;
    this.didChange.fire();

    if (statusText.length === 0 && !debug) {
      this.appShell.showWarningMessage('No tests ran, please check the configuration settings for the tests.');
    }

    return tests;
  } // tslint:disable-next-line:no-any


  updateTestRunWithFailure(reason) {
    this.clearProgressTicker();
    this.statusBar.command = constants.Commands.Tests_View_UI;

    if (reason === constants_1.CANCELLATION_REASON) {
      this.statusBar.text = '$(zap) Run Tests';
      this.statusBar.tooltip = 'Run Tests';
    } else {
      this.statusBar.text = '$(alert) Tests Failed';
      this.statusBar.tooltip = 'Running Tests Failed';
      this.testsHelper.displayTestErrorMessage('There was an error in running the tests.');
    }

    return Promise.reject(reason);
  }

  displayProgress(message, tooltip, command) {
    this.progressPrefix = this.statusBar.text = `$(stop) ${message}`;
    this.statusBar.command = command;
    this.statusBar.tooltip = tooltip;
    this.statusBar.show();
    this.clearProgressTicker();
    this.progressTimeout = setInterval(() => this.updateProgressTicker(), 150);
  }

  updateProgressTicker() {
    const text = `${this.progressPrefix} ${this.ticker[this.discoverCounter % 7]}`;
    this.discoverCounter += 1;
    this.statusBar.text = text;
  }

  clearProgressTicker() {
    if (this.progressTimeout) {
      clearInterval(this.progressTimeout);
    }

    this.progressTimeout = null;
    this.discoverCounter = 0;
  } // tslint:disable-next-line:no-any


  disableTests() {
    return __awaiter(this, void 0, void 0, function* () {
      const configurationService = this.serviceContainer.get(types_2.IConfigurationService);
      const settingsToDisable = ['unitTest.promptToConfigure', 'unitTest.pyTestEnabled', 'unitTest.unittestEnabled', 'unitTest.nosetestsEnabled'];

      for (const setting of settingsToDisable) {
        yield configurationService.updateSetting(setting, false).catch(misc_1.noop);
      }
    });
  }

  updateWithDiscoverSuccess(tests, quietMode = false) {
    this.clearProgressTicker();
    const haveTests = tests && tests.testFunctions.length > 0;
    this.statusBar.text = '$(zap) Run Tests';
    this.statusBar.tooltip = 'Run Tests';
    this.statusBar.command = constants.Commands.Tests_View_UI;
    this.statusBar.show();

    if (this.didChange) {
      this.didChange.fire();
    }

    if (!haveTests && !quietMode) {
      this.appShell.showInformationMessage('No tests discovered, please check the configuration settings for the tests.', 'Disable Tests').then(item => {
        if (item === 'Disable Tests') {
          this.disableTests().catch(ex => console.error('Python Extension: disableTests', ex));
        }
      });
    }
  } // tslint:disable-next-line:no-any


  updateWithDiscoverFailure(reason) {
    this.clearProgressTicker();
    this.statusBar.text = '$(zap) Discover Tests';
    this.statusBar.tooltip = 'Discover Tests';
    this.statusBar.command = constants.Commands.Tests_Discover;
    this.statusBar.show();
    this.statusBar.color = 'yellow';

    if (reason !== constants_1.CANCELLATION_REASON) {
      this.statusBar.text = '$(alert) Test discovery failed';
      this.statusBar.tooltip = 'Discovering Tests failed (view \'Python Test Log\' output panel for details)'; // tslint:disable-next-line:no-suspicious-comment
      // TODO: ignore this quitemode, always display the error message (inform the user).

      if (!helpers_1.isNotInstalledError(reason)) {
        // tslint:disable-next-line:no-suspicious-comment
        // TODO: show an option that will invoke a command 'python.test.configureTest' or similar.
        // This will be hanlded by main.ts that will capture input from user and configure the tests.
        this.appShell.showErrorMessage('Test discovery error, please check the configuration settings for the tests.');
      }
    }
  }

};
TestResultDisplay = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_3.IServiceContainer))], TestResultDisplay);
exports.TestResultDisplay = TestResultDisplay;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInZzY29kZV8xIiwidHlwZXNfMSIsImNvbnN0YW50cyIsImhlbHBlcnNfMSIsInR5cGVzXzIiLCJtaXNjXzEiLCJ0eXBlc18zIiwiY29uc3RhbnRzXzEiLCJ0eXBlc180IiwiVGVzdFJlc3VsdERpc3BsYXkiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJkaXNjb3ZlckNvdW50ZXIiLCJ0aWNrZXIiLCJfZW5hYmxlZCIsImRpZENoYW5nZSIsIkV2ZW50RW1pdHRlciIsImFwcFNoZWxsIiwiZ2V0IiwiSUFwcGxpY2F0aW9uU2hlbGwiLCJzdGF0dXNCYXIiLCJjcmVhdGVTdGF0dXNCYXJJdGVtIiwiU3RhdHVzQmFyQWxpZ25tZW50IiwiTGVmdCIsInRlc3RzSGVscGVyIiwiSVRlc3RzSGVscGVyIiwib25EaWRDaGFuZ2UiLCJldmVudCIsImRpc3Bvc2UiLCJjbGVhclByb2dyZXNzVGlja2VyIiwiZW5hYmxlZCIsImVuYWJsZSIsInNob3ciLCJoaWRlIiwiZGlzcGxheVByb2dyZXNzU3RhdHVzIiwidGVzdFJ1blJlc3VsdCIsImRlYnVnIiwiZGlzcGxheVByb2dyZXNzIiwiQ29tbWFuZHMiLCJUZXN0c19Bc2tfVG9fU3RvcF9UZXN0IiwidGVzdHMiLCJ1cGRhdGVUZXN0UnVuV2l0aFN1Y2Nlc3MiLCJjYXRjaCIsInVwZGF0ZVRlc3RSdW5XaXRoRmFpbHVyZSIsImJpbmQiLCJub29wIiwiZGlzcGxheURpc2NvdmVyU3RhdHVzIiwidGVzdERpc2NvdmVyeSIsInF1aWV0TW9kZSIsIlRlc3RzX0Fza19Ub19TdG9wX0Rpc2NvdmVyeSIsInVwZGF0ZVdpdGhEaXNjb3ZlclN1Y2Nlc3MiLCJyZWFzb24iLCJ1cGRhdGVXaXRoRGlzY292ZXJGYWlsdXJlIiwic3RhdHVzVGV4dCIsInRvb2xUaXAiLCJmb3JlQ29sb3IiLCJzdW1tYXJ5IiwicGFzc2VkIiwicHVzaCIsIk9jdGljb25zIiwiVGVzdF9QYXNzIiwic2tpcHBlZCIsIlRlc3RfU2tpcCIsImZhaWx1cmVzIiwiVGVzdF9GYWlsIiwiZXJyb3JzIiwiVGVzdF9FcnJvciIsInRvb2x0aXAiLCJqb2luIiwidGV4dCIsImNvbG9yIiwiY29tbWFuZCIsIlRlc3RzX1ZpZXdfVUkiLCJmaXJlIiwic2hvd1dhcm5pbmdNZXNzYWdlIiwiQ0FOQ0VMTEFUSU9OX1JFQVNPTiIsImRpc3BsYXlUZXN0RXJyb3JNZXNzYWdlIiwibWVzc2FnZSIsInByb2dyZXNzUHJlZml4IiwicHJvZ3Jlc3NUaW1lb3V0Iiwic2V0SW50ZXJ2YWwiLCJ1cGRhdGVQcm9ncmVzc1RpY2tlciIsImNsZWFySW50ZXJ2YWwiLCJkaXNhYmxlVGVzdHMiLCJjb25maWd1cmF0aW9uU2VydmljZSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsInNldHRpbmdzVG9EaXNhYmxlIiwic2V0dGluZyIsInVwZGF0ZVNldHRpbmciLCJoYXZlVGVzdHMiLCJ0ZXN0RnVuY3Rpb25zIiwic2hvd0luZm9ybWF0aW9uTWVzc2FnZSIsIml0ZW0iLCJleCIsImNvbnNvbGUiLCJlcnJvciIsIlRlc3RzX0Rpc2NvdmVyIiwiaXNOb3RJbnN0YWxsZWRFcnJvciIsInNob3dFcnJvck1lc3NhZ2UiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiSVNlcnZpY2VDb250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFVBQVUsR0FBSSxVQUFRLFNBQUtBLFVBQWQsSUFBNkIsVUFBVUMsVUFBVixFQUFzQkMsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUNuRixNQUFJQyxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsTUFBbEI7QUFBQSxNQUEwQkMsQ0FBQyxHQUFHSCxDQUFDLEdBQUcsQ0FBSixHQUFRSCxNQUFSLEdBQWlCRSxJQUFJLEtBQUssSUFBVCxHQUFnQkEsSUFBSSxHQUFHSyxNQUFNLENBQUNDLHdCQUFQLENBQWdDUixNQUFoQyxFQUF3Q0MsR0FBeEMsQ0FBdkIsR0FBc0VDLElBQXJIO0FBQUEsTUFBMkhPLENBQTNIO0FBQ0EsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFFBQW5CLElBQStCLE9BQU9BLE9BQU8sQ0FBQ0MsUUFBZixLQUE0QixVQUEvRCxFQUEyRUwsQ0FBQyxHQUFHSSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJaLFVBQWpCLEVBQTZCQyxNQUE3QixFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLENBQUosQ0FBM0UsS0FDSyxLQUFLLElBQUlVLENBQUMsR0FBR2IsVUFBVSxDQUFDTSxNQUFYLEdBQW9CLENBQWpDLEVBQW9DTyxDQUFDLElBQUksQ0FBekMsRUFBNENBLENBQUMsRUFBN0MsRUFBaUQsSUFBSUgsQ0FBQyxHQUFHVixVQUFVLENBQUNhLENBQUQsQ0FBbEIsRUFBdUJOLENBQUMsR0FBRyxDQUFDSCxDQUFDLEdBQUcsQ0FBSixHQUFRTSxDQUFDLENBQUNILENBQUQsQ0FBVCxHQUFlSCxDQUFDLEdBQUcsQ0FBSixHQUFRTSxDQUFDLENBQUNULE1BQUQsRUFBU0MsR0FBVCxFQUFjSyxDQUFkLENBQVQsR0FBNEJHLENBQUMsQ0FBQ1QsTUFBRCxFQUFTQyxHQUFULENBQTdDLEtBQStESyxDQUFuRTtBQUM3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TCxFQUE0QztBQUN4QztBQUNBO0FBQ0E7QUFDQSxhQUFLbEMsUUFBTCxDQUFjaUYsZ0JBQWQsQ0FBK0IsOEVBQS9CO0FBQ0g7QUFDSjtBQUNKOztBQTFLMkMsQ0FBaEQ7QUE0S0F6RixpQkFBaUIsR0FBR2pELFVBQVUsQ0FBQyxDQUMzQnNDLFdBQVcsQ0FBQ3FHLFVBQVosRUFEMkIsRUFFM0IzSCxPQUFPLENBQUMsQ0FBRCxFQUFJc0IsV0FBVyxDQUFDc0csTUFBWixDQUFtQjlGLE9BQU8sQ0FBQytGLGlCQUEzQixDQUFKLENBRm9CLENBQUQsRUFHM0I1RixpQkFIMkIsQ0FBOUI7QUFJQVosT0FBTyxDQUFDWSxpQkFBUixHQUE0QkEsaUJBQTVCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn07XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCBjb25zdGFudHMgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgaGVscGVyc18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9oZWxwZXJzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi91dGlscy9taXNjXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uL2lvYy90eXBlc1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi9jb21tb24vdHlwZXNcIik7XHJcbmxldCBUZXN0UmVzdWx0RGlzcGxheSA9IGNsYXNzIFRlc3RSZXN1bHREaXNwbGF5IHtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2VDb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLnNlcnZpY2VDb250YWluZXIgPSBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuZGlzY292ZXJDb3VudGVyID0gMDtcclxuICAgICAgICB0aGlzLnRpY2tlciA9IFsnfCcsICcvJywgJy0nLCAnfCcsICcvJywgJy0nLCAnXFxcXCddO1xyXG4gICAgICAgIHRoaXMuX2VuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmRpZENoYW5nZSA9IG5ldyB2c2NvZGVfMS5FdmVudEVtaXR0ZXIoKTtcclxuICAgICAgICB0aGlzLmFwcFNoZWxsID0gc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JQXBwbGljYXRpb25TaGVsbCk7XHJcbiAgICAgICAgdGhpcy5zdGF0dXNCYXIgPSB0aGlzLmFwcFNoZWxsLmNyZWF0ZVN0YXR1c0Jhckl0ZW0odnNjb2RlXzEuU3RhdHVzQmFyQWxpZ25tZW50LkxlZnQpO1xyXG4gICAgICAgIHRoaXMudGVzdHNIZWxwZXIgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc180LklUZXN0c0hlbHBlcik7XHJcbiAgICB9XHJcbiAgICBnZXQgb25EaWRDaGFuZ2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlkQ2hhbmdlLmV2ZW50O1xyXG4gICAgfVxyXG4gICAgZGlzcG9zZSgpIHtcclxuICAgICAgICB0aGlzLmNsZWFyUHJvZ3Jlc3NUaWNrZXIoKTtcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5kaXNwb3NlKCk7XHJcbiAgICB9XHJcbiAgICBnZXQgZW5hYmxlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZDtcclxuICAgIH1cclxuICAgIHNldCBlbmFibGVkKGVuYWJsZSkge1xyXG4gICAgICAgIHRoaXMuX2VuYWJsZWQgPSBlbmFibGU7XHJcbiAgICAgICAgaWYgKGVuYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5zaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci5oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZGlzcGxheVByb2dyZXNzU3RhdHVzKHRlc3RSdW5SZXN1bHQsIGRlYnVnID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLmRpc3BsYXlQcm9ncmVzcygnUnVubmluZyBUZXN0cycsICdSdW5uaW5nIFRlc3RzIChDbGljayB0byBTdG9wKScsIGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19Bc2tfVG9fU3RvcF9UZXN0KTtcclxuICAgICAgICB0ZXN0UnVuUmVzdWx0XHJcbiAgICAgICAgICAgIC50aGVuKHRlc3RzID0+IHRoaXMudXBkYXRlVGVzdFJ1bldpdGhTdWNjZXNzKHRlc3RzLCBkZWJ1ZykpXHJcbiAgICAgICAgICAgIC5jYXRjaCh0aGlzLnVwZGF0ZVRlc3RSdW5XaXRoRmFpbHVyZS5iaW5kKHRoaXMpKVxyXG4gICAgICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGFueSBvdGhlciBleGNlcHRpb25zIHJldHVybmVkIGJ5IHVwZGF0ZVRlc3RSdW5XaXRoRmFpbHVyZVxyXG4gICAgICAgICAgICAuY2F0Y2gobWlzY18xLm5vb3ApO1xyXG4gICAgfVxyXG4gICAgZGlzcGxheURpc2NvdmVyU3RhdHVzKHRlc3REaXNjb3ZlcnksIHF1aWV0TW9kZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5UHJvZ3Jlc3MoJ0Rpc2NvdmVyaW5nIFRlc3RzJywgJ0Rpc2NvdmVyaW5nIHRlc3RzIChjbGljayB0byBzdG9wKScsIGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19Bc2tfVG9fU3RvcF9EaXNjb3ZlcnkpO1xyXG4gICAgICAgIHJldHVybiB0ZXN0RGlzY292ZXJ5LnRoZW4odGVzdHMgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVdpdGhEaXNjb3ZlclN1Y2Nlc3ModGVzdHMsIHF1aWV0TW9kZSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXN0cztcclxuICAgICAgICB9KS5jYXRjaChyZWFzb24gPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVdpdGhEaXNjb3ZlckZhaWx1cmUocmVhc29uKTtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB1cGRhdGVUZXN0UnVuV2l0aFN1Y2Nlc3ModGVzdHMsIGRlYnVnID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLmNsZWFyUHJvZ3Jlc3NUaWNrZXIoKTtcclxuICAgICAgICAvLyBUcmVhdCBlcnJvcnMgYXMgYSBzcGVjaWFsIGNhc2UsIGFzIHdlIGdlbmVyYWxseSB3b3VsZG4ndCBoYXZlIGFueSBlcnJvcnNcclxuICAgICAgICBjb25zdCBzdGF0dXNUZXh0ID0gW107XHJcbiAgICAgICAgY29uc3QgdG9vbFRpcCA9IFtdO1xyXG4gICAgICAgIGxldCBmb3JlQ29sb3IgPSAnJztcclxuICAgICAgICBpZiAodGVzdHMuc3VtbWFyeS5wYXNzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgIHN0YXR1c1RleHQucHVzaChgJHtjb25zdGFudHMuT2N0aWNvbnMuVGVzdF9QYXNzfSAke3Rlc3RzLnN1bW1hcnkucGFzc2VkfWApO1xyXG4gICAgICAgICAgICB0b29sVGlwLnB1c2goYCR7dGVzdHMuc3VtbWFyeS5wYXNzZWR9IFBhc3NlZGApO1xyXG4gICAgICAgICAgICBmb3JlQ29sb3IgPSAnIzY2ZmY2Nic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0ZXN0cy5zdW1tYXJ5LnNraXBwZWQgPiAwKSB7XHJcbiAgICAgICAgICAgIHN0YXR1c1RleHQucHVzaChgJHtjb25zdGFudHMuT2N0aWNvbnMuVGVzdF9Ta2lwfSAke3Rlc3RzLnN1bW1hcnkuc2tpcHBlZH1gKTtcclxuICAgICAgICAgICAgdG9vbFRpcC5wdXNoKGAke3Rlc3RzLnN1bW1hcnkuc2tpcHBlZH0gU2tpcHBlZGApO1xyXG4gICAgICAgICAgICBmb3JlQ29sb3IgPSAnIzY2ZmY2Nic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0ZXN0cy5zdW1tYXJ5LmZhaWx1cmVzID4gMCkge1xyXG4gICAgICAgICAgICBzdGF0dXNUZXh0LnB1c2goYCR7Y29uc3RhbnRzLk9jdGljb25zLlRlc3RfRmFpbH0gJHt0ZXN0cy5zdW1tYXJ5LmZhaWx1cmVzfWApO1xyXG4gICAgICAgICAgICB0b29sVGlwLnB1c2goYCR7dGVzdHMuc3VtbWFyeS5mYWlsdXJlc30gRmFpbGVkYCk7XHJcbiAgICAgICAgICAgIGZvcmVDb2xvciA9ICd5ZWxsb3cnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGVzdHMuc3VtbWFyeS5lcnJvcnMgPiAwKSB7XHJcbiAgICAgICAgICAgIHN0YXR1c1RleHQucHVzaChgJHtjb25zdGFudHMuT2N0aWNvbnMuVGVzdF9FcnJvcn0gJHt0ZXN0cy5zdW1tYXJ5LmVycm9yc31gKTtcclxuICAgICAgICAgICAgdG9vbFRpcC5wdXNoKGAke3Rlc3RzLnN1bW1hcnkuZXJyb3JzfSBFcnJvciR7dGVzdHMuc3VtbWFyeS5lcnJvcnMgPiAxID8gJ3MnIDogJyd9YCk7XHJcbiAgICAgICAgICAgIGZvcmVDb2xvciA9ICd5ZWxsb3cnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci50b29sdGlwID0gdG9vbFRpcC5sZW5ndGggPT09IDAgPyAnTm8gVGVzdHMgUmFuJyA6IGAke3Rvb2xUaXAuam9pbignLCAnKX0gKFRlc3RzKWA7XHJcbiAgICAgICAgdGhpcy5zdGF0dXNCYXIudGV4dCA9IHN0YXR1c1RleHQubGVuZ3RoID09PSAwID8gJ05vIFRlc3RzIFJhbicgOiBzdGF0dXNUZXh0LmpvaW4oJyAnKTtcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5jb2xvciA9IGZvcmVDb2xvcjtcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5jb21tYW5kID0gY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX1ZpZXdfVUk7XHJcbiAgICAgICAgdGhpcy5kaWRDaGFuZ2UuZmlyZSgpO1xyXG4gICAgICAgIGlmIChzdGF0dXNUZXh0Lmxlbmd0aCA9PT0gMCAmJiAhZGVidWcpIHtcclxuICAgICAgICAgICAgdGhpcy5hcHBTaGVsbC5zaG93V2FybmluZ01lc3NhZ2UoJ05vIHRlc3RzIHJhbiwgcGxlYXNlIGNoZWNrIHRoZSBjb25maWd1cmF0aW9uIHNldHRpbmdzIGZvciB0aGUgdGVzdHMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0ZXN0cztcclxuICAgIH1cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgIHVwZGF0ZVRlc3RSdW5XaXRoRmFpbHVyZShyZWFzb24pIHtcclxuICAgICAgICB0aGlzLmNsZWFyUHJvZ3Jlc3NUaWNrZXIoKTtcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5jb21tYW5kID0gY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX1ZpZXdfVUk7XHJcbiAgICAgICAgaWYgKHJlYXNvbiA9PT0gY29uc3RhbnRzXzEuQ0FOQ0VMTEFUSU9OX1JFQVNPTikge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci50ZXh0ID0gJyQoemFwKSBSdW4gVGVzdHMnO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci50b29sdGlwID0gJ1J1biBUZXN0cyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci50ZXh0ID0gJyQoYWxlcnQpIFRlc3RzIEZhaWxlZCc7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyLnRvb2x0aXAgPSAnUnVubmluZyBUZXN0cyBGYWlsZWQnO1xyXG4gICAgICAgICAgICB0aGlzLnRlc3RzSGVscGVyLmRpc3BsYXlUZXN0RXJyb3JNZXNzYWdlKCdUaGVyZSB3YXMgYW4gZXJyb3IgaW4gcnVubmluZyB0aGUgdGVzdHMuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZWFzb24pO1xyXG4gICAgfVxyXG4gICAgZGlzcGxheVByb2dyZXNzKG1lc3NhZ2UsIHRvb2x0aXAsIGNvbW1hbmQpIHtcclxuICAgICAgICB0aGlzLnByb2dyZXNzUHJlZml4ID0gdGhpcy5zdGF0dXNCYXIudGV4dCA9IGAkKHN0b3ApICR7bWVzc2FnZX1gO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLmNvbW1hbmQgPSBjb21tYW5kO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLnRvb2x0aXAgPSB0b29sdGlwO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLnNob3coKTtcclxuICAgICAgICB0aGlzLmNsZWFyUHJvZ3Jlc3NUaWNrZXIoKTtcclxuICAgICAgICB0aGlzLnByb2dyZXNzVGltZW91dCA9IHNldEludGVydmFsKCgpID0+IHRoaXMudXBkYXRlUHJvZ3Jlc3NUaWNrZXIoKSwgMTUwKTtcclxuICAgIH1cclxuICAgIHVwZGF0ZVByb2dyZXNzVGlja2VyKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSBgJHt0aGlzLnByb2dyZXNzUHJlZml4fSAke3RoaXMudGlja2VyW3RoaXMuZGlzY292ZXJDb3VudGVyICUgN119YDtcclxuICAgICAgICB0aGlzLmRpc2NvdmVyQ291bnRlciArPSAxO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLnRleHQgPSB0ZXh0O1xyXG4gICAgfVxyXG4gICAgY2xlYXJQcm9ncmVzc1RpY2tlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5wcm9ncmVzc1RpbWVvdXQpIHtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnByb2dyZXNzVGltZW91dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3NUaW1lb3V0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRpc2NvdmVyQ291bnRlciA9IDA7XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICBkaXNhYmxlVGVzdHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgY29uZmlndXJhdGlvblNlcnZpY2UgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzIuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlKTtcclxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3NUb0Rpc2FibGUgPSBbJ3VuaXRUZXN0LnByb21wdFRvQ29uZmlndXJlJywgJ3VuaXRUZXN0LnB5VGVzdEVuYWJsZWQnLFxyXG4gICAgICAgICAgICAgICAgJ3VuaXRUZXN0LnVuaXR0ZXN0RW5hYmxlZCcsICd1bml0VGVzdC5ub3NldGVzdHNFbmFibGVkJ107XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc2V0dGluZyBvZiBzZXR0aW5nc1RvRGlzYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgY29uZmlndXJhdGlvblNlcnZpY2UudXBkYXRlU2V0dGluZyhzZXR0aW5nLCBmYWxzZSkuY2F0Y2gobWlzY18xLm5vb3ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB1cGRhdGVXaXRoRGlzY292ZXJTdWNjZXNzKHRlc3RzLCBxdWlldE1vZGUgPSBmYWxzZSkge1xyXG4gICAgICAgIHRoaXMuY2xlYXJQcm9ncmVzc1RpY2tlcigpO1xyXG4gICAgICAgIGNvbnN0IGhhdmVUZXN0cyA9IHRlc3RzICYmICh0ZXN0cy50ZXN0RnVuY3Rpb25zLmxlbmd0aCA+IDApO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLnRleHQgPSAnJCh6YXApIFJ1biBUZXN0cyc7XHJcbiAgICAgICAgdGhpcy5zdGF0dXNCYXIudG9vbHRpcCA9ICdSdW4gVGVzdHMnO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLmNvbW1hbmQgPSBjb25zdGFudHMuQ29tbWFuZHMuVGVzdHNfVmlld19VSTtcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5zaG93KCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlkQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlkQ2hhbmdlLmZpcmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFoYXZlVGVzdHMgJiYgIXF1aWV0TW9kZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFwcFNoZWxsLnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoJ05vIHRlc3RzIGRpc2NvdmVyZWQsIHBsZWFzZSBjaGVjayB0aGUgY29uZmlndXJhdGlvbiBzZXR0aW5ncyBmb3IgdGhlIHRlc3RzLicsICdEaXNhYmxlIFRlc3RzJykudGhlbihpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtID09PSAnRGlzYWJsZSBUZXN0cycpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGVUZXN0cygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChleCA9PiBjb25zb2xlLmVycm9yKCdQeXRob24gRXh0ZW5zaW9uOiBkaXNhYmxlVGVzdHMnLCBleCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICB1cGRhdGVXaXRoRGlzY292ZXJGYWlsdXJlKHJlYXNvbikge1xyXG4gICAgICAgIHRoaXMuY2xlYXJQcm9ncmVzc1RpY2tlcigpO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLnRleHQgPSAnJCh6YXApIERpc2NvdmVyIFRlc3RzJztcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci50b29sdGlwID0gJ0Rpc2NvdmVyIFRlc3RzJztcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5jb21tYW5kID0gY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX0Rpc2NvdmVyO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQmFyLnNob3coKTtcclxuICAgICAgICB0aGlzLnN0YXR1c0Jhci5jb2xvciA9ICd5ZWxsb3cnO1xyXG4gICAgICAgIGlmIChyZWFzb24gIT09IGNvbnN0YW50c18xLkNBTkNFTExBVElPTl9SRUFTT04pIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXIudGV4dCA9ICckKGFsZXJ0KSBUZXN0IGRpc2NvdmVyeSBmYWlsZWQnO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0Jhci50b29sdGlwID0gJ0Rpc2NvdmVyaW5nIFRlc3RzIGZhaWxlZCAodmlldyBcXCdQeXRob24gVGVzdCBMb2dcXCcgb3V0cHV0IHBhbmVsIGZvciBkZXRhaWxzKSc7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1zdXNwaWNpb3VzLWNvbW1lbnRcclxuICAgICAgICAgICAgLy8gVE9ETzogaWdub3JlIHRoaXMgcXVpdGVtb2RlLCBhbHdheXMgZGlzcGxheSB0aGUgZXJyb3IgbWVzc2FnZSAoaW5mb3JtIHRoZSB1c2VyKS5cclxuICAgICAgICAgICAgaWYgKCFoZWxwZXJzXzEuaXNOb3RJbnN0YWxsZWRFcnJvcihyZWFzb24pKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tc3VzcGljaW91cy1jb21tZW50XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBzaG93IGFuIG9wdGlvbiB0aGF0IHdpbGwgaW52b2tlIGEgY29tbWFuZCAncHl0aG9uLnRlc3QuY29uZmlndXJlVGVzdCcgb3Igc2ltaWxhci5cclxuICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBiZSBoYW5sZGVkIGJ5IG1haW4udHMgdGhhdCB3aWxsIGNhcHR1cmUgaW5wdXQgZnJvbSB1c2VyIGFuZCBjb25maWd1cmUgdGhlIHRlc3RzLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBTaGVsbC5zaG93RXJyb3JNZXNzYWdlKCdUZXN0IGRpc2NvdmVyeSBlcnJvciwgcGxlYXNlIGNoZWNrIHRoZSBjb25maWd1cmF0aW9uIHNldHRpbmdzIGZvciB0aGUgdGVzdHMuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblRlc3RSZXN1bHREaXNwbGF5ID0gX19kZWNvcmF0ZShbXHJcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXHJcbiAgICBfX3BhcmFtKDAsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc18zLklTZXJ2aWNlQ29udGFpbmVyKSlcclxuXSwgVGVzdFJlc3VsdERpc3BsYXkpO1xyXG5leHBvcnRzLlRlc3RSZXN1bHREaXNwbGF5ID0gVGVzdFJlc3VsdERpc3BsYXk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1haW4uanMubWFwIl19