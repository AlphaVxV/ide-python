"use strict";

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const path = require("path");

const vscode_1 = require("vscode");

const types_1 = require("../../common/application/types");

const constants = require("../../common/constants");

const misc_1 = require("../../common/utils/misc");

const types_2 = require("../../ioc/types");

const types_3 = require("../common/types");

let TestDisplay = class TestDisplay {
  constructor(serviceRegistry) {
    this.testCollectionStorage = serviceRegistry.get(types_3.ITestCollectionStorageService);
    this.appShell = serviceRegistry.get(types_1.IApplicationShell);
  }

  displayStopTestUI(workspace, message) {
    this.appShell.showQuickPick([message]).then(item => {
      if (item === message) {
        vscode_1.commands.executeCommand(constants.Commands.Tests_Stop, undefined, workspace);
      }
    });
  }

  displayTestUI(cmdSource, wkspace) {
    const tests = this.testCollectionStorage.getTests(wkspace);
    this.appShell.showQuickPick(buildItems(tests), {
      matchOnDescription: true,
      matchOnDetail: true
    }).then(item => item ? onItemSelected(cmdSource, wkspace, item, false) : misc_1.noop());
  }

  selectTestFunction(rootDirectory, tests) {
    return new Promise((resolve, reject) => {
      this.appShell.showQuickPick(buildItemsForFunctions(rootDirectory, tests.testFunctions), {
        matchOnDescription: true,
        matchOnDetail: true
      }).then(item => {
        if (item && item.fn) {
          return resolve(item.fn);
        }

        return reject();
      }, reject);
    });
  }

  selectTestFile(rootDirectory, tests) {
    return new Promise((resolve, reject) => {
      this.appShell.showQuickPick(buildItemsForTestFiles(rootDirectory, tests.testFiles), {
        matchOnDescription: true,
        matchOnDetail: true
      }).then(item => {
        if (item && item.testFile) {
          return resolve(item.testFile);
        }

        return reject();
      }, reject);
    });
  }

  displayFunctionTestPickerUI(cmdSource, wkspace, rootDirectory, file, testFunctions, debug) {
    const tests = this.testCollectionStorage.getTests(wkspace);

    if (!tests) {
      return;
    }

    const fileName = file.fsPath;
    const testFile = tests.testFiles.find(item => item.name === fileName || item.fullPath === fileName);

    if (!testFile) {
      return;
    }

    const flattenedFunctions = tests.testFunctions.filter(fn => {
      return fn.parentTestFile.name === testFile.name && testFunctions.some(testFunc => testFunc.nameToRun === fn.testFunction.nameToRun);
    });
    this.appShell.showQuickPick(buildItemsForFunctions(rootDirectory, flattenedFunctions, undefined, undefined, debug), {
      matchOnDescription: true,
      matchOnDetail: true
    }).then(testItem => testItem ? onItemSelected(cmdSource, wkspace, testItem, debug) : misc_1.noop());
  }

};
TestDisplay = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], TestDisplay);
exports.TestDisplay = TestDisplay;
var Type;

(function (Type) {
  Type[Type["RunAll"] = 0] = "RunAll";
  Type[Type["ReDiscover"] = 1] = "ReDiscover";
  Type[Type["RunFailed"] = 2] = "RunFailed";
  Type[Type["RunFolder"] = 3] = "RunFolder";
  Type[Type["RunFile"] = 4] = "RunFile";
  Type[Type["RunClass"] = 5] = "RunClass";
  Type[Type["RunMethod"] = 6] = "RunMethod";
  Type[Type["ViewTestOutput"] = 7] = "ViewTestOutput";
  Type[Type["Null"] = 8] = "Null";
  Type[Type["SelectAndRunMethod"] = 9] = "SelectAndRunMethod";
  Type[Type["DebugMethod"] = 10] = "DebugMethod";
})(Type || (Type = {}));

const statusIconMapping = new Map();
statusIconMapping.set(types_3.TestStatus.Pass, constants.Octicons.Test_Pass);
statusIconMapping.set(types_3.TestStatus.Fail, constants.Octicons.Test_Fail);
statusIconMapping.set(types_3.TestStatus.Error, constants.Octicons.Test_Error);
statusIconMapping.set(types_3.TestStatus.Skipped, constants.Octicons.Test_Skip);

function getSummary(tests) {
  if (!tests || !tests.summary) {
    return '';
  }

  const statusText = [];

  if (tests.summary.passed > 0) {
    statusText.push(`${constants.Octicons.Test_Pass} ${tests.summary.passed} Passed`);
  }

  if (tests.summary.failures > 0) {
    statusText.push(`${constants.Octicons.Test_Fail} ${tests.summary.failures} Failed`);
  }

  if (tests.summary.errors > 0) {
    const plural = tests.summary.errors === 1 ? '' : 's';
    statusText.push(`${constants.Octicons.Test_Error} ${tests.summary.errors} Error${plural}`);
  }

  if (tests.summary.skipped > 0) {
    statusText.push(`${constants.Octicons.Test_Skip} ${tests.summary.skipped} Skipped`);
  }

  return statusText.join(', ').trim();
}

function buildItems(tests) {
  const items = [];
  items.push({
    description: '',
    label: 'Run All Unit Tests',
    type: Type.RunAll
  });
  items.push({
    description: '',
    label: 'Discover Unit Tests',
    type: Type.ReDiscover
  });
  items.push({
    description: '',
    label: 'Run Unit Test Method ...',
    type: Type.SelectAndRunMethod
  });
  const summary = getSummary(tests);
  items.push({
    description: '',
    label: 'View Unit Test Output',
    type: Type.ViewTestOutput,
    detail: summary
  });

  if (tests && tests.summary.failures > 0) {
    items.push({
      description: '',
      label: 'Run Failed Tests',
      type: Type.RunFailed,
      detail: `${constants.Octicons.Test_Fail} ${tests.summary.failures} Failed`
    });
  }

  return items;
}

const statusSortPrefix = {};
statusSortPrefix[types_3.TestStatus.Error] = '1';
statusSortPrefix[types_3.TestStatus.Fail] = '2';
statusSortPrefix[types_3.TestStatus.Skipped] = '3';
statusSortPrefix[types_3.TestStatus.Pass] = '4';

function buildItemsForFunctions(rootDirectory, tests, sortBasedOnResults = false, displayStatusIcons = false, debug = false) {
  const functionItems = [];
  tests.forEach(fn => {
    let icon = '';

    if (displayStatusIcons && fn.testFunction.status && statusIconMapping.has(fn.testFunction.status)) {
      icon = `${statusIconMapping.get(fn.testFunction.status)} `;
    }

    functionItems.push({
      description: '',
      detail: path.relative(rootDirectory, fn.parentTestFile.fullPath),
      label: icon + fn.testFunction.name,
      type: debug === true ? Type.DebugMethod : Type.RunMethod,
      fn: fn
    });
  });
  functionItems.sort((a, b) => {
    let sortAPrefix = '5-';
    let sortBPrefix = '5-';

    if (sortBasedOnResults && a.fn && a.fn.testFunction.status && b.fn && b.fn.testFunction.status) {
      sortAPrefix = statusSortPrefix[a.fn.testFunction.status] ? statusSortPrefix[a.fn.testFunction.status] : sortAPrefix;
      sortBPrefix = statusSortPrefix[b.fn.testFunction.status] ? statusSortPrefix[b.fn.testFunction.status] : sortBPrefix;
    }

    if (sortAPrefix + a.detail + a.label < sortBPrefix + b.detail + b.label) {
      return -1;
    }

    if (sortAPrefix + a.detail + a.label > sortBPrefix + b.detail + b.label) {
      return 1;
    }

    return 0;
  });
  return functionItems;
}

function buildItemsForTestFiles(rootDirectory, testFiles) {
  const fileItems = testFiles.map(testFile => {
    return {
      description: '',
      detail: path.relative(rootDirectory, testFile.fullPath),
      type: Type.RunFile,
      label: path.basename(testFile.fullPath),
      testFile: testFile
    };
  });
  fileItems.sort((a, b) => {
    if (!a.detail && !b.detail) {
      return 0;
    }

    if (!a.detail || a.detail < b.detail) {
      return -1;
    }

    if (!b.detail || a.detail > b.detail) {
      return 1;
    }

    return 0;
  });
  return fileItems;
}

function onItemSelected(cmdSource, wkspace, selection, debug) {
  if (!selection || typeof selection.type !== 'number') {
    return;
  }

  let cmd = ''; // tslint:disable-next-line:no-any

  const args = [undefined, cmdSource, wkspace];

  switch (selection.type) {
    case Type.Null:
      {
        return;
      }

    case Type.RunAll:
      {
        cmd = constants.Commands.Tests_Run;
        break;
      }

    case Type.ReDiscover:
      {
        cmd = constants.Commands.Tests_Discover;
        break;
      }

    case Type.ViewTestOutput:
      {
        cmd = constants.Commands.Tests_ViewOutput;
        break;
      }

    case Type.RunFailed:
      {
        cmd = constants.Commands.Tests_Run_Failed;
        break;
      }

    case Type.SelectAndRunMethod:
      {
        cmd = debug ? constants.Commands.Tests_Select_And_Debug_Method : constants.Commands.Tests_Select_And_Run_Method;
        break;
      }

    case Type.RunMethod:
      {
        cmd = constants.Commands.Tests_Run; // tslint:disable-next-line:prefer-type-cast no-object-literal-type-assertion

        args.push({
          testFunction: [selection.fn.testFunction]
        });
        break;
      }

    case Type.DebugMethod:
      {
        cmd = constants.Commands.Tests_Debug; // tslint:disable-next-line:prefer-type-cast no-object-literal-type-assertion

        args.push({
          testFunction: [selection.fn.testFunction]
        });
        args.push(true);
        break;
      }

    default:
      {
        return;
      }
  }

  vscode_1.commands.executeCommand(cmd, ...args);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBpY2tlci5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX3BhcmFtIiwicGFyYW1JbmRleCIsImRlY29yYXRvciIsImV4cG9ydHMiLCJ2YWx1ZSIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInBhdGgiLCJ2c2NvZGVfMSIsInR5cGVzXzEiLCJjb25zdGFudHMiLCJtaXNjXzEiLCJ0eXBlc18yIiwidHlwZXNfMyIsIlRlc3REaXNwbGF5IiwiY29uc3RydWN0b3IiLCJzZXJ2aWNlUmVnaXN0cnkiLCJ0ZXN0Q29sbGVjdGlvblN0b3JhZ2UiLCJnZXQiLCJJVGVzdENvbGxlY3Rpb25TdG9yYWdlU2VydmljZSIsImFwcFNoZWxsIiwiSUFwcGxpY2F0aW9uU2hlbGwiLCJkaXNwbGF5U3RvcFRlc3RVSSIsIndvcmtzcGFjZSIsIm1lc3NhZ2UiLCJzaG93UXVpY2tQaWNrIiwidGhlbiIsIml0ZW0iLCJjb21tYW5kcyIsImV4ZWN1dGVDb21tYW5kIiwiQ29tbWFuZHMiLCJUZXN0c19TdG9wIiwidW5kZWZpbmVkIiwiZGlzcGxheVRlc3RVSSIsImNtZFNvdXJjZSIsIndrc3BhY2UiLCJ0ZXN0cyIsImdldFRlc3RzIiwiYnVpbGRJdGVtcyIsIm1hdGNoT25EZXNjcmlwdGlvbiIsIm1hdGNoT25EZXRhaWwiLCJvbkl0ZW1TZWxlY3RlZCIsIm5vb3AiLCJzZWxlY3RUZXN0RnVuY3Rpb24iLCJyb290RGlyZWN0b3J5IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJidWlsZEl0ZW1zRm9yRnVuY3Rpb25zIiwidGVzdEZ1bmN0aW9ucyIsImZuIiwic2VsZWN0VGVzdEZpbGUiLCJidWlsZEl0ZW1zRm9yVGVzdEZpbGVzIiwidGVzdEZpbGVzIiwidGVzdEZpbGUiLCJkaXNwbGF5RnVuY3Rpb25UZXN0UGlja2VyVUkiLCJmaWxlIiwiZGVidWciLCJmaWxlTmFtZSIsImZzUGF0aCIsImZpbmQiLCJuYW1lIiwiZnVsbFBhdGgiLCJmbGF0dGVuZWRGdW5jdGlvbnMiLCJmaWx0ZXIiLCJwYXJlbnRUZXN0RmlsZSIsInNvbWUiLCJ0ZXN0RnVuYyIsIm5hbWVUb1J1biIsInRlc3RGdW5jdGlvbiIsInRlc3RJdGVtIiwiaW5qZWN0YWJsZSIsImluamVjdCIsIklTZXJ2aWNlQ29udGFpbmVyIiwiVHlwZSIsInN0YXR1c0ljb25NYXBwaW5nIiwiTWFwIiwic2V0IiwiVGVzdFN0YXR1cyIsIlBhc3MiLCJPY3RpY29ucyIsIlRlc3RfUGFzcyIsIkZhaWwiLCJUZXN0X0ZhaWwiLCJFcnJvciIsIlRlc3RfRXJyb3IiLCJTa2lwcGVkIiwiVGVzdF9Ta2lwIiwiZ2V0U3VtbWFyeSIsInN1bW1hcnkiLCJzdGF0dXNUZXh0IiwicGFzc2VkIiwicHVzaCIsImZhaWx1cmVzIiwiZXJyb3JzIiwicGx1cmFsIiwic2tpcHBlZCIsImpvaW4iLCJ0cmltIiwiaXRlbXMiLCJkZXNjcmlwdGlvbiIsImxhYmVsIiwidHlwZSIsIlJ1bkFsbCIsIlJlRGlzY292ZXIiLCJTZWxlY3RBbmRSdW5NZXRob2QiLCJWaWV3VGVzdE91dHB1dCIsImRldGFpbCIsIlJ1bkZhaWxlZCIsInN0YXR1c1NvcnRQcmVmaXgiLCJzb3J0QmFzZWRPblJlc3VsdHMiLCJkaXNwbGF5U3RhdHVzSWNvbnMiLCJmdW5jdGlvbkl0ZW1zIiwiZm9yRWFjaCIsImljb24iLCJzdGF0dXMiLCJoYXMiLCJyZWxhdGl2ZSIsIkRlYnVnTWV0aG9kIiwiUnVuTWV0aG9kIiwic29ydCIsImEiLCJiIiwic29ydEFQcmVmaXgiLCJzb3J0QlByZWZpeCIsImZpbGVJdGVtcyIsIm1hcCIsIlJ1bkZpbGUiLCJiYXNlbmFtZSIsInNlbGVjdGlvbiIsImNtZCIsImFyZ3MiLCJOdWxsIiwiVGVzdHNfUnVuIiwiVGVzdHNfRGlzY292ZXIiLCJUZXN0c19WaWV3T3V0cHV0IiwiVGVzdHNfUnVuX0ZhaWxlZCIsIlRlc3RzX1NlbGVjdF9BbmRfRGVidWdfTWV0aG9kIiwiVGVzdHNfU2VsZWN0X0FuZF9SdW5fTWV0aG9kIiwiVGVzdHNfRGVidWciXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFVBQVUsR0FBSSxVQUFRLFNBQUtBLFVBQWQsSUFBNkIsVUFBVUMsVUFBVixFQUFzQkMsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUNuRixNQUFJQyxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsTUFBbEI7QUFBQSxNQUEwQkMsQ0FBQyxHQUFHSCxDQUFDLEdBQUcsQ0FBSixHQUFRSCxNQUFSLEdBQWlCRSxJQUFJLEtBQUssSUFBVCxHQUFnQkEsSUFBSSxHQUFHSyxNQUFNLENBQUNDLHdCQUFQLENBQWdDUixNQUFoQyxFQUF3Q0MsR0FBeEMsQ0FBdkIsR0FBc0VDLElBQXJIO0FBQUEsTUFBMkhPLENBQTNIO0FBQ0EsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFFBQW5CLElBQStCLE9BQU9BLE9BQU8sQ0FBQ0MsUUFBZixLQUE0QixVQUEvRCxFQUEyRUwsQ0FBQyxHQUFHSSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJaLFVBQWpCLEVBQTZCQyxNQUE3QixFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLENBQUosQ0FBM0UsS0FDSyxLQUFLLElBQUlVLENBQUMsR0FBR2IsVUFBVSxDQUFDTSxNQUFYLEdBQW9CLENBQWpDLEVBQW9DTyxDQUFDLElBQUksQ0FBekMsRUFBNENBLENBQUMsRUFBN0MsRUFBaUQsSUFBSUgsQ0FBQyxHQUFHVixVQUFVLENBQUNhLENBQUQsQ0FBbEIsRUFBdUJOLENBQUMsR0FBRyxDQUFDSCxDQUFDLEdBQUcsQ0FBSixHQUFRTSxDQUFDLENBQUNILENBQUQsQ0FBVCxHQUFlSCxDQUFDLEdBQUcsQ0FBSixHQUFRTSxDQUFDLENBQUNULE1BQUQsRUFBU0MsR0FBVCxFQUFj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JiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX3BhcmFtID0gKHRoaXMgJiYgdGhpcy5fX3BhcmFtKSB8fCBmdW5jdGlvbiAocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBpbnZlcnNpZnlfMSA9IHJlcXVpcmUoXCJpbnZlcnNpZnlcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcclxuY29uc3QgY29uc3RhbnRzID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vdXRpbHMvbWlzY1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi9pb2MvdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vY29tbW9uL3R5cGVzXCIpO1xyXG5sZXQgVGVzdERpc3BsYXkgPSBjbGFzcyBUZXN0RGlzcGxheSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlUmVnaXN0cnkpIHtcclxuICAgICAgICB0aGlzLnRlc3RDb2xsZWN0aW9uU3RvcmFnZSA9IHNlcnZpY2VSZWdpc3RyeS5nZXQodHlwZXNfMy5JVGVzdENvbGxlY3Rpb25TdG9yYWdlU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5hcHBTaGVsbCA9IHNlcnZpY2VSZWdpc3RyeS5nZXQodHlwZXNfMS5JQXBwbGljYXRpb25TaGVsbCk7XHJcbiAgICB9XHJcbiAgICBkaXNwbGF5U3RvcFRlc3RVSSh3b3Jrc3BhY2UsIG1lc3NhZ2UpIHtcclxuICAgICAgICB0aGlzLmFwcFNoZWxsLnNob3dRdWlja1BpY2soW21lc3NhZ2VdKS50aGVuKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXRlbSA9PT0gbWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgdnNjb2RlXzEuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX1N0b3AsIHVuZGVmaW5lZCwgd29ya3NwYWNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZGlzcGxheVRlc3RVSShjbWRTb3VyY2UsIHdrc3BhY2UpIHtcclxuICAgICAgICBjb25zdCB0ZXN0cyA9IHRoaXMudGVzdENvbGxlY3Rpb25TdG9yYWdlLmdldFRlc3RzKHdrc3BhY2UpO1xyXG4gICAgICAgIHRoaXMuYXBwU2hlbGwuc2hvd1F1aWNrUGljayhidWlsZEl0ZW1zKHRlc3RzKSwgeyBtYXRjaE9uRGVzY3JpcHRpb246IHRydWUsIG1hdGNoT25EZXRhaWw6IHRydWUgfSlcclxuICAgICAgICAgICAgLnRoZW4oaXRlbSA9PiBpdGVtID8gb25JdGVtU2VsZWN0ZWQoY21kU291cmNlLCB3a3NwYWNlLCBpdGVtLCBmYWxzZSkgOiBtaXNjXzEubm9vcCgpKTtcclxuICAgIH1cclxuICAgIHNlbGVjdFRlc3RGdW5jdGlvbihyb290RGlyZWN0b3J5LCB0ZXN0cykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwU2hlbGwuc2hvd1F1aWNrUGljayhidWlsZEl0ZW1zRm9yRnVuY3Rpb25zKHJvb3REaXJlY3RvcnksIHRlc3RzLnRlc3RGdW5jdGlvbnMpLCB7IG1hdGNoT25EZXNjcmlwdGlvbjogdHJ1ZSwgbWF0Y2hPbkRldGFpbDogdHJ1ZSB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSAmJiBpdGVtLmZuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoaXRlbS5mbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0sIHJlamVjdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZWxlY3RUZXN0RmlsZShyb290RGlyZWN0b3J5LCB0ZXN0cykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwU2hlbGwuc2hvd1F1aWNrUGljayhidWlsZEl0ZW1zRm9yVGVzdEZpbGVzKHJvb3REaXJlY3RvcnksIHRlc3RzLnRlc3RGaWxlcyksIHsgbWF0Y2hPbkRlc2NyaXB0aW9uOiB0cnVlLCBtYXRjaE9uRGV0YWlsOiB0cnVlIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtICYmIGl0ZW0udGVzdEZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShpdGVtLnRlc3RGaWxlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoKTtcclxuICAgICAgICAgICAgfSwgcmVqZWN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGRpc3BsYXlGdW5jdGlvblRlc3RQaWNrZXJVSShjbWRTb3VyY2UsIHdrc3BhY2UsIHJvb3REaXJlY3RvcnksIGZpbGUsIHRlc3RGdW5jdGlvbnMsIGRlYnVnKSB7XHJcbiAgICAgICAgY29uc3QgdGVzdHMgPSB0aGlzLnRlc3RDb2xsZWN0aW9uU3RvcmFnZS5nZXRUZXN0cyh3a3NwYWNlKTtcclxuICAgICAgICBpZiAoIXRlc3RzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlLmZzUGF0aDtcclxuICAgICAgICBjb25zdCB0ZXN0RmlsZSA9IHRlc3RzLnRlc3RGaWxlcy5maW5kKGl0ZW0gPT4gaXRlbS5uYW1lID09PSBmaWxlTmFtZSB8fCBpdGVtLmZ1bGxQYXRoID09PSBmaWxlTmFtZSk7XHJcbiAgICAgICAgaWYgKCF0ZXN0RmlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGZsYXR0ZW5lZEZ1bmN0aW9ucyA9IHRlc3RzLnRlc3RGdW5jdGlvbnMuZmlsdGVyKGZuID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGZuLnBhcmVudFRlc3RGaWxlLm5hbWUgPT09IHRlc3RGaWxlLm5hbWUgJiZcclxuICAgICAgICAgICAgICAgIHRlc3RGdW5jdGlvbnMuc29tZSh0ZXN0RnVuYyA9PiB0ZXN0RnVuYy5uYW1lVG9SdW4gPT09IGZuLnRlc3RGdW5jdGlvbi5uYW1lVG9SdW4pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYXBwU2hlbGwuc2hvd1F1aWNrUGljayhidWlsZEl0ZW1zRm9yRnVuY3Rpb25zKHJvb3REaXJlY3RvcnksIGZsYXR0ZW5lZEZ1bmN0aW9ucywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRlYnVnKSwgeyBtYXRjaE9uRGVzY3JpcHRpb246IHRydWUsIG1hdGNoT25EZXRhaWw6IHRydWUgfSlcclxuICAgICAgICAgICAgLnRoZW4odGVzdEl0ZW0gPT4gdGVzdEl0ZW0gPyBvbkl0ZW1TZWxlY3RlZChjbWRTb3VyY2UsIHdrc3BhY2UsIHRlc3RJdGVtLCBkZWJ1ZykgOiBtaXNjXzEubm9vcCgpKTtcclxuICAgIH1cclxufTtcclxuVGVzdERpc3BsYXkgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBUZXN0RGlzcGxheSk7XHJcbmV4cG9ydHMuVGVzdERpc3BsYXkgPSBUZXN0RGlzcGxheTtcclxudmFyIFR5cGU7XHJcbihmdW5jdGlvbiAoVHlwZSkge1xyXG4gICAgVHlwZVtUeXBlW1wiUnVuQWxsXCJdID0gMF0gPSBcIlJ1bkFsbFwiO1xyXG4gICAgVHlwZVtUeXBlW1wiUmVEaXNjb3ZlclwiXSA9IDFdID0gXCJSZURpc2NvdmVyXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJSdW5GYWlsZWRcIl0gPSAyXSA9IFwiUnVuRmFpbGVkXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJSdW5Gb2xkZXJcIl0gPSAzXSA9IFwiUnVuRm9sZGVyXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJSdW5GaWxlXCJdID0gNF0gPSBcIlJ1bkZpbGVcIjtcclxuICAgIFR5cGVbVHlwZVtcIlJ1bkNsYXNzXCJdID0gNV0gPSBcIlJ1bkNsYXNzXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJSdW5NZXRob2RcIl0gPSA2XSA9IFwiUnVuTWV0aG9kXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJWaWV3VGVzdE91dHB1dFwiXSA9IDddID0gXCJWaWV3VGVzdE91dHB1dFwiO1xyXG4gICAgVHlwZVtUeXBlW1wiTnVsbFwiXSA9IDhdID0gXCJOdWxsXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJTZWxlY3RBbmRSdW5NZXRob2RcIl0gPSA5XSA9IFwiU2VsZWN0QW5kUnVuTWV0aG9kXCI7XHJcbiAgICBUeXBlW1R5cGVbXCJEZWJ1Z01ldGhvZFwiXSA9IDEwXSA9IFwiRGVidWdNZXRob2RcIjtcclxufSkoVHlwZSB8fCAoVHlwZSA9IHt9KSk7XHJcbmNvbnN0IHN0YXR1c0ljb25NYXBwaW5nID0gbmV3IE1hcCgpO1xyXG5zdGF0dXNJY29uTWFwcGluZy5zZXQodHlwZXNfMy5UZXN0U3RhdHVzLlBhc3MsIGNvbnN0YW50cy5PY3RpY29ucy5UZXN0X1Bhc3MpO1xyXG5zdGF0dXNJY29uTWFwcGluZy5zZXQodHlwZXNfMy5UZXN0U3RhdHVzLkZhaWwsIGNvbnN0YW50cy5PY3RpY29ucy5UZXN0X0ZhaWwpO1xyXG5zdGF0dXNJY29uTWFwcGluZy5zZXQodHlwZXNfMy5UZXN0U3RhdHVzLkVycm9yLCBjb25zdGFudHMuT2N0aWNvbnMuVGVzdF9FcnJvcik7XHJcbnN0YXR1c0ljb25NYXBwaW5nLnNldCh0eXBlc18zLlRlc3RTdGF0dXMuU2tpcHBlZCwgY29uc3RhbnRzLk9jdGljb25zLlRlc3RfU2tpcCk7XHJcbmZ1bmN0aW9uIGdldFN1bW1hcnkodGVzdHMpIHtcclxuICAgIGlmICghdGVzdHMgfHwgIXRlc3RzLnN1bW1hcnkpIHtcclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzdGF0dXNUZXh0ID0gW107XHJcbiAgICBpZiAodGVzdHMuc3VtbWFyeS5wYXNzZWQgPiAwKSB7XHJcbiAgICAgICAgc3RhdHVzVGV4dC5wdXNoKGAke2NvbnN0YW50cy5PY3RpY29ucy5UZXN0X1Bhc3N9ICR7dGVzdHMuc3VtbWFyeS5wYXNzZWR9IFBhc3NlZGApO1xyXG4gICAgfVxyXG4gICAgaWYgKHRlc3RzLnN1bW1hcnkuZmFpbHVyZXMgPiAwKSB7XHJcbiAgICAgICAgc3RhdHVzVGV4dC5wdXNoKGAke2NvbnN0YW50cy5PY3RpY29ucy5UZXN0X0ZhaWx9ICR7dGVzdHMuc3VtbWFyeS5mYWlsdXJlc30gRmFpbGVkYCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGVzdHMuc3VtbWFyeS5lcnJvcnMgPiAwKSB7XHJcbiAgICAgICAgY29uc3QgcGx1cmFsID0gdGVzdHMuc3VtbWFyeS5lcnJvcnMgPT09IDEgPyAnJyA6ICdzJztcclxuICAgICAgICBzdGF0dXNUZXh0LnB1c2goYCR7Y29uc3RhbnRzLk9jdGljb25zLlRlc3RfRXJyb3J9ICR7dGVzdHMuc3VtbWFyeS5lcnJvcnN9IEVycm9yJHtwbHVyYWx9YCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGVzdHMuc3VtbWFyeS5za2lwcGVkID4gMCkge1xyXG4gICAgICAgIHN0YXR1c1RleHQucHVzaChgJHtjb25zdGFudHMuT2N0aWNvbnMuVGVzdF9Ta2lwfSAke3Rlc3RzLnN1bW1hcnkuc2tpcHBlZH0gU2tpcHBlZGApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0YXR1c1RleHQuam9pbignLCAnKS50cmltKCk7XHJcbn1cclxuZnVuY3Rpb24gYnVpbGRJdGVtcyh0ZXN0cykge1xyXG4gICAgY29uc3QgaXRlbXMgPSBbXTtcclxuICAgIGl0ZW1zLnB1c2goeyBkZXNjcmlwdGlvbjogJycsIGxhYmVsOiAnUnVuIEFsbCBVbml0IFRlc3RzJywgdHlwZTogVHlwZS5SdW5BbGwgfSk7XHJcbiAgICBpdGVtcy5wdXNoKHsgZGVzY3JpcHRpb246ICcnLCBsYWJlbDogJ0Rpc2NvdmVyIFVuaXQgVGVzdHMnLCB0eXBlOiBUeXBlLlJlRGlzY292ZXIgfSk7XHJcbiAgICBpdGVtcy5wdXNoKHsgZGVzY3JpcHRpb246ICcnLCBsYWJlbDogJ1J1biBVbml0IFRlc3QgTWV0aG9kIC4uLicsIHR5cGU6IFR5cGUuU2VsZWN0QW5kUnVuTWV0aG9kIH0pO1xyXG4gICAgY29uc3Qgc3VtbWFyeSA9IGdldFN1bW1hcnkodGVzdHMpO1xyXG4gICAgaXRlbXMucHVzaCh7IGRlc2NyaXB0aW9uOiAnJywgbGFiZWw6ICdWaWV3IFVuaXQgVGVzdCBPdXRwdXQnLCB0eXBlOiBUeXBlLlZpZXdUZXN0T3V0cHV0LCBkZXRhaWw6IHN1bW1hcnkgfSk7XHJcbiAgICBpZiAodGVzdHMgJiYgdGVzdHMuc3VtbWFyeS5mYWlsdXJlcyA+IDApIHtcclxuICAgICAgICBpdGVtcy5wdXNoKHsgZGVzY3JpcHRpb246ICcnLCBsYWJlbDogJ1J1biBGYWlsZWQgVGVzdHMnLCB0eXBlOiBUeXBlLlJ1bkZhaWxlZCwgZGV0YWlsOiBgJHtjb25zdGFudHMuT2N0aWNvbnMuVGVzdF9GYWlsfSAke3Rlc3RzLnN1bW1hcnkuZmFpbHVyZXN9IEZhaWxlZGAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlbXM7XHJcbn1cclxuY29uc3Qgc3RhdHVzU29ydFByZWZpeCA9IHt9O1xyXG5zdGF0dXNTb3J0UHJlZml4W3R5cGVzXzMuVGVzdFN0YXR1cy5FcnJvcl0gPSAnMSc7XHJcbnN0YXR1c1NvcnRQcmVmaXhbdHlwZXNfMy5UZXN0U3RhdHVzLkZhaWxdID0gJzInO1xyXG5zdGF0dXNTb3J0UHJlZml4W3R5cGVzXzMuVGVzdFN0YXR1cy5Ta2lwcGVkXSA9ICczJztcclxuc3RhdHVzU29ydFByZWZpeFt0eXBlc18zLlRlc3RTdGF0dXMuUGFzc10gPSAnNCc7XHJcbmZ1bmN0aW9uIGJ1aWxkSXRlbXNGb3JGdW5jdGlvbnMocm9vdERpcmVjdG9yeSwgdGVzdHMsIHNvcnRCYXNlZE9uUmVzdWx0cyA9IGZhbHNlLCBkaXNwbGF5U3RhdHVzSWNvbnMgPSBmYWxzZSwgZGVidWcgPSBmYWxzZSkge1xyXG4gICAgY29uc3QgZnVuY3Rpb25JdGVtcyA9IFtdO1xyXG4gICAgdGVzdHMuZm9yRWFjaChmbiA9PiB7XHJcbiAgICAgICAgbGV0IGljb24gPSAnJztcclxuICAgICAgICBpZiAoZGlzcGxheVN0YXR1c0ljb25zICYmIGZuLnRlc3RGdW5jdGlvbi5zdGF0dXMgJiYgc3RhdHVzSWNvbk1hcHBpbmcuaGFzKGZuLnRlc3RGdW5jdGlvbi5zdGF0dXMpKSB7XHJcbiAgICAgICAgICAgIGljb24gPSBgJHtzdGF0dXNJY29uTWFwcGluZy5nZXQoZm4udGVzdEZ1bmN0aW9uLnN0YXR1cyl9IGA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uSXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcclxuICAgICAgICAgICAgZGV0YWlsOiBwYXRoLnJlbGF0aXZlKHJvb3REaXJlY3RvcnksIGZuLnBhcmVudFRlc3RGaWxlLmZ1bGxQYXRoKSxcclxuICAgICAgICAgICAgbGFiZWw6IGljb24gKyBmbi50ZXN0RnVuY3Rpb24ubmFtZSxcclxuICAgICAgICAgICAgdHlwZTogZGVidWcgPT09IHRydWUgPyBUeXBlLkRlYnVnTWV0aG9kIDogVHlwZS5SdW5NZXRob2QsXHJcbiAgICAgICAgICAgIGZuOiBmblxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBmdW5jdGlvbkl0ZW1zLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICBsZXQgc29ydEFQcmVmaXggPSAnNS0nO1xyXG4gICAgICAgIGxldCBzb3J0QlByZWZpeCA9ICc1LSc7XHJcbiAgICAgICAgaWYgKHNvcnRCYXNlZE9uUmVzdWx0cyAmJiBhLmZuICYmIGEuZm4udGVzdEZ1bmN0aW9uLnN0YXR1cyAmJiBiLmZuICYmIGIuZm4udGVzdEZ1bmN0aW9uLnN0YXR1cykge1xyXG4gICAgICAgICAgICBzb3J0QVByZWZpeCA9IHN0YXR1c1NvcnRQcmVmaXhbYS5mbi50ZXN0RnVuY3Rpb24uc3RhdHVzXSA/IHN0YXR1c1NvcnRQcmVmaXhbYS5mbi50ZXN0RnVuY3Rpb24uc3RhdHVzXSA6IHNvcnRBUHJlZml4O1xyXG4gICAgICAgICAgICBzb3J0QlByZWZpeCA9IHN0YXR1c1NvcnRQcmVmaXhbYi5mbi50ZXN0RnVuY3Rpb24uc3RhdHVzXSA/IHN0YXR1c1NvcnRQcmVmaXhbYi5mbi50ZXN0RnVuY3Rpb24uc3RhdHVzXSA6IHNvcnRCUHJlZml4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc29ydEFQcmVmaXggKyBhLmRldGFpbCArIGEubGFiZWwgPCBzb3J0QlByZWZpeCArIGIuZGV0YWlsICsgYi5sYWJlbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzb3J0QVByZWZpeCArIGEuZGV0YWlsICsgYS5sYWJlbCA+IHNvcnRCUHJlZml4ICsgYi5kZXRhaWwgKyBiLmxhYmVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uSXRlbXM7XHJcbn1cclxuZnVuY3Rpb24gYnVpbGRJdGVtc0ZvclRlc3RGaWxlcyhyb290RGlyZWN0b3J5LCB0ZXN0RmlsZXMpIHtcclxuICAgIGNvbnN0IGZpbGVJdGVtcyA9IHRlc3RGaWxlcy5tYXAodGVzdEZpbGUgPT4ge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnJyxcclxuICAgICAgICAgICAgZGV0YWlsOiBwYXRoLnJlbGF0aXZlKHJvb3REaXJlY3RvcnksIHRlc3RGaWxlLmZ1bGxQYXRoKSxcclxuICAgICAgICAgICAgdHlwZTogVHlwZS5SdW5GaWxlLFxyXG4gICAgICAgICAgICBsYWJlbDogcGF0aC5iYXNlbmFtZSh0ZXN0RmlsZS5mdWxsUGF0aCksXHJcbiAgICAgICAgICAgIHRlc3RGaWxlOiB0ZXN0RmlsZVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuICAgIGZpbGVJdGVtcy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgaWYgKCFhLmRldGFpbCAmJiAhYi5kZXRhaWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghYS5kZXRhaWwgfHwgYS5kZXRhaWwgPCBiLmRldGFpbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghYi5kZXRhaWwgfHwgYS5kZXRhaWwgPiBiLmRldGFpbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBmaWxlSXRlbXM7XHJcbn1cclxuZnVuY3Rpb24gb25JdGVtU2VsZWN0ZWQoY21kU291cmNlLCB3a3NwYWNlLCBzZWxlY3Rpb24sIGRlYnVnKSB7XHJcbiAgICBpZiAoIXNlbGVjdGlvbiB8fCB0eXBlb2Ygc2VsZWN0aW9uLnR5cGUgIT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IGNtZCA9ICcnO1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxyXG4gICAgY29uc3QgYXJncyA9IFt1bmRlZmluZWQsIGNtZFNvdXJjZSwgd2tzcGFjZV07XHJcbiAgICBzd2l0Y2ggKHNlbGVjdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBUeXBlLk51bGw6IHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFR5cGUuUnVuQWxsOiB7XHJcbiAgICAgICAgICAgIGNtZCA9IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19SdW47XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFR5cGUuUmVEaXNjb3Zlcjoge1xyXG4gICAgICAgICAgICBjbWQgPSBjb25zdGFudHMuQ29tbWFuZHMuVGVzdHNfRGlzY292ZXI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFR5cGUuVmlld1Rlc3RPdXRwdXQ6IHtcclxuICAgICAgICAgICAgY21kID0gY29uc3RhbnRzLkNvbW1hbmRzLlRlc3RzX1ZpZXdPdXRwdXQ7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFR5cGUuUnVuRmFpbGVkOiB7XHJcbiAgICAgICAgICAgIGNtZCA9IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19SdW5fRmFpbGVkO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSBUeXBlLlNlbGVjdEFuZFJ1bk1ldGhvZDoge1xyXG4gICAgICAgICAgICBjbWQgPSBkZWJ1ZyA/IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19TZWxlY3RfQW5kX0RlYnVnX01ldGhvZCA6IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19TZWxlY3RfQW5kX1J1bl9NZXRob2Q7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFR5cGUuUnVuTWV0aG9kOiB7XHJcbiAgICAgICAgICAgIGNtZCA9IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19SdW47XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItdHlwZS1jYXN0IG5vLW9iamVjdC1saXRlcmFsLXR5cGUtYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgIGFyZ3MucHVzaCh7IHRlc3RGdW5jdGlvbjogW3NlbGVjdGlvbi5mbi50ZXN0RnVuY3Rpb25dIH0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSBUeXBlLkRlYnVnTWV0aG9kOiB7XHJcbiAgICAgICAgICAgIGNtZCA9IGNvbnN0YW50cy5Db21tYW5kcy5UZXN0c19EZWJ1ZztcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci10eXBlLWNhc3Qgbm8tb2JqZWN0LWxpdGVyYWwtdHlwZS1hc3NlcnRpb25cclxuICAgICAgICAgICAgYXJncy5wdXNoKHsgdGVzdEZ1bmN0aW9uOiBbc2VsZWN0aW9uLmZuLnRlc3RGdW5jdGlvbl0gfSk7XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaCh0cnVlKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHZzY29kZV8xLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKGNtZCwgLi4uYXJncyk7XHJcbn1cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGlja2VyLmpzLm1hcCJdfQ==