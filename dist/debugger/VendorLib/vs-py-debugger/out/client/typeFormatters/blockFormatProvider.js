"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

const codeBlockFormatProvider_1 = require("./codeBlockFormatProvider");

const contracts_1 = require("./contracts");

const contracts_2 = require("./contracts");

const contracts_3 = require("./contracts");

class BlockFormatProviders {
  constructor() {
    this.providers = [];
    const boundaryBlocks = [contracts_3.DEF_REGEX, contracts_3.ASYNC_DEF_REGEX, contracts_3.CLASS_REGEX];
    const elseParentBlocks = [contracts_1.IF_REGEX, contracts_1.ELIF_REGEX, contracts_1.FOR_IN_REGEX, contracts_1.ASYNC_FOR_IN_REGEX, contracts_1.WHILE_REGEX, contracts_2.TRY_REGEX, contracts_2.EXCEPT_REGEX];
    this.providers.push(new codeBlockFormatProvider_1.CodeBlockFormatProvider(contracts_1.ELSE_REGEX, elseParentBlocks, boundaryBlocks));
    const elifParentBlocks = [contracts_1.IF_REGEX, contracts_1.ELIF_REGEX];
    this.providers.push(new codeBlockFormatProvider_1.CodeBlockFormatProvider(contracts_1.ELIF_REGEX, elifParentBlocks, boundaryBlocks));
    const exceptParentBlocks = [contracts_2.TRY_REGEX, contracts_2.EXCEPT_REGEX];
    this.providers.push(new codeBlockFormatProvider_1.CodeBlockFormatProvider(contracts_2.EXCEPT_REGEX, exceptParentBlocks, boundaryBlocks));
    const finallyParentBlocks = [contracts_2.TRY_REGEX, contracts_2.EXCEPT_REGEX];
    this.providers.push(new codeBlockFormatProvider_1.CodeBlockFormatProvider(contracts_2.FINALLY_REGEX, finallyParentBlocks, boundaryBlocks));
  }

  provideOnTypeFormattingEdits(document, position, ch, options, token) {
    if (position.line === 0) {
      return [];
    }

    const currentLine = document.lineAt(position.line);
    const prevousLine = document.lineAt(position.line - 1); // We're only interested in cases where the current block is at the same indentation level as the previous line
    // E.g. if we have an if..else block, generally the else statement would be at the same level as the code in the if...

    if (currentLine.firstNonWhitespaceCharacterIndex !== prevousLine.firstNonWhitespaceCharacterIndex) {
      return [];
    }

    const currentLineText = currentLine.text;
    const provider = this.providers.find(p => p.canProvideEdits(currentLineText));

    if (provider) {
      return provider.provideEdits(document, position, ch, options, currentLine);
    }

    return [];
  }

}

exports.BlockFormatProviders = BlockFormatProviders;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJsb2NrRm9ybWF0UHJvdmlkZXIuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjb2RlQmxvY2tGb3JtYXRQcm92aWRlcl8xIiwicmVxdWlyZSIsImNvbnRyYWN0c18xIiwiY29udHJhY3RzXzIiLCJjb250cmFjdHNfMyIsIkJsb2NrRm9ybWF0UHJvdmlkZXJzIiwiY29uc3RydWN0b3IiLCJwcm92aWRlcnMiLCJib3VuZGFyeUJsb2NrcyIsIkRFRl9SRUdFWCIsIkFTWU5DX0RFRl9SRUdFWCIsIkNMQVNTX1JFR0VYIiwiZWxzZVBhcmVudEJsb2NrcyIsIklGX1JFR0VYIiwiRUxJRl9SRUdFWCIsIkZPUl9JTl9SRUdFWCIsIkFTWU5DX0ZPUl9JTl9SRUdFWCIsIldISUxFX1JFR0VYIiwiVFJZX1JFR0VYIiwiRVhDRVBUX1JFR0VYIiwicHVzaCIsIkNvZGVCbG9ja0Zvcm1hdFByb3ZpZGVyIiwiRUxTRV9SRUdFWCIsImVsaWZQYXJlbnRCbG9ja3MiLCJleGNlcHRQYXJlbnRCbG9ja3MiLCJmaW5hbGx5UGFyZW50QmxvY2tzIiwiRklOQUxMWV9SRUdFWCIsInByb3ZpZGVPblR5cGVGb3JtYXR0aW5nRWRpdHMiLCJkb2N1bWVudCIsInBvc2l0aW9uIiwiY2giLCJvcHRpb25zIiwidG9rZW4iLCJsaW5lIiwiY3VycmVudExpbmUiLCJsaW5lQXQiLCJwcmV2b3VzTGluZSIsImZpcnN0Tm9uV2hpdGVzcGFjZUNoYXJhY3RlckluZGV4IiwiY3VycmVudExpbmVUZXh0IiwidGV4dCIsInByb3ZpZGVyIiwiZmluZCIsInAiLCJjYW5Qcm92aWRlRWRpdHMiLCJwcm92aWRlRWRpdHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLHlCQUF5QixHQUFH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QUFjO0FBQ1YsYUFBT0EsUUFBUSxDQUFDSSxZQUFULENBQXNCaEIsUUFBdEIsRUFBZ0NDLFFBQWhDLEVBQTBDQyxFQUExQyxFQUE4Q0MsT0FBOUMsRUFBdURHLFdBQXZELENBQVA7QUFDSDs7QUFDRCxXQUFPLEVBQVA7QUFDSDs7QUFuRHNCOztBQXFEM0JwQyxPQUFPLENBQUNPLG9CQUFSLEdBQStCQSxvQkFBL0IiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBjb2RlQmxvY2tGb3JtYXRQcm92aWRlcl8xID0gcmVxdWlyZShcIi4vY29kZUJsb2NrRm9ybWF0UHJvdmlkZXJcIik7XHJcbmNvbnN0IGNvbnRyYWN0c18xID0gcmVxdWlyZShcIi4vY29udHJhY3RzXCIpO1xyXG5jb25zdCBjb250cmFjdHNfMiA9IHJlcXVpcmUoXCIuL2NvbnRyYWN0c1wiKTtcclxuY29uc3QgY29udHJhY3RzXzMgPSByZXF1aXJlKFwiLi9jb250cmFjdHNcIik7XHJcbmNsYXNzIEJsb2NrRm9ybWF0UHJvdmlkZXJzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzID0gW107XHJcbiAgICAgICAgY29uc3QgYm91bmRhcnlCbG9ja3MgPSBbXHJcbiAgICAgICAgICAgIGNvbnRyYWN0c18zLkRFRl9SRUdFWCxcclxuICAgICAgICAgICAgY29udHJhY3RzXzMuQVNZTkNfREVGX1JFR0VYLFxyXG4gICAgICAgICAgICBjb250cmFjdHNfMy5DTEFTU19SRUdFWFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgY29uc3QgZWxzZVBhcmVudEJsb2NrcyA9IFtcclxuICAgICAgICAgICAgY29udHJhY3RzXzEuSUZfUkVHRVgsXHJcbiAgICAgICAgICAgIGNvbnRyYWN0c18xLkVMSUZfUkVHRVgsXHJcbiAgICAgICAgICAgIGNvbnRyYWN0c18xLkZPUl9JTl9SRUdFWCxcclxuICAgICAgICAgICAgY29udHJhY3RzXzEuQVNZTkNfRk9SX0lOX1JFR0VYLFxyXG4gICAgICAgICAgICBjb250cmFjdHNfMS5XSElMRV9SRUdFWCxcclxuICAgICAgICAgICAgY29udHJhY3RzXzIuVFJZX1JFR0VYLFxyXG4gICAgICAgICAgICBjb250cmFjdHNfMi5FWENFUFRfUkVHRVhcclxuICAgICAgICBdO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzLnB1c2gobmV3IGNvZGVCbG9ja0Zvcm1hdFByb3ZpZGVyXzEuQ29kZUJsb2NrRm9ybWF0UHJvdmlkZXIoY29udHJhY3RzXzEuRUxTRV9SRUdFWCwgZWxzZVBhcmVudEJsb2NrcywgYm91bmRhcnlCbG9ja3MpKTtcclxuICAgICAgICBjb25zdCBlbGlmUGFyZW50QmxvY2tzID0gW1xyXG4gICAgICAgICAgICBjb250cmFjdHNfMS5JRl9SRUdFWCxcclxuICAgICAgICAgICAgY29udHJhY3RzXzEuRUxJRl9SRUdFWFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcnMucHVzaChuZXcgY29kZUJsb2NrRm9ybWF0UHJvdmlkZXJfMS5Db2RlQmxvY2tGb3JtYXRQcm92aWRlcihjb250cmFjdHNfMS5FTElGX1JFR0VYLCBlbGlmUGFyZW50QmxvY2tzLCBib3VuZGFyeUJsb2NrcykpO1xyXG4gICAgICAgIGNvbnN0IGV4Y2VwdFBhcmVudEJsb2NrcyA9IFtcclxuICAgICAgICAgICAgY29udHJhY3RzXzIuVFJZX1JFR0VYLFxyXG4gICAgICAgICAgICBjb250cmFjdHNfMi5FWENFUFRfUkVHRVhcclxuICAgICAgICBdO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzLnB1c2gobmV3IGNvZGVCbG9ja0Zvcm1hdFByb3ZpZGVyXzEuQ29kZUJsb2NrRm9ybWF0UHJvdmlkZXIoY29udHJhY3RzXzIuRVhDRVBUX1JFR0VYLCBleGNlcHRQYXJlbnRCbG9ja3MsIGJvdW5kYXJ5QmxvY2tzKSk7XHJcbiAgICAgICAgY29uc3QgZmluYWxseVBhcmVudEJsb2NrcyA9IFtcclxuICAgICAgICAgICAgY29udHJhY3RzXzIuVFJZX1JFR0VYLFxyXG4gICAgICAgICAgICBjb250cmFjdHNfMi5FWENFUFRfUkVHRVhcclxuICAgICAgICBdO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzLnB1c2gobmV3IGNvZGVCbG9ja0Zvcm1hdFByb3ZpZGVyXzEuQ29kZUJsb2NrRm9ybWF0UHJvdmlkZXIoY29udHJhY3RzXzIuRklOQUxMWV9SRUdFWCwgZmluYWxseVBhcmVudEJsb2NrcywgYm91bmRhcnlCbG9ja3MpKTtcclxuICAgIH1cclxuICAgIHByb3ZpZGVPblR5cGVGb3JtYXR0aW5nRWRpdHMoZG9jdW1lbnQsIHBvc2l0aW9uLCBjaCwgb3B0aW9ucywgdG9rZW4pIHtcclxuICAgICAgICBpZiAocG9zaXRpb24ubGluZSA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRMaW5lID0gZG9jdW1lbnQubGluZUF0KHBvc2l0aW9uLmxpbmUpO1xyXG4gICAgICAgIGNvbnN0IHByZXZvdXNMaW5lID0gZG9jdW1lbnQubGluZUF0KHBvc2l0aW9uLmxpbmUgLSAxKTtcclxuICAgICAgICAvLyBXZSdyZSBvbmx5IGludGVyZXN0ZWQgaW4gY2FzZXMgd2hlcmUgdGhlIGN1cnJlbnQgYmxvY2sgaXMgYXQgdGhlIHNhbWUgaW5kZW50YXRpb24gbGV2ZWwgYXMgdGhlIHByZXZpb3VzIGxpbmVcclxuICAgICAgICAvLyBFLmcuIGlmIHdlIGhhdmUgYW4gaWYuLmVsc2UgYmxvY2ssIGdlbmVyYWxseSB0aGUgZWxzZSBzdGF0ZW1lbnQgd291bGQgYmUgYXQgdGhlIHNhbWUgbGV2ZWwgYXMgdGhlIGNvZGUgaW4gdGhlIGlmLi4uXHJcbiAgICAgICAgaWYgKGN1cnJlbnRMaW5lLmZpcnN0Tm9uV2hpdGVzcGFjZUNoYXJhY3RlckluZGV4ICE9PSBwcmV2b3VzTGluZS5maXJzdE5vbldoaXRlc3BhY2VDaGFyYWN0ZXJJbmRleCkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRMaW5lVGV4dCA9IGN1cnJlbnRMaW5lLnRleHQ7XHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLnByb3ZpZGVycy5maW5kKHAgPT4gcC5jYW5Qcm92aWRlRWRpdHMoY3VycmVudExpbmVUZXh0KSk7XHJcbiAgICAgICAgaWYgKHByb3ZpZGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwcm92aWRlci5wcm92aWRlRWRpdHMoZG9jdW1lbnQsIHBvc2l0aW9uLCBjaCwgb3B0aW9ucywgY3VycmVudExpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5CbG9ja0Zvcm1hdFByb3ZpZGVycyA9IEJsb2NrRm9ybWF0UHJvdmlkZXJzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ibG9ja0Zvcm1hdFByb3ZpZGVyLmpzLm1hcCJdfQ==