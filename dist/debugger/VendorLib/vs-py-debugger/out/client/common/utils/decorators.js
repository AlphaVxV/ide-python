"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

const _ = require("lodash");

const constants_1 = require("../constants");
/**
 * Debounces a function execution. Function must return either a void or a promise that resolves to a void.
 * @export
 * @param {number} [wait] Wait time.
 * @returns void
 */


function debounce(wait) {
  // tslint:disable-next-line:no-any no-function-expression
  return function (_target, _propertyName, descriptor) {
    const originalMethod = descriptor.value; // If running tests, lets not debounce (so tests run fast).

    wait = wait && constants_1.isUnitTestExecution() ? undefined : wait; // tslint:disable-next-line:no-invalid-this no-any

    descriptor.value = _.debounce(function () {
      return originalMethod.apply(this, arguments);
    }, wait);
  };
}

exports.debounce = debounce;
/**
 * Swallows exceptions thrown by a function. Function must return either a void or a promise that resolves to a void.
 * @export
 * @param {string} [scopeName] Scope for the error message to be logged along with the error.
 * @returns void
 */

function swallowExceptions(scopeName) {
  // tslint:disable-next-line:no-any no-function-expression
  return function (_target, propertyName, descriptor) {
    const originalMethod = descriptor.value;
    const errorMessage = `Python Extension (Error in ${scopeName}, method:${propertyName}):`; // tslint:disable-next-line:no-any no-function-expression

    descriptor.value = function (...args) {
      try {
        // tslint:disable-next-line:no-invalid-this no-use-before-declare no-unsafe-any
        const result = originalMethod.apply(this, args); // If method being wrapped returns a promise then wait and swallow errors.

        if (result && typeof result.then === 'function' && typeof result.catch === 'function') {
          return result.catch(error => {
            if (constants_1.isTestExecution()) {
              return;
            }

            console.error(errorMessage, error);
          });
        }
      } catch (error) {
        if (constants_1.isTestExecution()) {
          return;
        }

        console.error(errorMessage, error);
      }
    };
  };
}

exports.swallowExceptions = swallowExceptions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlY29yYXRvcnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJfIiwicmVxdWlyZSIsImNvbnN0YW50c18xIiwiZGVib3VuY2UiLCJ3YWl0IiwiX3RhcmdldCIsIl9wcm9wZXJ0eU5hbWUiLCJkZXNjcmlwdG9yIiwib3JpZ2luYWxNZXRob2QiLCJpc1VuaXRUZXN0RXhlY3V0aW9uIiwidW5kZWZpbmVkIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJzd2FsbG93RXhjZXB0aW9ucyIsInNjb3BlTmFtZSIsInByb3BlcnR5TmFtZSIsImVycm9yTWVzc2FnZSIsImFyZ3MiLCJyZXN1bHQiLCJ0aGVuIiwiY2F0Y2giLCJlcnJvciIsImlzVGVzdEV4ZWN1dGlvbiIsImNvbnNvbGUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLENBQUMsR0FBR0MsT0FBTyxDQUFDLFFBQUQsQ0FBakI7O0FBQ0EsTUFBTUMsV0FBVyxHQUFHRCxPQUFPLENBQUMsY0FBRCxDQUEzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsU0FBU0UsUUFBVCxDQUFrQkMsSUFBbEIsRUFBd0I7QUFDcEI7QUFDQSxTQUFPLFVBQVVDLE9BQVYsRUFBbUJDLGFBQW5CLEVBQWtDQyxVQUFsQyxFQUE4QztBQUNqRCxVQUFNQyxjQUFjLEdBQUdELFVBQVUsQ0FBQ1IsS0FBbEMsQ0FEaUQsQ0FFakQ7O0FBQ0FLLElBQUFBLElBQUksR0FBR0EsSUFBSSxJQUFJRixXQUFXLENBQUNPLG1CQUFaLEVBQVIsR0FBNENDLFNBQTVDLEdBQXdETixJQUEvRCxDQUhpRCxDQUlqRDs7QUFDQUcsSUFBQUEsVUFBVSxDQUFDUixLQUFYLEdBQW1CQyxDQUFDLENBQUNHLFFBQUYsQ0FBVyxZQUFZO0FBQUUsYUFBT0ssY0FBYyxDQUFDRyxLQUFmLENBQXFCLElBQXJCLEVBQTJCQyxTQUEzQixDQUFQO0FBQStDLEtBQXhFLEVBQTBFUixJQUExRSxDQUFuQjtBQUNILEdBTkQ7QUFPSDs7QUFDRE4sT0FBTyxDQUFDSyxRQUFSLEdBQW1CQSxRQUFuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQSxTQUFTVSxpQkFBVCxDQUEyQkMsU0FBM0IsRUFBc0M7QUFDbEM7QUFDQSxTQUFPLFVBQVVULE9BQVYsRUFBbUJVLFlBQW5CLEVBQWlDUixVQUFqQyxFQUE2QztBQUNoRCxVQUFNQyxjQUFjLEdBQUdELFVBQVUsQ0FBQ1IsS0FBbEM7QUFDQSxVQUFNaUIsWUFBWSxHQUFJLDhCQUE2QkYsU0FBVSxZQUFXQyxZQUFhLElBQXJGLENBRmdELENBR2hEOztBQUNBUixJQUFBQSxVQUFVLENBQUNSLEtBQVgsR0FBbUIsVUFBVSxHQUFHa0IsSUFBYixFQUFtQjtBQUNsQyxVQUFJO0FBQ0E7QUFDQSxjQUFNQyxNQUFNLEdBQUdWLGNBQWMsQ0FBQ0csS0FBZixDQUFxQixJQUFyQixFQUEyQk0sSUFBM0IsQ0FBZixDQUZBLENBR0E7O0FBQ0EsWUFBSUMsTUFBTSxJQUFJLE9BQU9BLE1BQU0sQ0FBQ0MsSUFBZCxLQUF1QixVQUFqQyxJQUErQyxPQUFPRCxNQUFNLENBQUNFLEtBQWQsS0FBd0IsVUFBM0UsRUFBdUY7QUFDbkYsaUJBQU9GLE1BQU0sQ0FBQ0UsS0FBUCxDQUFhQyxLQUFLLElBQUk7QUFDekIsZ0JBQUluQixXQUFXLENBQUNvQixlQUFaLEVBQUosRUFBbUM7QUFDL0I7QUFDSDs7QUFDREMsWUFBQUEsT0FBTyxDQUFDRixLQUFSLENBQWNMLFlBQWQsRUFBNEJLLEtBQTVCO0FBQ0gsV0FMTSxDQUFQO0FBTUg7QUFDSixPQVpELENBYUEsT0FBT0EsS0FBUCxFQUFjO0FBQ1YsWUFBSW5CLFdBQVcsQ0FBQ29CLGVBQVosRUFBSixFQUFtQztBQUMvQjtBQUNIOztBQUNEQyxRQUFBQSxPQUFPLENBQUNGLEtBQVIsQ0FBY0wsWUFBZCxFQUE0QkssS0FBNUI7QUFDSDtBQUNKLEtBcEJEO0FBcUJILEdBekJEO0FBMEJIOztBQUNEdkIsT0FBTyxDQUFDZSxpQkFBUixHQUE0QkEsaUJBQTVCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcclxuLyoqXHJcbiAqIERlYm91bmNlcyBhIGZ1bmN0aW9uIGV4ZWN1dGlvbi4gRnVuY3Rpb24gbXVzdCByZXR1cm4gZWl0aGVyIGEgdm9pZCBvciBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhIHZvaWQuXHJcbiAqIEBleHBvcnRcclxuICogQHBhcmFtIHtudW1iZXJ9IFt3YWl0XSBXYWl0IHRpbWUuXHJcbiAqIEByZXR1cm5zIHZvaWRcclxuICovXHJcbmZ1bmN0aW9uIGRlYm91bmNlKHdhaXQpIHtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnkgbm8tZnVuY3Rpb24tZXhwcmVzc2lvblxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChfdGFyZ2V0LCBfcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xyXG4gICAgICAgIC8vIElmIHJ1bm5pbmcgdGVzdHMsIGxldHMgbm90IGRlYm91bmNlIChzbyB0ZXN0cyBydW4gZmFzdCkuXHJcbiAgICAgICAgd2FpdCA9IHdhaXQgJiYgY29uc3RhbnRzXzEuaXNVbml0VGVzdEV4ZWN1dGlvbigpID8gdW5kZWZpbmVkIDogd2FpdDtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzIG5vLWFueVxyXG4gICAgICAgIGRlc2NyaXB0b3IudmFsdWUgPSBfLmRlYm91bmNlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG9yaWdpbmFsTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0sIHdhaXQpO1xyXG4gICAgfTtcclxufVxyXG5leHBvcnRzLmRlYm91bmNlID0gZGVib3VuY2U7XHJcbi8qKlxyXG4gKiBTd2FsbG93cyBleGNlcHRpb25zIHRocm93biBieSBhIGZ1bmN0aW9uLiBGdW5jdGlvbiBtdXN0IHJldHVybiBlaXRoZXIgYSB2b2lkIG9yIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgdm9pZC5cclxuICogQGV4cG9ydFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gW3Njb3BlTmFtZV0gU2NvcGUgZm9yIHRoZSBlcnJvciBtZXNzYWdlIHRvIGJlIGxvZ2dlZCBhbG9uZyB3aXRoIHRoZSBlcnJvci5cclxuICogQHJldHVybnMgdm9pZFxyXG4gKi9cclxuZnVuY3Rpb24gc3dhbGxvd0V4Y2VwdGlvbnMoc2NvcGVOYW1lKSB7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55IG5vLWZ1bmN0aW9uLWV4cHJlc3Npb25cclxuICAgIHJldHVybiBmdW5jdGlvbiAoX3RhcmdldCwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGBQeXRob24gRXh0ZW5zaW9uIChFcnJvciBpbiAke3Njb3BlTmFtZX0sIG1ldGhvZDoke3Byb3BlcnR5TmFtZX0pOmA7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueSBuby1mdW5jdGlvbi1leHByZXNzaW9uXHJcbiAgICAgICAgZGVzY3JpcHRvci52YWx1ZSA9IGZ1bmN0aW9uICguLi5hcmdzKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzIG5vLXVzZS1iZWZvcmUtZGVjbGFyZSBuby11bnNhZmUtYW55XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBvcmlnaW5hbE1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcclxuICAgICAgICAgICAgICAgIC8vIElmIG1ldGhvZCBiZWluZyB3cmFwcGVkIHJldHVybnMgYSBwcm9taXNlIHRoZW4gd2FpdCBhbmQgc3dhbGxvdyBlcnJvcnMuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHR5cGVvZiByZXN1bHQudGhlbiA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgcmVzdWx0LmNhdGNoID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25zdGFudHNfMS5pc1Rlc3RFeGVjdXRpb24oKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29uc3RhbnRzXzEuaXNUZXN0RXhlY3V0aW9uKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZSwgZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn1cclxuZXhwb3J0cy5zd2FsbG93RXhjZXB0aW9ucyA9IHN3YWxsb3dFeGNlcHRpb25zO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1kZWNvcmF0b3JzLmpzLm1hcCJdfQ==