/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const Path = require("path");

const Types = require("../utils/sysTypes");
/* tslint:disable:rule1 no-any no-unnecessary-callback-wrapper jsdoc-format no-for-in prefer-const no-increment-decrement */


class AbstractSystemVariables {
  // tslint:disable-next-line:no-any
  resolve(value) {
    if (Types.isString(value)) {
      return this.__resolveString(value);
    } else if (Types.isArray(value)) {
      return this.__resolveArray(value);
    } else if (Types.isObject(value)) {
      return this.__resolveLiteral(value);
    }

    return value;
  } // tslint:disable-next-line:no-any


  resolveAny(value) {
    if (Types.isString(value)) {
      return this.__resolveString(value);
    } else if (Types.isArray(value)) {
      return this.__resolveAnyArray(value);
    } else if (Types.isObject(value)) {
      return this.__resolveAnyLiteral(value);
    }

    return value;
  }

  __resolveString(value) {
    const regexp = /\$\{(.*?)\}/g;
    return value.replace(regexp, (match, name) => {
      // tslint:disable-next-line:no-any
      const newValue = this[name];

      if (Types.isString(newValue)) {
        return newValue;
      } else {
        return match && (match.indexOf('env.') > 0 || match.indexOf('env:') > 0) ? '' : match;
      }
    });
  }

  __resolveLiteral(values) {
    const result = Object.create(null);
    Object.keys(values).forEach(key => {
      const value = values[key]; // tslint:disable-next-line:no-any

      result[key] = this.resolve(value);
    });
    return result;
  } // tslint:disable-next-line:no-any


  __resolveAnyLiteral(values) {
    const result = Object.create(null);
    Object.keys(values).forEach(key => {
      const value = values[key]; // tslint:disable-next-line:no-any

      result[key] = this.resolveAny(value);
    });
    return result;
  }

  __resolveArray(value) {
    return value.map(s => this.__resolveString(s));
  } // tslint:disable-next-line:no-any


  __resolveAnyArray(value) {
    return value.map(s => this.resolveAny(s));
  }

}

exports.AbstractSystemVariables = AbstractSystemVariables;

class SystemVariables extends AbstractSystemVariables {
  constructor(workspaceFolder) {
    super();
    this._workspaceFolder = typeof workspaceFolder === 'string' ? workspaceFolder : __dirname;
    this._workspaceFolderName = Path.basename(this._workspaceFolder);
    Object.keys(process.env).forEach(key => {
      this[`env:${key}`] = this[`env.${key}`] = process.env[key];
    });
  }

  get cwd() {
    return this.workspaceFolder;
  }

  get workspaceRoot() {
    return this._workspaceFolder;
  }

  get workspaceFolder() {
    return this._workspaceFolder;
  }

  get workspaceRootFolderName() {
    return this._workspaceFolderName;
  }

  get workspaceFolderBasename() {
    return this._workspaceFolderName;
  }

}

exports.SystemVariables = SystemVariables;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN5c3RlbVZhcmlhYmxlcy5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIlBhdGgiLCJyZXF1aXJlIiwiVHlwZXMiLCJBYnN0cmFjdFN5c3RlbVZhcmlhYmxlcyIsInJlc29sdmUiLCJpc1N0cmluZyIsIl9fcmVzb2x2ZVN0cmluZyIsImlzQXJyYXkiLCJfX3Jlc29sdmVBcnJheSIsImlzT2JqZWN0IiwiX19yZXNvbHZlTGl0ZXJhbCIsInJlc29sdmVBbnkiLCJfX3Jlc29sdmVBbnlBcnJheSIsIl9fcmVzb2x2ZUFueUxpdGVyYWwiLCJyZWdleHAiLCJyZXBsYWNlIiwibWF0Y2giLCJuYW1lIiwibmV3VmFsdWUiLCJpbmRleE9mIiwidmFsdWVzIiwicmVzdWx0IiwiY3JlYXRlIiwia2V5cyIsImZvckVhY2giLCJrZXkiLCJtYXAiLCJzIiwiU3lzdGVtVmFyaWFibGVzIiwiY29uc3RydWN0b3IiLCJ3b3Jrc3BhY2VGb2xkZXIiLCJfd29ya3NwYWNlRm9sZGVyIiwiX19kaXJuYW1lIiwiX3dvcmtzcGFjZUZvbGRlck5hbWUiLCJiYXNlbmFtZSIsInByb2Nlc3MiLCJlbnYiLCJjd2QiLCJ3b3Jrc3BhY2VSb290Iiwid29ya3NwYWNlUm9vdEZvbGRlck5hbWUiLCJ3b3Jrc3BhY2VGb2xkZXJCYXNlbmFtZSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUFFQyxFQUFBQSxLQUFLLEVBQUU7QUFBVCxDQUE3Qzs7QUFDQSxNQUFNQyxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1DLEtBQUssR0FBR0QsT0FBTyxDQUFDLG1CQUFELENBQXJCO0FBQ0E7OztBQUNBLE1BQU1FLHVCQUFOLENBQThCO0FBQzFCO0FBQ0FDLEVBQUFBLE9BQU8sQ0FBQ0wsS0FBRCxF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QUE4QjtBQUMxQixXQUFPLEtBQUtQLG9CQUFaO0FBQ0g7O0FBdkJpRDs7QUF5QnREbkMsT0FBTyxDQUFDOEIsZUFBUixHQUEwQkEsZUFBMUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxyXG4gKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cclxuJ3VzZSBzdHJpY3QnO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IFBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgVHlwZXMgPSByZXF1aXJlKFwiLi4vdXRpbHMvc3lzVHlwZXNcIik7XHJcbi8qIHRzbGludDpkaXNhYmxlOnJ1bGUxIG5vLWFueSBuby11bm5lY2Vzc2FyeS1jYWxsYmFjay13cmFwcGVyIGpzZG9jLWZvcm1hdCBuby1mb3ItaW4gcHJlZmVyLWNvbnN0IG5vLWluY3JlbWVudC1kZWNyZW1lbnQgKi9cclxuY2xhc3MgQWJzdHJhY3RTeXN0ZW1WYXJpYWJsZXMge1xyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxyXG4gICAgcmVzb2x2ZSh2YWx1ZSkge1xyXG4gICAgICAgIGlmIChUeXBlcy5pc1N0cmluZyh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19yZXNvbHZlU3RyaW5nKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoVHlwZXMuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19yZXNvbHZlQXJyYXkodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChUeXBlcy5pc09iamVjdCh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX19yZXNvbHZlTGl0ZXJhbCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgIHJlc29sdmVBbnkodmFsdWUpIHtcclxuICAgICAgICBpZiAoVHlwZXMuaXNTdHJpbmcodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fcmVzb2x2ZVN0cmluZyh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKFR5cGVzLmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fcmVzb2x2ZUFueUFycmF5KHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoVHlwZXMuaXNPYmplY3QodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9fcmVzb2x2ZUFueUxpdGVyYWwodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBfX3Jlc29sdmVTdHJpbmcodmFsdWUpIHtcclxuICAgICAgICBjb25zdCByZWdleHAgPSAvXFwkXFx7KC4qPylcXH0vZztcclxuICAgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZShyZWdleHAsIChtYXRjaCwgbmFtZSkgPT4ge1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGhpc1tuYW1lXTtcclxuICAgICAgICAgICAgaWYgKFR5cGVzLmlzU3RyaW5nKG5ld1ZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoICYmIChtYXRjaC5pbmRleE9mKCdlbnYuJykgPiAwIHx8IG1hdGNoLmluZGV4T2YoJ2VudjonKSA+IDApID8gJycgOiBtYXRjaDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgX19yZXNvbHZlTGl0ZXJhbCh2YWx1ZXMpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHZhbHVlcykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1trZXldO1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdGhpcy5yZXNvbHZlKHZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxyXG4gICAgX19yZXNvbHZlQW55TGl0ZXJhbCh2YWx1ZXMpIHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHZhbHVlcykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1trZXldO1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdGhpcy5yZXNvbHZlQW55KHZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgX19yZXNvbHZlQXJyYXkodmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUubWFwKHMgPT4gdGhpcy5fX3Jlc29sdmVTdHJpbmcocykpO1xyXG4gICAgfVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxyXG4gICAgX19yZXNvbHZlQW55QXJyYXkodmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWUubWFwKHMgPT4gdGhpcy5yZXNvbHZlQW55KHMpKTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLkFic3RyYWN0U3lzdGVtVmFyaWFibGVzID0gQWJzdHJhY3RTeXN0ZW1WYXJpYWJsZXM7XHJcbmNsYXNzIFN5c3RlbVZhcmlhYmxlcyBleHRlbmRzIEFic3RyYWN0U3lzdGVtVmFyaWFibGVzIHtcclxuICAgIGNvbnN0cnVjdG9yKHdvcmtzcGFjZUZvbGRlcikge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5fd29ya3NwYWNlRm9sZGVyID0gdHlwZW9mIHdvcmtzcGFjZUZvbGRlciA9PT0gJ3N0cmluZycgPyB3b3Jrc3BhY2VGb2xkZXIgOiBfX2Rpcm5hbWU7XHJcbiAgICAgICAgdGhpcy5fd29ya3NwYWNlRm9sZGVyTmFtZSA9IFBhdGguYmFzZW5hbWUodGhpcy5fd29ya3NwYWNlRm9sZGVyKTtcclxuICAgICAgICBPYmplY3Qua2V5cyhwcm9jZXNzLmVudikuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzW2BlbnY6JHtrZXl9YF0gPSB0aGlzW2BlbnYuJHtrZXl9YF0gPSBwcm9jZXNzLmVudltrZXldO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0IGN3ZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy53b3Jrc3BhY2VGb2xkZXI7XHJcbiAgICB9XHJcbiAgICBnZXQgd29ya3NwYWNlUm9vdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fd29ya3NwYWNlRm9sZGVyO1xyXG4gICAgfVxyXG4gICAgZ2V0IHdvcmtzcGFjZUZvbGRlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fd29ya3NwYWNlRm9sZGVyO1xyXG4gICAgfVxyXG4gICAgZ2V0IHdvcmtzcGFjZVJvb3RGb2xkZXJOYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl93b3Jrc3BhY2VGb2xkZXJOYW1lO1xyXG4gICAgfVxyXG4gICAgZ2V0IHdvcmtzcGFjZUZvbGRlckJhc2VuYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl93b3Jrc3BhY2VGb2xkZXJOYW1lO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuU3lzdGVtVmFyaWFibGVzID0gU3lzdGVtVmFyaWFibGVzO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zeXN0ZW1WYXJpYWJsZXMuanMubWFwIl19