"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable-next-line:no-require-imports no-var-requires

const sudo = require('sudo-prompt');

const fs = require("fs");

const inversify_1 = require("inversify");

const path = require("path");

const vscode = require("vscode");

const contracts_1 = require("../../interpreter/contracts");

const constants_1 = require("../constants");

const types_1 = require("../terminal/types");

const types_2 = require("../types");

const misc_1 = require("../utils/misc");

let ModuleInstaller = class ModuleInstaller {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
  }

  installModule(name, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      const executionInfo = yield this.getExecutionInfo(name, resource);
      const terminalService = this.serviceContainer.get(types_1.ITerminalServiceFactory).getTerminalService(resource);
      const executionInfoArgs = yield this.processInstallArgs(executionInfo.args, resource);

      if (executionInfo.moduleName) {
        const configService = this.serviceContainer.get(types_2.IConfigurationService);
        const settings = configService.getSettings(resource);
        const args = ['-m', executionInfo.moduleName].concat(executionInfoArgs);
        const pythonPath = settings.pythonPath;
        const interpreterService = this.serviceContainer.get(contracts_1.IInterpreterService);
        const currentInterpreter = yield interpreterService.getActiveInterpreter(resource);

        if (!currentInterpreter || currentInterpreter.type !== contracts_1.InterpreterType.Unknown) {
          yield terminalService.sendCommand(pythonPath, args);
        } else if (settings.globalModuleInstallation) {
          if (yield this.isPathWritableAsync(path.dirname(pythonPath))) {
            yield terminalService.sendCommand(pythonPath, args);
          } else {
            this.elevatedInstall(pythonPath, args);
          }
        } else {
          yield terminalService.sendCommand(pythonPath, args.concat(['--user']));
        }
      } else {
        yield terminalService.sendCommand(executionInfo.execPath, executionInfoArgs);
      }
    });
  }

  processInstallArgs(args, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      const indexOfPylint = args.findIndex(arg => arg.toUpperCase() === 'PYLINT');

      if (indexOfPylint === -1) {
        return args;
      } // If installing pylint on python 2.x, then use pylint~=1.9.0


      const interpreterService = this.serviceContainer.get(contracts_1.IInterpreterService);
      const currentInterpreter = yield interpreterService.getActiveInterpreter(resource);

      if (currentInterpreter && currentInterpreter.version_info && currentInterpreter.version_info[0] === 2) {
        const newArgs = [...args]; // This command could be sent to the terminal, hence '<' needs to be escaped for UNIX.

        newArgs[indexOfPylint] = '"pylint<2.0.0"';
        return newArgs;
      }

      return args;
    });
  }

  isPathWritableAsync(directoryPath) {
    return __awaiter(this, void 0, void 0, function* () {
      const filePath = `${directoryPath}${path.sep}___vscpTest___`;
      return new Promise(resolve => {
        fs.open(filePath, fs.constants.O_CREAT | fs.constants.O_RDWR, (error, fd) => {
          if (!error) {
            fs.close(fd, e => {
              fs.unlink(filePath, misc_1.noop);
            });
          }

          return resolve(!error);
        });
      });
    });
  }

  elevatedInstall(execPath, args) {
    const options = {
      name: 'VS Code Python'
    };
    const outputChannel = this.serviceContainer.get(types_2.IOutputChannel, constants_1.STANDARD_OUTPUT_CHANNEL);
    const command = `"${execPath.replace(/\\/g, '/')}" ${args.join(' ')}`;
    outputChannel.appendLine('');
    outputChannel.appendLine(`[Elevated] ${command}`);
    sudo.exec(command, options, (error, stdout, stderr) => {
      if (error) {
        vscode.window.showErrorMessage(error);
      } else {
        outputChannel.show();

        if (stdout) {
          outputChannel.appendLine('');
          outputChannel.append(stdout);
        }

        if (stderr) {
          outputChannel.appendLine('');
          outputChannel.append(`Warning: ${stderr}`);
        }
      }
    });
  }

};
ModuleInstaller = __decorate([inversify_1.injectable()], ModuleInstaller);
exports.ModuleInstaller = ModuleInstaller;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZUluc3RhbGxlci5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsInN1ZG8iLCJyZXF1aXJlIiwiZnMiLCJpbnZlcnNpZnlfMSIsInBhdGgiLCJ2c2NvZGUiLCJjb250cmFjdHNfMSIsImNvbnN0YW50c18xIiwidHlwZXNfMSIsInR5cGVzXzIiLCJtaXNjXzEiLCJNb2R1bGVJbnN0YWxsZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJpbnN0YWxsTW9kdWxlIiwibmFtZSIsInJlc291cmNlIiwiZXhlY3V0aW9uSW5mbyIsImdldEV4ZWN1dGlvbkluZm8iLCJ0ZXJtaW5hbFNlcnZpY2UiLCJnZXQiLCJJVGVybWluYWxTZXJ2aWNlRmFjdG9yeSIsImdldFRlcm1pbmFsU2VydmljZSIsImV4ZWN1dGlvbkluZm9BcmdzIiwicHJvY2Vzc0luc3RhbGxBcmdzIiwiYXJncyIsIm1vZHVsZU5hbWUiLCJjb25maWdTZXJ2aWNlIiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsImNvbmNhdCIsInB5dGhvblBhdGgiLCJpbnRlcnByZXRlclNlcnZpY2UiLCJJSW50ZXJwcmV0ZXJTZXJ2aWNlIiwiY3VycmVudEludGVycHJldGVyIiwiZ2V0QWN0aXZlSW50ZXJwcmV0ZXIiLCJ0eXBlIiwiSW50ZXJwcmV0ZXJUeXBlIiwiVW5rbm93biIsInNlbmRDb21tYW5kIiwiZ2xvYmFsTW9kdWxlSW5zdGFsbGF0aW9uIiwiaXNQYXRoV3JpdGFibGVBc3luYyIsImRpcm5hbWUiLCJlbGV2YXRlZEluc3RhbGwiLCJleGVjUGF0aCIsImluZGV4T2ZQeWxpbnQiLCJmaW5kSW5kZXgiLCJhcmciLCJ0b1VwcGVyQ2FzZSIsInZlcnNpb25faW5mbyIsIm5ld0FyZ3MiLCJkaXJlY3RvcnlQYXRoIiwiZmlsZVBhdGgiLCJzZXAiLCJvcGVuIiwiY29uc3RhbnRzIiwiT19DUkVBVCIsIk9fUkRXUiIsImVycm9yIiwiZmQiLCJjbG9zZSIsInVubGluayIsIm5vb3AiLCJvcHRpb25zIiwib3V0cHV0Q2hhbm5lbCIsIklPdXRwdXRDaGFubmVsIiwiU1RBTkRBUkRfT1VUUFVUX0NIQU5ORUwiLCJjb21tYW5kIiwicmVwbGFjZSIsImpvaW4iLCJhcHBlbmRMaW5lIiwiZXhlYyIsInN0ZG91dCIsInN0ZGVyciIsIndpbmRvdyIsInNob3dFcnJvck1lc3NhZ2UiLCJzaG93IiwiYXBwZW5kIiwiaW5qZWN0YWJsZSJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsVUFBVSxHQUFJLFVBQVEsU0FBS0EsVUFBZCxJQUE2QixVQUFVQyxVQUFWLEVBQXNCQyxNQUF0QixFQUE4QkMsR0FBOUIsRUFBbUNDLElBQW5DLEVBQXlDO0FBQ25GLE1BQUlDLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUFsQjtBQUFBLE1BQTBCQyxDQUFDLEdBQUdILENBQUMsR0FBRyxDQUFKLEdBQVFILE1BQVIsR0FBaUJFLElBQUksS0FBSyxJQUFULEdBQWdCQSxJQUFJLEdBQUdLLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NSLE1BQWhDLEVBQXdDQyxHQUF4QyxDQUF2QixHQUFzRUMsSUFBckg7QUFBQSxNQUEySE8sQ0FBM0g7QUFDQSxNQUFJLE9BQU9DLE9BQVAsS0FBbUIsUUFBbkIs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QUNBcEUsSUFBQUEsSUFBSSxDQUFDd0UsSUFBTCxDQUFVSixPQUFWLEVBQW1CSixPQUFuQixFQUE0QixDQUFDTCxLQUFELEVBQVFjLE1BQVIsRUFBZ0JDLE1BQWhCLEtBQTJCO0FBQ25ELFVBQUlmLEtBQUosRUFBVztBQUNQdEQsUUFBQUEsTUFBTSxDQUFDc0UsTUFBUCxDQUFjQyxnQkFBZCxDQUErQmpCLEtBQS9CO0FBQ0gsT0FGRCxNQUdLO0FBQ0RNLFFBQUFBLGFBQWEsQ0FBQ1ksSUFBZDs7QUFDQSxZQUFJSixNQUFKLEVBQVk7QUFDUlIsVUFBQUEsYUFBYSxDQUFDTSxVQUFkLENBQXlCLEVBQXpCO0FBQ0FOLFVBQUFBLGFBQWEsQ0FBQ2EsTUFBZCxDQUFxQkwsTUFBckI7QUFDSDs7QUFDRCxZQUFJQyxNQUFKLEVBQVk7QUFDUlQsVUFBQUEsYUFBYSxDQUFDTSxVQUFkLENBQXlCLEVBQXpCO0FBQ0FOLFVBQUFBLGFBQWEsQ0FBQ2EsTUFBZCxDQUFzQixZQUFXSixNQUFPLEVBQXhDO0FBQ0g7QUFDSjtBQUNKLEtBZkQ7QUFnQkg7O0FBN0Z1QyxDQUE1QztBQStGQS9ELGVBQWUsR0FBRzlDLFVBQVUsQ0FBQyxDQUN6QnNDLFdBQVcsQ0FBQzRFLFVBQVosRUFEeUIsQ0FBRCxFQUV6QnBFLGVBRnlCLENBQTVCO0FBR0FaLE9BQU8sQ0FBQ1ksZUFBUixHQUEwQkEsZUFBMUIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tcmVxdWlyZS1pbXBvcnRzIG5vLXZhci1yZXF1aXJlc1xyXG5jb25zdCBzdWRvID0gcmVxdWlyZSgnc3Vkby1wcm9tcHQnKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKFwiZnNcIik7XHJcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB2c2NvZGUgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9pbnRlcnByZXRlci9jb250cmFjdHNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi90ZXJtaW5hbC90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi90eXBlc1wiKTtcclxuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uL3V0aWxzL21pc2NcIik7XHJcbmxldCBNb2R1bGVJbnN0YWxsZXIgPSBjbGFzcyBNb2R1bGVJbnN0YWxsZXIge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuc2VydmljZUNvbnRhaW5lciA9IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICB9XHJcbiAgICBpbnN0YWxsTW9kdWxlKG5hbWUsIHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgZXhlY3V0aW9uSW5mbyA9IHlpZWxkIHRoaXMuZ2V0RXhlY3V0aW9uSW5mbyhuYW1lLCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlcm1pbmFsU2VydmljZSA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JVGVybWluYWxTZXJ2aWNlRmFjdG9yeSkuZ2V0VGVybWluYWxTZXJ2aWNlKHJlc291cmNlKTtcclxuICAgICAgICAgICAgY29uc3QgZXhlY3V0aW9uSW5mb0FyZ3MgPSB5aWVsZCB0aGlzLnByb2Nlc3NJbnN0YWxsQXJncyhleGVjdXRpb25JbmZvLmFyZ3MsIHJlc291cmNlKTtcclxuICAgICAgICAgICAgaWYgKGV4ZWN1dGlvbkluZm8ubW9kdWxlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JQ29uZmlndXJhdGlvblNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBjb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFyZ3MgPSBbJy1tJywgZXhlY3V0aW9uSW5mby5tb2R1bGVOYW1lXS5jb25jYXQoZXhlY3V0aW9uSW5mb0FyZ3MpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHl0aG9uUGF0aCA9IHNldHRpbmdzLnB5dGhvblBhdGg7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnRlcnByZXRlclNlcnZpY2UgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KGNvbnRyYWN0c18xLklJbnRlcnByZXRlclNlcnZpY2UpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEludGVycHJldGVyID0geWllbGQgaW50ZXJwcmV0ZXJTZXJ2aWNlLmdldEFjdGl2ZUludGVycHJldGVyKHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudEludGVycHJldGVyIHx8IGN1cnJlbnRJbnRlcnByZXRlci50eXBlICE9PSBjb250cmFjdHNfMS5JbnRlcnByZXRlclR5cGUuVW5rbm93bikge1xyXG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHRlcm1pbmFsU2VydmljZS5zZW5kQ29tbWFuZChweXRob25QYXRoLCBhcmdzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNldHRpbmdzLmdsb2JhbE1vZHVsZUluc3RhbGxhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh5aWVsZCB0aGlzLmlzUGF0aFdyaXRhYmxlQXN5bmMocGF0aC5kaXJuYW1lKHB5dGhvblBhdGgpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXJtaW5hbFNlcnZpY2Uuc2VuZENvbW1hbmQocHl0aG9uUGF0aCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZXZhdGVkSW5zdGFsbChweXRob25QYXRoLCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXJtaW5hbFNlcnZpY2Uuc2VuZENvbW1hbmQocHl0aG9uUGF0aCwgYXJncy5jb25jYXQoWyctLXVzZXInXSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdGVybWluYWxTZXJ2aWNlLnNlbmRDb21tYW5kKGV4ZWN1dGlvbkluZm8uZXhlY1BhdGgsIGV4ZWN1dGlvbkluZm9BcmdzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJvY2Vzc0luc3RhbGxBcmdzKGFyZ3MsIHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXhPZlB5bGludCA9IGFyZ3MuZmluZEluZGV4KGFyZyA9PiBhcmcudG9VcHBlckNhc2UoKSA9PT0gJ1BZTElOVCcpO1xyXG4gICAgICAgICAgICBpZiAoaW5kZXhPZlB5bGludCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcmdzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIElmIGluc3RhbGxpbmcgcHlsaW50IG9uIHB5dGhvbiAyLngsIHRoZW4gdXNlIHB5bGludH49MS45LjBcclxuICAgICAgICAgICAgY29uc3QgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gdGhpcy5zZXJ2aWNlQ29udGFpbmVyLmdldChjb250cmFjdHNfMS5JSW50ZXJwcmV0ZXJTZXJ2aWNlKTtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudEludGVycHJldGVyID0geWllbGQgaW50ZXJwcmV0ZXJTZXJ2aWNlLmdldEFjdGl2ZUludGVycHJldGVyKHJlc291cmNlKTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRJbnRlcnByZXRlciAmJiBjdXJyZW50SW50ZXJwcmV0ZXIudmVyc2lvbl9pbmZvICYmIGN1cnJlbnRJbnRlcnByZXRlci52ZXJzaW9uX2luZm9bMF0gPT09IDIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0FyZ3MgPSBbLi4uYXJnc107XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGNvbW1hbmQgY291bGQgYmUgc2VudCB0byB0aGUgdGVybWluYWwsIGhlbmNlICc8JyBuZWVkcyB0byBiZSBlc2NhcGVkIGZvciBVTklYLlxyXG4gICAgICAgICAgICAgICAgbmV3QXJnc1tpbmRleE9mUHlsaW50XSA9ICdcInB5bGludDwyLjAuMFwiJztcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdBcmdzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaXNQYXRoV3JpdGFibGVBc3luYyhkaXJlY3RvcnlQYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBgJHtkaXJlY3RvcnlQYXRofSR7cGF0aC5zZXB9X19fdnNjcFRlc3RfX19gO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmcy5vcGVuKGZpbGVQYXRoLCBmcy5jb25zdGFudHMuT19DUkVBVCB8IGZzLmNvbnN0YW50cy5PX1JEV1IsIChlcnJvciwgZmQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZzLmNsb3NlKGZkLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnMudW5saW5rKGZpbGVQYXRoLCBtaXNjXzEubm9vcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSghZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZWxldmF0ZWRJbnN0YWxsKGV4ZWNQYXRoLCBhcmdzKSB7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ1ZTIENvZGUgUHl0aG9uJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0Q2hhbm5lbCA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JT3V0cHV0Q2hhbm5lbCwgY29uc3RhbnRzXzEuU1RBTkRBUkRfT1VUUFVUX0NIQU5ORUwpO1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBgXCIke2V4ZWNQYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKX1cIiAke2FyZ3Muam9pbignICcpfWA7XHJcbiAgICAgICAgb3V0cHV0Q2hhbm5lbC5hcHBlbmRMaW5lKCcnKTtcclxuICAgICAgICBvdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoYFtFbGV2YXRlZF0gJHtjb21tYW5kfWApO1xyXG4gICAgICAgIHN1ZG8uZXhlYyhjb21tYW5kLCBvcHRpb25zLCAoZXJyb3IsIHN0ZG91dCwgc3RkZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdnNjb2RlLndpbmRvdy5zaG93RXJyb3JNZXNzYWdlKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG91dHB1dENoYW5uZWwuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0ZG91dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dENoYW5uZWwuYXBwZW5kTGluZSgnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0Q2hhbm5lbC5hcHBlbmQoc3Rkb3V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzdGRlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoJycpO1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dENoYW5uZWwuYXBwZW5kKGBXYXJuaW5nOiAke3N0ZGVycn1gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5Nb2R1bGVJbnN0YWxsZXIgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKVxyXG5dLCBNb2R1bGVJbnN0YWxsZXIpO1xyXG5leHBvcnRzLk1vZHVsZUluc3RhbGxlciA9IE1vZHVsZUluc3RhbGxlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bW9kdWxlSW5zdGFsbGVyLmpzLm1hcCJdfQ==