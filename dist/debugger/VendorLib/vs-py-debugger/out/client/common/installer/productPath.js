// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-classes-per-file

const inversify_1 = require("inversify");

const path = require("path");

const types_1 = require("../../formatters/types");

const types_2 = require("../../ioc/types");

const types_3 = require("../../linters/types");

const types_4 = require("../../unittests/common/types");

const types_5 = require("../types");

let BaseProductPathsService = class BaseProductPathsService {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
    this.configService = serviceContainer.get(types_5.IConfigurationService);
    this.productInstaller = serviceContainer.get(types_5.IInstaller);
  }

  isExecutableAModule(product, resource) {
    let moduleName;

    try {
      moduleName = this.productInstaller.translateProductToModuleName(product, types_5.ModuleNamePurpose.run); // tslint:disable-next-line:no-empty
    } catch (_a) {} // User may have customized the module name or provided the fully qualifieid path.


    const executableName = this.getExecutableNameFromSettings(product, resource);
    return typeof moduleName === 'string' && moduleName.length > 0 && path.basename(executableName) === executableName;
  }

};
BaseProductPathsService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], BaseProductPathsService);
let CTagsProductPathService = class CTagsProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(_, resource) {
    const settings = this.configService.getSettings(resource);
    return settings.workspaceSymbols.ctagsPath;
  }

};
CTagsProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], CTagsProductPathService);
exports.CTagsProductPathService = CTagsProductPathService;
let FormatterProductPathService = class FormatterProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, resource) {
    const settings = this.configService.getSettings(resource);
    const formatHelper = this.serviceContainer.get(types_1.IFormatterHelper);
    const settingsPropNames = formatHelper.getSettingsPropertyNames(product);
    return settings.formatting[settingsPropNames.pathName];
  }

};
FormatterProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], FormatterProductPathService);
exports.FormatterProductPathService = FormatterProductPathService;
let LinterProductPathService = class LinterProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, resource) {
    const linterManager = this.serviceContainer.get(types_3.ILinterManager);
    return linterManager.getLinterInfo(product).pathName(resource);
  }

};
LinterProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], LinterProductPathService);
exports.LinterProductPathService = LinterProductPathService;
let TestFrameworkProductPathService = class TestFrameworkProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, resource) {
    const testHelper = this.serviceContainer.get(types_4.ITestsHelper);
    const settingsPropNames = testHelper.getSettingsPropertyNames(product);

    if (!settingsPropNames.pathName) {
      // E.g. in the case of UnitTests we don't allow customizing the paths.
      return this.productInstaller.translateProductToModuleName(product, types_5.ModuleNamePurpose.run);
    }

    const settings = this.configService.getSettings(resource);
    return settings.unitTest[settingsPropNames.pathName];
  }

};
TestFrameworkProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], TestFrameworkProductPathService);
exports.TestFrameworkProductPathService = TestFrameworkProductPathService;
let RefactoringLibraryProductPathService = class RefactoringLibraryProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, _) {
    return this.productInstaller.translateProductToModuleName(product, types_5.ModuleNamePurpose.run);
  }

};
RefactoringLibraryProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], RefactoringLibraryProductPathService);
exports.RefactoringLibraryProductPathService = RefactoringLibraryProductPathService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2R1Y3RQYXRoLmpzIl0sIm5hbWVzIjpbIl9fZGVjb3JhdGUiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJyIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZCIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fcGFyYW0iLCJwYXJhbUluZGV4IiwiZGVjb3JhdG9yIiwiZXhwb3J0cyIsInZhbHVlIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwicGF0aCIsInR5cGVzXzEiLCJ0eXBlc18yIiwidHlwZXNfMyIsInR5cGVzXzQiLCJ0eXBlc181IiwiQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJjb25maWdTZXJ2aWNlIiwiZ2V0IiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwicHJvZHVjdEluc3RhbGxlciIsIklJbnN0YWxsZXIiLCJpc0V4ZWN1dGFibGVBTW9kdWxlIiwicHJvZHVjdCIsInJlc291cmNlIiwibW9kdWxlTmFtZSIsInRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUiLCJNb2R1bGVOYW1lUHVycG9zZSIsInJ1biIsIl9hIiwiZXhlY3V0YWJsZU5hbWUiLCJnZXRFeGVjdXRhYmxlTmFtZUZyb21TZXR0aW5ncyIsImJhc2VuYW1lIiwiaW5qZWN0YWJsZSIsImluamVjdCIsIklTZXJ2aWNlQ29udGFpbmVyIiwiQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UiLCJfIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsIndvcmtzcGFjZVN5bWJvbHMiLCJjdGFnc1BhdGgiLCJGb3JtYXR0ZXJQcm9kdWN0UGF0aFNlcnZpY2UiLCJmb3JtYXRIZWxwZXIiLCJJRm9ybWF0dGVySGVscGVyIiwic2V0dGluZ3NQcm9wTmFtZXMiLCJnZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMiLCJmb3JtYXR0aW5nIiwicGF0aE5hbWUiLCJMaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UiLCJsaW50ZXJNYW5hZ2VyIiwiSUxpbnRlck1hbmFnZXIiLCJnZXRMaW50ZXJJbmZvIiwiVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZSIsInRlc3RIZWxwZXIiLCJJVGVzdHNIZWxwZXIiLCJ1bml0VGVzdCIsIlJlZmFjdG9yaW5nTGlicmFyeVByb2R1Y3RQYXRoU2VydmljZSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFVBQVUsR0FBSSxVQUFRLFNBQUtBLFVBQWQsSUFBNkIsVUFBVUMsVUFBVixFQUFzQkMsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUNuRixNQUFJQyxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsTUFBbEI7QUFBQSxNQUEwQkMsQ0FBQyxHQUFHSCxDQUFDLEdBQUcsQ0FBSixHQUFRSCxNQUFSLEdBQWlCRSxJQUFJLEtBQUssSUFBVCxHQUFnQkEsSUFBSSxHQUFHSyxNQUFNLENBQUNDLHdCQUFQLENBQWdDUixNQUFoQyxFQUF3Q0MsR0FBeEMsQ0FBdkIsR0FBc0VDLElBQXJIO0FBQUEsTUFBMkhPLENBQTNIO0FBQ0EsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFFBQW5CLElBQStCLE9BQU9BLE9BQU8sQ0FBQ0MsUUFBZixLQUE0QixVQUEvRCxFQUEyRUwsQ0FBQyxHQUFHSSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJaLFVBQWpCLEVBQTZCQyxNQUE3QixFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLENBQUosQ0FBM0UsS0FDSyxLQUFLLElBQUlVLENBQUMsR0FBR2IsVUFBVSxDQUFDTSxNQUFYLEdBQW9CLENBQWpDLEVBQW9DTyxDQUFDLElBQUksQ0FBekMsRUFBNENBLENBQUMsRUFBN0MsRUFBaUQsSUFBSUgsQ0FBQyxHQUFHVixVQUFVLENBQUNhLENBQUQsQ0FBbEIsRUFBdUJOLENBQUMsR0FBRyxDQUFDSCxDQUFDLEdBQUcsQ0FBSixHQUFR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LENBQVA7QUFDSDs7QUFOaUgsQ0FBdEg7QUFRQTZCLG9DQUFvQyxHQUFHeEUsVUFBVSxDQUFDLENBQzlDcUIsV0FBVyxDQUFDMkIsVUFBWixFQUQ4QyxFQUU5Q2hDLE9BQU8sQ0FBQyxDQUFELEVBQUlLLFdBQVcsQ0FBQzRCLE1BQVosQ0FBbUJ4QixPQUFPLENBQUN5QixpQkFBM0IsQ0FBSixDQUZ1QyxDQUFELEVBRzlDc0Isb0NBSDhDLENBQWpEO0FBSUFyRCxPQUFPLENBQUNxRCxvQ0FBUixHQUErQ0Esb0NBQS9DIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gdHNsaW50OmRpc2FibGU6bWF4LWNsYXNzZXMtcGVyLWZpbGVcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vZm9ybWF0dGVycy90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi9pb2MvdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vbGludGVycy90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi91bml0dGVzdHMvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc181ID0gcmVxdWlyZShcIi4uL3R5cGVzXCIpO1xyXG5sZXQgQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2UgPSBjbGFzcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlQ29udGFpbmVyID0gc2VydmljZUNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmNvbmZpZ1NlcnZpY2UgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc181LklDb25maWd1cmF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgdGhpcy5wcm9kdWN0SW5zdGFsbGVyID0gc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfNS5JSW5zdGFsbGVyKTtcclxuICAgIH1cclxuICAgIGlzRXhlY3V0YWJsZUFNb2R1bGUocHJvZHVjdCwgcmVzb3VyY2UpIHtcclxuICAgICAgICBsZXQgbW9kdWxlTmFtZTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBtb2R1bGVOYW1lID0gdGhpcy5wcm9kdWN0SW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdCwgdHlwZXNfNS5Nb2R1bGVOYW1lUHVycG9zZS5ydW4pO1xyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZW1wdHlcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7IH1cclxuICAgICAgICAvLyBVc2VyIG1heSBoYXZlIGN1c3RvbWl6ZWQgdGhlIG1vZHVsZSBuYW1lIG9yIHByb3ZpZGVkIHRoZSBmdWxseSBxdWFsaWZpZWlkIHBhdGguXHJcbiAgICAgICAgY29uc3QgZXhlY3V0YWJsZU5hbWUgPSB0aGlzLmdldEV4ZWN1dGFibGVOYW1lRnJvbVNldHRpbmdzKHByb2R1Y3QsIHJlc291cmNlKTtcclxuICAgICAgICByZXR1cm4gdHlwZW9mIG1vZHVsZU5hbWUgPT09ICdzdHJpbmcnICYmIG1vZHVsZU5hbWUubGVuZ3RoID4gMCAmJiBwYXRoLmJhc2VuYW1lKGV4ZWN1dGFibGVOYW1lKSA9PT0gZXhlY3V0YWJsZU5hbWU7XHJcbiAgICB9XHJcbn07XHJcbkJhc2VQcm9kdWN0UGF0aHNTZXJ2aWNlID0gX19kZWNvcmF0ZShbXHJcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXHJcbiAgICBfX3BhcmFtKDAsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc18yLklTZXJ2aWNlQ29udGFpbmVyKSlcclxuXSwgQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2UpO1xyXG5sZXQgQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UgPSBjbGFzcyBDVGFnc1Byb2R1Y3RQYXRoU2VydmljZSBleHRlbmRzIEJhc2VQcm9kdWN0UGF0aHNTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2VDb250YWluZXIpIHtcclxuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGdldEV4ZWN1dGFibGVOYW1lRnJvbVNldHRpbmdzKF8sIHJlc291cmNlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpO1xyXG4gICAgICAgIHJldHVybiBzZXR0aW5ncy53b3Jrc3BhY2VTeW1ib2xzLmN0YWdzUGF0aDtcclxuICAgIH1cclxufTtcclxuQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBDVGFnc1Byb2R1Y3RQYXRoU2VydmljZSk7XHJcbmV4cG9ydHMuQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UgPSBDVGFnc1Byb2R1Y3RQYXRoU2VydmljZTtcclxubGV0IEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSA9IGNsYXNzIEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSBleHRlbmRzIEJhc2VQcm9kdWN0UGF0aHNTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2VDb250YWluZXIpIHtcclxuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGdldEV4ZWN1dGFibGVOYW1lRnJvbVNldHRpbmdzKHByb2R1Y3QsIHJlc291cmNlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpO1xyXG4gICAgICAgIGNvbnN0IGZvcm1hdEhlbHBlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JRm9ybWF0dGVySGVscGVyKTtcclxuICAgICAgICBjb25zdCBzZXR0aW5nc1Byb3BOYW1lcyA9IGZvcm1hdEhlbHBlci5nZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMocHJvZHVjdCk7XHJcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzLmZvcm1hdHRpbmdbc2V0dGluZ3NQcm9wTmFtZXMucGF0aE5hbWVdO1xyXG4gICAgfVxyXG59O1xyXG5Gb3JtYXR0ZXJQcm9kdWN0UGF0aFNlcnZpY2UgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBGb3JtYXR0ZXJQcm9kdWN0UGF0aFNlcnZpY2UpO1xyXG5leHBvcnRzLkZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSA9IEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZTtcclxubGV0IExpbnRlclByb2R1Y3RQYXRoU2VydmljZSA9IGNsYXNzIExpbnRlclByb2R1Y3RQYXRoU2VydmljZSBleHRlbmRzIEJhc2VQcm9kdWN0UGF0aHNTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2VDb250YWluZXIpIHtcclxuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGdldEV4ZWN1dGFibGVOYW1lRnJvbVNldHRpbmdzKHByb2R1Y3QsIHJlc291cmNlKSB7XHJcbiAgICAgICAgY29uc3QgbGludGVyTWFuYWdlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMy5JTGludGVyTWFuYWdlcik7XHJcbiAgICAgICAgcmV0dXJuIGxpbnRlck1hbmFnZXIuZ2V0TGludGVySW5mbyhwcm9kdWN0KS5wYXRoTmFtZShyZXNvdXJjZSk7XHJcbiAgICB9XHJcbn07XHJcbkxpbnRlclByb2R1Y3RQYXRoU2VydmljZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxyXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JU2VydmljZUNvbnRhaW5lcikpXHJcbl0sIExpbnRlclByb2R1Y3RQYXRoU2VydmljZSk7XHJcbmV4cG9ydHMuTGludGVyUHJvZHVjdFBhdGhTZXJ2aWNlID0gTGludGVyUHJvZHVjdFBhdGhTZXJ2aWNlO1xyXG5sZXQgVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZSA9IGNsYXNzIFRlc3RGcmFtZXdvcmtQcm9kdWN0UGF0aFNlcnZpY2UgZXh0ZW5kcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgc3VwZXIoc2VydmljZUNvbnRhaW5lcik7XHJcbiAgICB9XHJcbiAgICBnZXRFeGVjdXRhYmxlTmFtZUZyb21TZXR0aW5ncyhwcm9kdWN0LCByZXNvdXJjZSkge1xyXG4gICAgICAgIGNvbnN0IHRlc3RIZWxwZXIgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzQuSVRlc3RzSGVscGVyKTtcclxuICAgICAgICBjb25zdCBzZXR0aW5nc1Byb3BOYW1lcyA9IHRlc3RIZWxwZXIuZ2V0U2V0dGluZ3NQcm9wZXJ0eU5hbWVzKHByb2R1Y3QpO1xyXG4gICAgICAgIGlmICghc2V0dGluZ3NQcm9wTmFtZXMucGF0aE5hbWUpIHtcclxuICAgICAgICAgICAgLy8gRS5nLiBpbiB0aGUgY2FzZSBvZiBVbml0VGVzdHMgd2UgZG9uJ3QgYWxsb3cgY3VzdG9taXppbmcgdGhlIHBhdGhzLlxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9kdWN0SW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdCwgdHlwZXNfNS5Nb2R1bGVOYW1lUHVycG9zZS5ydW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuY29uZmlnU2VydmljZS5nZXRTZXR0aW5ncyhyZXNvdXJjZSk7XHJcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzLnVuaXRUZXN0W3NldHRpbmdzUHJvcE5hbWVzLnBhdGhOYW1lXTtcclxuICAgIH1cclxufTtcclxuVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxyXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JU2VydmljZUNvbnRhaW5lcikpXHJcbl0sIFRlc3RGcmFtZXdvcmtQcm9kdWN0UGF0aFNlcnZpY2UpO1xyXG5leHBvcnRzLlRlc3RGcmFtZXdvcmtQcm9kdWN0UGF0aFNlcnZpY2UgPSBUZXN0RnJhbWV3b3JrUHJvZHVjdFBhdGhTZXJ2aWNlO1xyXG5sZXQgUmVmYWN0b3JpbmdMaWJyYXJ5UHJvZHVjdFBhdGhTZXJ2aWNlID0gY2xhc3MgUmVmYWN0b3JpbmdMaWJyYXJ5UHJvZHVjdFBhdGhTZXJ2aWNlIGV4dGVuZHMgQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xyXG4gICAgICAgIHN1cGVyKHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgfVxyXG4gICAgZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MocHJvZHVjdCwgXykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnByb2R1Y3RJbnN0YWxsZXIudHJhbnNsYXRlUHJvZHVjdFRvTW9kdWxlTmFtZShwcm9kdWN0LCB0eXBlc181Lk1vZHVsZU5hbWVQdXJwb3NlLnJ1bik7XHJcbiAgICB9XHJcbn07XHJcblJlZmFjdG9yaW5nTGlicmFyeVByb2R1Y3RQYXRoU2VydmljZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxyXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JU2VydmljZUNvbnRhaW5lcikpXHJcbl0sIFJlZmFjdG9yaW5nTGlicmFyeVByb2R1Y3RQYXRoU2VydmljZSk7XHJcbmV4cG9ydHMuUmVmYWN0b3JpbmdMaWJyYXJ5UHJvZHVjdFBhdGhTZXJ2aWNlID0gUmVmYWN0b3JpbmdMaWJyYXJ5UHJvZHVjdFBhdGhTZXJ2aWNlO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9kdWN0UGF0aC5qcy5tYXAiXX0=