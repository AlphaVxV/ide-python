"use strict";

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const dmp = require("diff-match-patch");

const fs = require("fs-extra");

const inversify_1 = require("inversify");

const md5 = require("md5");

const os_1 = require("os");

const path = require("path");

const vscode_1 = require("vscode"); // Code borrowed from goFormat.ts (Go Extension for VS Code)


var EditAction;

(function (EditAction) {
  EditAction[EditAction["Delete"] = 0] = "Delete";
  EditAction[EditAction["Insert"] = 1] = "Insert";
  EditAction[EditAction["Replace"] = 2] = "Replace";
})(EditAction || (EditAction = {}));

const NEW_LINE_LENGTH = os_1.EOL.length;

class Patch {}

class Edit {
  constructor(action, start) {
    this.action = action;
    this.start = start;
    this.text = '';
  }

  apply() {
    switch (this.action) {
      case EditAction.Insert:
        return vscode_1.TextEdit.insert(this.start, this.text);

      case EditAction.Delete:
        return vscode_1.TextEdit.delete(new vscode_1.Range(this.start, this.end));

      case EditAction.Replace:
        return vscode_1.TextEdit.replace(new vscode_1.Range(this.start, this.end), this.text);

      default:
        return new vscode_1.TextEdit(new vscode_1.Range(new vscode_1.Position(0, 0), new vscode_1.Position(0, 0)), '');
    }
  }

}

function getTextEditsFromPatch(before, patch) {
  if (patch.startsWith('---')) {
    // Strip the first two lines
    patch = patch.substring(patch.indexOf('@@'));
  }

  if (patch.length === 0) {
    return [];
  } // Remove the text added by unified_diff
  // # Work around missing newline (http://bugs.python.org/issue2142).


  patch = patch.replace(/\\ No newline at end of file[\r\n]/, '');
  const d = new dmp.diff_match_patch();
  const patches = patch_fromText.call(d, patch);

  if (!Array.isArray(patches) || patches.length === 0) {
    throw new Error('Unable to parse Patch string');
  }

  const textEdits = []; // Add line feeds and build the text edits

  patches.forEach(p => {
    p.diffs.forEach(diff => {
      diff[1] += os_1.EOL;
    });
    getTextEditsInternal(before, p.diffs, p.start1).forEach(edit => textEdits.push(edit.apply()));
  });
  return textEdits;
}

exports.getTextEditsFromPatch = getTextEditsFromPatch;

function getWorkspaceEditsFromPatch(filePatches, workspaceRoot) {
  const workspaceEdit = new vscode_1.WorkspaceEdit();
  filePatches.forEach(patch => {
    const indexOfAtAt = patch.indexOf('@@');

    if (indexOfAtAt === -1) {
      return;
    }

    const fileNameLines = patch.substring(0, indexOfAtAt).split(/\r?\n/g).map(line => line.trim()).filter(line => line.length > 0 && line.toLowerCase().endsWith('.py') && line.indexOf(' a') > 0);

    if (patch.startsWith('---')) {
      // Strip the first two lines
      patch = patch.substring(indexOfAtAt);
    }

    if (patch.length === 0) {
      return;
    } // We can't find the find name


    if (fileNameLines.length === 0) {
      return;
    }

    let fileName = fileNameLines[0].substring(fileNameLines[0].indexOf(' a') + 3).trim();
    fileName = workspaceRoot && !path.isAbsolute(fileName) ? path.resolve(workspaceRoot, fileName) : fileName;

    if (!fs.existsSync(fileName)) {
      return;
    } // Remove the text added by unified_diff
    // # Work around missing newline (http://bugs.python.org/issue2142).


    patch = patch.replace(/\\ No newline at end of file[\r\n]/, '');
    const d = new dmp.diff_match_patch();
    const patches = patch_fromText.call(d, patch);

    if (!Array.isArray(patches) || patches.length === 0) {
      throw new Error('Unable to parse Patch string');
    }

    const fileSource = fs.readFileSync(fileName).toString('utf8');
    const fileUri = vscode_1.Uri.file(fileName); // Add line feeds and build the text edits

    patches.forEach(p => {
      p.diffs.forEach(diff => {
        diff[1] += os_1.EOL;
      });
      getTextEditsInternal(fileSource, p.diffs, p.start1).forEach(edit => {
        switch (edit.action) {
          case EditAction.Delete:
            workspaceEdit.delete(fileUri, new vscode_1.Range(edit.start, edit.end));
            break;

          case EditAction.Insert:
            workspaceEdit.insert(fileUri, edit.start, edit.text);
            break;

          case EditAction.Replace:
            workspaceEdit.replace(fileUri, new vscode_1.Range(edit.start, edit.end), edit.text);
            break;

          default:
            break;
        }
      });
    });
  });
  return workspaceEdit;
}

exports.getWorkspaceEditsFromPatch = getWorkspaceEditsFromPatch;

function getTextEdits(before, after) {
  const d = new dmp.diff_match_patch();
  const diffs = d.diff_main(before, after);
  return getTextEditsInternal(before, diffs).map(edit => edit.apply());
}

exports.getTextEdits = getTextEdits;

function getTextEditsInternal(before, diffs, startLine = 0) {
  let line = startLine;
  let character = 0;

  if (line > 0) {
    const beforeLines = before.split(/\r?\n/g);
    beforeLines.filter((l, i) => i < line).forEach(l => character += l.length + NEW_LINE_LENGTH);
  }

  const edits = [];
  let edit = null; // tslint:disable-next-line:prefer-for-of

  for (let i = 0; i < diffs.length; i += 1) {
    const start = new vscode_1.Position(line, character); // Compute the line/character after the diff is applied.
    // tslint:disable-next-line:prefer-for-of

    for (let curr = 0; curr < diffs[i][1].length; curr += 1) {
      if (diffs[i][1][curr] !== '\n') {
        character += 1;
      } else {
        character = 0;
        line += 1;
      }
    } // tslint:disable-next-line:switch-default


    switch (diffs[i][0]) {
      case dmp.DIFF_DELETE:
        if (edit === null) {
          edit = new Edit(EditAction.Delete, start);
        } else if (edit.action !== EditAction.Delete) {
          throw new Error('cannot format due to an internal error.');
        }

        edit.end = new vscode_1.Position(line, character);
        break;

      case dmp.DIFF_INSERT:
        if (edit === null) {
          edit = new Edit(EditAction.Insert, start);
        } else if (edit.action === EditAction.Delete) {
          edit.action = EditAction.Replace;
        } // insert and replace edits are all relative to the original state
        // of the document, so inserts should reset the current line/character
        // position to the start.


        line = start.line;
        character = start.character;
        edit.text += diffs[i][1];
        break;

      case dmp.DIFF_EQUAL:
        if (edit !== null) {
          edits.push(edit);
          edit = null;
        }

        break;
    }
  }

  if (edit !== null) {
    edits.push(edit);
  }

  return edits;
}

function getTempFileWithDocumentContents(document) {
  return new Promise((resolve, reject) => {
    const ext = path.extname(document.uri.fsPath); // Don't create file in temp folder since external utilities
    // look into configuration files in the workspace and are not able
    // to find custom rules if file is saved in a random disk location.
    // This means temp file has to be created in the same folder
    // as the original one and then removed.
    // tslint:disable-next-line:no-require-imports

    const fileName = `${document.uri.fsPath}.${md5(document.uri.fsPath)}${ext}`;
    fs.writeFile(fileName, document.getText(), ex => {
      if (ex) {
        reject(`Failed to create a temporary file, ${ex.message}`);
      }

      resolve(fileName);
    });
  });
}

exports.getTempFileWithDocumentContents = getTempFileWithDocumentContents;
/**
 * Parse a textual representation of patches and return a list of Patch objects.
 * @param {string} textline Text representation of patches.
 * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.
 * @throws {!Error} If invalid input.
 */

function patch_fromText(textline) {
  const patches = [];

  if (!textline) {
    return patches;
  } // Start Modification by Don Jayamanne 24/06/2016 Support for CRLF


  const text = textline.split(/[\r\n]/); // End Modification

  let textPointer = 0;
  const patchHeader = /^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;

  while (textPointer < text.length) {
    const m = text[textPointer].match(patchHeader);

    if (!m) {
      throw new Error(`Invalid patch string: ${text[textPointer]}`);
    } // tslint:disable-next-line:no-any


    const patch = new dmp.diff_match_patch.patch_obj();
    patches.push(patch);
    patch.start1 = parseInt(m[1], 10);

    if (m[2] === '') {
      patch.start1 -= 1;
      patch.length1 = 1;
    } else if (m[2] === '0') {
      patch.length1 = 0;
    } else {
      patch.start1 -= 1;
      patch.length1 = parseInt(m[2], 10);
    }

    patch.start2 = parseInt(m[3], 10);

    if (m[4] === '') {
      patch.start2 -= 1;
      patch.length2 = 1;
    } else if (m[4] === '0') {
      patch.length2 = 0;
    } else {
      patch.start2 -= 1;
      patch.length2 = parseInt(m[4], 10);
    }

    textPointer += 1;

    while (textPointer < text.length) {
      const sign = text[textPointer].charAt(0);
      let line;

      try {
        //var line = decodeURI(text[textPointer].substring(1));
        // For some reason the patch generated by python files don't encode any characters
        // And this patch module (code from Google) is expecting the text to be encoded!!
        // Temporary solution, disable decoding
        // Issue #188
        line = text[textPointer].substring(1);
      } catch (ex) {
        // Malformed URI sequence.
        throw new Error('Illegal escape in patch_fromText');
      }

      if (sign === '-') {
        // Deletion.
        patch.diffs.push([dmp.DIFF_DELETE, line]);
      } else if (sign === '+') {
        // Insertion.
        patch.diffs.push([dmp.DIFF_INSERT, line]);
      } else if (sign === ' ') {
        // Minor equality.
        patch.diffs.push([dmp.DIFF_EQUAL, line]);
      } else if (sign === '@') {
        // Start of next patch.
        break;
      } else if (sign === '') {// Blank line?  Whatever.
      } else {
        // WTF?
        throw new Error(`Invalid patch mode '${sign}' in: ${line}`);
      }

      textPointer += 1;
    }
  }

  return patches;
}

let EditorUtils = class EditorUtils {
  getWorkspaceEditsFromPatch(originalContents, patch, uri) {
    const workspaceEdit = new vscode_1.WorkspaceEdit();

    if (patch.startsWith('---')) {
      // Strip the first two lines
      patch = patch.substring(patch.indexOf('@@'));
    }

    if (patch.length === 0) {
      return workspaceEdit;
    } // Remove the text added by unified_diff
    // # Work around missing newline (http://bugs.python.org/issue2142).


    patch = patch.replace(/\\ No newline at end of file[\r\n]/, '');
    const d = new dmp.diff_match_patch();
    const patches = patch_fromText.call(d, patch);

    if (!Array.isArray(patches) || patches.length === 0) {
      throw new Error('Unable to parse Patch string');
    } // Add line feeds and build the text edits


    patches.forEach(p => {
      p.diffs.forEach(diff => {
        diff[1] += os_1.EOL;
      });
      getTextEditsInternal(originalContents, p.diffs, p.start1).forEach(edit => {
        switch (edit.action) {
          case EditAction.Delete:
            workspaceEdit.delete(uri, new vscode_1.Range(edit.start, edit.end));
            break;

          case EditAction.Insert:
            workspaceEdit.insert(uri, edit.start, edit.text);
            break;

          case EditAction.Replace:
            workspaceEdit.replace(uri, new vscode_1.Range(edit.start, edit.end), edit.text);
            break;

          default:
            break;
        }
      });
    });
    return workspaceEdit;
  }

};
EditorUtils = __decorate([inversify_1.injectable()], EditorUtils);
exports.EditorUtils = EditorUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVkaXRvci5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkbXAiLCJyZXF1aXJlIiwiZnMiLCJpbnZlcnNpZnlfMSIsIm1kNSIsIm9zXzEiLCJwYXRoIiwidnNjb2RlXzEiLCJFZGl0QWN0aW9uIiwiTkVXX0xJTkVfTEVOR1RIIiwiRU9MIiwiUGF0Y2giLCJFZGl0IiwiY29uc3RydWN0b3IiLCJhY3Rpb24iLCJzdGFydCIsInRleHQiLCJhcHBseSIsIkluc2VydCIsIlRleHRFZGl0IiwiaW5zZXJ0IiwiRGVsZXRlIiwiZGVsZXRlIiwiUmFuZ2UiLCJlbmQiLCJSZXBsYWNlIiwicmVwbGFjZSIsIlBvc2l0aW9uIiwiZ2V0VGV4dEVkaXRzRnJvbVBhdGNoIiwiYmVmb3JlIiwicGF0Y2giLCJzdGFydHNXaXRoIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImRpZmZfbWF0Y2hfcGF0Y2giLCJwYXRjaGVzIiwicGF0Y2hfZnJvbVRleHQiLCJjYWxsIiwiQXJyYXkiLCJpc0FycmF5IiwiRXJyb3IiLCJ0ZXh0RWRpdHMiLCJmb3JFYWNoIiwicCIsImRpZmZzIiwiZGlmZiIsImdldFRleHRFZGl0c0ludGVybmFsIiwic3RhcnQxIiwiZWRpdCIsInB1c2giLCJnZXRXb3Jrc3BhY2VFZGl0c0Zyb21QYXRjaCIsImZpbGVQYXRjaGVzIiwid29ya3NwYWNlUm9vdCIsIndvcmtzcGFjZUVkaXQiLCJXb3Jrc3BhY2VFZGl0IiwiaW5kZXhPZkF0QXQiLCJmaWxlTmFtZUxpbmVzIiwic3BsaXQiLCJtYXAiLCJsaW5lIiwidHJpbSIsImZpbHRlciIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJmaWxlTmFtZSIsImlzQWJzb2x1dGUiLCJyZXNvbHZlIiwiZXhpc3RzU3luYyIsImZpbGVTb3VyY2UiLCJyZWFkRmlsZVN5bmMiLCJ0b1N0cmluZyIsImZpbGVVcmkiLCJVcmkiLCJmaWxlIiwiZ2V0VGV4dEVkaXRzIiwiYWZ0ZXIiLCJkaWZmX21haW4iLCJzdGFydExpbmUiLCJjaGFyYWN0ZXIiLCJiZWZvcmVMaW5lcyIsImwiLCJlZGl0cyIsImN1cnIiLCJESUZGX0RFTEVURSIsIkRJRkZfSU5TRVJUIiwiRElGRl9FUVVBTCIsImdldFRlbXBGaWxlV2l0aERvY3VtZW50Q29udGVudHMiLCJkb2N1bWVudCIsIlByb21pc2UiLCJyZWplY3QiLCJleHQiLCJleHRuYW1lIiwidXJpIiwiZnNQYXRoIiwid3JpdGVGaWxlIiwiZ2V0VGV4dCIsImV4IiwibWVzc2FnZSIsInRleHRsaW5lIiwidGV4dFBvaW50ZXIiLCJwYXRjaEhlYWRlciIsIm0iLCJtYXRjaCIsInBhdGNoX29iaiIsInBhcnNlSW50IiwibGVuZ3RoMSIsInN0YXJ0MiIsImxlbmd0aDIiLCJzaWduIiwiY2hhckF0IiwiRWRpdG9yVXRpbHMiLCJvcmlnaW5hbENvbnRlbnRzIiwiaW5qZWN0YWJsZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsVUFBVSxHQUFJLFVBQVEsU0FBS0EsVUFBZCxJQUE2QixVQUFVQyxVQUFWLEVBQXNCQyxNQUF0QixFQUE4QkMsR0FBOUIsRUFBbUNDLElBQW5DLEVBQXlDO0FBQ25GLE1BQUlDLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUFsQjtBQUFBLE1BQTBCQyxDQUFDLEdBQUdILENBQUMsR0FBRyxDQUFKLEdBQVFILE1BQVIsR0FBaUJFLElBQUksS0FBSyxJQUFULEdBQWdCQSxJQUFJLEdBQUdLLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NSLE1BQWhDLEVBQXdDQyxHQUF4QyxDQUF2QixHQUFzRUMsSUFBckg7QUFBQSxNQUEySE8sQ0FBM0g7QUFDQSxNQUFJLE9BQU9DLE9BQVAsS0FBbUIsUUFB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QUFxQnNFLEdBQXJCLEVBQTBCLElBQUlyRixRQUFRLENBQUNnQixLQUFiLENBQW1CeUIsSUFBSSxDQUFDakMsS0FBeEIsRUFBK0JpQyxJQUFJLENBQUN4QixHQUFwQyxDQUExQjtBQUNBOztBQUNKLGVBQUtoQixVQUFVLENBQUNVLE1BQWhCO0FBQ0ltQyxZQUFBQSxhQUFhLENBQUNqQyxNQUFkLENBQXFCd0UsR0FBckIsRUFBMEI1QyxJQUFJLENBQUNqQyxLQUEvQixFQUFzQ2lDLElBQUksQ0FBQ2hDLElBQTNDO0FBQ0E7O0FBQ0osZUFBS1IsVUFBVSxDQUFDaUIsT0FBaEI7QUFDSTRCLFlBQUFBLGFBQWEsQ0FBQzNCLE9BQWQsQ0FBc0JrRSxHQUF0QixFQUEyQixJQUFJckYsUUFBUSxDQUFDZ0IsS0FBYixDQUFtQnlCLElBQUksQ0FBQ2pDLEtBQXhCLEVBQStCaUMsSUFBSSxDQUFDeEIsR0FBcEMsQ0FBM0IsRUFBcUV3QixJQUFJLENBQUNoQyxJQUExRTtBQUNBOztBQUNKO0FBQ0k7QUFYUjtBQWFILE9BZEQ7QUFlSCxLQW5CRDtBQW9CQSxXQUFPcUMsYUFBUDtBQUNIOztBQXhDK0IsQ0FBcEM7QUEwQ0F5RCxXQUFXLEdBQUdoSSxVQUFVLENBQUMsQ0FDckJxQixXQUFXLENBQUM2RyxVQUFaLEVBRHFCLENBQUQsRUFFckJGLFdBRnFCLENBQXhCO0FBR0FoSCxPQUFPLENBQUNnSCxXQUFSLEdBQXNCQSxXQUF0QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGRtcCA9IHJlcXVpcmUoXCJkaWZmLW1hdGNoLXBhdGNoXCIpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmcy1leHRyYVwiKTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCBtZDUgPSByZXF1aXJlKFwibWQ1XCIpO1xyXG5jb25zdCBvc18xID0gcmVxdWlyZShcIm9zXCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuLy8gQ29kZSBib3Jyb3dlZCBmcm9tIGdvRm9ybWF0LnRzIChHbyBFeHRlbnNpb24gZm9yIFZTIENvZGUpXHJcbnZhciBFZGl0QWN0aW9uO1xyXG4oZnVuY3Rpb24gKEVkaXRBY3Rpb24pIHtcclxuICAgIEVkaXRBY3Rpb25bRWRpdEFjdGlvbltcIkRlbGV0ZVwiXSA9IDBdID0gXCJEZWxldGVcIjtcclxuICAgIEVkaXRBY3Rpb25bRWRpdEFjdGlvbltcIkluc2VydFwiXSA9IDFdID0gXCJJbnNlcnRcIjtcclxuICAgIEVkaXRBY3Rpb25bRWRpdEFjdGlvbltcIlJlcGxhY2VcIl0gPSAyXSA9IFwiUmVwbGFjZVwiO1xyXG59KShFZGl0QWN0aW9uIHx8IChFZGl0QWN0aW9uID0ge30pKTtcclxuY29uc3QgTkVXX0xJTkVfTEVOR1RIID0gb3NfMS5FT0wubGVuZ3RoO1xyXG5jbGFzcyBQYXRjaCB7XHJcbn1cclxuY2xhc3MgRWRpdCB7XHJcbiAgICBjb25zdHJ1Y3RvcihhY3Rpb24sIHN0YXJ0KSB7XHJcbiAgICAgICAgdGhpcy5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xyXG4gICAgICAgIHRoaXMudGV4dCA9ICcnO1xyXG4gICAgfVxyXG4gICAgYXBwbHkoKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGlvbikge1xyXG4gICAgICAgICAgICBjYXNlIEVkaXRBY3Rpb24uSW5zZXJ0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZzY29kZV8xLlRleHRFZGl0Lmluc2VydCh0aGlzLnN0YXJ0LCB0aGlzLnRleHQpO1xyXG4gICAgICAgICAgICBjYXNlIEVkaXRBY3Rpb24uRGVsZXRlOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZzY29kZV8xLlRleHRFZGl0LmRlbGV0ZShuZXcgdnNjb2RlXzEuUmFuZ2UodGhpcy5zdGFydCwgdGhpcy5lbmQpKTtcclxuICAgICAgICAgICAgY2FzZSBFZGl0QWN0aW9uLlJlcGxhY2U6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdnNjb2RlXzEuVGV4dEVkaXQucmVwbGFjZShuZXcgdnNjb2RlXzEuUmFuZ2UodGhpcy5zdGFydCwgdGhpcy5lbmQpLCB0aGlzLnRleHQpO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyB2c2NvZGVfMS5UZXh0RWRpdChuZXcgdnNjb2RlXzEuUmFuZ2UobmV3IHZzY29kZV8xLlBvc2l0aW9uKDAsIDApLCBuZXcgdnNjb2RlXzEuUG9zaXRpb24oMCwgMCkpLCAnJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGdldFRleHRFZGl0c0Zyb21QYXRjaChiZWZvcmUsIHBhdGNoKSB7XHJcbiAgICBpZiAocGF0Y2guc3RhcnRzV2l0aCgnLS0tJykpIHtcclxuICAgICAgICAvLyBTdHJpcCB0aGUgZmlyc3QgdHdvIGxpbmVzXHJcbiAgICAgICAgcGF0Y2ggPSBwYXRjaC5zdWJzdHJpbmcocGF0Y2guaW5kZXhPZignQEAnKSk7XHJcbiAgICB9XHJcbiAgICBpZiAocGF0Y2gubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgLy8gUmVtb3ZlIHRoZSB0ZXh0IGFkZGVkIGJ5IHVuaWZpZWRfZGlmZlxyXG4gICAgLy8gIyBXb3JrIGFyb3VuZCBtaXNzaW5nIG5ld2xpbmUgKGh0dHA6Ly9idWdzLnB5dGhvbi5vcmcvaXNzdWUyMTQyKS5cclxuICAgIHBhdGNoID0gcGF0Y2gucmVwbGFjZSgvXFxcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlW1xcclxcbl0vLCAnJyk7XHJcbiAgICBjb25zdCBkID0gbmV3IGRtcC5kaWZmX21hdGNoX3BhdGNoKCk7XHJcbiAgICBjb25zdCBwYXRjaGVzID0gcGF0Y2hfZnJvbVRleHQuY2FsbChkLCBwYXRjaCk7XHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0Y2hlcykgfHwgcGF0Y2hlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBwYXJzZSBQYXRjaCBzdHJpbmcnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHRleHRFZGl0cyA9IFtdO1xyXG4gICAgLy8gQWRkIGxpbmUgZmVlZHMgYW5kIGJ1aWxkIHRoZSB0ZXh0IGVkaXRzXHJcbiAgICBwYXRjaGVzLmZvckVhY2gocCA9PiB7XHJcbiAgICAgICAgcC5kaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xyXG4gICAgICAgICAgICBkaWZmWzFdICs9IG9zXzEuRU9MO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGdldFRleHRFZGl0c0ludGVybmFsKGJlZm9yZSwgcC5kaWZmcywgcC5zdGFydDEpLmZvckVhY2goZWRpdCA9PiB0ZXh0RWRpdHMucHVzaChlZGl0LmFwcGx5KCkpKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRleHRFZGl0cztcclxufVxyXG5leHBvcnRzLmdldFRleHRFZGl0c0Zyb21QYXRjaCA9IGdldFRleHRFZGl0c0Zyb21QYXRjaDtcclxuZnVuY3Rpb24gZ2V0V29ya3NwYWNlRWRpdHNGcm9tUGF0Y2goZmlsZVBhdGNoZXMsIHdvcmtzcGFjZVJvb3QpIHtcclxuICAgIGNvbnN0IHdvcmtzcGFjZUVkaXQgPSBuZXcgdnNjb2RlXzEuV29ya3NwYWNlRWRpdCgpO1xyXG4gICAgZmlsZVBhdGNoZXMuZm9yRWFjaChwYXRjaCA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5kZXhPZkF0QXQgPSBwYXRjaC5pbmRleE9mKCdAQCcpO1xyXG4gICAgICAgIGlmIChpbmRleE9mQXRBdCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaWxlTmFtZUxpbmVzID0gcGF0Y2guc3Vic3RyaW5nKDAsIGluZGV4T2ZBdEF0KS5zcGxpdCgvXFxyP1xcbi9nKVxyXG4gICAgICAgICAgICAubWFwKGxpbmUgPT4gbGluZS50cmltKCkpXHJcbiAgICAgICAgICAgIC5maWx0ZXIobGluZSA9PiBsaW5lLmxlbmd0aCA+IDAgJiZcclxuICAgICAgICAgICAgbGluZS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKCcucHknKSAmJlxyXG4gICAgICAgICAgICBsaW5lLmluZGV4T2YoJyBhJykgPiAwKTtcclxuICAgICAgICBpZiAocGF0Y2guc3RhcnRzV2l0aCgnLS0tJykpIHtcclxuICAgICAgICAgICAgLy8gU3RyaXAgdGhlIGZpcnN0IHR3byBsaW5lc1xyXG4gICAgICAgICAgICBwYXRjaCA9IHBhdGNoLnN1YnN0cmluZyhpbmRleE9mQXRBdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXRjaC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBXZSBjYW4ndCBmaW5kIHRoZSBmaW5kIG5hbWVcclxuICAgICAgICBpZiAoZmlsZU5hbWVMaW5lcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZmlsZU5hbWUgPSBmaWxlTmFtZUxpbmVzWzBdLnN1YnN0cmluZyhmaWxlTmFtZUxpbmVzWzBdLmluZGV4T2YoJyBhJykgKyAzKS50cmltKCk7XHJcbiAgICAgICAgZmlsZU5hbWUgPSB3b3Jrc3BhY2VSb290ICYmICFwYXRoLmlzQWJzb2x1dGUoZmlsZU5hbWUpID8gcGF0aC5yZXNvbHZlKHdvcmtzcGFjZVJvb3QsIGZpbGVOYW1lKSA6IGZpbGVOYW1lO1xyXG4gICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlTmFtZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBSZW1vdmUgdGhlIHRleHQgYWRkZWQgYnkgdW5pZmllZF9kaWZmXHJcbiAgICAgICAgLy8gIyBXb3JrIGFyb3VuZCBtaXNzaW5nIG5ld2xpbmUgKGh0dHA6Ly9idWdzLnB5dGhvbi5vcmcvaXNzdWUyMTQyKS5cclxuICAgICAgICBwYXRjaCA9IHBhdGNoLnJlcGxhY2UoL1xcXFwgTm8gbmV3bGluZSBhdCBlbmQgb2YgZmlsZVtcXHJcXG5dLywgJycpO1xyXG4gICAgICAgIGNvbnN0IGQgPSBuZXcgZG1wLmRpZmZfbWF0Y2hfcGF0Y2goKTtcclxuICAgICAgICBjb25zdCBwYXRjaGVzID0gcGF0Y2hfZnJvbVRleHQuY2FsbChkLCBwYXRjaCk7XHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGNoZXMpIHx8IHBhdGNoZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIHBhcnNlIFBhdGNoIHN0cmluZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBmaWxlU291cmNlID0gZnMucmVhZEZpbGVTeW5jKGZpbGVOYW1lKS50b1N0cmluZygndXRmOCcpO1xyXG4gICAgICAgIGNvbnN0IGZpbGVVcmkgPSB2c2NvZGVfMS5VcmkuZmlsZShmaWxlTmFtZSk7XHJcbiAgICAgICAgLy8gQWRkIGxpbmUgZmVlZHMgYW5kIGJ1aWxkIHRoZSB0ZXh0IGVkaXRzXHJcbiAgICAgICAgcGF0Y2hlcy5mb3JFYWNoKHAgPT4ge1xyXG4gICAgICAgICAgICBwLmRpZmZzLmZvckVhY2goZGlmZiA9PiB7XHJcbiAgICAgICAgICAgICAgICBkaWZmWzFdICs9IG9zXzEuRU9MO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZ2V0VGV4dEVkaXRzSW50ZXJuYWwoZmlsZVNvdXJjZSwgcC5kaWZmcywgcC5zdGFydDEpLmZvckVhY2goZWRpdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGVkaXQuYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZGl0QWN0aW9uLkRlbGV0ZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlRWRpdC5kZWxldGUoZmlsZVVyaSwgbmV3IHZzY29kZV8xLlJhbmdlKGVkaXQuc3RhcnQsIGVkaXQuZW5kKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5JbnNlcnQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUVkaXQuaW5zZXJ0KGZpbGVVcmksIGVkaXQuc3RhcnQsIGVkaXQudGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5SZXBsYWNlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VFZGl0LnJlcGxhY2UoZmlsZVVyaSwgbmV3IHZzY29kZV8xLlJhbmdlKGVkaXQuc3RhcnQsIGVkaXQuZW5kKSwgZWRpdC50ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gd29ya3NwYWNlRWRpdDtcclxufVxyXG5leHBvcnRzLmdldFdvcmtzcGFjZUVkaXRzRnJvbVBhdGNoID0gZ2V0V29ya3NwYWNlRWRpdHNGcm9tUGF0Y2g7XHJcbmZ1bmN0aW9uIGdldFRleHRFZGl0cyhiZWZvcmUsIGFmdGVyKSB7XHJcbiAgICBjb25zdCBkID0gbmV3IGRtcC5kaWZmX21hdGNoX3BhdGNoKCk7XHJcbiAgICBjb25zdCBkaWZmcyA9IGQuZGlmZl9tYWluKGJlZm9yZSwgYWZ0ZXIpO1xyXG4gICAgcmV0dXJuIGdldFRleHRFZGl0c0ludGVybmFsKGJlZm9yZSwgZGlmZnMpLm1hcChlZGl0ID0+IGVkaXQuYXBwbHkoKSk7XHJcbn1cclxuZXhwb3J0cy5nZXRUZXh0RWRpdHMgPSBnZXRUZXh0RWRpdHM7XHJcbmZ1bmN0aW9uIGdldFRleHRFZGl0c0ludGVybmFsKGJlZm9yZSwgZGlmZnMsIHN0YXJ0TGluZSA9IDApIHtcclxuICAgIGxldCBsaW5lID0gc3RhcnRMaW5lO1xyXG4gICAgbGV0IGNoYXJhY3RlciA9IDA7XHJcbiAgICBpZiAobGluZSA+IDApIHtcclxuICAgICAgICBjb25zdCBiZWZvcmVMaW5lcyA9IGJlZm9yZS5zcGxpdCgvXFxyP1xcbi9nKTtcclxuICAgICAgICBiZWZvcmVMaW5lcy5maWx0ZXIoKGwsIGkpID0+IGkgPCBsaW5lKS5mb3JFYWNoKGwgPT4gY2hhcmFjdGVyICs9IGwubGVuZ3RoICsgTkVXX0xJTkVfTEVOR1RIKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGVkaXRzID0gW107XHJcbiAgICBsZXQgZWRpdCA9IG51bGw7XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWZvci1vZlxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaWZmcy5sZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IHZzY29kZV8xLlBvc2l0aW9uKGxpbmUsIGNoYXJhY3Rlcik7XHJcbiAgICAgICAgLy8gQ29tcHV0ZSB0aGUgbGluZS9jaGFyYWN0ZXIgYWZ0ZXIgdGhlIGRpZmYgaXMgYXBwbGllZC5cclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWZvci1vZlxyXG4gICAgICAgIGZvciAobGV0IGN1cnIgPSAwOyBjdXJyIDwgZGlmZnNbaV1bMV0ubGVuZ3RoOyBjdXJyICs9IDEpIHtcclxuICAgICAgICAgICAgaWYgKGRpZmZzW2ldWzFdW2N1cnJdICE9PSAnXFxuJykge1xyXG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgbGluZSArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpzd2l0Y2gtZGVmYXVsdFxyXG4gICAgICAgIHN3aXRjaCAoZGlmZnNbaV1bMF0pIHtcclxuICAgICAgICAgICAgY2FzZSBkbXAuRElGRl9ERUxFVEU6XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXQgPSBuZXcgRWRpdChFZGl0QWN0aW9uLkRlbGV0ZSwgc3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZWRpdC5hY3Rpb24gIT09IEVkaXRBY3Rpb24uRGVsZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW5ub3QgZm9ybWF0IGR1ZSB0byBhbiBpbnRlcm5hbCBlcnJvci4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVkaXQuZW5kID0gbmV3IHZzY29kZV8xLlBvc2l0aW9uKGxpbmUsIGNoYXJhY3Rlcik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBkbXAuRElGRl9JTlNFUlQ6XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXQgPSBuZXcgRWRpdChFZGl0QWN0aW9uLkluc2VydCwgc3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZWRpdC5hY3Rpb24gPT09IEVkaXRBY3Rpb24uRGVsZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdC5hY3Rpb24gPSBFZGl0QWN0aW9uLlJlcGxhY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBpbnNlcnQgYW5kIHJlcGxhY2UgZWRpdHMgYXJlIGFsbCByZWxhdGl2ZSB0byB0aGUgb3JpZ2luYWwgc3RhdGVcclxuICAgICAgICAgICAgICAgIC8vIG9mIHRoZSBkb2N1bWVudCwgc28gaW5zZXJ0cyBzaG91bGQgcmVzZXQgdGhlIGN1cnJlbnQgbGluZS9jaGFyYWN0ZXJcclxuICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9uIHRvIHRoZSBzdGFydC5cclxuICAgICAgICAgICAgICAgIGxpbmUgPSBzdGFydC5saW5lO1xyXG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyID0gc3RhcnQuY2hhcmFjdGVyO1xyXG4gICAgICAgICAgICAgICAgZWRpdC50ZXh0ICs9IGRpZmZzW2ldWzFdO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgZG1wLkRJRkZfRVFVQUw6XHJcbiAgICAgICAgICAgICAgICBpZiAoZWRpdCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRzLnB1c2goZWRpdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoZWRpdCAhPT0gbnVsbCkge1xyXG4gICAgICAgIGVkaXRzLnB1c2goZWRpdCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZWRpdHM7XHJcbn1cclxuZnVuY3Rpb24gZ2V0VGVtcEZpbGVXaXRoRG9jdW1lbnRDb250ZW50cyhkb2N1bWVudCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBjb25zdCBleHQgPSBwYXRoLmV4dG5hbWUoZG9jdW1lbnQudXJpLmZzUGF0aCk7XHJcbiAgICAgICAgLy8gRG9uJ3QgY3JlYXRlIGZpbGUgaW4gdGVtcCBmb2xkZXIgc2luY2UgZXh0ZXJuYWwgdXRpbGl0aWVzXHJcbiAgICAgICAgLy8gbG9vayBpbnRvIGNvbmZpZ3VyYXRpb24gZmlsZXMgaW4gdGhlIHdvcmtzcGFjZSBhbmQgYXJlIG5vdCBhYmxlXHJcbiAgICAgICAgLy8gdG8gZmluZCBjdXN0b20gcnVsZXMgaWYgZmlsZSBpcyBzYXZlZCBpbiBhIHJhbmRvbSBkaXNrIGxvY2F0aW9uLlxyXG4gICAgICAgIC8vIFRoaXMgbWVhbnMgdGVtcCBmaWxlIGhhcyB0byBiZSBjcmVhdGVkIGluIHRoZSBzYW1lIGZvbGRlclxyXG4gICAgICAgIC8vIGFzIHRoZSBvcmlnaW5hbCBvbmUgYW5kIHRoZW4gcmVtb3ZlZC5cclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tcmVxdWlyZS1pbXBvcnRzXHJcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBgJHtkb2N1bWVudC51cmkuZnNQYXRofS4ke21kNShkb2N1bWVudC51cmkuZnNQYXRoKX0ke2V4dH1gO1xyXG4gICAgICAgIGZzLndyaXRlRmlsZShmaWxlTmFtZSwgZG9jdW1lbnQuZ2V0VGV4dCgpLCBleCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChleCkge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGBGYWlsZWQgdG8gY3JlYXRlIGEgdGVtcG9yYXJ5IGZpbGUsICR7ZXgubWVzc2FnZX1gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvbHZlKGZpbGVOYW1lKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuZ2V0VGVtcEZpbGVXaXRoRG9jdW1lbnRDb250ZW50cyA9IGdldFRlbXBGaWxlV2l0aERvY3VtZW50Q29udGVudHM7XHJcbi8qKlxyXG4gKiBQYXJzZSBhIHRleHR1YWwgcmVwcmVzZW50YXRpb24gb2YgcGF0Y2hlcyBhbmQgcmV0dXJuIGEgbGlzdCBvZiBQYXRjaCBvYmplY3RzLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dGxpbmUgVGV4dCByZXByZXNlbnRhdGlvbiBvZiBwYXRjaGVzLlxyXG4gKiBAcmV0dXJuIHshQXJyYXkuPCFkaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaj59IEFycmF5IG9mIFBhdGNoIG9iamVjdHMuXHJcbiAqIEB0aHJvd3MgeyFFcnJvcn0gSWYgaW52YWxpZCBpbnB1dC5cclxuICovXHJcbmZ1bmN0aW9uIHBhdGNoX2Zyb21UZXh0KHRleHRsaW5lKSB7XHJcbiAgICBjb25zdCBwYXRjaGVzID0gW107XHJcbiAgICBpZiAoIXRleHRsaW5lKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhdGNoZXM7XHJcbiAgICB9XHJcbiAgICAvLyBTdGFydCBNb2RpZmljYXRpb24gYnkgRG9uIEpheWFtYW5uZSAyNC8wNi8yMDE2IFN1cHBvcnQgZm9yIENSTEZcclxuICAgIGNvbnN0IHRleHQgPSB0ZXh0bGluZS5zcGxpdCgvW1xcclxcbl0vKTtcclxuICAgIC8vIEVuZCBNb2RpZmljYXRpb25cclxuICAgIGxldCB0ZXh0UG9pbnRlciA9IDA7XHJcbiAgICBjb25zdCBwYXRjaEhlYWRlciA9IC9eQEAgLShcXGQrKSw/KFxcZCopIFxcKyhcXGQrKSw/KFxcZCopIEBAJC87XHJcbiAgICB3aGlsZSAodGV4dFBvaW50ZXIgPCB0ZXh0Lmxlbmd0aCkge1xyXG4gICAgICAgIGNvbnN0IG0gPSB0ZXh0W3RleHRQb2ludGVyXS5tYXRjaChwYXRjaEhlYWRlcik7XHJcbiAgICAgICAgaWYgKCFtKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBwYXRjaCBzdHJpbmc6ICR7dGV4dFt0ZXh0UG9pbnRlcl19YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgICAgICBjb25zdCBwYXRjaCA9IG5ldyBkbXAuZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmooKTtcclxuICAgICAgICBwYXRjaGVzLnB1c2gocGF0Y2gpO1xyXG4gICAgICAgIHBhdGNoLnN0YXJ0MSA9IHBhcnNlSW50KG1bMV0sIDEwKTtcclxuICAgICAgICBpZiAobVsyXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgcGF0Y2guc3RhcnQxIC09IDE7XHJcbiAgICAgICAgICAgIHBhdGNoLmxlbmd0aDEgPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChtWzJdID09PSAnMCcpIHtcclxuICAgICAgICAgICAgcGF0Y2gubGVuZ3RoMSA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwYXRjaC5zdGFydDEgLT0gMTtcclxuICAgICAgICAgICAgcGF0Y2gubGVuZ3RoMSA9IHBhcnNlSW50KG1bMl0sIDEwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcGF0Y2guc3RhcnQyID0gcGFyc2VJbnQobVszXSwgMTApO1xyXG4gICAgICAgIGlmIChtWzRdID09PSAnJykge1xyXG4gICAgICAgICAgICBwYXRjaC5zdGFydDIgLT0gMTtcclxuICAgICAgICAgICAgcGF0Y2gubGVuZ3RoMiA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG1bNF0gPT09ICcwJykge1xyXG4gICAgICAgICAgICBwYXRjaC5sZW5ndGgyID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHBhdGNoLnN0YXJ0MiAtPSAxO1xyXG4gICAgICAgICAgICBwYXRjaC5sZW5ndGgyID0gcGFyc2VJbnQobVs0XSwgMTApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0ZXh0UG9pbnRlciArPSAxO1xyXG4gICAgICAgIHdoaWxlICh0ZXh0UG9pbnRlciA8IHRleHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNpZ24gPSB0ZXh0W3RleHRQb2ludGVyXS5jaGFyQXQoMCk7XHJcbiAgICAgICAgICAgIGxldCBsaW5lO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgLy92YXIgbGluZSA9IGRlY29kZVVSSSh0ZXh0W3RleHRQb2ludGVyXS5zdWJzdHJpbmcoMSkpO1xyXG4gICAgICAgICAgICAgICAgLy8gRm9yIHNvbWUgcmVhc29uIHRoZSBwYXRjaCBnZW5lcmF0ZWQgYnkgcHl0aG9uIGZpbGVzIGRvbid0IGVuY29kZSBhbnkgY2hhcmFjdGVyc1xyXG4gICAgICAgICAgICAgICAgLy8gQW5kIHRoaXMgcGF0Y2ggbW9kdWxlIChjb2RlIGZyb20gR29vZ2xlKSBpcyBleHBlY3RpbmcgdGhlIHRleHQgdG8gYmUgZW5jb2RlZCEhXHJcbiAgICAgICAgICAgICAgICAvLyBUZW1wb3Jhcnkgc29sdXRpb24sIGRpc2FibGUgZGVjb2RpbmdcclxuICAgICAgICAgICAgICAgIC8vIElzc3VlICMxODhcclxuICAgICAgICAgICAgICAgIGxpbmUgPSB0ZXh0W3RleHRQb2ludGVyXS5zdWJzdHJpbmcoMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBNYWxmb3JtZWQgVVJJIHNlcXVlbmNlLlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbGxlZ2FsIGVzY2FwZSBpbiBwYXRjaF9mcm9tVGV4dCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzaWduID09PSAnLScpIHtcclxuICAgICAgICAgICAgICAgIC8vIERlbGV0aW9uLlxyXG4gICAgICAgICAgICAgICAgcGF0Y2guZGlmZnMucHVzaChbZG1wLkRJRkZfREVMRVRFLCBsaW5lXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoc2lnbiA9PT0gJysnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJbnNlcnRpb24uXHJcbiAgICAgICAgICAgICAgICBwYXRjaC5kaWZmcy5wdXNoKFtkbXAuRElGRl9JTlNFUlQsIGxpbmVdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzaWduID09PSAnICcpIHtcclxuICAgICAgICAgICAgICAgIC8vIE1pbm9yIGVxdWFsaXR5LlxyXG4gICAgICAgICAgICAgICAgcGF0Y2guZGlmZnMucHVzaChbZG1wLkRJRkZfRVFVQUwsIGxpbmVdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzaWduID09PSAnQCcpIHtcclxuICAgICAgICAgICAgICAgIC8vIFN0YXJ0IG9mIG5leHQgcGF0Y2guXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzaWduID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgLy8gQmxhbmsgbGluZT8gIFdoYXRldmVyLlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gV1RGP1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhdGNoIG1vZGUgJyR7c2lnbn0nIGluOiAke2xpbmV9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGV4dFBvaW50ZXIgKz0gMTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGF0Y2hlcztcclxufVxyXG5sZXQgRWRpdG9yVXRpbHMgPSBjbGFzcyBFZGl0b3JVdGlscyB7XHJcbiAgICBnZXRXb3Jrc3BhY2VFZGl0c0Zyb21QYXRjaChvcmlnaW5hbENvbnRlbnRzLCBwYXRjaCwgdXJpKSB7XHJcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlRWRpdCA9IG5ldyB2c2NvZGVfMS5Xb3Jrc3BhY2VFZGl0KCk7XHJcbiAgICAgICAgaWYgKHBhdGNoLnN0YXJ0c1dpdGgoJy0tLScpKSB7XHJcbiAgICAgICAgICAgIC8vIFN0cmlwIHRoZSBmaXJzdCB0d28gbGluZXNcclxuICAgICAgICAgICAgcGF0Y2ggPSBwYXRjaC5zdWJzdHJpbmcocGF0Y2guaW5kZXhPZignQEAnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXRjaC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHdvcmtzcGFjZUVkaXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgdGV4dCBhZGRlZCBieSB1bmlmaWVkX2RpZmZcclxuICAgICAgICAvLyAjIFdvcmsgYXJvdW5kIG1pc3NpbmcgbmV3bGluZSAoaHR0cDovL2J1Z3MucHl0aG9uLm9yZy9pc3N1ZTIxNDIpLlxyXG4gICAgICAgIHBhdGNoID0gcGF0Y2gucmVwbGFjZSgvXFxcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlW1xcclxcbl0vLCAnJyk7XHJcbiAgICAgICAgY29uc3QgZCA9IG5ldyBkbXAuZGlmZl9tYXRjaF9wYXRjaCgpO1xyXG4gICAgICAgIGNvbnN0IHBhdGNoZXMgPSBwYXRjaF9mcm9tVGV4dC5jYWxsKGQsIHBhdGNoKTtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0Y2hlcykgfHwgcGF0Y2hlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gcGFyc2UgUGF0Y2ggc3RyaW5nJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEFkZCBsaW5lIGZlZWRzIGFuZCBidWlsZCB0aGUgdGV4dCBlZGl0c1xyXG4gICAgICAgIHBhdGNoZXMuZm9yRWFjaChwID0+IHtcclxuICAgICAgICAgICAgcC5kaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xyXG4gICAgICAgICAgICAgICAgZGlmZlsxXSArPSBvc18xLkVPTDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGdldFRleHRFZGl0c0ludGVybmFsKG9yaWdpbmFsQ29udGVudHMsIHAuZGlmZnMsIHAuc3RhcnQxKS5mb3JFYWNoKGVkaXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChlZGl0LmFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5EZWxldGU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUVkaXQuZGVsZXRlKHVyaSwgbmV3IHZzY29kZV8xLlJhbmdlKGVkaXQuc3RhcnQsIGVkaXQuZW5kKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5JbnNlcnQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUVkaXQuaW5zZXJ0KHVyaSwgZWRpdC5zdGFydCwgZWRpdC50ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZGl0QWN0aW9uLlJlcGxhY2U6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUVkaXQucmVwbGFjZSh1cmksIG5ldyB2c2NvZGVfMS5SYW5nZShlZGl0LnN0YXJ0LCBlZGl0LmVuZCksIGVkaXQudGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gd29ya3NwYWNlRWRpdDtcclxuICAgIH1cclxufTtcclxuRWRpdG9yVXRpbHMgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKVxyXG5dLCBFZGl0b3JVdGlscyk7XHJcbmV4cG9ydHMuRWRpdG9yVXRpbHMgPSBFZGl0b3JVdGlscztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZWRpdG9yLmpzLm1hcCJdfQ==