"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const path = require("path");

const types_1 = require("../../../ioc/types");

require("../../extensions");

const types_2 = require("../types");

const baseActivationProvider_1 = require("./baseActivationProvider");

let CommandPromptAndPowerShell = class CommandPromptAndPowerShell extends baseActivationProvider_1.BaseActivationCommandProvider {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  isShellSupported(targetShell) {
    return targetShell === types_2.TerminalShellType.commandPrompt || targetShell === types_2.TerminalShellType.powershell || targetShell === types_2.TerminalShellType.powershellCore;
  }

  getActivationCommandsForInterpreter(pythonPath, targetShell) {
    return __awaiter(this, void 0, void 0, function* () {
      // Dependending on the target shell, look for the preferred script file.
      const scriptFile = yield this.findScriptFile(pythonPath, this.getScriptsInOrderOfPreference(targetShell));

      if (!scriptFile) {
        return;
      }

      if (targetShell === types_2.TerminalShellType.commandPrompt && scriptFile.endsWith('activate.bat')) {
        return [scriptFile.fileToCommandArgument()];
      } else if ((targetShell === types_2.TerminalShellType.powershell || targetShell === types_2.TerminalShellType.powershellCore) && scriptFile.endsWith('activate.ps1')) {
        return [`& ${scriptFile.fileToCommandArgument()}`];
      } else if (targetShell === types_2.TerminalShellType.commandPrompt && scriptFile.endsWith('activate.ps1')) {
        // lets not try to run the powershell file from command prompt (user may not have powershell)
        return [];
      } else {
        return;
      }
    });
  }

  getScriptsInOrderOfPreference(targetShell) {
    const batchFiles = ['activate.bat', path.join('Scripts', 'activate.bat'), path.join('scripts', 'activate.bat')];
    const powerShellFiles = ['activate.ps1', path.join('Scripts', 'activate.ps1'), path.join('scripts', 'activate.ps1')];

    if (targetShell === types_2.TerminalShellType.commandPrompt) {
      return batchFiles.concat(powerShellFiles);
    } else {
      return powerShellFiles.concat(batchFiles);
    }
  }

};
CommandPromptAndPowerShell = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_1.IServiceContainer))], CommandPromptAndPowerShell);
exports.CommandPromptAndPowerShell = CommandPromptAndPowerShell;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1hbmRQcm9tcHQuanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInBhdGgiLCJ0eXBlc18xIiwidHlwZXNfMiIsImJhc2VBY3RpdmF0aW9uUHJvdmlkZXJfMSIsIkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsIiwiQmFzZUFjdGl2YXRpb25Db21tYW5kUHJvdmlkZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJpc1NoZWxsU3VwcG9ydGVkIiwidGFyZ2V0U2hlbGwiLCJUZXJtaW5hbFNoZWxsVHlwZSIsImNvbW1hbmRQcm9tcHQiLCJwb3dlcnNoZWxsIiwicG93ZXJzaGVsbENvcmUiLCJnZXRBY3RpdmF0aW9uQ29tbWFuZHNGb3JJbnRlcnByZXRlciIsInB5dGhvblBhdGgiLCJzY3JpcHRGaWxlIiwiZmluZFNjcmlwdEZpbGUiLCJnZXRTY3JpcHRzSW5PcmRlck9mUHJlZmVyZW5jZSIsImVuZHNXaXRoIiwiZmlsZVRvQ29tbWFuZEFyZ3VtZW50IiwiYmF0Y2hGaWxlcyIsImpvaW4iLCJwb3dlclNoZWxsRmlsZXMiLCJjb25jYXQiLCJpbmplY3RhYmxlIiwiaW5q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QUEsNkJBQTZCLENBQUNULFdBQUQsRUFBYztBQUN2QyxVQUFNWSxVQUFVLEdBQUcsQ0FBQyxjQUFELEVBQWlCckIsSUFBSSxDQUFDc0IsSUFBTCxDQUFVLFNBQVYsRUFBcUIsY0FBckIsQ0FBakIsRUFBdUR0QixJQUFJLENBQUNzQixJQUFMLENBQVUsU0FBVixFQUFxQixjQUFyQixDQUF2RCxDQUFuQjtBQUNBLFVBQU1DLGVBQWUsR0FBRyxDQUFDLGNBQUQsRUFBaUJ2QixJQUFJLENBQUNzQixJQUFMLENBQVUsU0FBVixFQUFxQixjQUFyQixDQUFqQixFQUF1RHRCLElBQUksQ0FBQ3NCLElBQUwsQ0FBVSxTQUFWLEVBQXFCLGNBQXJCLENBQXZELENBQXhCOztBQUNBLFFBQUliLFdBQVcsS0FBS1AsT0FBTyxDQUFDUSxpQkFBUixDQUEwQkMsYUFBOUMsRUFBNkQ7QUFDekQsYUFBT1UsVUFBVSxDQUFDRyxNQUFYLENBQWtCRCxlQUFsQixDQUFQO0FBQ0gsS0FGRCxNQUdLO0FBQ0QsYUFBT0EsZUFBZSxDQUFDQyxNQUFoQixDQUF1QkgsVUFBdkIsQ0FBUDtBQUNIO0FBQ0o7O0FBeEM0SCxDQUFqSTtBQTBDQWpCLDBCQUEwQixHQUFHNUMsVUFBVSxDQUFDLENBQ3BDc0MsV0FBVyxDQUFDMkIsVUFBWixFQURvQyxFQUVwQ2pELE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUM0QixNQUFaLENBQW1CekIsT0FBTyxDQUFDMEIsaUJBQTNCLENBQUosQ0FGNkIsQ0FBRCxFQUdwQ3ZCLDBCQUhvQyxDQUF2QztBQUlBUCxPQUFPLENBQUNPLDBCQUFSLEdBQXFDQSwwQkFBckMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59O1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2lvYy90eXBlc1wiKTtcclxucmVxdWlyZShcIi4uLy4uL2V4dGVuc2lvbnNcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vdHlwZXNcIik7XHJcbmNvbnN0IGJhc2VBY3RpdmF0aW9uUHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuL2Jhc2VBY3RpdmF0aW9uUHJvdmlkZXJcIik7XHJcbmxldCBDb21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbCA9IGNsYXNzIENvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsIGV4dGVuZHMgYmFzZUFjdGl2YXRpb25Qcm92aWRlcl8xLkJhc2VBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2VDb250YWluZXIpIHtcclxuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIGlzU2hlbGxTdXBwb3J0ZWQodGFyZ2V0U2hlbGwpIHtcclxuICAgICAgICByZXR1cm4gdGFyZ2V0U2hlbGwgPT09IHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUuY29tbWFuZFByb21wdCB8fFxyXG4gICAgICAgICAgICB0YXJnZXRTaGVsbCA9PT0gdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsIHx8XHJcbiAgICAgICAgICAgIHRhcmdldFNoZWxsID09PSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGxDb3JlO1xyXG4gICAgfVxyXG4gICAgZ2V0QWN0aXZhdGlvbkNvbW1hbmRzRm9ySW50ZXJwcmV0ZXIocHl0aG9uUGF0aCwgdGFyZ2V0U2hlbGwpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAvLyBEZXBlbmRlbmRpbmcgb24gdGhlIHRhcmdldCBzaGVsbCwgbG9vayBmb3IgdGhlIHByZWZlcnJlZCBzY3JpcHQgZmlsZS5cclxuICAgICAgICAgICAgY29uc3Qgc2NyaXB0RmlsZSA9IHlpZWxkIHRoaXMuZmluZFNjcmlwdEZpbGUocHl0aG9uUGF0aCwgdGhpcy5nZXRTY3JpcHRzSW5PcmRlck9mUHJlZmVyZW5jZSh0YXJnZXRTaGVsbCkpO1xyXG4gICAgICAgICAgICBpZiAoIXNjcmlwdEZpbGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGFyZ2V0U2hlbGwgPT09IHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUuY29tbWFuZFByb21wdCAmJiBzY3JpcHRGaWxlLmVuZHNXaXRoKCdhY3RpdmF0ZS5iYXQnKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtzY3JpcHRGaWxlLmZpbGVUb0NvbW1hbmRBcmd1bWVudCgpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICgodGFyZ2V0U2hlbGwgPT09IHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbCB8fCB0YXJnZXRTaGVsbCA9PT0gdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsQ29yZSkgJiYgc2NyaXB0RmlsZS5lbmRzV2l0aCgnYWN0aXZhdGUucHMxJykpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbYCYgJHtzY3JpcHRGaWxlLmZpbGVUb0NvbW1hbmRBcmd1bWVudCgpfWBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRhcmdldFNoZWxsID09PSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmNvbW1hbmRQcm9tcHQgJiYgc2NyaXB0RmlsZS5lbmRzV2l0aCgnYWN0aXZhdGUucHMxJykpIHtcclxuICAgICAgICAgICAgICAgIC8vIGxldHMgbm90IHRyeSB0byBydW4gdGhlIHBvd2Vyc2hlbGwgZmlsZSBmcm9tIGNvbW1hbmQgcHJvbXB0ICh1c2VyIG1heSBub3QgaGF2ZSBwb3dlcnNoZWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRTY3JpcHRzSW5PcmRlck9mUHJlZmVyZW5jZSh0YXJnZXRTaGVsbCkge1xyXG4gICAgICAgIGNvbnN0IGJhdGNoRmlsZXMgPSBbJ2FjdGl2YXRlLmJhdCcsIHBhdGguam9pbignU2NyaXB0cycsICdhY3RpdmF0ZS5iYXQnKSwgcGF0aC5qb2luKCdzY3JpcHRzJywgJ2FjdGl2YXRlLmJhdCcpXTtcclxuICAgICAgICBjb25zdCBwb3dlclNoZWxsRmlsZXMgPSBbJ2FjdGl2YXRlLnBzMScsIHBhdGguam9pbignU2NyaXB0cycsICdhY3RpdmF0ZS5wczEnKSwgcGF0aC5qb2luKCdzY3JpcHRzJywgJ2FjdGl2YXRlLnBzMScpXTtcclxuICAgICAgICBpZiAodGFyZ2V0U2hlbGwgPT09IHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUuY29tbWFuZFByb21wdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYmF0Y2hGaWxlcy5jb25jYXQocG93ZXJTaGVsbEZpbGVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwb3dlclNoZWxsRmlsZXMuY29uY2F0KGJhdGNoRmlsZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzEuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBDb21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbCk7XHJcbmV4cG9ydHMuQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwgPSBDb21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbWFuZFByb21wdC5qcy5tYXAiXX0=