// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const vscode_1 = require("vscode");

const logger_1 = require("../../common/logger");

const types_1 = require("../../common/types");

const async_1 = require("../../common/utils/async");

const misc_1 = require("../../common/utils/misc");

const types_2 = require("../../ioc/types");

const contracts_1 = require("../contracts");

let InterpreterLocatorProgressService = class InterpreterLocatorProgressService {
  constructor(serviceContainer, disposables) {
    this.disposables = disposables;
    this.deferreds = [];
    this.refreshing = new vscode_1.EventEmitter();
    this.refreshed = new vscode_1.EventEmitter();
    this.locators = [];
    this.locators = serviceContainer.getAll(contracts_1.IInterpreterLocatorService);
  }

  get onRefreshing() {
    return this.refreshing.event;
  }

  get onRefreshed() {
    return this.refreshed.event;
  }

  register() {
    this.locators.forEach(locator => {
      locator.onLocating(this.handleProgress, this, this.disposables);
    });
  }

  handleProgress(promise) {
    this.deferreds.push(async_1.createDeferredFrom(promise));
    this.notifyRefreshing();
    this.checkProgress();
  }

  notifyCompleted() {
    this.refreshed.fire();
  }

  notifyRefreshing() {
    this.refreshing.fire();
  }

  checkProgress() {
    if (this.areAllItemsCcomplete()) {
      return this.notifyCompleted();
    }

    Promise.all(this.deferreds.map(item => item.promise)).catch(misc_1.noop).then(() => this.checkProgress()).ignoreErrors();
  }

  areAllItemsCcomplete() {
    this.deferreds = this.deferreds.filter(item => !item.completed);
    return this.deferreds.length === 0;
  }

};

__decorate([logger_1.traceVerbose('Detected refreshing of Interpreters')], InterpreterLocatorProgressService.prototype, "handleProgress", null);

__decorate([logger_1.traceVerbose('All locators have completed locating')], InterpreterLocatorProgressService.prototype, "notifyCompleted", null);

__decorate([logger_1.traceVerbose('Notify locators are locating')], InterpreterLocatorProgressService.prototype, "notifyRefreshing", null);

__decorate([logger_1.traceVerbose('Checking whether locactors have completed locating')], InterpreterLocatorProgressService.prototype, "checkProgress", null);

InterpreterLocatorProgressService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer)), __param(1, inversify_1.inject(types_1.IDisposableRegistry))], InterpreterLocatorProgressService);
exports.InterpreterLocatorProgressService = InterpreterLocatorProgressService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2dyZXNzU2VydmljZS5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX3BhcmFtIiwicGFyYW1JbmRleCIsImRlY29yYXRvciIsImV4cG9ydHMiLCJ2YWx1ZSIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInZzY29kZV8xIiwibG9nZ2VyXzEiLCJ0eXBlc18xIiwiYXN5bmNfMSIsIm1pc2NfMSIsInR5cGVzXzIiLCJjb250cmFjdHNfMSIsIkludGVycHJldGVyTG9jYXRvclByb2dyZXNzU2VydmljZSIsImNvbnN0cnVjdG9yIiwic2VydmljZUNvbnRhaW5lciIsImRpc3Bvc2FibGVzIiwiZGVmZXJyZWRzIiwicmVmcmVzaGluZyIsIkV2ZW50RW1pdHRlciIsInJlZnJlc2hlZCIsImxvY2F0b3JzIiwiZ2V0QWxsIiwiSUludGVycHJldGVyTG9jYXRvclNlcnZpY2UiLCJvblJlZnJlc2hpbmciLCJldmVudCIsIm9uUmVmcmVzaGVkIiwicmVnaXN0ZXIiLCJmb3JFYWNoIiwibG9jYXRvciIsIm9uTG9jYXRpbmciLCJoYW5kbGVQcm9ncmVzcyIsInByb21pc2UiLCJwdXNoIiwiY3JlYXRlRGVmZXJyZWRGcm9tIiwibm90aWZ5UmVmcmVzaGluZyIsImNoZWNrUHJvZ3Jlc3MiLCJub3RpZnlDb21wbGV0ZWQiLCJmaXJlIiwiYXJlQWxsSXRlbXNDY29tcGxldGUiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiaXRlbSIsImNhdGNoIiwibm9vcCIsInRoZW4iLCJpZ25vcmVFcnJvcnMiLCJmaWx0ZXIiLCJjb21wbGV0ZWQiLCJ0cmFjZVZlcmJvc2UiLCJwcm90b3R5cGUiLCJpbmplY3RhYmxlIiwiaW5q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QUFaLENBQW1CMUMsT0FBTyxDQUFDMkMsaUJBQTNCLENBQUosQ0FGb0MsRUFHM0N2RCxPQUFPLENBQUMsQ0FBRCxFQUFJSyxXQUFXLENBQUNpRCxNQUFaLENBQW1CN0MsT0FBTyxDQUFDK0MsbUJBQTNCLENBQUosQ0FIb0MsQ0FBRCxFQUkzQzFDLGlDQUoyQyxDQUE5QztBQUtBWCxPQUFPLENBQUNXLGlDQUFSLEdBQTRDQSxpQ0FBNUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbnZhciBfX3BhcmFtID0gKHRoaXMgJiYgdGhpcy5fX3BhcmFtKSB8fCBmdW5jdGlvbiAocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBpbnZlcnNpZnlfMSA9IHJlcXVpcmUoXCJpbnZlcnNpZnlcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgbG9nZ2VyXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL2xvZ2dlclwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGFzeW5jXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3V0aWxzL2FzeW5jXCIpO1xyXG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3V0aWxzL21pc2NcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vaW9jL3R5cGVzXCIpO1xyXG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi9jb250cmFjdHNcIik7XHJcbmxldCBJbnRlcnByZXRlckxvY2F0b3JQcm9ncmVzc1NlcnZpY2UgPSBjbGFzcyBJbnRlcnByZXRlckxvY2F0b3JQcm9ncmVzc1NlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lciwgZGlzcG9zYWJsZXMpIHtcclxuICAgICAgICB0aGlzLmRpc3Bvc2FibGVzID0gZGlzcG9zYWJsZXM7XHJcbiAgICAgICAgdGhpcy5kZWZlcnJlZHMgPSBbXTtcclxuICAgICAgICB0aGlzLnJlZnJlc2hpbmcgPSBuZXcgdnNjb2RlXzEuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgdGhpcy5yZWZyZXNoZWQgPSBuZXcgdnNjb2RlXzEuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgdGhpcy5sb2NhdG9ycyA9IFtdO1xyXG4gICAgICAgIHRoaXMubG9jYXRvcnMgPSBzZXJ2aWNlQ29udGFpbmVyLmdldEFsbChjb250cmFjdHNfMS5JSW50ZXJwcmV0ZXJMb2NhdG9yU2VydmljZSk7XHJcbiAgICB9XHJcbiAgICBnZXQgb25SZWZyZXNoaW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZnJlc2hpbmcuZXZlbnQ7XHJcbiAgICB9XHJcbiAgICBnZXQgb25SZWZyZXNoZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVmcmVzaGVkLmV2ZW50O1xyXG4gICAgfVxyXG4gICAgcmVnaXN0ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5sb2NhdG9ycy5mb3JFYWNoKGxvY2F0b3IgPT4ge1xyXG4gICAgICAgICAgICBsb2NhdG9yLm9uTG9jYXRpbmcodGhpcy5oYW5kbGVQcm9ncmVzcywgdGhpcywgdGhpcy5kaXNwb3NhYmxlcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBoYW5kbGVQcm9ncmVzcyhwcm9taXNlKSB7XHJcbiAgICAgICAgdGhpcy5kZWZlcnJlZHMucHVzaChhc3luY18xLmNyZWF0ZURlZmVycmVkRnJvbShwcm9taXNlKSk7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlSZWZyZXNoaW5nKCk7XHJcbiAgICAgICAgdGhpcy5jaGVja1Byb2dyZXNzKCk7XHJcbiAgICB9XHJcbiAgICBub3RpZnlDb21wbGV0ZWQoKSB7XHJcbiAgICAgICAgdGhpcy5yZWZyZXNoZWQuZmlyZSgpO1xyXG4gICAgfVxyXG4gICAgbm90aWZ5UmVmcmVzaGluZygpIHtcclxuICAgICAgICB0aGlzLnJlZnJlc2hpbmcuZmlyZSgpO1xyXG4gICAgfVxyXG4gICAgY2hlY2tQcm9ncmVzcygpIHtcclxuICAgICAgICBpZiAodGhpcy5hcmVBbGxJdGVtc0Njb21wbGV0ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdGlmeUNvbXBsZXRlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBQcm9taXNlLmFsbCh0aGlzLmRlZmVycmVkcy5tYXAoaXRlbSA9PiBpdGVtLnByb21pc2UpKVxyXG4gICAgICAgICAgICAuY2F0Y2gobWlzY18xLm5vb3ApXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuY2hlY2tQcm9ncmVzcygpKVxyXG4gICAgICAgICAgICAuaWdub3JlRXJyb3JzKCk7XHJcbiAgICB9XHJcbiAgICBhcmVBbGxJdGVtc0Njb21wbGV0ZSgpIHtcclxuICAgICAgICB0aGlzLmRlZmVycmVkcyA9IHRoaXMuZGVmZXJyZWRzLmZpbHRlcihpdGVtID0+ICFpdGVtLmNvbXBsZXRlZCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmZXJyZWRzLmxlbmd0aCA9PT0gMDtcclxuICAgIH1cclxufTtcclxuX19kZWNvcmF0ZShbXHJcbiAgICBsb2dnZXJfMS50cmFjZVZlcmJvc2UoJ0RldGVjdGVkIHJlZnJlc2hpbmcgb2YgSW50ZXJwcmV0ZXJzJylcclxuXSwgSW50ZXJwcmV0ZXJMb2NhdG9yUHJvZ3Jlc3NTZXJ2aWNlLnByb3RvdHlwZSwgXCJoYW5kbGVQcm9ncmVzc1wiLCBudWxsKTtcclxuX19kZWNvcmF0ZShbXHJcbiAgICBsb2dnZXJfMS50cmFjZVZlcmJvc2UoJ0FsbCBsb2NhdG9ycyBoYXZlIGNvbXBsZXRlZCBsb2NhdGluZycpXHJcbl0sIEludGVycHJldGVyTG9jYXRvclByb2dyZXNzU2VydmljZS5wcm90b3R5cGUsIFwibm90aWZ5Q29tcGxldGVkXCIsIG51bGwpO1xyXG5fX2RlY29yYXRlKFtcclxuICAgIGxvZ2dlcl8xLnRyYWNlVmVyYm9zZSgnTm90aWZ5IGxvY2F0b3JzIGFyZSBsb2NhdGluZycpXHJcbl0sIEludGVycHJldGVyTG9jYXRvclByb2dyZXNzU2VydmljZS5wcm90b3R5cGUsIFwibm90aWZ5UmVmcmVzaGluZ1wiLCBudWxsKTtcclxuX19kZWNvcmF0ZShbXHJcbiAgICBsb2dnZXJfMS50cmFjZVZlcmJvc2UoJ0NoZWNraW5nIHdoZXRoZXIgbG9jYWN0b3JzIGhhdmUgY29tcGxldGVkIGxvY2F0aW5nJylcclxuXSwgSW50ZXJwcmV0ZXJMb2NhdG9yUHJvZ3Jlc3NTZXJ2aWNlLnByb3RvdHlwZSwgXCJjaGVja1Byb2dyZXNzXCIsIG51bGwpO1xyXG5JbnRlcnByZXRlckxvY2F0b3JQcm9ncmVzc1NlcnZpY2UgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKSxcclxuICAgIF9fcGFyYW0oMSwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzEuSURpc3Bvc2FibGVSZWdpc3RyeSkpXHJcbl0sIEludGVycHJldGVyTG9jYXRvclByb2dyZXNzU2VydmljZSk7XHJcbmV4cG9ydHMuSW50ZXJwcmV0ZXJMb2NhdG9yUHJvZ3Jlc3NTZXJ2aWNlID0gSW50ZXJwcmV0ZXJMb2NhdG9yUHJvZ3Jlc3NTZXJ2aWNlO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9ncmVzc1NlcnZpY2UuanMubWFwIl19