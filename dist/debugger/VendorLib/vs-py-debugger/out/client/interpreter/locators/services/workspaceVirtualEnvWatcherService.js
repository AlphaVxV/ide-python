// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const path = require("path");

const vscode_1 = require("vscode");

const types_1 = require("../../../common/application/types");

require("../../../common/extensions");

const logger_1 = require("../../../common/logger");

const types_2 = require("../../../common/platform/types");

const types_3 = require("../../../common/process/types");

const types_4 = require("../../../common/types");

const maxTimeToWaitForEnvCreation = 60000;
const timeToPollForEnvCreation = 2000;
let WorkspaceVirtualEnvWatcherService = class WorkspaceVirtualEnvWatcherService {
  constructor(disposableRegistry, workspaceService, platformService, pythonExecFactory) {
    this.disposableRegistry = disposableRegistry;
    this.workspaceService = workspaceService;
    this.platformService = platformService;
    this.pythonExecFactory = pythonExecFactory;
    this.timers = new Map();
    this.fsWatchers = [];
    this.didCreate = new vscode_1.EventEmitter();
    disposableRegistry.push(this);
  }

  get onDidCreate() {
    return this.didCreate.event;
  }

  dispose() {
    this.clearTimers();
  }

  register(resource) {
    return __awaiter(this, void 0, void 0, function* () {
      if (this.fsWatchers.length > 0) {
        return;
      }

      const workspaceFolder = resource ? this.workspaceService.getWorkspaceFolder(resource) : undefined;
      const executable = this.platformService.isWindows ? 'python.exe' : 'python';
      const patterns = [path.join('*', executable), path.join('*', '*', executable)];

      for (const pattern of patterns) {
        const globPatern = workspaceFolder ? new vscode_1.RelativePattern(workspaceFolder.uri.fsPath, pattern) : pattern;
        logger_1.Logger.verbose(`Create file systemwatcher with pattern ${pattern}`);
        const fsWatcher = this.workspaceService.createFileSystemWatcher(globPatern);
        fsWatcher.onDidCreate(e => this.createHandler(e), this, this.disposableRegistry);
        this.disposableRegistry.push(fsWatcher);
        this.fsWatchers.push(fsWatcher);
      }
    });
  }

  createHandler(e) {
    return __awaiter(this, void 0, void 0, function* () {
      this.didCreate.fire(); // On Windows, creation of environments are very slow, hence lets notify again after
      // the python executable is accessible (i.e. when we can launch the process).

      this.notifyCreationWhenReady(e.fsPath).ignoreErrors();
    });
  }

  notifyCreationWhenReady(pythonPath) {
    return __awaiter(this, void 0, void 0, function* () {
      const counter = this.timers.has(pythonPath) ? this.timers.get(pythonPath).counter + 1 : 0;
      const isValid = yield this.isValidExecutable(pythonPath);

      if (isValid) {
        if (counter > 0) {
          this.didCreate.fire();
        }

        return this.timers.delete(pythonPath);
      }

      if (counter > maxTimeToWaitForEnvCreation / timeToPollForEnvCreation) {
        // Send notification before we give up trying.
        this.didCreate.fire();
        this.timers.delete(pythonPath);
        return;
      }

      const timer = setTimeout(() => this.notifyCreationWhenReady(pythonPath).ignoreErrors(), timeToPollForEnvCreation);
      this.timers.set(pythonPath, {
        timer,
        counter
      });
    });
  }

  clearTimers() {
    this.timers.forEach(item => clearTimeout(item.timer));
    this.timers.clear();
  }

  isValidExecutable(pythonPath) {
    return __awaiter(this, void 0, void 0, function* () {
      const execService = yield this.pythonExecFactory.create({
        pythonPath
      });
      const info = yield execService.getInterpreterInformation().catch(() => undefined);
      return info !== undefined;
    });
  }

};

__decorate([logger_1.traceVerbose('Register Intepreter Watcher')], WorkspaceVirtualEnvWatcherService.prototype, "register", null);

__decorate([logger_1.traceVerbose('Intepreter Watcher change handler')], WorkspaceVirtualEnvWatcherService.prototype, "createHandler", null);

WorkspaceVirtualEnvWatcherService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_4.IDisposableRegistry)), __param(1, inversify_1.inject(types_1.IWorkspaceService)), __param(2, inversify_1.inject(types_2.IPlatformService)), __param(3, inversify_1.inject(types_3.IPythonExecutionFactory))], WorkspaceVirtualEnvWatcherService);
exports.WorkspaceVirtualEnvWatcherService = WorkspaceVirtualEnvWatcherService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmtzcGFjZVZpcnR1YWxFbnZXYXRjaGVyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX3BhcmFtIiwicGFyYW1JbmRleCIsImRlY29yYXRvciIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJleHBvcnRzIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwicGF0aCIsInZzY29kZV8xIiwidHlwZXNfMSIsImxvZ2dlcl8xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJ0eXBlc180IiwibWF4VGltZVRvV2FpdEZvckVudkNyZWF0aW9uIiwidGltZVRvUG9sbEZvckVudkNyZWF0aW9uIiwiV29ya3NwYWNlVmlydHVhbEVudldhdGNoZXJTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJkaXNwb3NhYmxlUmVnaXN0cnkiLCJ3b3Jrc3BhY2VTZXJ2aWNlIiwicGxhdGZvcm1TZXJ2aWNlIiwicHl0aG9uRXhlY0ZhY3RvcnkiLCJ0aW1lcnMiLCJNYXAiLCJmc1dhdGNoZXJzIiwiZGlkQ3JlYXRlIiwiRXZlbnRFbWl0dGVyIiwicHVzaCIsIm9uRGlkQ3JlYXRlIiwiZXZlbnQiLCJkaXNwb3NlIiwiY2xlYXJUaW1lcnMiLCJyZWdpc3RlciIsInJlc291cmNlIiwid29ya3NwYWNlRm9sZGVyIiwiZ2V0V29ya3NwYWNlRm9sZGVyIiwidW5kZWZpbmVkIiwiZXhlY3V0YWJsZSIsImlzV2luZG93cyIsInBhdHRlcm5zIiwiam9pbiIsInBhdHRlcm4iLCJnbG9iUGF0ZXJuIiwiUmVsYXRpdmVQYXR0ZXJuIiwidXJpIiwiZnNQYXRoIiwiTG9nZ2VyIiwidmVyYm9zZSIsImZzV2F0Y2hlciIsImNyZWF0ZUZpbGVTeXN0ZW1XYXRjaGVyIiwiY3JlYXRlSGFuZGxlciIsImZpcmUiLCJub3RpZnlDcmVhdGlvbldoZW5SZWFkeSIsImlnbm9yZUVycm9ycyIsInB5dGhvblBhdGgiLCJjb3VudGVyIiwiaGFzIiwiZ2V0IiwiaXNWYWxpZCIsImlzVmFsaWRFeGVjdXRhYmxlIiwiZGVsZXRlIiwidGltZXIiLCJzZXRUaW1lb3V0Iiwic2V0IiwiZm9yRWFjaCIsIml0ZW0iLCJjbGVhclRpbWVvdXQiLCJjbGVhciIsImV4ZWNTZXJ2aWNlIiwiY3JlYXRlIiwiaW5mbyIsImdldEludGVycHJldGVySW5mb3JtYXRpb24iLCJjYXRjaCIsInRyYWNlVmVyYm9zZSIsInByb3RvdHlwZSIsImluamVjdGFibGUiLCJpbmplY3QiLCJJRGlzcG9zYWJsZVJlZ2lzdHJ5IiwiSVdvcmtzcGFjZVNlcnZpY2UiLCJJUGxhdGZvcm1TZXJ2aWNlIiwiSVB5dGhvbkV4ZWN1dGlvbkZhY3RvcnkiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxVQUFVLEdBQUksVUFBUSxTQUFLQSxVQUFkLElBQTZCLFVBQVVDLFVBQVYsRUFBc0JDLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUM7QUFDbkYsTUFBSUMsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWxCO0FBQUEsTUFBMEJDLENBQUMsR0FBR0gsQ0FBQyxHQUFHLENBQUosR0FBUUgsTUFBUixHQUFpQkUsSUFBSSxLQUFLLElBQVQsR0FBZ0JBLElBQUksR0FBR0ssTUFBTSxDQUFDQyx3QkFBUCxDQUFnQ1IsTUFBaEMsRUFBd0NDLEdBQXhDLENBQXZCLEdBQXNFQyxJQUFySDtBQUFBLE1BQTJITyxDQUEzSDtBQUNB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Q0FBQzBELFNBRjNCLEVBRXNDLFVBRnRDLEVBRWtELElBRmxELENBQVY7O0FBR0EzRyxVQUFVLENBQUMsQ0FDUDJDLFFBQVEsQ0FBQytELFlBQVQsQ0FBc0IsbUNBQXRCLENBRE8sQ0FBRCxFQUVQekQsaUNBQWlDLENBQUMwRCxTQUYzQixFQUVzQyxlQUZ0QyxFQUV1RCxJQUZ2RCxDQUFWOztBQUdBMUQsaUNBQWlDLEdBQUdqRCxVQUFVLENBQUMsQ0FDM0NzQyxXQUFXLENBQUNzRSxVQUFaLEVBRDJDLEVBRTNDNUYsT0FBTyxDQUFDLENBQUQsRUFBSXNCLFdBQVcsQ0FBQ3VFLE1BQVosQ0FBbUIvRCxPQUFPLENBQUNnRSxtQkFBM0IsQ0FBSixDQUZvQyxFQUczQzlGLE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUN1RSxNQUFaLENBQW1CbkUsT0FBTyxDQUFDcUUsaUJBQTNCLENBQUosQ0FIb0MsRUFJM0MvRixPQUFPLENBQUMsQ0FBRCxFQUFJc0IsV0FBVyxDQUFDdUUsTUFBWixDQUFtQmpFLE9BQU8sQ0FBQ29FLGdCQUEzQixDQUFKLENBSm9DLEVBSzNDaEcsT0FBTyxDQUFDLENBQUQsRUFBSXNCLFdBQVcsQ0FBQ3VFLE1BQVosQ0FBbUJoRSxPQUFPLENBQUNvRSx1QkFBM0IsQ0FBSixDQUxvQyxDQUFELEVBTTNDaEUsaUNBTjJDLENBQTlDO0FBT0FaLE9BQU8sQ0FBQ1ksaUNBQVIsR0FBNENBLGlDQUE1QyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59O1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5yZXF1aXJlKFwiLi4vLi4vLi4vY29tbW9uL2V4dGVuc2lvbnNcIik7XHJcbmNvbnN0IGxvZ2dlcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbW1vbi9sb2dnZXJcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY29tbW9uL3BsYXRmb3JtL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbW1vbi9wcm9jZXNzL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc180ID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgbWF4VGltZVRvV2FpdEZvckVudkNyZWF0aW9uID0gNjAwMDA7XHJcbmNvbnN0IHRpbWVUb1BvbGxGb3JFbnZDcmVhdGlvbiA9IDIwMDA7XHJcbmxldCBXb3Jrc3BhY2VWaXJ0dWFsRW52V2F0Y2hlclNlcnZpY2UgPSBjbGFzcyBXb3Jrc3BhY2VWaXJ0dWFsRW52V2F0Y2hlclNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoZGlzcG9zYWJsZVJlZ2lzdHJ5LCB3b3Jrc3BhY2VTZXJ2aWNlLCBwbGF0Zm9ybVNlcnZpY2UsIHB5dGhvbkV4ZWNGYWN0b3J5KSB7XHJcbiAgICAgICAgdGhpcy5kaXNwb3NhYmxlUmVnaXN0cnkgPSBkaXNwb3NhYmxlUmVnaXN0cnk7XHJcbiAgICAgICAgdGhpcy53b3Jrc3BhY2VTZXJ2aWNlID0gd29ya3NwYWNlU2VydmljZTtcclxuICAgICAgICB0aGlzLnBsYXRmb3JtU2VydmljZSA9IHBsYXRmb3JtU2VydmljZTtcclxuICAgICAgICB0aGlzLnB5dGhvbkV4ZWNGYWN0b3J5ID0gcHl0aG9uRXhlY0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy50aW1lcnMgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5mc1dhdGNoZXJzID0gW107XHJcbiAgICAgICAgdGhpcy5kaWRDcmVhdGUgPSBuZXcgdnNjb2RlXzEuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgZGlzcG9zYWJsZVJlZ2lzdHJ5LnB1c2godGhpcyk7XHJcbiAgICB9XHJcbiAgICBnZXQgb25EaWRDcmVhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlkQ3JlYXRlLmV2ZW50O1xyXG4gICAgfVxyXG4gICAgZGlzcG9zZSgpIHtcclxuICAgICAgICB0aGlzLmNsZWFyVGltZXJzKCk7XHJcbiAgICB9XHJcbiAgICByZWdpc3RlcihyZXNvdXJjZSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZzV2F0Y2hlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHJlc291cmNlID8gdGhpcy53b3Jrc3BhY2VTZXJ2aWNlLmdldFdvcmtzcGFjZUZvbGRlcihyZXNvdXJjZSkgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGFibGUgPSB0aGlzLnBsYXRmb3JtU2VydmljZS5pc1dpbmRvd3MgPyAncHl0aG9uLmV4ZScgOiAncHl0aG9uJztcclxuICAgICAgICAgICAgY29uc3QgcGF0dGVybnMgPSBbcGF0aC5qb2luKCcqJywgZXhlY3V0YWJsZSksIHBhdGguam9pbignKicsICcqJywgZXhlY3V0YWJsZSldO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgcGF0dGVybnMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdsb2JQYXRlcm4gPSB3b3Jrc3BhY2VGb2xkZXIgPyBuZXcgdnNjb2RlXzEuUmVsYXRpdmVQYXR0ZXJuKHdvcmtzcGFjZUZvbGRlci51cmkuZnNQYXRoLCBwYXR0ZXJuKSA6IHBhdHRlcm47XHJcbiAgICAgICAgICAgICAgICBsb2dnZXJfMS5Mb2dnZXIudmVyYm9zZShgQ3JlYXRlIGZpbGUgc3lzdGVtd2F0Y2hlciB3aXRoIHBhdHRlcm4gJHtwYXR0ZXJufWApO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZnNXYXRjaGVyID0gdGhpcy53b3Jrc3BhY2VTZXJ2aWNlLmNyZWF0ZUZpbGVTeXN0ZW1XYXRjaGVyKGdsb2JQYXRlcm4pO1xyXG4gICAgICAgICAgICAgICAgZnNXYXRjaGVyLm9uRGlkQ3JlYXRlKGUgPT4gdGhpcy5jcmVhdGVIYW5kbGVyKGUpLCB0aGlzLCB0aGlzLmRpc3Bvc2FibGVSZWdpc3RyeSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2FibGVSZWdpc3RyeS5wdXNoKGZzV2F0Y2hlcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZzV2F0Y2hlcnMucHVzaChmc1dhdGNoZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVIYW5kbGVyKGUpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB0aGlzLmRpZENyZWF0ZS5maXJlKCk7XHJcbiAgICAgICAgICAgIC8vIE9uIFdpbmRvd3MsIGNyZWF0aW9uIG9mIGVudmlyb25tZW50cyBhcmUgdmVyeSBzbG93LCBoZW5jZSBsZXRzIG5vdGlmeSBhZ2FpbiBhZnRlclxyXG4gICAgICAgICAgICAvLyB0aGUgcHl0aG9uIGV4ZWN1dGFibGUgaXMgYWNjZXNzaWJsZSAoaS5lLiB3aGVuIHdlIGNhbiBsYXVuY2ggdGhlIHByb2Nlc3MpLlxyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeUNyZWF0aW9uV2hlblJlYWR5KGUuZnNQYXRoKS5pZ25vcmVFcnJvcnMoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG5vdGlmeUNyZWF0aW9uV2hlblJlYWR5KHB5dGhvblBhdGgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb3VudGVyID0gdGhpcy50aW1lcnMuaGFzKHB5dGhvblBhdGgpID8gdGhpcy50aW1lcnMuZ2V0KHB5dGhvblBhdGgpLmNvdW50ZXIgKyAxIDogMDtcclxuICAgICAgICAgICAgY29uc3QgaXNWYWxpZCA9IHlpZWxkIHRoaXMuaXNWYWxpZEV4ZWN1dGFibGUocHl0aG9uUGF0aCk7XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY291bnRlciA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRpZENyZWF0ZS5maXJlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50aW1lcnMuZGVsZXRlKHB5dGhvblBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb3VudGVyID4gKG1heFRpbWVUb1dhaXRGb3JFbnZDcmVhdGlvbiAvIHRpbWVUb1BvbGxGb3JFbnZDcmVhdGlvbikpIHtcclxuICAgICAgICAgICAgICAgIC8vIFNlbmQgbm90aWZpY2F0aW9uIGJlZm9yZSB3ZSBnaXZlIHVwIHRyeWluZy5cclxuICAgICAgICAgICAgICAgIHRoaXMuZGlkQ3JlYXRlLmZpcmUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZXJzLmRlbGV0ZShweXRob25QYXRoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy5ub3RpZnlDcmVhdGlvbldoZW5SZWFkeShweXRob25QYXRoKS5pZ25vcmVFcnJvcnMoKSwgdGltZVRvUG9sbEZvckVudkNyZWF0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy50aW1lcnMuc2V0KHB5dGhvblBhdGgsIHsgdGltZXIsIGNvdW50ZXIgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjbGVhclRpbWVycygpIHtcclxuICAgICAgICB0aGlzLnRpbWVycy5mb3JFYWNoKGl0ZW0gPT4gY2xlYXJUaW1lb3V0KGl0ZW0udGltZXIpKTtcclxuICAgICAgICB0aGlzLnRpbWVycy5jbGVhcigpO1xyXG4gICAgfVxyXG4gICAgaXNWYWxpZEV4ZWN1dGFibGUocHl0aG9uUGF0aCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4ZWNTZXJ2aWNlID0geWllbGQgdGhpcy5weXRob25FeGVjRmFjdG9yeS5jcmVhdGUoeyBweXRob25QYXRoIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBpbmZvID0geWllbGQgZXhlY1NlcnZpY2UuZ2V0SW50ZXJwcmV0ZXJJbmZvcm1hdGlvbigpLmNhdGNoKCgpID0+IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcbl9fZGVjb3JhdGUoW1xyXG4gICAgbG9nZ2VyXzEudHJhY2VWZXJib3NlKCdSZWdpc3RlciBJbnRlcHJldGVyIFdhdGNoZXInKVxyXG5dLCBXb3Jrc3BhY2VWaXJ0dWFsRW52V2F0Y2hlclNlcnZpY2UucHJvdG90eXBlLCBcInJlZ2lzdGVyXCIsIG51bGwpO1xyXG5fX2RlY29yYXRlKFtcclxuICAgIGxvZ2dlcl8xLnRyYWNlVmVyYm9zZSgnSW50ZXByZXRlciBXYXRjaGVyIGNoYW5nZSBoYW5kbGVyJylcclxuXSwgV29ya3NwYWNlVmlydHVhbEVudldhdGNoZXJTZXJ2aWNlLnByb3RvdHlwZSwgXCJjcmVhdGVIYW5kbGVyXCIsIG51bGwpO1xyXG5Xb3Jrc3BhY2VWaXJ0dWFsRW52V2F0Y2hlclNlcnZpY2UgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzQuSURpc3Bvc2FibGVSZWdpc3RyeSkpLFxyXG4gICAgX19wYXJhbSgxLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpLFxyXG4gICAgX19wYXJhbSgyLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JUGxhdGZvcm1TZXJ2aWNlKSksXHJcbiAgICBfX3BhcmFtKDMsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc18zLklQeXRob25FeGVjdXRpb25GYWN0b3J5KSlcclxuXSwgV29ya3NwYWNlVmlydHVhbEVudldhdGNoZXJTZXJ2aWNlKTtcclxuZXhwb3J0cy5Xb3Jrc3BhY2VWaXJ0dWFsRW52V2F0Y2hlclNlcnZpY2UgPSBXb3Jrc3BhY2VWaXJ0dWFsRW52V2F0Y2hlclNlcnZpY2U7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtzcGFjZVZpcnR1YWxFbnZXYXRjaGVyU2VydmljZS5qcy5tYXAiXX0=