"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const vscode_1 = require("vscode");

const async_1 = require("../common/utils/async");

const stopWatch_1 = require("../common/utils/stopWatch");

const telemetry_1 = require("../telemetry");

const constants_1 = require("../telemetry/constants"); // Draw the line at Language Server analysis 'timing out'
// and becoming a failure-case at 1 minute:


const ANALYSIS_TIMEOUT_MS = 60000;

class ProgressReporting {
  constructor(languageClient) {
    this.languageClient = languageClient;
    this.languageClient.onNotification('python/setStatusBarMessage', m => {
      if (this.statusBarMessage) {
        this.statusBarMessage.dispose();
      }

      this.statusBarMessage = vscode_1.window.setStatusBarMessage(m);
    });
    this.languageClient.onNotification('python/beginProgress', _ => __awaiter(this, void 0, void 0, function* () {
      if (this.progressDeferred) {
        return;
      }

      this.progressDeferred = async_1.createDeferred();
      this.progressTimer = new stopWatch_1.StopWatch();
      this.progressTimeout = setTimeout(this.handleTimeout.bind(this), ANALYSIS_TIMEOUT_MS);
      vscode_1.window.withProgress({
        location: vscode_1.ProgressLocation.Window,
        title: ''
      }, progress => {
        this.progress = progress;
        return this.progressDeferred.promise;
      });
    }));
    this.languageClient.onNotification('python/reportProgress', m => {
      if (!this.progress) {
        return;
      }

      this.progress.report({
        message: m
      });
    });
    this.languageClient.onNotification('python/endProgress', _ => {
      if (this.progressDeferred) {
        this.progressDeferred.resolve();
        this.progressDeferred = undefined;
        this.progress = undefined;
        this.completeAnalysisTracking(true);
      }
    });
  }

  dispose() {
    if (this.statusBarMessage) {
      this.statusBarMessage.dispose();
    }
  }

  completeAnalysisTracking(success) {
    if (this.progressTimer) {
      telemetry_1.sendTelemetryEvent(constants_1.PYTHON_LANGUAGE_SERVER_ANALYSISTIME, this.progressTimer.elapsedTime, {
        success
      });
    }

    this.progressTimer = undefined;
    this.progressTimeout = undefined;
  } // tslint:disable-next-line:no-any


  handleTimeout(_args) {
    this.completeAnalysisTracking(false);
  }

}

exports.ProgressReporting = ProgressReporting;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2dyZXNzLmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2c2NvZGVfMSIsInJlcXVpcmUiLCJhc3luY18xIiwic3RvcFdhdGNoXzEiLCJ0ZWxlbWV0cnlfMSIsImNvbnN0YW50c18xIiwiQU5BTFlTSVNfVElNRU9VVF9NUyIsIlByb2dyZXNzUmVwb3J0aW5nIiwiY29uc3RydWN0b3IiLCJsYW5ndWFnZUNsaWVudCIsIm9uTm90aWZpY2F0aW9uIiwibSIsInN0YXR1c0Jhck1lc3NhZ2UiLCJkaXNwb3NlIiwid2luZG93Iiwic2V0U3RhdHVzQmFyTWVzc2FnZSIsIl8iLCJwcm9ncmVzc0RlZmVycmVkIiwiY3JlYXRlRGVmZXJyZWQiLCJwcm9ncmVzc1RpbWVyIiwiU3RvcFdhdGNoIiwicHJvZ3Jlc3NUaW1lb3V0Iiwic2V0VGltZW91dCIsImhhbmRsZVRpbWVvdXQiLCJiaW5kIiwid2l0aFByb2dyZXNzIiwibG9jYXRpb24iLCJQcm9ncmVzc0xvY2F0aW9uIiwiV2luZG93IiwidGl0bGUiLCJwcm9ncmVzcyIsInByb21pc2UiLCJyZXBvcnQiLCJtZXNzYWdlIiwidW5kZWZpbmVkIiwiY29tcGxldGVBbmFseXNpc1RyYWNraW5nIiwic3VjY2VzcyIsInNlbmRUZWxlbWV0cnlFdmVudCIsIlBZVEhPTl9MQU5HVUFHRV9TRVJWRVJfQU5BTFlTSVNUSU1FIiwiZWxhcHNlZFRpbWUiLCJfYXJncyJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8sSUFBckQsQ0FBMERSLFNBQTFELEVBQXFFSyxRQUFyRSxDQUF0QztBQUF1SDs7QUFDL0lILElBQUFBLElBQUksQ0FBQyxDQUFDTixTQUFTLEdBQUdBLFNBQVMsQ0FBQ2EsS0FBVixDQUFnQmhCLE9BQWhCLEVBQXlCQyxVQUFVLElBQUksRUFBdkMsQ0FBYixFQUF5RFMsSUFBekQsRUFBRCxDQUFKO0FBQ0gsR0FMTSxDQUFQO0FBTUgsQ0FQRDs7QUFRQU8sTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUFFWCxFQUFBQSxLQUFLLEVBQUU7QUFBVCxDQUE3Qzs7QUFDQSxNQUFNWSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQXhCOztBQUNBLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLHVCQUFELENBQXZCOztBQUNBLE1BQU1FLFdBQVcsR0FBR0YsT0FBTyxDQUFDLDJCQUFELENBQTNCOztBQUNBLE1BQU1HLFdBQVcsR0FBR0gsT0FBTyxDQUFDLGNBQUQsQ0FBM0I7O0FBQ0EsTUFBTUksV0FBVyxHQUFHSixPQUFPLENBQUMsd0JBQUQsQ0FBM0IsQyxDQUNBO0FBQ0E7OztBQUNBLE1BQU1LLG1CQUFtQixHQUFHLEtBQTVCOztBQUNBLE1BQU1DLGlCQUFOLENBQXdCO0FBQ3BCQyxFQUFBQSxXQUFXLENBQUNDLGNBQUQsRUFBaUI7QUFDeEIsU0FBS0EsY0FBTCxHQUFzQkEsY0FBdEI7QUFDQSxTQUFLQSxjQUFMLENBQW9CQyxjQUFwQixDQUFtQyw0QkFBbkMsRUFBa0VDLENBQUQsSUFBTztBQUNwRSxVQUFJLEtBQUtDLGdCQUFULEVBQTJCO0FBQ3ZCLGFBQUtBLGdCQUFMLENBQXNCQyxPQUF0QjtBQUNIOztBQUNELFdBQUtELGdCQUFMLEdBQXdCWixRQUFRLENBQUNjLE1BQVQsQ0FBZ0JDLG1CQUFoQixDQUFvQ0osQ0FBcEMsQ0FBeEI7QUFDSCxLQUxEO0FBTUEsU0FBS0YsY0FBTCxDQUFvQkMsY0FBcEIsQ0FBbUMsc0JBQW5DLEVBQTRETSxDQUFELElBQU9yQyxTQUFTLENBQUMsSUFBRCxFQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUMzRyxVQUFJLEtBQUtzQyxnQkFBVCxFQUEyQjtBQUN2QjtBQUNIOztBQUNELFdBQUtBLGdCQUFMLEdBQXdCZixPQUFPLENBQUNnQixjQUFSLEVBQXhCO0FBQ0EsV0FBS0MsYUFBTCxHQUFxQixJQUFJaEIsV0FBVyxDQUFDaUIsU0FBaEIsRUFBckI7QUFDQSxXQUFLQyxlQUFMLEdBQXVCQyxVQUFVLENBQUMsS0FBS0MsYUFBTCxDQUFtQkMsSUFBbkIsQ0FBd0IsSUFBeEIsQ0FBRCxFQUFnQ2xCLG1CQUFoQyxDQUFqQztBQUNBTixNQUFBQSxRQUFRLENBQUNjLE1BQVQsQ0FBZ0JXLFlBQWhCLENBQTZCO0FBQ3pCQyxRQUFBQSxRQUFRLEVBQUUxQixRQUFRLENBQUMyQixnQkFBVCxDQUEwQkMsTUFEWDtBQUV6QkMsUUFBQUEsS0FBSyxFQUFFO0FBRmtCLE9BQTdCLEVBR0dDLFFBQVEsSUFBSTtBQUNYLGFBQUtBLFFBQUwsR0FBZ0JBLFFBQWhCO0FBQ0EsZUFBTyxLQUFLYixnQkFBTCxDQUFzQmMsT0FBN0I7QUFDSCxPQU5EO0FBT0gsS0FkMEUsQ0FBM0U7QUFlQSxTQUFLdEIsY0FBTCxDQUFvQkMsY0FBcEIsQ0FBbUMsdUJBQW5DLEVBQTZEQyxDQUFELElBQU87QUFDL0QsVUFBSSxDQUFDLEtBQUttQixRQUFWLEVBQW9CO0FBQ2hCO0FBQ0g7O0FBQ0QsV0FBS0EsUUFBTCxDQUFjRSxNQUFkLENBQXFCO0FBQUVDLFFBQUFBLE9BQU8sRUFBRXRCO0FBQVgsT0FBckI7QUFDSCxLQUxEO0FBTUEsU0FBS0YsY0FBTCxDQUFvQkMsY0FBcEIsQ0FBbUMsb0JBQW5DLEVBQXlETSxDQUFDLElBQUk7QUFDMUQsVUFBSSxLQUFLQyxnQkFBVCxFQUEyQjtBQUN2QixhQUFLQSxnQkFBTCxDQUFzQmhDLE9BQXRCO0FBQ0EsYUFBS2dDLGdCQUFMLEdBQXdCaUIsU0FBeEI7QUFDQSxhQUFLSixRQUFMLEdBQWdCSSxTQUFoQjtBQUNBLGFBQUtDLHdCQUFMLENBQThCLElBQTlCO0FBQ0g7QUFDSixLQVBEO0FBUUg7O0FBQ0R0QixFQUFBQSxPQUFPLEdBQUc7QUFDTixRQUFJLEtBQUtELGdCQUFULEVBQTJCO0FBQ3ZCLFdBQUtBLGdCQUFMLENBQXNCQyxPQUF0QjtBQUNIO0FBQ0o7O0FBQ0RzQixFQUFBQSx3QkFBd0IsQ0FBQ0MsT0FBRCxFQUFVO0FBQzlCLFFBQUksS0FBS2pCLGFBQVQsRUFBd0I7QUFDcEJmLE1BQUFBLFdBQVcsQ0FBQ2lDLGtCQUFaLENBQStCaEMsV0FBVyxDQUFDaUMsbUNBQTNDLEVBQWdGLEtBQUtuQixhQUFMLENBQW1Cb0IsV0FBbkcsRUFBZ0g7QUFBRUgsUUFBQUE7QUFBRixPQUFoSDtBQUNIOztBQUNELFNBQUtqQixhQUFMLEdBQXFCZSxTQUFyQjtBQUNBLFNBQUtiLGVBQUwsR0FBdUJhLFNBQXZCO0FBQ0gsR0FsRG1CLENBbURwQjs7O0FBQ0FYLEVBQUFBLGFBQWEsQ0FBQ2lCLEtBQUQsRUFBUTtBQUNqQixTQUFLTCx3QkFBTCxDQUE4QixLQUE5QjtBQUNIOztBQXREbUI7O0FBd0R4QnBDLE9BQU8sQ0FBQ1EsaUJBQVIsR0FBNEJBLGlCQUE1QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgYXN5bmNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vdXRpbHMvYXN5bmNcIik7XHJcbmNvbnN0IHN0b3BXYXRjaF8xID0gcmVxdWlyZShcIi4uL2NvbW1vbi91dGlscy9zdG9wV2F0Y2hcIik7XHJcbmNvbnN0IHRlbGVtZXRyeV8xID0gcmVxdWlyZShcIi4uL3RlbGVtZXRyeVwiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vdGVsZW1ldHJ5L2NvbnN0YW50c1wiKTtcclxuLy8gRHJhdyB0aGUgbGluZSBhdCBMYW5ndWFnZSBTZXJ2ZXIgYW5hbHlzaXMgJ3RpbWluZyBvdXQnXHJcbi8vIGFuZCBiZWNvbWluZyBhIGZhaWx1cmUtY2FzZSBhdCAxIG1pbnV0ZTpcclxuY29uc3QgQU5BTFlTSVNfVElNRU9VVF9NUyA9IDYwMDAwO1xyXG5jbGFzcyBQcm9ncmVzc1JlcG9ydGluZyB7XHJcbiAgICBjb25zdHJ1Y3RvcihsYW5ndWFnZUNsaWVudCkge1xyXG4gICAgICAgIHRoaXMubGFuZ3VhZ2VDbGllbnQgPSBsYW5ndWFnZUNsaWVudDtcclxuICAgICAgICB0aGlzLmxhbmd1YWdlQ2xpZW50Lm9uTm90aWZpY2F0aW9uKCdweXRob24vc2V0U3RhdHVzQmFyTWVzc2FnZScsIChtKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1c0Jhck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyTWVzc2FnZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXJNZXNzYWdlID0gdnNjb2RlXzEud2luZG93LnNldFN0YXR1c0Jhck1lc3NhZ2UobSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNsaWVudC5vbk5vdGlmaWNhdGlvbigncHl0aG9uL2JlZ2luUHJvZ3Jlc3MnLCAoXykgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9ncmVzc0RlZmVycmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0RlZmVycmVkID0gYXN5bmNfMS5jcmVhdGVEZWZlcnJlZCgpO1xyXG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzVGltZXIgPSBuZXcgc3RvcFdhdGNoXzEuU3RvcFdhdGNoKCk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLmhhbmRsZVRpbWVvdXQuYmluZCh0aGlzKSwgQU5BTFlTSVNfVElNRU9VVF9NUyk7XHJcbiAgICAgICAgICAgIHZzY29kZV8xLndpbmRvdy53aXRoUHJvZ3Jlc3Moe1xyXG4gICAgICAgICAgICAgICAgbG9jYXRpb246IHZzY29kZV8xLlByb2dyZXNzTG9jYXRpb24uV2luZG93LFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICcnXHJcbiAgICAgICAgICAgIH0sIHByb2dyZXNzID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb2dyZXNzRGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRoaXMubGFuZ3VhZ2VDbGllbnQub25Ob3RpZmljYXRpb24oJ3B5dGhvbi9yZXBvcnRQcm9ncmVzcycsIChtKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5wcm9ncmVzcykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MucmVwb3J0KHsgbWVzc2FnZTogbSB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxhbmd1YWdlQ2xpZW50Lm9uTm90aWZpY2F0aW9uKCdweXRob24vZW5kUHJvZ3Jlc3MnLCBfID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHJvZ3Jlc3NEZWZlcnJlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0RlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NEZWZlcnJlZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlQW5hbHlzaXNUcmFja2luZyh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZGlzcG9zZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5zdGF0dXNCYXJNZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFyTWVzc2FnZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29tcGxldGVBbmFseXNpc1RyYWNraW5nKHN1Y2Nlc3MpIHtcclxuICAgICAgICBpZiAodGhpcy5wcm9ncmVzc1RpbWVyKSB7XHJcbiAgICAgICAgICAgIHRlbGVtZXRyeV8xLnNlbmRUZWxlbWV0cnlFdmVudChjb25zdGFudHNfMS5QWVRIT05fTEFOR1VBR0VfU0VSVkVSX0FOQUxZU0lTVElNRSwgdGhpcy5wcm9ncmVzc1RpbWVyLmVsYXBzZWRUaW1lLCB7IHN1Y2Nlc3MgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3NUaW1lciA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLnByb2dyZXNzVGltZW91dCA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgIGhhbmRsZVRpbWVvdXQoX2FyZ3MpIHtcclxuICAgICAgICB0aGlzLmNvbXBsZXRlQW5hbHlzaXNUcmFja2luZyhmYWxzZSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Qcm9ncmVzc1JlcG9ydGluZyA9IFByb2dyZXNzUmVwb3J0aW5nO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9ncmVzcy5qcy5tYXAiXX0=