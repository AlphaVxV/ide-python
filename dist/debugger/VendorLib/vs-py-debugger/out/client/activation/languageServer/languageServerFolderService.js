// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const path = require("path");

const semver = require("semver");

const constants_1 = require("../../common/constants");

const logger_1 = require("../../common/logger");

const types_1 = require("../../common/platform/types");

const types_2 = require("../../common/types");

const types_3 = require("../../ioc/types");

const types_4 = require("../types");

const languageServerFolder = 'languageServer';
let LanguageServerFolderService = class LanguageServerFolderService {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
  }

  getLanguageServerFolderName() {
    return __awaiter(this, void 0, void 0, function* () {
      const currentFolder = yield this.getCurrentLanguageServerDirectory();
      let serverVersion;
      const shouldLookForNewVersion = yield this.shouldLookForNewLanguageServer(currentFolder);

      if (currentFolder && !shouldLookForNewVersion) {
        return path.basename(currentFolder.path);
      }

      serverVersion = yield this.getLatestLanguageServerVersion().catch(ex => undefined);

      if (currentFolder && (!serverVersion || serverVersion.version.compare(currentFolder.version) <= 0)) {
        return path.basename(currentFolder.path);
      }

      return `${languageServerFolder}.${serverVersion.version.raw}`;
    });
  }

  getLatestLanguageServerVersion() {
    const lsPackageService = this.serviceContainer.get(types_4.ILanguageServerPackageService);
    return lsPackageService.getLatestNugetPackageVersion();
  }

  shouldLookForNewLanguageServer(currentFolder) {
    return __awaiter(this, void 0, void 0, function* () {
      const configService = this.serviceContainer.get(types_2.IConfigurationService);
      const autoUpdateLanguageServer = configService.getSettings().autoUpdateLanguageServer;
      const downloadLanguageServer = configService.getSettings().downloadLanguageServer;

      if (currentFolder && (!autoUpdateLanguageServer || !downloadLanguageServer)) {
        return false;
      }

      const downloadChannel = this.getDownloadChannel();
      const rule = this.serviceContainer.get(types_4.IDownloadChannelRule, downloadChannel);
      return rule.shouldLookForNewLanguageServer(currentFolder);
    });
  }

  getCurrentLanguageServerDirectory() {
    return __awaiter(this, void 0, void 0, function* () {
      const configService = this.serviceContainer.get(types_2.IConfigurationService);

      if (!configService.getSettings().downloadLanguageServer) {
        return {
          path: languageServerFolder,
          version: new semver.SemVer('0.0.0')
        };
      }

      const dirs = yield this.getExistingLanguageServerDirectories();

      if (dirs.length === 0) {
        return;
      }

      dirs.sort((a, b) => a.version.compare(b.version));
      return dirs[dirs.length - 1];
    });
  }

  getExistingLanguageServerDirectories() {
    return __awaiter(this, void 0, void 0, function* () {
      const fs = this.serviceContainer.get(types_1.IFileSystem);
      const subDirs = yield fs.getSubDirectories(constants_1.EXTENSION_ROOT_DIR);
      return subDirs.filter(dir => path.basename(dir).startsWith(languageServerFolder)).map(dir => {
        return {
          path: dir,
          version: this.getFolderVersion(path.basename(dir))
        };
      });
    });
  }

  getFolderVersion(dirName) {
    const suffix = dirName.substring(languageServerFolder.length + 1);
    return suffix.length === 0 ? new semver.SemVer('0.0.0') : semver.parse(suffix, true) || new semver.SemVer('0.0.0');
  }

  getDownloadChannel() {
    const lsPackageService = this.serviceContainer.get(types_4.ILanguageServerPackageService);
    return lsPackageService.getLanguageServerDownloadChannel();
  }

};

__decorate([logger_1.traceVerbose('Get language server folder name')], LanguageServerFolderService.prototype, "getLanguageServerFolderName", null);

__decorate([logger_1.traceVerbose('Get latest version of Language Server')], LanguageServerFolderService.prototype, "getLatestLanguageServerVersion", null);

LanguageServerFolderService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_3.IServiceContainer))], LanguageServerFolderService);
exports.LanguageServerFolderService = LanguageServerFolderService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZS5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX3BhcmFtIiwicGFyYW1JbmRleCIsImRlY29yYXRvciIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJleHBvcnRzIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwicGF0aCIsInNlbXZlciIsImNvbnN0YW50c18xIiwibG9nZ2VyXzEiLCJ0eXBlc18xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJ0eXBlc180IiwibGFuZ3VhZ2VTZXJ2ZXJGb2xkZXIiLCJMYW5ndWFnZVNlcnZlckZvbGRlclNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJnZXRMYW5ndWFnZVNlcnZlckZvbGRlck5hbWUiLCJjdXJyZW50Rm9sZGVyIiwiZ2V0Q3VycmVudExhbmd1YWdlU2VydmVyRGlyZWN0b3J5Iiwic2VydmVyVmVyc2lvbiIsInNob3VsZExvb2tGb3JOZXdWZXJzaW9uIiwic2hvdWxkTG9va0Zvck5ld0xhbmd1YWdlU2VydmVyIiwiYmFzZW5hbWUiLCJnZXRMYXRlc3RMYW5ndWFnZVNlcnZlclZlcnNpb24iLCJjYXRjaCIsImV4IiwidW5kZWZpbmVkIiwidmVyc2lvbiIsImNvbXBhcmUiLCJyYXciLCJsc1BhY2thZ2VTZXJ2aWNlIiwiZ2V0IiwiSUxhbmd1YWdlU2VydmVyUGFja2FnZVNlcnZpY2UiLCJnZXRMYXRlc3ROdWdldFBhY2thZ2VWZXJzaW9uIiwiY29uZmlnU2VydmljZSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsImF1dG9VcGRhdGVMYW5ndWFnZVNlcnZlciIsImdldFNldHRpbmdzIiwiZG93bmxvYWRMYW5ndWFnZVNlcnZlciIsImRvd25sb2FkQ2hhbm5lbCIsImdldERvd25sb2FkQ2hhbm5lbCIsInJ1bGUiLCJJRG93bmxvYWRDaGFubmVsUnVsZSIsIlNlbVZlciIsImRpcnMiLCJnZXRFeGlzdGluZ0xhbmd1YWdlU2VydmVyRGlyZWN0b3JpZXMiLCJzb3J0IiwiYSIsImIiLCJmcyIsIklGaWxlU3lzdGVtIiwic3ViRGlycyIsImdldFN1YkRpcmVjdG9yaWVzIiwiRVhURU5TSU9OX1JPT1RfRElSIiwiZmlsdGVyIiwiZGlyIiwic3RhcnRzV2l0aCIsIm1hcCIsImdldEZvbGRlclZlcnNpb24iLCJkaXJOYW1lIiwic3VmZml4Iiwic3Vic3RyaW5nIiwicGFyc2UiLCJnZXRMYW5ndWFnZVNlcnZlckRvd25sb2FkQ2hhbm5lbCIsInRyYWNlVmVyYm9zZSIsInByb3RvdHlwZSIsImluamVjdGFibGUiLCJpbmplY3QiLCJJU2VydmljZUNvbnRhaW5lciJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFVBQVUsR0FBSSxVQUFRLFNBQUtBLFVBQWQsSUFBNkIsVUFBVUMsVUFBVixFQUFzQkMsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUNuRixNQUFJQyxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsTUFBbEI7QUFBQSxNQUEwQkMsQ0FBQyxHQUFHSCxDQUFDLEdBQUcsQ0FBSixHQUFRSCxNQUFSLEdBQWlCRSxJQUFJLEtBQUssSUFBVCxHQUFnQkEsSUFBSSxHQUFHSyxNQUFNLENBQUNDLHdCQUFQLENBQWdDUixNQUFoQyxFQUF3Q0MsR0FBeEMsQ0FBdkIsR0FBc0VDLElBQXJIO0FBQUEsTUFBMkhPLENBQTNIO0FBQ0EsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFFBQW5CLElBQStCLE9BQU9BLE9BQU8sQ0FBQ0MsUUFBZixLQUE0QixVQUEvRCxFQUEyRUwsQ0FBQyxHQUFHSSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJaLFVBQWpCLEVBQTZCQyxNQUE3QixFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLENBQUosQ0FBM0UsS0FDSyxLQUFLLElBQUlVLENBQUMsR0FBR2IsVUFBVSxDQUFDTSxNQUFYLEdBQW9CLENBQWpDLEVBQW9DTyxDQUFDLElBQUksQ0FBekMsRUFBNENBLENBQUMsRUFBN0MsRUFBaUQsSUFBSUgsQ0FBQyxHQUFHVixVQUFVLENBQUNhLENBQUQsQ0FBbEIsRUFBdUJOLENBQUMsR0FBRyxDQUFDSCxDQUFDLEdBQUcsQ0FBSixHQUFRTSxDQUFDLENBQUNILENBQUQsQ0FBVCxHQUFlSCxDQUFDLEdBQUcsQ0FBSixHQUFRTSxDQUFDLENBQUNULE1BQUQsRUFBU0MsR0FBVCxFQUFjSyxDQUFkLENBQVQsR0FBNEJHLENBQUMsQ0FBQ1QsTUFBRCxFQUFTQyxHQUFULENBQTdDLEtBQStESyxDQUFuRTtBQUM3RSxTQUFPSCxDQUFDLEdBQUcsQ0FBSixJQUFTRyxDQUFULElBQWNDLE1BQU0sQ0FBQ00sY0FBUCxDQUFzQmIsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DSyxDQUFuQyxDQUFkLEVBQXFEQSxDQUE1RDtBQUNILENBTEQ7O0FBTUEsSUFBSVEsT0FBTyxHQUFJLFVBQVEsU0FBS0EsT0FBZCxJQUEwQixVQUFVQyxVQUFWLEVBQXNCQyxTQUF0QixFQUFpQztBQUNyRSxTQUFPLFVBQVVoQixNQUFWLEVBQWtCQyxHQUFsQixFQUF1QjtBQUFFZSxJQUFBQSxTQUFTLENBQUNoQixNQUFELEVBQVNDLEdBQVQsRUFBY2MsVUFBZCxDQUFUO0FBQXFDLEdBQXJFO0FBQ0gsQ0FGRDs7QUFHQSxJQUFJRSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFyQixHQUFzQyxJQUFJTixDQUFKLENBQU0sVUFBVUcsT0FBVixFQUFtQjtBQUFFQSxRQUFBQSxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFQO0FBQXdCLE9BQW5ELEVBQXFETyxJQUFyRCxDQUEwRFIsU0FBMUQsRUFBcUVLLFFBQXJFLENBQXRDO0FBQXVIOztBQUMvSUgsSUFBQUEsSUFBSSxDQUFDLENBQUNOLFNBQVMsR0FBR0EsU0FBUyxDQUFDYSxLQUFWLENBQWdCaEIsT0FBaEIsRUFBeUJDLFVBQVUsSUFBSSxFQUF2QyxDQUFiLEVBQXlEUyxJQUF6RCxFQUFELENBQUo7QUFDSCxHQUxNLENBQVA7QUFNSCxDQVBEOztBQVFBckIsTUFBTSxDQUFDTSxjQUFQLENBQXNCc0IsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRVQsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7O0FBQ0EsTUFBTVUsV0FBVyxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUEzQjs7QUFDQSxNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1FLE1BQU0sR0FBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBQ0EsTUFBTUcsV0FBVyxHQUFHSCxPQUFPLENBQUMsd0JBQUQsQ0FBM0I7O0FBQ0EsTUFBTUksUUFBUSxHQUFHSixPQUFPLENBQUMscUJBQUQsQ0FBeEI7O0FBQ0EsTUFBTUssT0FBTyxHQUFHTCxPQUFPLENBQUMsNkJBQUQsQ0FBdkI7O0FBQ0EsTUFBTU0sT0FBTyxHQUFHTixPQUFPLENBQUMsb0JBQUQsQ0FBdkI7O0FBQ0EsTUFBTU8sT0FBTyxHQUFHUCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBQ0EsTUFBTVEsT0FBTyxHQUFHUixPQUFPLENBQUMsVUFBRCxDQUF2Qjs7QUFDQSxNQUFNUyxvQkFBb0IsR0FBRyxnQkFBN0I7QUFDQSxJQUFJQywyQkFBMkIsR0FBRyxNQUFNQSwyQkFBTixDQUFrQztBQUNoRUMsRUFBQUEsV0FBVyxDQUFDQyxnQkFBRCxFQUFtQjtBQUMxQixTQUFLQSxnQkFBTCxHQUF3QkEsZ0JBQXhCO0FBQ0g7O0FBQ0RDLEVBQUFBLDJCQUEyQixHQUFHO0FBQzFCLFdBQU9qQyxTQUFTLENBQUMsSUFBRCxFQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUNoRCxZQUFNa0MsYUFBYSxHQUFHLE1BQU0sS0FBS0MsaUNBQUwsRUFBNUI7QUFDQSxVQUFJQyxhQUFKO0FBQ0EsWUFBTUMsdUJBQXVCLEdBQUcsTUFBTSxLQUFLQyw4QkFBTCxDQUFvQ0osYUFBcEMsQ0FBdEM7O0FBQ0EsVUFBSUEsYUFBYSxJQUFJLENBQUNHLHVCQUF0QixFQUErQztBQUMzQyxlQUFPaEIsSUFBSSxDQUFDa0IsUUFBTCxDQUFjTCxhQUFhLENBQUNiLElBQTVCLENBQVA7QUFDSDs7QUFDRGUsTUFBQUEsYUFBYSxHQUFHLE1BQU0sS0FBS0ksOEJBQUwsR0FDakJDLEtBRGlCLENBQ1hDLEVBQUUsSUFBSUMsU0FESyxDQUF0Qjs7QUFFQSxVQUFJVCxhQUFhLEtBQUssQ0FBQ0UsYUFBRCxJQUFrQkEsYUFBYSxDQUFDUSxPQUFkLENBQXNCQyxPQUF0QixDQUE4QlgsYUFBYSxDQUFDVSxPQUE1QyxLQUF3RCxDQUEvRSxDQUFqQixFQUFvRztBQUNoRyxlQUFPdkIsSUFBSSxDQUFDa0IsUUFBTCxDQUFjTCxhQUFhLENBQUNiLElBQTVCLENBQVA7QUFDSDs7QUFDRCxhQUFRLEdBQUVRLG9CQUFxQixJQUFHTyxhQUFhLENBQUNRLE9BQWQsQ0FBc0JFLEdBQUksRUFBNUQ7QUFDSCxLQWJlLENBQWhCO0FBY0g7O0FBQ0ROLEVBQUFBLDhCQUE4QixHQUFHO0FBQzdCLFVBQU1PLGdCQUFnQixHQUFHLEtBQUtmLGdCQUFMLENBQXNCZ0IsR0FBdEIsQ0FBMEJwQixPQUFPLENBQUNxQiw2QkFBbEMsQ0FBekI7QUFDQSxXQUFPRixnQkFBZ0IsQ0FBQ0csNEJBQWpCLEVBQVA7QUFDSDs7QUFDRFosRUFBQUEsOEJBQThCLENBQUNKLGFBQUQsRUFBZ0I7QUFDMUMsV0FBT2xDLFNBQVMsQ0FBQyxJQUFELEVBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ2hELFlBQU1tRCxhQUFhLEdBQUcsS0FBS25CLGdCQUFMLENBQXNCZ0IsR0FBdEIsQ0FBMEJ0QixPQUFPLENBQUMwQixxQkFBbEMsQ0FBdEI7QUFDQSxZQUFNQyx3QkFBd0IsR0FBR0YsYUFBYSxDQUFDRyxXQUFkLEdBQTRCRCx3QkFBN0Q7QUFDQSxZQUFNRSxzQkFBc0IsR0FBR0osYUFBYSxDQUFDRyxXQUFkLEdBQTRCQyxzQkFBM0Q7O0FBQ0EsVUFBSXJCLGFBQWEsS0FBSyxDQUFDbUIsd0JBQUQsSUFBNkIsQ0FBQ0Usc0JBQW5DLENBQWpCLEVBQTZFO0FBQ3pFLGVBQU8sS0FBUDtBQUNIOztBQUNELFlBQU1DLGVBQWUsR0FBRyxLQUFLQyxrQkFBTCxFQUF4QjtBQUNBLFlBQU1DLElBQUksR0FBRyxLQUFLMUIsZ0JBQUwsQ0FBc0JnQixHQUF0QixDQUEwQnBCLE9BQU8sQ0FBQytCLG9CQUFsQyxFQUF3REgsZUFBeEQsQ0FBYjtBQUNBLGFBQU9FLElBQUksQ0FBQ3BCLDhCQUFMLENBQW9DSixhQUFwQyxDQUFQO0FBQ0gsS0FWZSxDQUFoQjtBQVdIOztBQUNEQyxFQUFBQSxpQ0FBaUMsR0FBRztBQUNoQyxXQUFPbkMsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEQsWUFBTW1ELGFBQWEsR0FBRyxLQUFLbkIsZ0JBQUwsQ0FBc0JnQixHQUF0QixDQUEwQnRCLE9BQU8sQ0FBQzBCLHFCQUFsQyxDQUF0Qjs7QUFDQSxVQUFJLENBQUNELGFBQWEsQ0FBQ0csV0FBZCxHQUE0QkMsc0JBQWpDLEVBQXlEO0FBQ3JELGVBQU87QUFBRWxDLFVBQUFBLElBQUksRUFBRVEsb0JBQVI7QUFBOEJlLFVBQUFBLE9BQU8sRUFBRSxJQUFJdEIsTUFBTSxDQUFDc0MsTUFBWCxDQUFrQixPQUFsQjtBQUF2QyxTQUFQO0FBQ0g7O0FBQ0QsWUFBTUMsSUFBSSxHQUFHLE1BQU0sS0FBS0Msb0NBQUwsRUFBbkI7O0FBQ0EsVUFBSUQsSUFBSSxDQUFDekUsTUFBTCxLQUFnQixDQUFwQixFQUF1QjtBQUNuQjtBQUNIOztBQUNEeUUsTUFBQUEsSUFBSSxDQUFDRSxJQUFMLENBQVUsQ0FBQ0MsQ0FBRCxFQUFJQyxDQUFKLEtBQVVELENBQUMsQ0FBQ3BCLE9BQUYsQ0FBVUMsT0FBVixDQUFrQm9CLENBQUMsQ0FBQ3JCLE9BQXBCLENBQXBCO0FBQ0EsYUFBT2lCLElBQUksQ0FBQ0EsSUFBSSxDQUFDekUsTUFBTCxHQUFjLENBQWYsQ0FBWDtBQUNILEtBWGUsQ0FBaEI7QUFZSDs7QUFDRDBFLEVBQUFBLG9DQUFvQyxHQUFHO0FBQ25DLFdBQU85RCxTQUFTLENBQUMsSUFBRCxFQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUNoRCxZQUFNa0UsRUFBRSxHQUFHLEtBQUtsQyxnQkFBTCxDQUFzQmdCLEdBQXRCLENBQTBCdkIsT0FBTyxDQUFDMEMsV0FBbEMsQ0FBWDtBQUNBLFlBQU1DLE9BQU8sR0FBRyxNQUFNRixFQUFFLENBQUNHLGlCQUFILENBQXFCOUMsV0FBVyxDQUFDK0Msa0JBQWpDLENBQXRCO0FBQ0EsYUFBT0YsT0FBTyxDQUNURyxNQURFLENBQ0tDLEdBQUcsSUFBSW5ELElBQUksQ0FBQ2tCLFFBQUwsQ0FBY2lDLEdBQWQsRUFBbUJDLFVBQW5CLENBQThCNUMsb0JBQTlCLENBRFosRUFFRjZDLEdBRkUsQ0FFRUYsR0FBRyxJQUFJO0FBQUUsZUFBTztBQUFFbkQsVUFBQUEsSUFBSSxFQUFFbUQsR0FBUjtBQUFhNUIsVUFBQUEsT0FBTyxFQUFFLEtBQUsrQixnQkFBTCxDQUFzQnRELElBQUksQ0FBQ2tCLFFBQUwsQ0FBY2lDLEdBQWQsQ0FBdEI7QUFBdEIsU0FBUDtBQUEyRSxPQUZ0RixDQUFQO0FBR0gsS0FOZSxDQUFoQjtBQU9IOztBQUNERyxFQUFBQSxnQkFBZ0IsQ0FBQ0MsT0FBRCxFQUFVO0FBQ3RCLFVBQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDRSxTQUFSLENBQWtCakQsb0JBQW9CLENBQUN6QyxNQUFyQixHQUE4QixDQUFoRCxDQUFmO0FBQ0EsV0FBT3lGLE1BQU0sQ0FBQ3pGLE1BQVAsS0FBa0IsQ0FBbEIsR0FBc0IsSUFBSWtDLE1BQU0sQ0FBQ3NDLE1BQVgsQ0FBa0IsT0FBbEIsQ0FBdEIsR0FBb0R0QyxNQUFNLENBQUN5RCxLQUFQLENBQWFGLE1BQWIsRUFBcUIsSUFBckIsS0FBOEIsSUFBSXZELE1BQU0sQ0FBQ3NDLE1BQVgsQ0FBa0IsT0FBbEIsQ0FBekY7QUFDSDs7QUFDREgsRUFBQUEsa0JBQWtCLEdBQUc7QUFDakIsVUFBTVYsZ0JBQWdCLEdBQUcsS0FBS2YsZ0JBQUwsQ0FBc0JnQixHQUF0QixDQUEwQnBCLE9BQU8sQ0FBQ3FCLDZCQUFsQyxDQUF6QjtBQUNBLFdBQU9GLGdCQUFnQixDQUFDaUMsZ0NBQWpCLEVBQVA7QUFDSDs7QUFuRStELENBQXBFOztBQXFFQW5HLFVBQVUsQ0FBQyxDQUNQMkMsUUFBUSxDQUFDeUQsWUFBVCxDQUFzQixpQ0FBdEIsQ0FETyxDQUFELEVBRVBuRCwyQkFBMkIsQ0FBQ29ELFNBRnJCLEVBRWdDLDZCQUZoQyxFQUUrRCxJQUYvRCxDQUFWOztBQUdBckcsVUFBVSxDQUFDLENBQ1AyQyxRQUFRLENBQUN5RCxZQUFULENBQXNCLHVDQUF0QixDQURPLENBQUQsRUFFUG5ELDJCQUEyQixDQUFDb0QsU0FGckIsRUFFZ0MsZ0NBRmhDLEVBRWtFLElBRmxFLENBQVY7O0FBR0FwRCwyQkFBMkIsR0FBR2pELFVBQVUsQ0FBQyxDQUNyQ3NDLFdBQVcsQ0FBQ2dFLFVBQVosRUFEcUMsRUFFckN0RixPQUFPLENBQUMsQ0FBRCxFQUFJc0IsV0FBVyxDQUFDaUUsTUFBWixDQUFtQnpELE9BQU8sQ0FBQzBELGlCQUEzQixDQUFKLENBRjhCLENBQUQsRUFHckN2RCwyQkFIcUMsQ0FBeEM7QUFJQVosT0FBTyxDQUFDWSwyQkFBUixHQUFzQ0EsMkJBQXRDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn07XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHNlbXZlciA9IHJlcXVpcmUoXCJzZW12ZXJcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IGxvZ2dlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9sb2dnZXJcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL3BsYXRmb3JtL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMyA9IHJlcXVpcmUoXCIuLi8uLi9pb2MvdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vdHlwZXNcIik7XHJcbmNvbnN0IGxhbmd1YWdlU2VydmVyRm9sZGVyID0gJ2xhbmd1YWdlU2VydmVyJztcclxubGV0IExhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSA9IGNsYXNzIExhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlQ29udGFpbmVyID0gc2VydmljZUNvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIGdldExhbmd1YWdlU2VydmVyRm9sZGVyTmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Rm9sZGVyID0geWllbGQgdGhpcy5nZXRDdXJyZW50TGFuZ3VhZ2VTZXJ2ZXJEaXJlY3RvcnkoKTtcclxuICAgICAgICAgICAgbGV0IHNlcnZlclZlcnNpb247XHJcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZExvb2tGb3JOZXdWZXJzaW9uID0geWllbGQgdGhpcy5zaG91bGRMb29rRm9yTmV3TGFuZ3VhZ2VTZXJ2ZXIoY3VycmVudEZvbGRlcik7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Rm9sZGVyICYmICFzaG91bGRMb29rRm9yTmV3VmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhdGguYmFzZW5hbWUoY3VycmVudEZvbGRlci5wYXRoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXJ2ZXJWZXJzaW9uID0geWllbGQgdGhpcy5nZXRMYXRlc3RMYW5ndWFnZVNlcnZlclZlcnNpb24oKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4ID0+IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Rm9sZGVyICYmICghc2VydmVyVmVyc2lvbiB8fCBzZXJ2ZXJWZXJzaW9uLnZlcnNpb24uY29tcGFyZShjdXJyZW50Rm9sZGVyLnZlcnNpb24pIDw9IDApKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aC5iYXNlbmFtZShjdXJyZW50Rm9sZGVyLnBhdGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBgJHtsYW5ndWFnZVNlcnZlckZvbGRlcn0uJHtzZXJ2ZXJWZXJzaW9uLnZlcnNpb24ucmF3fWA7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRMYXRlc3RMYW5ndWFnZVNlcnZlclZlcnNpb24oKSB7XHJcbiAgICAgICAgY29uc3QgbHNQYWNrYWdlU2VydmljZSA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfNC5JTGFuZ3VhZ2VTZXJ2ZXJQYWNrYWdlU2VydmljZSk7XHJcbiAgICAgICAgcmV0dXJuIGxzUGFja2FnZVNlcnZpY2UuZ2V0TGF0ZXN0TnVnZXRQYWNrYWdlVmVyc2lvbigpO1xyXG4gICAgfVxyXG4gICAgc2hvdWxkTG9va0Zvck5ld0xhbmd1YWdlU2VydmVyKGN1cnJlbnRGb2xkZXIpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb25maWdTZXJ2aWNlID0gdGhpcy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklDb25maWd1cmF0aW9uU2VydmljZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGF1dG9VcGRhdGVMYW5ndWFnZVNlcnZlciA9IGNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MoKS5hdXRvVXBkYXRlTGFuZ3VhZ2VTZXJ2ZXI7XHJcbiAgICAgICAgICAgIGNvbnN0IGRvd25sb2FkTGFuZ3VhZ2VTZXJ2ZXIgPSBjb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKCkuZG93bmxvYWRMYW5ndWFnZVNlcnZlcjtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRGb2xkZXIgJiYgKCFhdXRvVXBkYXRlTGFuZ3VhZ2VTZXJ2ZXIgfHwgIWRvd25sb2FkTGFuZ3VhZ2VTZXJ2ZXIpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZG93bmxvYWRDaGFubmVsID0gdGhpcy5nZXREb3dubG9hZENoYW5uZWwoKTtcclxuICAgICAgICAgICAgY29uc3QgcnVsZSA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfNC5JRG93bmxvYWRDaGFubmVsUnVsZSwgZG93bmxvYWRDaGFubmVsKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJ1bGUuc2hvdWxkTG9va0Zvck5ld0xhbmd1YWdlU2VydmVyKGN1cnJlbnRGb2xkZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZ2V0Q3VycmVudExhbmd1YWdlU2VydmVyRGlyZWN0b3J5KCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1NlcnZpY2UgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzIuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlKTtcclxuICAgICAgICAgICAgaWYgKCFjb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKCkuZG93bmxvYWRMYW5ndWFnZVNlcnZlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgcGF0aDogbGFuZ3VhZ2VTZXJ2ZXJGb2xkZXIsIHZlcnNpb246IG5ldyBzZW12ZXIuU2VtVmVyKCcwLjAuMCcpIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZGlycyA9IHlpZWxkIHRoaXMuZ2V0RXhpc3RpbmdMYW5ndWFnZVNlcnZlckRpcmVjdG9yaWVzKCk7XHJcbiAgICAgICAgICAgIGlmIChkaXJzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRpcnMuc29ydCgoYSwgYikgPT4gYS52ZXJzaW9uLmNvbXBhcmUoYi52ZXJzaW9uKSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkaXJzW2RpcnMubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBnZXRFeGlzdGluZ0xhbmd1YWdlU2VydmVyRGlyZWN0b3JpZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgZnMgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSUZpbGVTeXN0ZW0pO1xyXG4gICAgICAgICAgICBjb25zdCBzdWJEaXJzID0geWllbGQgZnMuZ2V0U3ViRGlyZWN0b3JpZXMoY29uc3RhbnRzXzEuRVhURU5TSU9OX1JPT1RfRElSKTtcclxuICAgICAgICAgICAgcmV0dXJuIHN1YkRpcnNcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoZGlyID0+IHBhdGguYmFzZW5hbWUoZGlyKS5zdGFydHNXaXRoKGxhbmd1YWdlU2VydmVyRm9sZGVyKSlcclxuICAgICAgICAgICAgICAgIC5tYXAoZGlyID0+IHsgcmV0dXJuIHsgcGF0aDogZGlyLCB2ZXJzaW9uOiB0aGlzLmdldEZvbGRlclZlcnNpb24ocGF0aC5iYXNlbmFtZShkaXIpKSB9OyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGdldEZvbGRlclZlcnNpb24oZGlyTmFtZSkge1xyXG4gICAgICAgIGNvbnN0IHN1ZmZpeCA9IGRpck5hbWUuc3Vic3RyaW5nKGxhbmd1YWdlU2VydmVyRm9sZGVyLmxlbmd0aCArIDEpO1xyXG4gICAgICAgIHJldHVybiBzdWZmaXgubGVuZ3RoID09PSAwID8gbmV3IHNlbXZlci5TZW1WZXIoJzAuMC4wJykgOiAoc2VtdmVyLnBhcnNlKHN1ZmZpeCwgdHJ1ZSkgfHwgbmV3IHNlbXZlci5TZW1WZXIoJzAuMC4wJykpO1xyXG4gICAgfVxyXG4gICAgZ2V0RG93bmxvYWRDaGFubmVsKCkge1xyXG4gICAgICAgIGNvbnN0IGxzUGFja2FnZVNlcnZpY2UgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzQuSUxhbmd1YWdlU2VydmVyUGFja2FnZVNlcnZpY2UpO1xyXG4gICAgICAgIHJldHVybiBsc1BhY2thZ2VTZXJ2aWNlLmdldExhbmd1YWdlU2VydmVyRG93bmxvYWRDaGFubmVsKCk7XHJcbiAgICB9XHJcbn07XHJcbl9fZGVjb3JhdGUoW1xyXG4gICAgbG9nZ2VyXzEudHJhY2VWZXJib3NlKCdHZXQgbGFuZ3VhZ2Ugc2VydmVyIGZvbGRlciBuYW1lJylcclxuXSwgTGFuZ3VhZ2VTZXJ2ZXJGb2xkZXJTZXJ2aWNlLnByb3RvdHlwZSwgXCJnZXRMYW5ndWFnZVNlcnZlckZvbGRlck5hbWVcIiwgbnVsbCk7XHJcbl9fZGVjb3JhdGUoW1xyXG4gICAgbG9nZ2VyXzEudHJhY2VWZXJib3NlKCdHZXQgbGF0ZXN0IHZlcnNpb24gb2YgTGFuZ3VhZ2UgU2VydmVyJylcclxuXSwgTGFuZ3VhZ2VTZXJ2ZXJGb2xkZXJTZXJ2aWNlLnByb3RvdHlwZSwgXCJnZXRMYXRlc3RMYW5ndWFnZVNlcnZlclZlcnNpb25cIiwgbnVsbCk7XHJcbkxhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxyXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMy5JU2VydmljZUNvbnRhaW5lcikpXHJcbl0sIExhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSk7XHJcbmV4cG9ydHMuTGFuZ3VhZ2VTZXJ2ZXJGb2xkZXJTZXJ2aWNlID0gTGFuZ3VhZ2VTZXJ2ZXJGb2xkZXJTZXJ2aWNlO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYW5ndWFnZVNlcnZlckZvbGRlclNlcnZpY2UuanMubWFwIl19