// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const types_1 = require("../../../common/platform/types");

const types_2 = require("../../../ioc/types");

const telemetry_1 = require("../../../telemetry");

const constants_1 = require("../../../telemetry/constants");

const types_3 = require("../../types");

const baseProvider_1 = require("./baseProvider");

const types_4 = require("./types");

let PythonV2DebugConfigurationProvider = class PythonV2DebugConfigurationProvider extends baseProvider_1.BaseConfigurationProvider {
  constructor(serviceContainer) {
    super('python', serviceContainer);
  }

  provideLaunchDefaults(workspaceFolder, debugConfiguration) {
    const _super = name => super[name];

    return __awaiter(this, void 0, void 0, function* () {
      yield _super("provideLaunchDefaults").call(this, workspaceFolder, debugConfiguration);
      const debugOptions = debugConfiguration.debugOptions;

      if (debugConfiguration.debugStdLib) {
        this.debugOption(debugOptions, types_3.DebugOptions.DebugStdLib);
      }

      if (debugConfiguration.stopOnEntry) {
        this.debugOption(debugOptions, types_3.DebugOptions.StopOnEntry);
      }

      if (debugConfiguration.showReturnValue) {
        this.debugOption(debugOptions, types_3.DebugOptions.ShowReturnValue);
      }

      if (debugConfiguration.django) {
        this.debugOption(debugOptions, types_3.DebugOptions.Django);
      }

      if (debugConfiguration.jinja) {
        this.debugOption(debugOptions, types_3.DebugOptions.Jinja);
      }

      if (debugConfiguration.redirectOutput || debugConfiguration.redirectOutput === undefined) {
        this.debugOption(debugOptions, types_3.DebugOptions.RedirectOutput);
      }

      if (debugConfiguration.sudo) {
        this.debugOption(debugOptions, types_3.DebugOptions.Sudo);
      }

      if (debugConfiguration.subProcess === true) {
        this.debugOption(debugOptions, types_3.DebugOptions.SubProcess);
      }

      if (this.serviceContainer.get(types_1.IPlatformService).isWindows) {
        this.debugOption(debugOptions, types_3.DebugOptions.FixFilePathCase);
      }

      const isFlask = this.isDebuggingFlask(debugConfiguration);

      if ((debugConfiguration.pyramid || isFlask) && debugOptions.indexOf(types_3.DebugOptions.Jinja) === -1 && debugConfiguration.jinja !== false) {
        this.debugOption(debugOptions, types_3.DebugOptions.Jinja);
      }

      if (debugConfiguration.pyramid) {
        const utils = this.serviceContainer.get(types_4.IConfigurationProviderUtils);
        debugConfiguration.program = yield utils.getPyramidStartupScriptFilePath(workspaceFolder);
      }

      this.sendTelemetry('launch', debugConfiguration);
    });
  } // tslint:disable-next-line:cyclomatic-complexity


  provideAttachDefaults(workspaceFolder, debugConfiguration) {
    const _super = name => super[name];

    return __awaiter(this, void 0, void 0, function* () {
      yield _super("provideAttachDefaults").call(this, workspaceFolder, debugConfiguration);
      const debugOptions = debugConfiguration.debugOptions;

      if (debugConfiguration.debugStdLib) {
        this.debugOption(debugOptions, types_3.DebugOptions.DebugStdLib);
      }

      if (debugConfiguration.django) {
        this.debugOption(debugOptions, types_3.DebugOptions.Django);
      }

      if (debugConfiguration.jinja) {
        this.debugOption(debugOptions, types_3.DebugOptions.Jinja);
      }

      if (debugConfiguration.subProcess === true) {
        this.debugOption(debugOptions, types_3.DebugOptions.SubProcess);
      }

      if (debugConfiguration.pyramid && debugOptions.indexOf(types_3.DebugOptions.Jinja) === -1 && debugConfiguration.jinja !== false) {
        this.debugOption(debugOptions, types_3.DebugOptions.Jinja);
      }

      if (debugConfiguration.redirectOutput || debugConfiguration.redirectOutput === undefined) {
        this.debugOption(debugOptions, types_3.DebugOptions.RedirectOutput);
      } // We'll need paths to be fixed only in the case where local and remote hosts are the same
      // I.e. only if hostName === 'localhost' or '127.0.0.1' or ''


      const isLocalHost = this.isLocalHost(debugConfiguration.host);

      if (this.serviceContainer.get(types_1.IPlatformService).isWindows && isLocalHost) {
        this.debugOption(debugOptions, types_3.DebugOptions.FixFilePathCase);
      }

      if (this.serviceContainer.get(types_1.IPlatformService).isWindows) {
        this.debugOption(debugOptions, types_3.DebugOptions.WindowsClient);
      } else {
        this.debugOption(debugOptions, types_3.DebugOptions.UnixClient);
      }

      if (!debugConfiguration.pathMappings) {
        debugConfiguration.pathMappings = [];
      } // This is for backwards compatibility.


      if (debugConfiguration.localRoot && debugConfiguration.remoteRoot) {
        debugConfiguration.pathMappings.push({
          localRoot: debugConfiguration.localRoot,
          remoteRoot: debugConfiguration.remoteRoot
        });
      } // If attaching to local host, then always map local root and remote roots.


      if (workspaceFolder && debugConfiguration.host && debugConfiguration.pathMappings.length === 0 && ['LOCALHOST', '127.0.0.1', '::1'].indexOf(debugConfiguration.host.toUpperCase()) >= 0) {
        debugConfiguration.pathMappings.push({
          localRoot: workspaceFolder.fsPath,
          remoteRoot: workspaceFolder.fsPath
        });
      }

      this.sendTelemetry('attach', debugConfiguration);
    });
  }

  debugOption(debugOptions, debugOption) {
    if (debugOptions.indexOf(debugOption) >= 0) {
      return;
    }

    debugOptions.push(debugOption);
  }

  isLocalHost(hostName) {
    const LocalHosts = ['localhost', '127.0.0.1', '::1'];
    return hostName && LocalHosts.indexOf(hostName.toLowerCase()) >= 0 ? true : false;
  }

  isDebuggingFlask(debugConfiguration) {
    return debugConfiguration.module && debugConfiguration.module.toUpperCase() === 'FLASK' ? true : false;
  }

  sendTelemetry(trigger, debugConfiguration) {
    const telemetryProps = {
      trigger,
      console: debugConfiguration.console,
      hasEnvVars: typeof debugConfiguration.env === 'object' && Object.keys(debugConfiguration.env).length > 0,
      django: !!debugConfiguration.django,
      flask: this.isDebuggingFlask(debugConfiguration),
      hasArgs: Array.isArray(debugConfiguration.args) && debugConfiguration.args.length > 0,
      isLocalhost: this.isLocalHost(debugConfiguration.host),
      isModule: typeof debugConfiguration.module === 'string' && debugConfiguration.module.length > 0,
      isSudo: !!debugConfiguration.sudo,
      jinja: !!debugConfiguration.jinja,
      pyramid: !!debugConfiguration.pyramid,
      stopOnEntry: !!debugConfiguration.stopOnEntry,
      showReturnValue: !!debugConfiguration.showReturnValue,
      subProcess: !!debugConfiguration.subProcess
    };
    telemetry_1.sendTelemetryEvent(constants_1.DEBUGGER, undefined, telemetryProps);
  }

};
PythonV2DebugConfigurationProvider = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], PythonV2DebugConfigurationProvider);
exports.PythonV2DebugConfigurationProvider = PythonV2DebugConfigurationProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5dGhvblYyUHJvdmlkZXIuanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInR5cGVzXzEiLCJ0eXBlc18yIiwidGVsZW1ldHJ5XzEiLCJjb25zdGFudHNfMSIsInR5cGVzXzMiLCJiYXNlUHJvdmlkZXJfMSIsInR5cGVzXzQiLCJQeXRob25WMkRlYnVnQ29uZmlndXJhdGlvblByb3ZpZGVyIiwiQmFzZUNvbmZpZ3VyYXRpb25Qcm92aWRlciIsImNvbnN0cnVjdG9yIiwic2VydmljZUNvbnRhaW5lciIsInByb3ZpZGVMYXVuY2hEZWZhdWx0cyIsIndvcmtzcGFjZUZvbGRlciIsImRlYnVnQ29uZmlndXJhdGlvbiIsIl9zdXBlciIsIm5hbWUiLCJjYWxsIiwiZGVidWdPcHRpb25zIiwiZGVidWdTdGRMaWIiLCJkZWJ1Z09wdGlvbiIsIkRlYnVnT3B0aW9ucyIsIkRlYnVnU3RkTGliIiwic3RvcE9uRW50cnkiLCJTdG9wT25FbnRyeSIsInNob3dSZXR1cm5WYWx1ZSIsIlNob3dSZXR1cm5WYWx1ZSIsImRqYW5nbyIsIkRqYW5nbyIsImppbmphIiwiSmluamEiLCJyZWRpcmVjdE91dHB1dCIsInVuZGVmaW5lZCIsIlJlZGlyZWN0T3V0cHV0Iiwic3VkbyIsIlN1ZG8iLCJzdWJQcm9jZXNzIiwiU3ViUHJvY2VzcyIsImdldCIsIklQbGF0Zm9ybVNlcnZpY2UiLCJpc1dpbmRvd3MiLCJGaXhGaWxlUGF0aENhc2UiLCJpc0ZsYXNrIiwiaXNEZWJ1Z2dpbmdGbGFzayIsInB5cmFtaWQiLCJpbmRleE9mIiwidXRpbHMiLCJJQ29uZmlndXJhdGlvblByb3ZpZGVyVXRpbHMiLCJwcm9ncmFtIiwiZ2V0UHlyYW1pZFN0YXJ0dXBTY3JpcHRGaWxlUGF0aCIsInNlbmRUZWxlbWV0cnkiLCJwcm92aWRlQXR0YWNoRGVmYXVsdHMiLCJpc0xvY2FsSG9zdCIsImhvc3QiLCJXaW5kb3dzQ2xpZW50IiwiVW5peENsaWVudCIsInBhdGhNYXBwaW5ncyIsImxvY2FsUm9vdCIsInJlbW90ZVJvb3QiLCJwdXNoIiwidG9VcHBlckNhc2UiLCJmc1BhdGgiLCJob3N0TmFtZSIsIkxvY2FsSG9zdHMiLCJ0b0xvd2VyQ2FzZSIsIm1vZHVsZSIsInRyaWdnZXIiLCJ0ZWxlbWV0cnlQcm9wcyIsImNvbnNvbGUiLCJoYXNFbnZWYXJzIiwiZW52Iiwia2V5cyIsImZsYXNrIiwiaGFzQXJncyIsIkFycmF5IiwiaXNBcnJheSIsImFyZ3MiLCJpc0xvY2FsaG9zdCIsImlzTW9kdWxlIiwiaXNTdWRvIiwic2VuZFRlbGVtZXRyeUV2ZW50IiwiREVCVUdHRVIiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiSVNlcnZpY2VDb250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxVQUFVLEdBQUksVUFBUSxTQUFLQSxVQUFkLElBQTZCLFVBQVVDLFVBQVYsRUFBc0JDLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUM7QUFDbkYsTUFBSUMsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWxCO0FBQUEsTUFBMEJDLENBQUMsR0FBR0gsQ0FBQyxHQUFHLENBQUosR0FBUUgsTUFBUixHQUFpQkUs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LEVBQUUsQ0FBQyxDQUFDakUsa0JBQWtCLENBQUNvQixJQVRWO0FBVW5CTCxNQUFBQSxLQUFLLEVBQUUsQ0FBQyxDQUFDZixrQkFBa0IsQ0FBQ2UsS0FWVDtBQVduQmUsTUFBQUEsT0FBTyxFQUFFLENBQUMsQ0FBQzlCLGtCQUFrQixDQUFDOEIsT0FYWDtBQVluQnJCLE1BQUFBLFdBQVcsRUFBRSxDQUFDLENBQUNULGtCQUFrQixDQUFDUyxXQVpmO0FBYW5CRSxNQUFBQSxlQUFlLEVBQUUsQ0FBQyxDQUFDWCxrQkFBa0IsQ0FBQ1csZUFibkI7QUFjbkJXLE1BQUFBLFVBQVUsRUFBRSxDQUFDLENBQUN0QixrQkFBa0IsQ0FBQ3NCO0FBZGQsS0FBdkI7QUFnQkFqQyxJQUFBQSxXQUFXLENBQUM2RSxrQkFBWixDQUErQjVFLFdBQVcsQ0FBQzZFLFFBQTNDLEVBQXFEakQsU0FBckQsRUFBZ0VtQyxjQUFoRTtBQUNIOztBQTVJOEgsQ0FBbkk7QUE4SUEzRCxrQ0FBa0MsR0FBRy9DLFVBQVUsQ0FBQyxDQUM1Q3NDLFdBQVcsQ0FBQ21GLFVBQVosRUFENEMsRUFFNUN6RyxPQUFPLENBQUMsQ0FBRCxFQUFJc0IsV0FBVyxDQUFDb0YsTUFBWixDQUFtQmpGLE9BQU8sQ0FBQ2tGLGlCQUEzQixDQUFKLENBRnFDLENBQUQsRUFHNUM1RSxrQ0FINEMsQ0FBL0M7QUFJQVYsT0FBTyxDQUFDVSxrQ0FBUixHQUE2Q0Esa0NBQTdDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59O1xyXG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn07XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbW1vbi9wbGF0Zm9ybS90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi8uLi9pb2MvdHlwZXNcIik7XHJcbmNvbnN0IHRlbGVtZXRyeV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL3RlbGVtZXRyeVwiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vdGVsZW1ldHJ5L2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMyA9IHJlcXVpcmUoXCIuLi8uLi90eXBlc1wiKTtcclxuY29uc3QgYmFzZVByb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi9iYXNlUHJvdmlkZXJcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi90eXBlc1wiKTtcclxubGV0IFB5dGhvblYyRGVidWdDb25maWd1cmF0aW9uUHJvdmlkZXIgPSBjbGFzcyBQeXRob25WMkRlYnVnQ29uZmlndXJhdGlvblByb3ZpZGVyIGV4dGVuZHMgYmFzZVByb3ZpZGVyXzEuQmFzZUNvbmZpZ3VyYXRpb25Qcm92aWRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgc3VwZXIoJ3B5dGhvbicsIHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgfVxyXG4gICAgcHJvdmlkZUxhdW5jaERlZmF1bHRzKHdvcmtzcGFjZUZvbGRlciwgZGVidWdDb25maWd1cmF0aW9uKSB7XHJcbiAgICAgICAgY29uc3QgX3N1cGVyID0gbmFtZSA9PiBzdXBlcltuYW1lXTtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB5aWVsZCBfc3VwZXIoXCJwcm92aWRlTGF1bmNoRGVmYXVsdHNcIikuY2FsbCh0aGlzLCB3b3Jrc3BhY2VGb2xkZXIsIGRlYnVnQ29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlYnVnT3B0aW9ucyA9IGRlYnVnQ29uZmlndXJhdGlvbi5kZWJ1Z09wdGlvbnM7XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24uZGVidWdTdGRMaWIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5EZWJ1Z1N0ZExpYik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlYnVnQ29uZmlndXJhdGlvbi5zdG9wT25FbnRyeSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z09wdGlvbihkZWJ1Z09wdGlvbnMsIHR5cGVzXzMuRGVidWdPcHRpb25zLlN0b3BPbkVudHJ5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZGVidWdDb25maWd1cmF0aW9uLnNob3dSZXR1cm5WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z09wdGlvbihkZWJ1Z09wdGlvbnMsIHR5cGVzXzMuRGVidWdPcHRpb25zLlNob3dSZXR1cm5WYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlYnVnQ29uZmlndXJhdGlvbi5kamFuZ28pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5EamFuZ28pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24uamluamEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5KaW5qYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlYnVnQ29uZmlndXJhdGlvbi5yZWRpcmVjdE91dHB1dCB8fCBkZWJ1Z0NvbmZpZ3VyYXRpb24ucmVkaXJlY3RPdXRwdXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z09wdGlvbihkZWJ1Z09wdGlvbnMsIHR5cGVzXzMuRGVidWdPcHRpb25zLlJlZGlyZWN0T3V0cHV0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZGVidWdDb25maWd1cmF0aW9uLnN1ZG8pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5TdWRvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZGVidWdDb25maWd1cmF0aW9uLnN1YlByb2Nlc3MgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5TdWJQcm9jZXNzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklQbGF0Zm9ybVNlcnZpY2UpLmlzV2luZG93cykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z09wdGlvbihkZWJ1Z09wdGlvbnMsIHR5cGVzXzMuRGVidWdPcHRpb25zLkZpeEZpbGVQYXRoQ2FzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgaXNGbGFzayA9IHRoaXMuaXNEZWJ1Z2dpbmdGbGFzayhkZWJ1Z0NvbmZpZ3VyYXRpb24pO1xyXG4gICAgICAgICAgICBpZiAoKGRlYnVnQ29uZmlndXJhdGlvbi5weXJhbWlkIHx8IGlzRmxhc2spXHJcbiAgICAgICAgICAgICAgICAmJiBkZWJ1Z09wdGlvbnMuaW5kZXhPZih0eXBlc18zLkRlYnVnT3B0aW9ucy5KaW5qYSkgPT09IC0xXHJcbiAgICAgICAgICAgICAgICAmJiBkZWJ1Z0NvbmZpZ3VyYXRpb24uamluamEgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnT3B0aW9uKGRlYnVnT3B0aW9ucywgdHlwZXNfMy5EZWJ1Z09wdGlvbnMuSmluamEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24ucHlyYW1pZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdXRpbHMgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzQuSUNvbmZpZ3VyYXRpb25Qcm92aWRlclV0aWxzKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnQ29uZmlndXJhdGlvbi5wcm9ncmFtID0gKHlpZWxkIHV0aWxzLmdldFB5cmFtaWRTdGFydHVwU2NyaXB0RmlsZVBhdGgod29ya3NwYWNlRm9sZGVyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zZW5kVGVsZW1ldHJ5KCdsYXVuY2gnLCBkZWJ1Z0NvbmZpZ3VyYXRpb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmN5Y2xvbWF0aWMtY29tcGxleGl0eVxyXG4gICAgcHJvdmlkZUF0dGFjaERlZmF1bHRzKHdvcmtzcGFjZUZvbGRlciwgZGVidWdDb25maWd1cmF0aW9uKSB7XHJcbiAgICAgICAgY29uc3QgX3N1cGVyID0gbmFtZSA9PiBzdXBlcltuYW1lXTtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB5aWVsZCBfc3VwZXIoXCJwcm92aWRlQXR0YWNoRGVmYXVsdHNcIikuY2FsbCh0aGlzLCB3b3Jrc3BhY2VGb2xkZXIsIGRlYnVnQ29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlYnVnT3B0aW9ucyA9IGRlYnVnQ29uZmlndXJhdGlvbi5kZWJ1Z09wdGlvbnM7XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24uZGVidWdTdGRMaWIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5EZWJ1Z1N0ZExpYik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlYnVnQ29uZmlndXJhdGlvbi5kamFuZ28pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5EamFuZ28pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24uamluamEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5KaW5qYSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlYnVnQ29uZmlndXJhdGlvbi5zdWJQcm9jZXNzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnT3B0aW9uKGRlYnVnT3B0aW9ucywgdHlwZXNfMy5EZWJ1Z09wdGlvbnMuU3ViUHJvY2Vzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlYnVnQ29uZmlndXJhdGlvbi5weXJhbWlkXHJcbiAgICAgICAgICAgICAgICAmJiBkZWJ1Z09wdGlvbnMuaW5kZXhPZih0eXBlc18zLkRlYnVnT3B0aW9ucy5KaW5qYSkgPT09IC0xXHJcbiAgICAgICAgICAgICAgICAmJiBkZWJ1Z0NvbmZpZ3VyYXRpb24uamluamEgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnT3B0aW9uKGRlYnVnT3B0aW9ucywgdHlwZXNfMy5EZWJ1Z09wdGlvbnMuSmluamEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24ucmVkaXJlY3RPdXRwdXQgfHwgZGVidWdDb25maWd1cmF0aW9uLnJlZGlyZWN0T3V0cHV0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5SZWRpcmVjdE91dHB1dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gV2UnbGwgbmVlZCBwYXRocyB0byBiZSBmaXhlZCBvbmx5IGluIHRoZSBjYXNlIHdoZXJlIGxvY2FsIGFuZCByZW1vdGUgaG9zdHMgYXJlIHRoZSBzYW1lXHJcbiAgICAgICAgICAgIC8vIEkuZS4gb25seSBpZiBob3N0TmFtZSA9PT0gJ2xvY2FsaG9zdCcgb3IgJzEyNy4wLjAuMScgb3IgJydcclxuICAgICAgICAgICAgY29uc3QgaXNMb2NhbEhvc3QgPSB0aGlzLmlzTG9jYWxIb3N0KGRlYnVnQ29uZmlndXJhdGlvbi5ob3N0KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JUGxhdGZvcm1TZXJ2aWNlKS5pc1dpbmRvd3MgJiYgaXNMb2NhbEhvc3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGVidWdPcHRpb24oZGVidWdPcHRpb25zLCB0eXBlc18zLkRlYnVnT3B0aW9ucy5GaXhGaWxlUGF0aENhc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSVBsYXRmb3JtU2VydmljZSkuaXNXaW5kb3dzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnT3B0aW9uKGRlYnVnT3B0aW9ucywgdHlwZXNfMy5EZWJ1Z09wdGlvbnMuV2luZG93c0NsaWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnT3B0aW9uKGRlYnVnT3B0aW9ucywgdHlwZXNfMy5EZWJ1Z09wdGlvbnMuVW5peENsaWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFkZWJ1Z0NvbmZpZ3VyYXRpb24ucGF0aE1hcHBpbmdzKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z0NvbmZpZ3VyYXRpb24ucGF0aE1hcHBpbmdzID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gVGhpcyBpcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuXHJcbiAgICAgICAgICAgIGlmIChkZWJ1Z0NvbmZpZ3VyYXRpb24ubG9jYWxSb290ICYmIGRlYnVnQ29uZmlndXJhdGlvbi5yZW1vdGVSb290KSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z0NvbmZpZ3VyYXRpb24ucGF0aE1hcHBpbmdzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsUm9vdDogZGVidWdDb25maWd1cmF0aW9uLmxvY2FsUm9vdCxcclxuICAgICAgICAgICAgICAgICAgICByZW1vdGVSb290OiBkZWJ1Z0NvbmZpZ3VyYXRpb24ucmVtb3RlUm9vdFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gSWYgYXR0YWNoaW5nIHRvIGxvY2FsIGhvc3QsIHRoZW4gYWx3YXlzIG1hcCBsb2NhbCByb290IGFuZCByZW1vdGUgcm9vdHMuXHJcbiAgICAgICAgICAgIGlmICh3b3Jrc3BhY2VGb2xkZXIgJiYgZGVidWdDb25maWd1cmF0aW9uLmhvc3QgJiZcclxuICAgICAgICAgICAgICAgIGRlYnVnQ29uZmlndXJhdGlvbi5wYXRoTWFwcGluZ3MubGVuZ3RoID09PSAwICYmXHJcbiAgICAgICAgICAgICAgICBbJ0xPQ0FMSE9TVCcsICcxMjcuMC4wLjEnLCAnOjoxJ10uaW5kZXhPZihkZWJ1Z0NvbmZpZ3VyYXRpb24uaG9zdC50b1VwcGVyQ2FzZSgpKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z0NvbmZpZ3VyYXRpb24ucGF0aE1hcHBpbmdzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsUm9vdDogd29ya3NwYWNlRm9sZGVyLmZzUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICByZW1vdGVSb290OiB3b3Jrc3BhY2VGb2xkZXIuZnNQYXRoXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNlbmRUZWxlbWV0cnkoJ2F0dGFjaCcsIGRlYnVnQ29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBkZWJ1Z09wdGlvbihkZWJ1Z09wdGlvbnMsIGRlYnVnT3B0aW9uKSB7XHJcbiAgICAgICAgaWYgKGRlYnVnT3B0aW9ucy5pbmRleE9mKGRlYnVnT3B0aW9uKSA+PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVidWdPcHRpb25zLnB1c2goZGVidWdPcHRpb24pO1xyXG4gICAgfVxyXG4gICAgaXNMb2NhbEhvc3QoaG9zdE5hbWUpIHtcclxuICAgICAgICBjb25zdCBMb2NhbEhvc3RzID0gWydsb2NhbGhvc3QnLCAnMTI3LjAuMC4xJywgJzo6MSddO1xyXG4gICAgICAgIHJldHVybiAoaG9zdE5hbWUgJiYgTG9jYWxIb3N0cy5pbmRleE9mKGhvc3ROYW1lLnRvTG93ZXJDYXNlKCkpID49IDApID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaXNEZWJ1Z2dpbmdGbGFzayhkZWJ1Z0NvbmZpZ3VyYXRpb24pIHtcclxuICAgICAgICByZXR1cm4gKGRlYnVnQ29uZmlndXJhdGlvbi5tb2R1bGUgJiYgZGVidWdDb25maWd1cmF0aW9uLm1vZHVsZS50b1VwcGVyQ2FzZSgpID09PSAnRkxBU0snKSA/IHRydWUgOiBmYWxzZTtcclxuICAgIH1cclxuICAgIHNlbmRUZWxlbWV0cnkodHJpZ2dlciwgZGVidWdDb25maWd1cmF0aW9uKSB7XHJcbiAgICAgICAgY29uc3QgdGVsZW1ldHJ5UHJvcHMgPSB7XHJcbiAgICAgICAgICAgIHRyaWdnZXIsXHJcbiAgICAgICAgICAgIGNvbnNvbGU6IGRlYnVnQ29uZmlndXJhdGlvbi5jb25zb2xlLFxyXG4gICAgICAgICAgICBoYXNFbnZWYXJzOiB0eXBlb2YgZGVidWdDb25maWd1cmF0aW9uLmVudiA9PT0gJ29iamVjdCcgJiYgT2JqZWN0LmtleXMoZGVidWdDb25maWd1cmF0aW9uLmVudikubGVuZ3RoID4gMCxcclxuICAgICAgICAgICAgZGphbmdvOiAhIWRlYnVnQ29uZmlndXJhdGlvbi5kamFuZ28sXHJcbiAgICAgICAgICAgIGZsYXNrOiB0aGlzLmlzRGVidWdnaW5nRmxhc2soZGVidWdDb25maWd1cmF0aW9uKSxcclxuICAgICAgICAgICAgaGFzQXJnczogQXJyYXkuaXNBcnJheShkZWJ1Z0NvbmZpZ3VyYXRpb24uYXJncykgJiYgZGVidWdDb25maWd1cmF0aW9uLmFyZ3MubGVuZ3RoID4gMCxcclxuICAgICAgICAgICAgaXNMb2NhbGhvc3Q6IHRoaXMuaXNMb2NhbEhvc3QoZGVidWdDb25maWd1cmF0aW9uLmhvc3QpLFxyXG4gICAgICAgICAgICBpc01vZHVsZTogdHlwZW9mIGRlYnVnQ29uZmlndXJhdGlvbi5tb2R1bGUgPT09ICdzdHJpbmcnICYmIGRlYnVnQ29uZmlndXJhdGlvbi5tb2R1bGUubGVuZ3RoID4gMCxcclxuICAgICAgICAgICAgaXNTdWRvOiAhIWRlYnVnQ29uZmlndXJhdGlvbi5zdWRvLFxyXG4gICAgICAgICAgICBqaW5qYTogISFkZWJ1Z0NvbmZpZ3VyYXRpb24uamluamEsXHJcbiAgICAgICAgICAgIHB5cmFtaWQ6ICEhZGVidWdDb25maWd1cmF0aW9uLnB5cmFtaWQsXHJcbiAgICAgICAgICAgIHN0b3BPbkVudHJ5OiAhIWRlYnVnQ29uZmlndXJhdGlvbi5zdG9wT25FbnRyeSxcclxuICAgICAgICAgICAgc2hvd1JldHVyblZhbHVlOiAhIWRlYnVnQ29uZmlndXJhdGlvbi5zaG93UmV0dXJuVmFsdWUsXHJcbiAgICAgICAgICAgIHN1YlByb2Nlc3M6ICEhZGVidWdDb25maWd1cmF0aW9uLnN1YlByb2Nlc3NcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRlbGVtZXRyeV8xLnNlbmRUZWxlbWV0cnlFdmVudChjb25zdGFudHNfMS5ERUJVR0dFUiwgdW5kZWZpbmVkLCB0ZWxlbWV0cnlQcm9wcyk7XHJcbiAgICB9XHJcbn07XHJcblB5dGhvblYyRGVidWdDb25maWd1cmF0aW9uUHJvdmlkZXIgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBQeXRob25WMkRlYnVnQ29uZmlndXJhdGlvblByb3ZpZGVyKTtcclxuZXhwb3J0cy5QeXRob25WMkRlYnVnQ29uZmlndXJhdGlvblByb3ZpZGVyID0gUHl0aG9uVjJEZWJ1Z0NvbmZpZ3VyYXRpb25Qcm92aWRlcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHl0aG9uVjJQcm92aWRlci5qcy5tYXAiXX0=