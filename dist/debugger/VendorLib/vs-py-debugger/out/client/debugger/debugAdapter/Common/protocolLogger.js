"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

let ProtocolLogger = class ProtocolLogger {
  constructor() {
    this.messagesToLog = [];

    this.fromDataCallbackHandler = data => {
      this.logMessages(['From Client:', data.toString('utf8')]);
    };

    this.toDataCallbackHandler = data => {
      this.logMessages(['To Client:', data.toString('utf8')]);
    };
  }

  dispose() {
    if (this.inputStream) {
      this.inputStream.removeListener('data', this.fromDataCallbackHandler);
      this.outputStream.removeListener('data', this.toDataCallbackHandler);
      this.messagesToLog = [];
      this.inputStream = undefined;
      this.outputStream = undefined;
    }
  }

  connect(inputStream, outputStream) {
    this.inputStream = inputStream;
    this.outputStream = outputStream;
    inputStream.addListener('data', this.fromDataCallbackHandler);
    outputStream.addListener('data', this.toDataCallbackHandler);
  }

  setup(logger) {
    this.logger = logger;
    this.logMessages([`Started @ ${new Date().toString()}`]);
    this.logMessages(this.messagesToLog);
    this.messagesToLog = [];
  }

  logMessages(messages) {
    if (this.logger) {
      messages.forEach(message => this.logger.verbose(`${message}`));
    } else {
      this.messagesToLog.push(...messages);
    }
  }

};
ProtocolLogger = __decorate([inversify_1.injectable()], ProtocolLogger);
exports.ProtocolLogger = ProtocolLogger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb3RvY29sTG9nZ2VyLmpzIl0sIm5hbWVzIjpbIl9fZGVjb3JhdGUiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJyIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZCIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsIlByb3RvY29sTG9nZ2VyIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlc1RvTG9nIiwiZnJvbURhdGFDYWxsYmFja0hhbmRsZXIiLCJkYXRhIiwibG9nTWVzc2FnZXMiLCJ0b1N0cmluZyIsInRvRGF0YUNhbGxiYWNrSGFuZGxlciIsImRpc3Bvc2UiLCJpbnB1dFN0cmVhbSIsInJlbW92ZUxpc3RlbmVyIiwib3V0cHV0U3RyZWFtIiwidW5kZWZpbmVkIiwiY29ubmVjdCIsImFkZExpc3RlbmVyIiwic2V0dXAiLCJsb2dnZXIiLCJEYXRlIiwibWVzc2FnZXMiLCJmb3JFYWNoIiwibWVzc2FnZSIsInZlcmJvc2UiLCJwdXNoIiwiaW5qZWN0YWJsZSJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsVUFBVSxHQUFJLFVBQVEsU0FBS0EsVUFBZCxJQUE2QixVQUFVQyxVQUFWLEVBQXNCQyxNQUF0QixFQUE4QkMsR0FBOUIsRUFBbUNDLElBQW5DLEVBQXlDO0FBQ25GLE1BQUlDLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUFsQjtBQUFBLE1BQTBCQyxDQUFDLEdBQUdILENBQUMsR0FBRyxDQUFKLEdBQVFILE1BQVIsR0FBaUJFLElBQUksS0FBSyxJQUFULEdBQWdCQSxJQUFJLEdBQUdLLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NSLE1BQWhDLEVBQXdDQyxHQUF4QyxDQUF2QixHQUFzRUMsSUFBckg7QUFBQSxNQUEySE8sQ0FBM0g7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QUFBLFdBQVcsQ0FBQ2EsUUFBRCxFQUFXO0FBQ2xCLFFBQUksS0FBS0YsTUFBVCxFQUFpQjtBQUNiRSxNQUFBQSxRQUFRLENBQUNDLE9BQVQsQ0FBaUJDLE9BQU8sSUFBSSxLQUFLSixNQUFMLENBQVlLLE9BQVosQ0FBcUIsR0FBRUQsT0FBUSxFQUEvQixDQUE1QjtBQUNILEtBRkQsTUFHSztBQUNELFdBQUtsQixhQUFMLENBQW1Cb0IsSUFBbkIsQ0FBd0IsR0FBR0osUUFBM0I7QUFDSDtBQUNKOztBQXRDcUMsQ0FBMUM7QUF3Q0FsQixjQUFjLEdBQUdwQixVQUFVLENBQUMsQ0FDeEJrQixXQUFXLENBQUN5QixVQUFaLEVBRHdCLENBQUQsRUFFeEJ2QixjQUZ3QixDQUEzQjtBQUdBSixPQUFPLENBQUNJLGNBQVIsR0FBeUJBLGNBQXpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5sZXQgUHJvdG9jb2xMb2dnZXIgPSBjbGFzcyBQcm90b2NvbExvZ2dlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VzVG9Mb2cgPSBbXTtcclxuICAgICAgICB0aGlzLmZyb21EYXRhQ2FsbGJhY2tIYW5kbGVyID0gKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb2dNZXNzYWdlcyhbJ0Zyb20gQ2xpZW50OicsIGRhdGEudG9TdHJpbmcoJ3V0ZjgnKV0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy50b0RhdGFDYWxsYmFja0hhbmRsZXIgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvZ01lc3NhZ2VzKFsnVG8gQ2xpZW50OicsIGRhdGEudG9TdHJpbmcoJ3V0ZjgnKV0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBkaXNwb3NlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlucHV0U3RyZWFtKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXRTdHJlYW0ucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCB0aGlzLmZyb21EYXRhQ2FsbGJhY2tIYW5kbGVyKTtcclxuICAgICAgICAgICAgdGhpcy5vdXRwdXRTdHJlYW0ucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCB0aGlzLnRvRGF0YUNhbGxiYWNrSGFuZGxlcik7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXNUb0xvZyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmlucHV0U3RyZWFtID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB0aGlzLm91dHB1dFN0cmVhbSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25uZWN0KGlucHV0U3RyZWFtLCBvdXRwdXRTdHJlYW0pIHtcclxuICAgICAgICB0aGlzLmlucHV0U3RyZWFtID0gaW5wdXRTdHJlYW07XHJcbiAgICAgICAgdGhpcy5vdXRwdXRTdHJlYW0gPSBvdXRwdXRTdHJlYW07XHJcbiAgICAgICAgaW5wdXRTdHJlYW0uYWRkTGlzdGVuZXIoJ2RhdGEnLCB0aGlzLmZyb21EYXRhQ2FsbGJhY2tIYW5kbGVyKTtcclxuICAgICAgICBvdXRwdXRTdHJlYW0uYWRkTGlzdGVuZXIoJ2RhdGEnLCB0aGlzLnRvRGF0YUNhbGxiYWNrSGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICBzZXR1cChsb2dnZXIpIHtcclxuICAgICAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcclxuICAgICAgICB0aGlzLmxvZ01lc3NhZ2VzKFtgU3RhcnRlZCBAICR7bmV3IERhdGUoKS50b1N0cmluZygpfWBdKTtcclxuICAgICAgICB0aGlzLmxvZ01lc3NhZ2VzKHRoaXMubWVzc2FnZXNUb0xvZyk7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlc1RvTG9nID0gW107XHJcbiAgICB9XHJcbiAgICBsb2dNZXNzYWdlcyhtZXNzYWdlcykge1xyXG4gICAgICAgIGlmICh0aGlzLmxvZ2dlcikge1xyXG4gICAgICAgICAgICBtZXNzYWdlcy5mb3JFYWNoKG1lc3NhZ2UgPT4gdGhpcy5sb2dnZXIudmVyYm9zZShgJHttZXNzYWdlfWApKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZXNUb0xvZy5wdXNoKC4uLm1lc3NhZ2VzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblByb3RvY29sTG9nZ2VyID0gX19kZWNvcmF0ZShbXHJcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKClcclxuXSwgUHJvdG9jb2xMb2dnZXIpO1xyXG5leHBvcnRzLlByb3RvY29sTG9nZ2VyID0gUHJvdG9jb2xMb2dnZXI7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXByb3RvY29sTG9nZ2VyLmpzLm1hcCJdfQ==