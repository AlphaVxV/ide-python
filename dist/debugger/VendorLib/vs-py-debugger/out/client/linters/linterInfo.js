"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

const types_1 = require("../common/types");

class LinterInfo {
  constructor(product, id, configService, configFileNames = []) {
    this.configService = configService;
    this._product = product;
    this._id = id;
    this._configFileNames = configFileNames;
  }

  get id() {
    return this._id;
  }

  get product() {
    return this._product;
  }

  get pathSettingName() {
    return `${this.id}Path`;
  }

  get argsSettingName() {
    return `${this.id}Args`;
  }

  get enabledSettingName() {
    return `${this.id}Enabled`;
  }

  get configFileNames() {
    return this._configFileNames;
  }

  enableAsync(enabled, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      return this.configService.updateSetting(`linting.${this.enabledSettingName}`, enabled, resource);
    });
  }

  isEnabled(resource) {
    const settings = this.configService.getSettings(resource);
    return settings.linting[this.enabledSettingName];
  }

  pathName(resource) {
    const settings = this.configService.getSettings(resource);
    return settings.linting[this.pathSettingName];
  }

  linterArgs(resource) {
    const settings = this.configService.getSettings(resource);
    const args = settings.linting[this.argsSettingName];
    return Array.isArray(args) ? args : [];
  }

  getExecutionInfo(customArgs, resource) {
    const execPath = this.pathName(resource);
    const args = this.linterArgs(resource).concat(customArgs);
    let moduleName; // If path information is not available, then treat it as a module,

    if (path.basename(execPath) === execPath) {
      moduleName = execPath;
    }

    return {
      execPath,
      moduleName,
      args,
      product: this.product
    };
  }

}

exports.LinterInfo = LinterInfo;

class PylintLinterInfo extends LinterInfo {
  constructor(configService, workspaceService, configFileNames = []) {
    super(types_1.Product.pylint, 'pylint', configService, configFileNames);
    this.workspaceService = workspaceService;
  }

  isEnabled(resource) {
    const enabled = super.isEnabled(resource);

    if (!enabled || this.configService.getSettings(resource).jediEnabled) {
      return enabled;
    } // If we're using new LS, then by default Pylint is disabled (unless the user provides a value).


    const inspection = this.workspaceService.getConfiguration('python.linting', resource).inspect('pylintEnabled');

    if (!inspection || inspection.globalValue === undefined && inspection.workspaceFolderValue === undefined || inspection.workspaceValue === undefined) {
      return false;
    }

    return enabled;
  }

}

exports.PylintLinterInfo = PylintLinterInfo;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpbnRlckluZm8uanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInBhdGgiLCJyZXF1aXJlIiwidHlwZXNfMSIsIkxpbnRlckluZm8iLCJjb25zdHJ1Y3RvciIsInByb2R1Y3QiLCJpZCIsImNvbmZpZ1NlcnZpY2UiLCJjb25maWdGaWxlTmFtZXMiLCJfcHJvZHVjdCIsIl9pZCIsIl9jb25maWdGaWxlTmFtZXMiLCJwYXRoU2V0dGluZ05hbWUiLCJhcmdzU2V0dGluZ05hbWUiLCJlbmFibGVkU2V0dGluZ05hbWUiLCJlbmFibGVBc3luYyIsImVuYWJsZWQiLCJyZXNvdXJjZSIsInVwZGF0ZVNldHRpbmciLCJpc0VuYWJsZWQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibGludGluZyIsInBhdGhOYW1lIiwibGludGVyQXJncyIsImFyZ3MiLCJBcnJheSIsImlzQXJyYXkiLCJnZXRFeGVjdXRpb25JbmZvIiwiY3VzdG9tQXJncyIsImV4ZWNQYXRoIiwiY29uY2F0IiwibW9kdWxlTmFtZSIsImJhc2VuYW1lIiwiUHlsaW50TGludGVySW5mbyIsIndvcmtzcGFjZVNlcnZpY2UiLCJQcm9kdWN0IiwicHlsaW50IiwiamVkaUVuYWJsZWQiLCJpbnNwZWN0aW9uIiwiZ2V0Q29uZmlndXJhdGlvbiIsImluc3BlY3QiLCJnbG9iYWxWYWx1ZSIsInVuZGVmaW5lZCIsIndvcmtzcGFjZUZvbGRlclZhbHVlIiwid29ya3NwYWNlVmFsdWUiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFR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Q0g7O0FBaEJxQzs7QUFrQjFDakIsT0FBTyxDQUFDbUMsZ0JBQVIsR0FBMkJBLGdCQUEzQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vdHlwZXNcIik7XHJcbmNsYXNzIExpbnRlckluZm8ge1xyXG4gICAgY29uc3RydWN0b3IocHJvZHVjdCwgaWQsIGNvbmZpZ1NlcnZpY2UsIGNvbmZpZ0ZpbGVOYW1lcyA9IFtdKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWdTZXJ2aWNlID0gY29uZmlnU2VydmljZTtcclxuICAgICAgICB0aGlzLl9wcm9kdWN0ID0gcHJvZHVjdDtcclxuICAgICAgICB0aGlzLl9pZCA9IGlkO1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZ0ZpbGVOYW1lcyA9IGNvbmZpZ0ZpbGVOYW1lcztcclxuICAgIH1cclxuICAgIGdldCBpZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faWQ7XHJcbiAgICB9XHJcbiAgICBnZXQgcHJvZHVjdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcHJvZHVjdDtcclxuICAgIH1cclxuICAgIGdldCBwYXRoU2V0dGluZ05hbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuaWR9UGF0aGA7XHJcbiAgICB9XHJcbiAgICBnZXQgYXJnc1NldHRpbmdOYW1lKCkge1xyXG4gICAgICAgIHJldHVybiBgJHt0aGlzLmlkfUFyZ3NgO1xyXG4gICAgfVxyXG4gICAgZ2V0IGVuYWJsZWRTZXR0aW5nTmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gYCR7dGhpcy5pZH1FbmFibGVkYDtcclxuICAgIH1cclxuICAgIGdldCBjb25maWdGaWxlTmFtZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZ0ZpbGVOYW1lcztcclxuICAgIH1cclxuICAgIGVuYWJsZUFzeW5jKGVuYWJsZWQsIHJlc291cmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnU2VydmljZS51cGRhdGVTZXR0aW5nKGBsaW50aW5nLiR7dGhpcy5lbmFibGVkU2V0dGluZ05hbWV9YCwgZW5hYmxlZCwgcmVzb3VyY2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaXNFbmFibGVkKHJlc291cmNlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpO1xyXG4gICAgICAgIHJldHVybiBzZXR0aW5ncy5saW50aW5nW3RoaXMuZW5hYmxlZFNldHRpbmdOYW1lXTtcclxuICAgIH1cclxuICAgIHBhdGhOYW1lKHJlc291cmNlKSB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpO1xyXG4gICAgICAgIHJldHVybiBzZXR0aW5ncy5saW50aW5nW3RoaXMucGF0aFNldHRpbmdOYW1lXTtcclxuICAgIH1cclxuICAgIGxpbnRlckFyZ3MocmVzb3VyY2UpIHtcclxuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuY29uZmlnU2VydmljZS5nZXRTZXR0aW5ncyhyZXNvdXJjZSk7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IHNldHRpbmdzLmxpbnRpbmdbdGhpcy5hcmdzU2V0dGluZ05hbWVdO1xyXG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFtdO1xyXG4gICAgfVxyXG4gICAgZ2V0RXhlY3V0aW9uSW5mbyhjdXN0b21BcmdzLCByZXNvdXJjZSkge1xyXG4gICAgICAgIGNvbnN0IGV4ZWNQYXRoID0gdGhpcy5wYXRoTmFtZShyZXNvdXJjZSk7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IHRoaXMubGludGVyQXJncyhyZXNvdXJjZSkuY29uY2F0KGN1c3RvbUFyZ3MpO1xyXG4gICAgICAgIGxldCBtb2R1bGVOYW1lO1xyXG4gICAgICAgIC8vIElmIHBhdGggaW5mb3JtYXRpb24gaXMgbm90IGF2YWlsYWJsZSwgdGhlbiB0cmVhdCBpdCBhcyBhIG1vZHVsZSxcclxuICAgICAgICBpZiAocGF0aC5iYXNlbmFtZShleGVjUGF0aCkgPT09IGV4ZWNQYXRoKSB7XHJcbiAgICAgICAgICAgIG1vZHVsZU5hbWUgPSBleGVjUGF0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHsgZXhlY1BhdGgsIG1vZHVsZU5hbWUsIGFyZ3MsIHByb2R1Y3Q6IHRoaXMucHJvZHVjdCB9O1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuTGludGVySW5mbyA9IExpbnRlckluZm87XHJcbmNsYXNzIFB5bGludExpbnRlckluZm8gZXh0ZW5kcyBMaW50ZXJJbmZvIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZ1NlcnZpY2UsIHdvcmtzcGFjZVNlcnZpY2UsIGNvbmZpZ0ZpbGVOYW1lcyA9IFtdKSB7XHJcbiAgICAgICAgc3VwZXIodHlwZXNfMS5Qcm9kdWN0LnB5bGludCwgJ3B5bGludCcsIGNvbmZpZ1NlcnZpY2UsIGNvbmZpZ0ZpbGVOYW1lcyk7XHJcbiAgICAgICAgdGhpcy53b3Jrc3BhY2VTZXJ2aWNlID0gd29ya3NwYWNlU2VydmljZTtcclxuICAgIH1cclxuICAgIGlzRW5hYmxlZChyZXNvdXJjZSkge1xyXG4gICAgICAgIGNvbnN0IGVuYWJsZWQgPSBzdXBlci5pc0VuYWJsZWQocmVzb3VyY2UpO1xyXG4gICAgICAgIGlmICghZW5hYmxlZCB8fCB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpLmplZGlFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlbmFibGVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiB3ZSdyZSB1c2luZyBuZXcgTFMsIHRoZW4gYnkgZGVmYXVsdCBQeWxpbnQgaXMgZGlzYWJsZWQgKHVubGVzcyB0aGUgdXNlciBwcm92aWRlcyBhIHZhbHVlKS5cclxuICAgICAgICBjb25zdCBpbnNwZWN0aW9uID0gdGhpcy53b3Jrc3BhY2VTZXJ2aWNlLmdldENvbmZpZ3VyYXRpb24oJ3B5dGhvbi5saW50aW5nJywgcmVzb3VyY2UpLmluc3BlY3QoJ3B5bGludEVuYWJsZWQnKTtcclxuICAgICAgICBpZiAoIWluc3BlY3Rpb24gfHwgaW5zcGVjdGlvbi5nbG9iYWxWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGluc3BlY3Rpb24ud29ya3NwYWNlRm9sZGVyVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBpbnNwZWN0aW9uLndvcmtzcGFjZVZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZW5hYmxlZDtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLlB5bGludExpbnRlckluZm8gPSBQeWxpbnRMaW50ZXJJbmZvO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1saW50ZXJJbmZvLmpzLm1hcCJdfQ==