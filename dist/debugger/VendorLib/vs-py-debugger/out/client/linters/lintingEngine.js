// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const minimatch_1 = require("minimatch");

const path = require("path");

const vscode = require("vscode");

const types_1 = require("../common/application/types");

const constants_1 = require("../common/constants");

const types_2 = require("../common/platform/types");

const types_3 = require("../common/types");

const stopWatch_1 = require("../common/utils/stopWatch");

const types_4 = require("../ioc/types");

const provider_1 = require("../jupyter/provider");

const telemetry_1 = require("../telemetry");

const constants_2 = require("../telemetry/constants");

const types_5 = require("./types");

const PYTHON = {
  language: 'python'
};
const lintSeverityToVSSeverity = new Map();
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Error, vscode.DiagnosticSeverity.Error);
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Hint, vscode.DiagnosticSeverity.Hint);
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Information, vscode.DiagnosticSeverity.Information);
lintSeverityToVSSeverity.set(types_5.LintMessageSeverity.Warning, vscode.DiagnosticSeverity.Warning);
let LintingEngine = class LintingEngine {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
    this.pendingLintings = new Map();

    this.documentHasJupyterCodeCells = (a, b) => Promise.resolve(false);

    this.documents = serviceContainer.get(types_1.IDocumentManager);
    this.workspace = serviceContainer.get(types_1.IWorkspaceService);
    this.configurationService = serviceContainer.get(types_3.IConfigurationService);
    this.outputChannel = serviceContainer.get(types_3.IOutputChannel, constants_1.STANDARD_OUTPUT_CHANNEL);
    this.linterManager = serviceContainer.get(types_5.ILinterManager);
    this.fileSystem = serviceContainer.get(types_2.IFileSystem);
    this.diagnosticCollection = vscode.languages.createDiagnosticCollection('python');
  }

  get diagnostics() {
    return this.diagnosticCollection;
  }

  clearDiagnostics(document) {
    if (this.diagnosticCollection.has(document.uri)) {
      this.diagnosticCollection.delete(document.uri);
    }
  }

  lintOpenPythonFiles() {
    return __awaiter(this, void 0, void 0, function* () {
      this.diagnosticCollection.clear();
      const promises = this.documents.textDocuments.map(document => __awaiter(this, void 0, void 0, function* () {
        return this.lintDocument(document, 'auto');
      }));
      yield Promise.all(promises);
      return this.diagnosticCollection;
    });
  }

  lintDocument(document, trigger) {
    return __awaiter(this, void 0, void 0, function* () {
      this.diagnosticCollection.set(document.uri, []); // Check if we need to lint this document

      if (!(yield this.shouldLintDocument(document))) {
        return;
      }

      if (this.pendingLintings.has(document.uri.fsPath)) {
        this.pendingLintings.get(document.uri.fsPath).cancel();
        this.pendingLintings.delete(document.uri.fsPath);
      }

      const cancelToken = new vscode.CancellationTokenSource();
      cancelToken.token.onCancellationRequested(() => {
        if (this.pendingLintings.has(document.uri.fsPath)) {
          this.pendingLintings.delete(document.uri.fsPath);
        }
      });
      this.pendingLintings.set(document.uri.fsPath, cancelToken);
      const activeLinters = yield this.linterManager.getActiveLinters(false, document.uri);
      const promises = activeLinters.map(info => __awaiter(this, void 0, void 0, function* () {
        const stopWatch = new stopWatch_1.StopWatch();
        const linter = yield this.linterManager.createLinter(info.product, this.outputChannel, this.serviceContainer, document.uri);
        const promise = linter.lint(document, cancelToken.token);
        this.sendLinterRunTelemetry(info, document.uri, promise, stopWatch, trigger);
        return promise;
      }));
      const hasJupyterCodeCells = yield this.documentHasJupyterCodeCells(document, cancelToken.token); // linters will resolve asynchronously - keep a track of all
      // diagnostics reported as them come in.

      let diagnostics = [];
      const settings = this.configurationService.getSettings(document.uri);

      for (const p of promises) {
        const msgs = yield p;

        if (cancelToken.token.isCancellationRequested) {
          break;
        }

        if (this.isDocumentOpen(document.uri)) {
          // Build the message and suffix the message with the name of the linter used.
          for (const m of msgs) {
            // Ignore magic commands from jupyter.
            if (hasJupyterCodeCells && document.lineAt(m.line - 1).text.trim().startsWith('%') && (m.code === constants_1.LinterErrors.pylint.InvalidSyntax || m.code === constants_1.LinterErrors.prospector.InvalidSyntax || m.code === constants_1.LinterErrors.flake8.InvalidSyntax)) {
              continue;
            }

            diagnostics.push(this.createDiagnostics(m, document));
          } // Limit the number of messages to the max value.


          diagnostics = diagnostics.filter((value, index) => index <= settings.linting.maxNumberOfProblems);
        }
      } // Set all diagnostics found in this pass, as this method always clears existing diagnostics.


      this.diagnosticCollection.set(document.uri, diagnostics);
    });
  } // tslint:disable-next-line:no-any


  linkJupyterExtension(jupyter) {
    return __awaiter(this, void 0, void 0, function* () {
      if (!jupyter) {
        return;
      }

      if (!jupyter.isActive) {
        yield jupyter.activate();
      } // tslint:disable-next-line:no-unsafe-any


      jupyter.exports.registerLanguageProvider(PYTHON.language, new provider_1.JupyterProvider()); // tslint:disable-next-line:no-unsafe-any

      this.documentHasJupyterCodeCells = jupyter.exports.hasCodeCells;
    });
  }

  sendLinterRunTelemetry(info, resource, promise, stopWatch, trigger) {
    const linterExecutablePathName = info.pathName(resource);
    const properties = {
      tool: info.id,
      hasCustomArgs: info.linterArgs(resource).length > 0,
      trigger,
      executableSpecified: linterExecutablePathName.length > 0
    };
    telemetry_1.sendTelemetryWhenDone(constants_2.LINTING, promise, stopWatch, properties);
  }

  isDocumentOpen(uri) {
    return this.documents.textDocuments.some(document => document.uri.fsPath === uri.fsPath);
  }

  createDiagnostics(message, document) {
    const position = new vscode.Position(message.line - 1, message.column);
    const range = new vscode.Range(position, position);
    const severity = lintSeverityToVSSeverity.get(message.severity);
    const diagnostic = new vscode.Diagnostic(range, message.message, severity);
    diagnostic.code = message.code;
    diagnostic.source = message.provider;
    return diagnostic;
  }

  shouldLintDocument(document) {
    return __awaiter(this, void 0, void 0, function* () {
      if (!(yield this.linterManager.isLintingEnabled(false, document.uri))) {
        this.diagnosticCollection.set(document.uri, []);
        return false;
      }

      if (document.languageId !== PYTHON.language) {
        return false;
      }

      const workspaceFolder = this.workspace.getWorkspaceFolder(document.uri);
      const workspaceRootPath = workspaceFolder && typeof workspaceFolder.uri.fsPath === 'string' ? workspaceFolder.uri.fsPath : undefined;
      const relativeFileName = typeof workspaceRootPath === 'string' ? path.relative(workspaceRootPath, document.fileName) : document.fileName;
      const settings = this.configurationService.getSettings(document.uri);
      const ignoreMinmatches = settings.linting.ignorePatterns.map(pattern => new minimatch_1.Minimatch(pattern));

      if (ignoreMinmatches.some(matcher => matcher.match(document.fileName) || matcher.match(relativeFileName))) {
        return false;
      }

      if (document.uri.scheme !== 'file' || !document.uri.fsPath) {
        return false;
      }

      return this.fileSystem.fileExists(document.uri.fsPath);
    });
  }

};
LintingEngine = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_4.IServiceContainer))], LintingEngine);
exports.LintingEngine = LintingEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpbnRpbmdFbmdpbmUuanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsIm1pbmltYXRjaF8xIiwicGF0aCIsInZzY29kZSIsInR5cGVzXzEiLCJjb25zdGFudHNfMSIsInR5cGVzXzIiLCJ0eXBlc18zIiwic3RvcFdhdGNoXzEiLCJ0eXBlc180IiwicHJvdmlkZXJfMSIsInRlbGVtZXRyeV8xIiwiY29uc3RhbnRzXzIiLCJ0eXBlc181IiwiUFlUSE9OIiwibGFuZ3VhZ2UiLCJsaW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkiLCJNYXAiLCJzZXQiLCJMaW50TWVzc2FnZVNldmVyaXR5IiwiRXJyb3IiLCJEaWFnbm9zdGljU2V2ZXJpdHkiLCJIaW50IiwiSW5mb3JtYXRpb24iLCJXYXJuaW5nIiwiTGludGluZ0VuZ2luZSIsImNvbnN0cnVjdG9yIiwic2VydmljZUNvbnRhaW5lciIsInBlbmRpbmdMaW50aW5ncyIsImRvY3VtZW50SGFzSnVweXRlckNvZGVDZWxscyIsImEiLCJiIiwiZG9jdW1lbnRzIiwiZ2V0IiwiSURvY3VtZW50TWFuYWdlciIsIndvcmtzcGFjZSIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwiY29uZmlndXJhdGlvblNlcnZpY2UiLCJJQ29uZmlndXJhdGlvblNlcnZpY2UiLCJvdXRwdXRDaGFubmVsIiwiSU91dHB1dENoYW5uZWwiLCJTVEFOREFSRF9PVVRQVVRfQ0hBTk5FTCIsImxpbnRlck1hbmFnZXIiLCJJTGludGVyTWFuYWdlciIsImZpbGVTeXN0ZW0iLCJJRmlsZVN5c3RlbSIsImRpYWdub3N0aWNDb2xsZWN0aW9uIiwibGFuZ3VhZ2VzIiwiY3JlYXRlRGlhZ25vc3RpY0NvbGxlY3Rpb24iLCJkaWFnbm9zdGljcyIsImNsZWFyRGlhZ25vc3RpY3MiLCJkb2N1bWVudCIsImhhcyIsInVyaSIsImRlbGV0ZSIsImxpbnRPcGVuUHl0aG9uRmlsZXMiLCJjbGVhciIsInByb21pc2VzIiwidGV4dERvY3VtZW50cyIsIm1hcCIsImxpbnREb2N1bWVudCIsImFsbCIsInRyaWdnZXIiLCJzaG91bGRMaW50RG9jdW1lbnQiLCJmc1BhdGgiLCJjYW5jZWwiLCJjYW5jZWxUb2tlbiIsIkNhbmNlbGxhdGlvblRva2VuU291cmNlIiwidG9rZW4iLCJvbkNhbmNlbGxhdGlvblJlcXVlc3RlZCIsImFjdGl2ZUxpbnRlcnMiLCJnZXRBY3RpdmVMaW50ZXJzIiwiaW5mbyIsInN0b3BXYXRjaCIsIlN0b3BXYXRjaCIsImxpbnRlciIsImNyZWF0ZUxpbnRlciIsInByb2R1Y3QiLCJwcm9taXNlIiwibGludCIsInNlbmRMaW50ZXJSdW5UZWxlbWV0cnkiLCJoYXNKdXB5dGVyQ29kZUNlbGxzIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsInAiLCJtc2dzIiwiaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQiLCJpc0RvY3VtZW50T3BlbiIsIm0iLCJsaW5lQXQiLCJsaW5lIiwidGV4dCIsInRyaW0iLCJzdGFydHNXaXRoIiwiY29kZSIsIkxpbnRlckVycm9ycyIsInB5bGludCIsIkludmFsaWRTeW50YXgiLCJwcm9zcGVjdG9yIiwiZmxha2U4IiwicHVzaCIsImNyZWF0ZURpYWdub3N0aWNzIiwiZmlsdGVyIiwiaW5kZXgiLCJsaW50aW5nIiwibWF4TnVtYmVyT2ZQcm9ibGVtcyIsImxpbmtKdXB5dGVyRXh0ZW5zaW9uIiwianVweXRlciIsImlzQWN0aXZlIiwiYWN0aXZhdGUiLCJyZWdpc3Rlckxhbmd1YWdlUHJvdmlkZXIiLCJKdXB5dGVyUHJvdmlkZXIiLCJoYXNDb2RlQ2VsbHMiLCJyZXNvdXJjZSIsImxpbnRlckV4ZWN1dGFibGVQYXRoTmFtZSIsInBhdGhOYW1lIiwicHJvcGVydGllcyIsInRvb2wiLCJpZCIsImhhc0N1c3RvbUFyZ3MiLCJsaW50ZXJBcmdzIiwiZXhlY3V0YWJsZVNwZWNpZmllZCIsInNlbmRUZWxlbWV0cnlXaGVuRG9uZSIsIkxJTlRJTkciLCJzb21lIiwibWVzc2FnZSIsInBvc2l0aW9uIiwiUG9zaXRpb24iLCJjb2x1bW4iLCJyYW5nZSIsIlJhbmdlIiwic2V2ZXJpdHkiLCJkaWFnbm9zdGljIiwiRGlhZ25vc3RpYyIsInNvdXJjZSIsInByb3ZpZGVyIiwiaXNMaW50aW5nRW5hYmxlZCIsImxhbmd1YWdlSWQiLCJ3b3Jrc3BhY2VGb2xkZXIiLCJnZXRXb3Jrc3BhY2VGb2xkZXIiLCJ3b3Jrc3BhY2VSb290UGF0aCIsInVuZGVmaW5lZCIsInJlbGF0aXZlRmlsZU5hbWUiLCJyZWxhdGl2ZSIsImZpbGVOYW1lIiwiaWdub3JlTWlubWF0Y2hlcyIsImlnbm9yZVBhdHRlcm5zIiwicGF0dGVybiIsIk1pbmltYXRjaCIsIm1hdGNoZXIiLCJtYXRjaCIsInNjaGVtZSIsImZpbGVFeGlzdHMiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiSVNlcnZpY2VDb250YWluZXIiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxVQUFVLEdBQUksVUFBUSxTQUFLQSxVQUFkLElBQTZCLFVBQVVDLFVBQVYsRUFBc0JDLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUM7QUFDbkYsTUFBSUMsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWxCO0FBQUEsTUFBMEJDLENBQUMsR0FBR0gsQ0FBQyxHQUFHLENBQUosR0FBUUgsTUFBUixHQUFpQkUsSUFBSSxLQUFLLElBQVQsR0FBZ0JBLElBQUksR0FBR0ssTUFBTSxDQUFDQyx3QkFBUCxDQUFnQ1IsTUFBaEMsRUFBd0NDLEdBQXhDLENBQXZCLEdBQXNFQyxJQUFySDtBQUFBLE1BQTJITyxDQUEzSDtBQUNBLE1BQUksT0FBT0MsT0FBUCxLQUFtQixRQUFuQixJQUErQixPQUFPQSxPQUFPLENBQUNDLFFBQWYsS0FBNEIsVUFBL0QsRUFBMkVMLENBQUMsR0FBR0ksT0FBTyxDQUFDQyxRQUFSLENBQWlCWixVQUFqQixFQUE2QkMsTUFBN0IsRUFBcUNDLEdBQXJDLEVBQTBDQyxJQUExQyxDQUFKLENBQTNFLEtBQ0ssS0FBSyxJQUFJVSxDQUFDLEdBQUdiLFVBQVUsQ0FBQ00sTUFBWCxHQUFvQixDQUFqQyxFQUFvQ08sQ0FBQyxJQUFJLENBQXpDLEVBQTRDQSxDQUFDLEVBQTdDLEVBQWlELElBQUlILENBQUMsR0FBR1YsVUFBVSxDQUFDYSxDQUFELENBQWxCLEVBQXVCTixDQUFDLEdBQUcsQ0FBQ0gsQ0FBQyxHQUFHLENBQUosR0FBUU0sQ0FBQyxDQUFDSCxDQUFELENBQVQsR0FBZUgsQ0FBQyxHQUFHLENBQUosR0FBUU0sQ0FBQyxDQUFDVCxNQUFELEVBQVNDLEdBQVQsRUFBY0ssQ0FBZCxDQUFULEdBQTRCRyxDQUFDLENBQUNULE1BQUQsRUFBU0MsR0FBVCxDQUE3QyxLQUErREssQ0FBbkU7QUFDN0UsU0FBT0gsQ0FBQyxHQUFHLENBQUosSUFBU0csQ0FBVCxJQUFjQyxNQUFNLENBQUNNLGNBQVAsQ0FBc0JiLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0ssQ0FBbkMsQ0FBZCxFQUFxREEsQ0FBNUQ7QUFDSCxDQUxEOztBQU1BLElBQUlRLE9BQU8sR0FBSSxVQUFRLFNBQUtBLE9BQWQsSUFBMEIsVUFBVUMsVUFBVixFQUFzQkMsU0FBdEIsRUFBaUM7QUFDckUsU0FBTyxVQUFVaEIsTUFBVixFQUFrQkMsR0FBbEIsRUFBdUI7QUFBRWUsSUFBQUEsU0FBUyxDQUFDaEIsTUFBRCxFQUFTQyxHQUFULEVBQWNjLFVBQWQsQ0FBVDtBQUFxQyxHQUFyRTtBQUNILENBRkQ7O0FBR0EsSUFBSUUsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8sSUFBckQsQ0FBMERSLFNBQTFELEVBQXFFSyxRQUFyRSxDQUF0QztBQUF1SDs7QUFDL0lILElBQUFBLElBQUksQ0FBQyxDQUFDTixTQUFTLEdBQUdBLFNBQVMsQ0FBQ2EsS0FBVixDQUFnQmhCLE9BQWhCLEVBQXlCQyxVQUFVLElBQUksRUFBdkMsQ0FBYixFQUF5RFMsSUFBekQsRUFBRCxDQUFKO0FBQ0gsR0FMTSxDQUFQO0FBTUgsQ0FQRDs7QUFRQXJCLE1BQU0sQ0FBQ00sY0FBUCxDQUFzQnNCLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVULEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1VLFdBQVcsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBM0I7O0FBQ0EsTUFBTUMsV0FBVyxHQUFHRCxPQUFPLENBQUMsV0FBRCxDQUEzQjs7QUFDQSxNQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1HLE1BQU0sR0FBR0gsT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBQ0EsTUFBTUksT0FBTyxHQUFHSixPQUFPLENBQUMsNkJBQUQsQ0FBdkI7O0FBQ0EsTUFBTUssV0FBVyxHQUFHTCxPQUFPLENBQUMscUJBQUQsQ0FBM0I7O0FBQ0EsTUFBTU0sT0FBTyxHQUFHTixPQUFPLENBQUMsMEJBQUQsQ0FBdkI7O0FBQ0EsTUFBTU8sT0FBTyxHQUFHUCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBQ0EsTUFBTVEsV0FBVyxHQUFHUixPQUFPLENBQUMsMkJBQUQsQ0FBM0I7O0FBQ0EsTUFBTVMsT0FBTyxHQUFHVCxPQUFPLENBQUMsY0FBRCxDQUF2Qjs7QUFDQSxNQUFNVSxVQUFVLEdBQUdWLE9BQU8sQ0FBQyxxQkFBRCxDQUExQjs7QUFDQSxNQUFNVyxXQUFXLEdBQUdYLE9BQU8sQ0FBQyxjQUFELENBQTNCOztBQUNBLE1BQU1ZLFdBQVcsR0FBR1osT0FBTyxDQUFDLHdCQUFELENBQTNCOztBQUNBLE1BQU1hLE9BQU8sR0FBR2IsT0FBTyxDQUFDLFNBQUQsQ0FBdkI7O0FBQ0EsTUFBTWMsTUFBTSxHQUFHO0FBQUVDLEVBQUFBLFFBQVEsRUFBRTtBQUFaLENBQWY7QUFDQSxNQUFNQyx3QkFBd0IsR0FBRyxJQUFJQyxHQUFKLEVBQWpDO0FBQ0FELHdCQUF3QixDQUFDRSxHQUF6QixDQUE2QkwsT0FBTyxDQUFDTSxtQkFBUixDQUE0QkMsS0FBekQsRUFBZ0VqQixNQUFNLENBQUNrQixrQkFBUCxDQUEwQkQsS0FBMUY7QUFDQUosd0JBQXdCLENBQUNFLEdBQXpCLENBQTZCTCxPQUFPLENBQUNNLG1CQUFSLENBQTRCRyxJQUF6RCxFQUErRG5CLE1BQU0sQ0FBQ2tCLGtCQUFQLENBQTBCQyxJQUF6RjtBQUNBTix3QkFBd0IsQ0FBQ0UsR0FBekIsQ0FBNkJMLE9BQU8sQ0FBQ00sbUJBQVIsQ0FBNEJJLFdBQXpELEVBQXNFcEIsTUFBTSxDQUFDa0Isa0JBQVAsQ0FBMEJFLFdBQWhHO0FBQ0FQLHdCQUF3QixDQUFDRSxHQUF6QixDQUE2QkwsT0FBTyxDQUFDTSxtQkFBUixDQUE0QkssT0FBekQsRUFBa0VyQixNQUFNLENBQUNrQixrQkFBUCxDQUEwQkcsT0FBNUY7QUFDQSxJQUFJQyxhQUFhLEdBQUcsTUFBTUEsYUFBTixDQUFvQjtBQUNwQ0MsRUFBQUEsV0FBVyxDQUFDQyxnQkFBRCxFQUFtQjtBQUMxQixTQUFLQSxnQkFBTCxHQUF3QkEsZ0JBQXhCO0FBQ0EsU0FBS0MsZUFBTCxHQUF1QixJQUFJWCxHQUFKLEVBQXZCOztBQUNBLFNBQUtZLDJCQUFMLEdBQW1DLENBQUNDLENBQUQsRUFBSUMsQ0FBSixLQUFVOUMsT0FBTyxDQUFDQyxPQUFSLENBQWdCLEtBQWhCLENBQTdDOztBQUNBLFNBQUs4QyxTQUFMLEdBQWlCTCxnQkFBZ0IsQ0FBQ00sR0FBakIsQ0FBcUI3QixPQUFPLENBQUM4QixnQkFBN0IsQ0FBakI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCUixnQkFBZ0IsQ0FBQ00sR0FBakIsQ0FBcUI3QixPQUFPLENBQUNnQyxpQkFBN0IsQ0FBakI7QUFDQSxTQUFLQyxvQkFBTCxHQUE0QlYsZ0JBQWdCLENBQUNNLEdBQWpCLENBQXFCMUIsT0FBTyxDQUFDK0IscUJBQTdCLENBQTVCO0FBQ0EsU0FBS0MsYUFBTCxHQUFxQlosZ0JBQWdCLENBQUNNLEdBQWpCLENBQXFCMUIsT0FBTyxDQUFDaUMsY0FBN0IsRUFBNkNuQyxXQUFXLENBQUNvQyx1QkFBekQsQ0FBckI7QUFDQSxTQUFLQyxhQUFMLEdBQXFCZixnQkFBZ0IsQ0FBQ00sR0FBakIsQ0FBcUJwQixPQUFPLENBQUM4QixjQUE3QixDQUFyQjtBQUNBLFNBQUtDLFVBQUwsR0FBa0JqQixnQkFBZ0IsQ0FBQ00sR0FBakIsQ0FBcUIzQixPQUFPLENBQUN1QyxXQUE3QixDQUFsQjtBQUNBLFNBQUtDLG9CQUFMLEdBQTRCM0MsTUFBTSxDQUFDNEMsU0FBUCxDQUFpQkMsMEJBQWpCLENBQTRDLFFBQTVDLENBQTVCO0FBQ0g7O0FBQ0QsTUFBSUMsV0FBSixHQUFrQjtBQUNkLFdBQU8sS0FBS0gsb0JBQVo7QUFDSDs7QUFDREksRUFBQUEsZ0JBQWdCLENBQUNDLFFBQUQsRUFBVztBQUN2QixRQUFJLEtBQUtMLG9CQUFMLENBQTBCTSxHQUExQixDQUE4QkQsUUFBUSxDQUFDRSxHQUF2QyxDQUFKLEVBQWlEO0FBQzdDLFdBQUtQLG9CQUFMLENBQTBCUSxNQUExQixDQUFpQ0gsUUFBUSxDQUFDRSxHQUExQztBQUNIO0FBQ0o7O0FBQ0RFLEVBQUFBLG1CQUFtQixHQUFHO0FBQ2xCLFdBQU8zRSxTQUFTLENBQUMsSUFBRCxFQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUNoRCxXQUFLa0Usb0JBQUwsQ0FBMEJVLEtBQTFCO0FBQ0EsWUFBTUMsUUFBUSxHQUFHLEtBQUt6QixTQUFMLENBQWUwQixhQUFmLENBQTZCQyxHQUE3QixDQUFrQ1IsUUFBRCxJQUFjdkUsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFBRSxlQUFPLEtBQUtnRixZQUFMLENBQWtCVCxRQUFsQixFQUE0QixNQUE1QixDQUFQO0FBQTZDLE9BQW5GLENBQXhELENBQWpCO0FBQ0EsWUFBTWxFLE9BQU8sQ0FBQzRFLEdBQVIsQ0FBWUosUUFBWixDQUFOO0FBQ0EsYUFBTyxLQUFLWCxvQkFBWjtBQUNILEtBTGUsQ0FBaEI7QUFNSDs7QUFDRGMsRUFBQUEsWUFBWSxDQUFDVCxRQUFELEVBQVdXLE9BQVgsRUFBb0I7QUFDNUIsV0FBT2xGLFNBQVMsQ0FBQyxJQUFELEVBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ2hELFdBQUtrRSxvQkFBTCxDQUEwQjVCLEdBQTFCLENBQThCaUMsUUFBUSxDQUFDRSxHQUF2QyxFQUE0QyxFQUE1QyxFQURnRCxDQUVoRDs7QUFDQSxVQUFJLEVBQUUsTUFBTSxLQUFLVSxrQkFBTCxDQUF3QlosUUFBeEIsQ0FBUixDQUFKLEVBQWdEO0FBQzVDO0FBQ0g7O0FBQ0QsVUFBSSxLQUFLdkIsZUFBTCxDQUFxQndCLEdBQXJCLENBQXlCRCxRQUFRLENBQUNFLEdBQVQsQ0FBYVcsTUFBdEMsQ0FBSixFQUFtRDtBQUMvQyxhQUFLcEMsZUFBTCxDQUFxQkssR0FBckIsQ0FBeUJrQixRQUFRLENBQUNFLEdBQVQsQ0FBYVcsTUFBdEMsRUFBOENDLE1BQTlDO0FBQ0EsYUFBS3JDLGVBQUwsQ0FBcUIwQixNQUFyQixDQUE0QkgsUUFBUSxDQUFDRSxHQUFULENBQWFXLE1BQXpDO0FBQ0g7O0FBQ0QsWUFBTUUsV0FBVyxHQUFHLElBQUkvRCxNQUFNLENBQUNnRSx1QkFBWCxFQUFwQjtBQUNBRCxNQUFBQSxXQUFXLENBQUNFLEtBQVosQ0FBa0JDLHVCQUFsQixDQUEwQyxNQUFNO0FBQzVDLFlBQUksS0FBS3pDLGVBQUwsQ0FBcUJ3QixHQUFyQixDQUF5QkQsUUFBUSxDQUFDRSxHQUFULENBQWFXLE1BQXRDLENBQUosRUFBbUQ7QUFDL0MsZUFBS3BDLGVBQUwsQ0FBcUIwQixNQUFyQixDQUE0QkgsUUFBUSxDQUFDRSxHQUFULENBQWFXLE1BQXpDO0FBQ0g7QUFDSixPQUpEO0FBS0EsV0FBS3BDLGVBQUwsQ0FBcUJWLEdBQXJCLENBQXlCaUMsUUFBUSxDQUFDRSxHQUFULENBQWFXLE1BQXRDLEVBQThDRSxXQUE5QztBQUNBLFlBQU1JLGFBQWEsR0FBRyxNQUFNLEtBQUs1QixhQUFMLENBQW1CNkIsZ0JBQW5CLENBQW9DLEtBQXBDLEVBQTJDcEIsUUFBUSxDQUFDRSxHQUFwRCxDQUE1QjtBQUNBLFlBQU1JLFFBQVEsR0FBR2EsYUFBYSxDQUN6QlgsR0FEWSxDQUNQYSxJQUFELElBQVU1RixTQUFTLENBQUMsSUFBRCxFQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUM1RCxjQUFNNkYsU0FBUyxHQUFHLElBQUlqRSxXQUFXLENBQUNrRSxTQUFoQixFQUFsQjtBQUNBLGNBQU1DLE1BQU0sR0FBRyxNQUFNLEtBQUtqQyxhQUFMLENBQW1Ca0MsWUFBbkIsQ0FBZ0NKLElBQUksQ0FBQ0ssT0FBckMsRUFBOEMsS0FBS3RDLGFBQW5ELEVBQWtFLEtBQUtaLGdCQUF2RSxFQUF5RndCLFFBQVEsQ0FBQ0UsR0FBbEcsQ0FBckI7QUFDQSxjQUFNeUIsT0FBTyxHQUFHSCxNQUFNLENBQUNJLElBQVAsQ0FBWTVCLFFBQVosRUFBc0JlLFdBQVcsQ0FBQ0UsS0FBbEMsQ0FBaEI7QUFDQSxhQUFLWSxzQkFBTCxDQUE0QlIsSUFBNUIsRUFBa0NyQixRQUFRLENBQUNFLEdBQTNDLEVBQWdEeUIsT0FBaEQsRUFBeURMLFNBQXpELEVBQW9FWCxPQUFwRTtBQUNBLGVBQU9nQixPQUFQO0FBQ0gsT0FOMkIsQ0FEWCxDQUFqQjtBQVFBLFlBQU1HLG1CQUFtQixHQUFHLE1BQU0sS0FBS3BELDJCQUFMLENBQWlDc0IsUUFBakMsRUFBMkNlLFdBQVcsQ0FBQ0UsS0FBdkQsQ0FBbEMsQ0ExQmdELENBMkJoRDtBQUNBOztBQUNBLFVBQUluQixXQUFXLEdBQUcsRUFBbEI7QUFDQSxZQUFNaUMsUUFBUSxHQUFHLEtBQUs3QyxvQkFBTCxDQUEwQjhDLFdBQTFCLENBQXNDaEMsUUFBUSxDQUFDRSxHQUEvQyxDQUFqQjs7QUFDQSxXQUFLLE1BQU0rQixDQUFYLElBQWdCM0IsUUFBaEIsRUFBMEI7QUFDdEIsY0FBTTRCLElBQUksR0FBRyxNQUFNRCxDQUFuQjs7QUFDQSxZQUFJbEIsV0FBVyxDQUFDRSxLQUFaLENBQWtCa0IsdUJBQXRCLEVBQStDO0FBQzNDO0FBQ0g7O0FBQ0QsWUFBSSxLQUFLQyxjQUFMLENBQW9CcEMsUUFBUSxDQUFDRSxHQUE3QixDQUFKLEVBQXVDO0FBQ25DO0FBQ0EsZUFBSyxNQUFNbUMsQ0FBWCxJQUFnQkgsSUFBaEIsRUFBc0I7QUFDbEI7QUFDQSxnQkFBSUosbUJBQW1CLElBQUk5QixRQUFRLENBQUNzQyxNQUFULENBQWdCRCxDQUFDLENBQUNFLElBQUYsR0FBUyxDQUF6QixFQUE0QkMsSUFBNUIsQ0FBaUNDLElBQWpDLEdBQXdDQyxVQUF4QyxDQUFtRCxHQUFuRCxDQUF2QixLQUNDTCxDQUFDLENBQUNNLElBQUYsS0FBV3pGLFdBQVcsQ0FBQzBGLFlBQVosQ0FBeUJDLE1BQXpCLENBQWdDQyxhQUEzQyxJQUNHVCxDQUFDLENBQUNNLElBQUYsS0FBV3pGLFdBQVcsQ0FBQzBGLFlBQVosQ0FBeUJHLFVBQXpCLENBQW9DRCxhQURsRCxJQUVHVCxDQUFDLENBQUNNLElBQUYsS0FBV3pGLFdBQVcsQ0FBQzBGLFlBQVosQ0FBeUJJLE1BQXpCLENBQWdDRixhQUgvQyxDQUFKLEVBR21FO0FBQy9EO0FBQ0g7O0FBQ0RoRCxZQUFBQSxXQUFXLENBQUNtRCxJQUFaLENBQWlCLEtBQUtDLGlCQUFMLENBQXVCYixDQUF2QixFQUEwQnJDLFFBQTFCLENBQWpCO0FBQ0gsV0FYa0MsQ0FZbkM7OztBQUNBRixVQUFBQSxXQUFXLEdBQUdBLFdBQVcsQ0FBQ3FELE1BQVosQ0FBbUIsQ0FBQ2pILEtBQUQsRUFBUWtILEtBQVIsS0FBa0JBLEtBQUssSUFBSXJCLFFBQVEsQ0FBQ3NCLE9BQVQsQ0FBaUJDLG1CQUEvRCxDQUFkO0FBQ0g7QUFDSixPQW5EK0MsQ0FvRGhEOzs7QUFDQSxXQUFLM0Qsb0JBQUwsQ0FBMEI1QixHQUExQixDQUE4QmlDLFFBQVEsQ0FBQ0UsR0FBdkMsRUFBNENKLFdBQTVDO0FBQ0gsS0F0RGUsQ0FBaEI7QUF1REgsR0FyRm1DLENBc0ZwQzs7O0FBQ0F5RCxFQUFBQSxvQkFBb0IsQ0FBQ0MsT0FBRCxFQUFVO0FBQzFCLFdBQU8vSCxTQUFTLENBQUMsSUFBRCxFQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUNoRCxVQUFJLENBQUMrSCxPQUFMLEVBQWM7QUFDVjtBQUNIOztBQUNELFVBQUksQ0FBQ0EsT0FBTyxDQUFDQyxRQUFiLEVBQXVCO0FBQ25CLGNBQU1ELE9BQU8sQ0FBQ0UsUUFBUixFQUFOO0FBQ0gsT0FOK0MsQ0FPaEQ7OztBQUNBRixNQUFBQSxPQUFPLENBQUM3RyxPQUFSLENBQWdCZ0gsd0JBQWhCLENBQXlDaEcsTUFBTSxDQUFDQyxRQUFoRCxFQUEwRCxJQUFJTCxVQUFVLENBQUNxRyxlQUFmLEVBQTFELEVBUmdELENBU2hEOztBQUNBLFdBQUtsRiwyQkFBTCxHQUFtQzhFLE9BQU8sQ0FBQzdHLE9BQVIsQ0FBZ0JrSCxZQUFuRDtBQUNILEtBWGUsQ0FBaEI7QUFZSDs7QUFDRGhDLEVBQUFBLHNCQUFzQixDQUFDUixJQUFELEVBQU95QyxRQUFQLEVBQWlCbkMsT0FBakIsRUFBMEJMLFNBQTFCLEVBQXFDWCxPQUFyQyxFQUE4QztBQUNoRSxVQUFNb0Qsd0JBQXdCLEdBQUcxQyxJQUFJLENBQUMyQyxRQUFMLENBQWNGLFFBQWQsQ0FBakM7QUFDQSxVQUFNRyxVQUFVLEdBQUc7QUFDZkMsTUFBQUEsSUFBSSxFQUFFN0MsSUFBSSxDQUFDOEMsRUFESTtBQUVmQyxNQUFBQSxhQUFhLEVBQUUvQyxJQUFJLENBQUNnRCxVQUFMLENBQWdCUCxRQUFoQixFQUEwQmpKLE1BQTFCLEdBQW1DLENBRm5DO0FBR2Y4RixNQUFBQSxPQUhlO0FBSWYyRCxNQUFBQSxtQkFBbUIsRUFBRVAsd0JBQXdCLENBQUNsSixNQUF6QixHQUFrQztBQUp4QyxLQUFuQjtBQU1BMkMsSUFBQUEsV0FBVyxDQUFDK0cscUJBQVosQ0FBa0M5RyxXQUFXLENBQUMrRyxPQUE5QyxFQUF1RDdDLE9BQXZELEVBQWdFTCxTQUFoRSxFQUEyRTJDLFVBQTNFO0FBQ0g7O0FBQ0Q3QixFQUFBQSxjQUFjLENBQUNsQyxHQUFELEVBQU07QUFDaEIsV0FBTyxLQUFLckIsU0FBTCxDQUFlMEIsYUFBZixDQUE2QmtFLElBQTdCLENBQWtDekUsUUFBUSxJQUFJQSxRQUFRLENBQUNFLEdBQVQsQ0FBYVcsTUFBYixLQUF3QlgsR0FBRyxDQUFDVyxNQUExRSxDQUFQO0FBQ0g7O0FBQ0RxQyxFQUFBQSxpQkFBaUIsQ0FBQ3dCLE9BQUQsRUFBVTFFLFFBQVYsRUFBb0I7QUFDakMsVUFBTTJFLFFBQVEsR0FBRyxJQUFJM0gsTUFBTSxDQUFDNEgsUUFBWCxDQUFvQkYsT0FBTyxDQUFDbkMsSUFBUixHQUFlLENBQW5DLEVBQXNDbUMsT0FBTyxDQUFDRyxNQUE5QyxDQUFqQjtBQUNBLFVBQU1DLEtBQUssR0FBRyxJQUFJOUgsTUFBTSxDQUFDK0gsS0FBWCxDQUFpQkosUUFBakIsRUFBMkJBLFFBQTNCLENBQWQ7QUFDQSxVQUFNSyxRQUFRLEdBQUduSCx3QkFBd0IsQ0FBQ2lCLEdBQXpCLENBQTZCNEYsT0FBTyxDQUFDTSxRQUFyQyxDQUFqQjtBQUNBLFVBQU1DLFVBQVUsR0FBRyxJQUFJakksTUFBTSxDQUFDa0ksVUFBWCxDQUFzQkosS0FBdEIsRUFBNkJKLE9BQU8sQ0FBQ0EsT0FBckMsRUFBOENNLFFBQTlDLENBQW5CO0FBQ0FDLElBQUFBLFVBQVUsQ0FBQ3RDLElBQVgsR0FBa0IrQixPQUFPLENBQUMvQixJQUExQjtBQUNBc0MsSUFBQUEsVUFBVSxDQUFDRSxNQUFYLEdBQW9CVCxPQUFPLENBQUNVLFFBQTVCO0FBQ0EsV0FBT0gsVUFBUDtBQUNIOztBQUNEckUsRUFBQUEsa0JBQWtCLENBQUNaLFFBQUQsRUFBVztBQUN6QixXQUFPdkUsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEQsVUFBSSxFQUFFLE1BQU0sS0FBSzhELGFBQUwsQ0FBbUI4RixnQkFBbkIsQ0FBb0MsS0FBcEMsRUFBMkNyRixRQUFRLENBQUNFLEdBQXBELENBQVIsQ0FBSixFQUF1RTtBQUNuRSxhQUFLUCxvQkFBTCxDQUEwQjVCLEdBQTFCLENBQThCaUMsUUFBUSxDQUFDRSxHQUF2QyxFQUE0QyxFQUE1QztBQUNBLGVBQU8sS0FBUDtBQUNIOztBQUNELFVBQUlGLFFBQVEsQ0FBQ3NGLFVBQVQsS0FBd0IzSCxNQUFNLENBQUNDLFFBQW5DLEVBQTZDO0FBQ3pDLGVBQU8sS0FBUDtBQUNIOztBQUNELFlBQU0ySCxlQUFlLEdBQUcsS0FBS3ZHLFNBQUwsQ0FBZXdHLGtCQUFmLENBQWtDeEYsUUFBUSxDQUFDRSxHQUEzQyxDQUF4QjtBQUNBLFlBQU11RixpQkFBaUIsR0FBSUYsZUFBZSxJQUFJLE9BQU9BLGVBQWUsQ0FBQ3JGLEdBQWhCLENBQW9CVyxNQUEzQixLQUFzQyxRQUExRCxHQUFzRTBFLGVBQWUsQ0FBQ3JGLEdBQWhCLENBQW9CVyxNQUExRixHQUFtRzZFLFNBQTdIO0FBQ0EsWUFBTUMsZ0JBQWdCLEdBQUcsT0FBT0YsaUJBQVAsS0FBNkIsUUFBN0IsR0FBd0MxSSxJQUFJLENBQUM2SSxRQUFMLENBQWNILGlCQUFkLEVBQWlDekYsUUFBUSxDQUFDNkYsUUFBMUMsQ0FBeEMsR0FBOEY3RixRQUFRLENBQUM2RixRQUFoSTtBQUNBLFlBQU05RCxRQUFRLEdBQUcsS0FBSzdDLG9CQUFMLENBQTBCOEMsV0FBMUIsQ0FBc0NoQyxRQUFRLENBQUNFLEdBQS9DLENBQWpCO0FBQ0EsWUFBTTRGLGdCQUFnQixHQUFHL0QsUUFBUSxDQUFDc0IsT0FBVCxDQUFpQjBDLGNBQWpCLENBQWdDdkYsR0FBaEMsQ0FBb0N3RixPQUFPLElBQUksSUFBSWxKLFdBQVcsQ0FBQ21KLFNBQWhCLENBQTBCRCxPQUExQixDQUEvQyxDQUF6Qjs7QUFDQSxVQUFJRixnQkFBZ0IsQ0FBQ3JCLElBQWpCLENBQXNCeUIsT0FBTyxJQUFJQSxPQUFPLENBQUNDLEtBQVIsQ0FBY25HLFFBQVEsQ0FBQzZGLFFBQXZCLEtBQW9DSyxPQUFPLENBQUNDLEtBQVIsQ0FBY1IsZ0JBQWQsQ0FBckUsQ0FBSixFQUEyRztBQUN2RyxlQUFPLEtBQVA7QUFDSDs7QUFDRCxVQUFJM0YsUUFBUSxDQUFDRSxHQUFULENBQWFrRyxNQUFiLEtBQXdCLE1BQXhCLElBQWtDLENBQUNwRyxRQUFRLENBQUNFLEdBQVQsQ0FBYVcsTUFBcEQsRUFBNEQ7QUFDeEQsZUFBTyxLQUFQO0FBQ0g7O0FBQ0QsYUFBTyxLQUFLcEIsVUFBTCxDQUFnQjRHLFVBQWhCLENBQTJCckcsUUFBUSxDQUFDRSxHQUFULENBQWFXLE1BQXhDLENBQVA7QUFDSCxLQXBCZSxDQUFoQjtBQXFCSDs7QUFqSm1DLENBQXhDO0FBbUpBdkMsYUFBYSxHQUFHaEUsVUFBVSxDQUFDLENBQ3ZCc0MsV0FBVyxDQUFDMEosVUFBWixFQUR1QixFQUV2QmhMLE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUMySixNQUFaLENBQW1CakosT0FBTyxDQUFDa0osaUJBQTNCLENBQUosQ0FGZ0IsQ0FBRCxFQUd2QmxJLGFBSHVCLENBQTFCO0FBSUEzQixPQUFPLENBQUMyQixhQUFSLEdBQXdCQSxhQUF4QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59O1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcclxuY29uc3QgbWluaW1hdGNoXzEgPSByZXF1aXJlKFwibWluaW1hdGNoXCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uL2NvbW1vbi9wbGF0Zm9ybS90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMyA9IHJlcXVpcmUoXCIuLi9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IHN0b3BXYXRjaF8xID0gcmVxdWlyZShcIi4uL2NvbW1vbi91dGlscy9zdG9wV2F0Y2hcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vaW9jL3R5cGVzXCIpO1xyXG5jb25zdCBwcm92aWRlcl8xID0gcmVxdWlyZShcIi4uL2p1cHl0ZXIvcHJvdmlkZXJcIik7XHJcbmNvbnN0IHRlbGVtZXRyeV8xID0gcmVxdWlyZShcIi4uL3RlbGVtZXRyeVwiKTtcclxuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi4vdGVsZW1ldHJ5L2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfNSA9IHJlcXVpcmUoXCIuL3R5cGVzXCIpO1xyXG5jb25zdCBQWVRIT04gPSB7IGxhbmd1YWdlOiAncHl0aG9uJyB9O1xyXG5jb25zdCBsaW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkgPSBuZXcgTWFwKCk7XHJcbmxpbnRTZXZlcml0eVRvVlNTZXZlcml0eS5zZXQodHlwZXNfNS5MaW50TWVzc2FnZVNldmVyaXR5LkVycm9yLCB2c2NvZGUuRGlhZ25vc3RpY1NldmVyaXR5LkVycm9yKTtcclxubGludFNldmVyaXR5VG9WU1NldmVyaXR5LnNldCh0eXBlc181LkxpbnRNZXNzYWdlU2V2ZXJpdHkuSGludCwgdnNjb2RlLkRpYWdub3N0aWNTZXZlcml0eS5IaW50KTtcclxubGludFNldmVyaXR5VG9WU1NldmVyaXR5LnNldCh0eXBlc181LkxpbnRNZXNzYWdlU2V2ZXJpdHkuSW5mb3JtYXRpb24sIHZzY29kZS5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb24pO1xyXG5saW50U2V2ZXJpdHlUb1ZTU2V2ZXJpdHkuc2V0KHR5cGVzXzUuTGludE1lc3NhZ2VTZXZlcml0eS5XYXJuaW5nLCB2c2NvZGUuRGlhZ25vc3RpY1NldmVyaXR5Lldhcm5pbmcpO1xyXG5sZXQgTGludGluZ0VuZ2luZSA9IGNsYXNzIExpbnRpbmdFbmdpbmUge1xyXG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuc2VydmljZUNvbnRhaW5lciA9IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nTGludGluZ3MgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5kb2N1bWVudEhhc0p1cHl0ZXJDb2RlQ2VsbHMgPSAoYSwgYikgPT4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgICAgICB0aGlzLmRvY3VtZW50cyA9IHNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSURvY3VtZW50TWFuYWdlcik7XHJcbiAgICAgICAgdGhpcy53b3Jrc3BhY2UgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlKTtcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25TZXJ2aWNlID0gc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMy5JQ29uZmlndXJhdGlvblNlcnZpY2UpO1xyXG4gICAgICAgIHRoaXMub3V0cHV0Q2hhbm5lbCA9IHNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzMuSU91dHB1dENoYW5uZWwsIGNvbnN0YW50c18xLlNUQU5EQVJEX09VVFBVVF9DSEFOTkVMKTtcclxuICAgICAgICB0aGlzLmxpbnRlck1hbmFnZXIgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc181LklMaW50ZXJNYW5hZ2VyKTtcclxuICAgICAgICB0aGlzLmZpbGVTeXN0ZW0gPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklGaWxlU3lzdGVtKTtcclxuICAgICAgICB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uID0gdnNjb2RlLmxhbmd1YWdlcy5jcmVhdGVEaWFnbm9zdGljQ29sbGVjdGlvbigncHl0aG9uJyk7XHJcbiAgICB9XHJcbiAgICBnZXQgZGlhZ25vc3RpY3MoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlhZ25vc3RpY0NvbGxlY3Rpb247XHJcbiAgICB9XHJcbiAgICBjbGVhckRpYWdub3N0aWNzKGRvY3VtZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlhZ25vc3RpY0NvbGxlY3Rpb24uaGFzKGRvY3VtZW50LnVyaSkpIHtcclxuICAgICAgICAgICAgdGhpcy5kaWFnbm9zdGljQ29sbGVjdGlvbi5kZWxldGUoZG9jdW1lbnQudXJpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBsaW50T3BlblB5dGhvbkZpbGVzKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlhZ25vc3RpY0NvbGxlY3Rpb24uY2xlYXIoKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSB0aGlzLmRvY3VtZW50cy50ZXh0RG9jdW1lbnRzLm1hcCgoZG9jdW1lbnQpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsgcmV0dXJuIHRoaXMubGludERvY3VtZW50KGRvY3VtZW50LCAnYXV0bycpOyB9KSk7XHJcbiAgICAgICAgICAgIHlpZWxkIFByb21pc2UuYWxsKHByb21pc2VzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlhZ25vc3RpY0NvbGxlY3Rpb247XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBsaW50RG9jdW1lbnQoZG9jdW1lbnQsIHRyaWdnZXIpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uLnNldChkb2N1bWVudC51cmksIFtdKTtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgbmVlZCB0byBsaW50IHRoaXMgZG9jdW1lbnRcclxuICAgICAgICAgICAgaWYgKCEoeWllbGQgdGhpcy5zaG91bGRMaW50RG9jdW1lbnQoZG9jdW1lbnQpKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBlbmRpbmdMaW50aW5ncy5oYXMoZG9jdW1lbnQudXJpLmZzUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLmdldChkb2N1bWVudC51cmkuZnNQYXRoKS5jYW5jZWwoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLmRlbGV0ZShkb2N1bWVudC51cmkuZnNQYXRoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBjYW5jZWxUb2tlbiA9IG5ldyB2c2NvZGUuQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTtcclxuICAgICAgICAgICAgY2FuY2VsVG9rZW4udG9rZW4ub25DYW5jZWxsYXRpb25SZXF1ZXN0ZWQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGVuZGluZ0xpbnRpbmdzLmhhcyhkb2N1bWVudC51cmkuZnNQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLmRlbGV0ZShkb2N1bWVudC51cmkuZnNQYXRoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ0xpbnRpbmdzLnNldChkb2N1bWVudC51cmkuZnNQYXRoLCBjYW5jZWxUb2tlbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUxpbnRlcnMgPSB5aWVsZCB0aGlzLmxpbnRlck1hbmFnZXIuZ2V0QWN0aXZlTGludGVycyhmYWxzZSwgZG9jdW1lbnQudXJpKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBhY3RpdmVMaW50ZXJzXHJcbiAgICAgICAgICAgICAgICAubWFwKChpbmZvKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9wV2F0Y2ggPSBuZXcgc3RvcFdhdGNoXzEuU3RvcFdhdGNoKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsaW50ZXIgPSB5aWVsZCB0aGlzLmxpbnRlck1hbmFnZXIuY3JlYXRlTGludGVyKGluZm8ucHJvZHVjdCwgdGhpcy5vdXRwdXRDaGFubmVsLCB0aGlzLnNlcnZpY2VDb250YWluZXIsIGRvY3VtZW50LnVyaSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlID0gbGludGVyLmxpbnQoZG9jdW1lbnQsIGNhbmNlbFRva2VuLnRva2VuKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VuZExpbnRlclJ1blRlbGVtZXRyeShpbmZvLCBkb2N1bWVudC51cmksIHByb21pc2UsIHN0b3BXYXRjaCwgdHJpZ2dlcik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBjb25zdCBoYXNKdXB5dGVyQ29kZUNlbGxzID0geWllbGQgdGhpcy5kb2N1bWVudEhhc0p1cHl0ZXJDb2RlQ2VsbHMoZG9jdW1lbnQsIGNhbmNlbFRva2VuLnRva2VuKTtcclxuICAgICAgICAgICAgLy8gbGludGVycyB3aWxsIHJlc29sdmUgYXN5bmNocm9ub3VzbHkgLSBrZWVwIGEgdHJhY2sgb2YgYWxsXHJcbiAgICAgICAgICAgIC8vIGRpYWdub3N0aWNzIHJlcG9ydGVkIGFzIHRoZW0gY29tZSBpbi5cclxuICAgICAgICAgICAgbGV0IGRpYWdub3N0aWNzID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5jb25maWd1cmF0aW9uU2VydmljZS5nZXRTZXR0aW5ncyhkb2N1bWVudC51cmkpO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgcHJvbWlzZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1zZ3MgPSB5aWVsZCBwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbmNlbFRva2VuLnRva2VuLmlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RvY3VtZW50T3Blbihkb2N1bWVudC51cmkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQnVpbGQgdGhlIG1lc3NhZ2UgYW5kIHN1ZmZpeCB0aGUgbWVzc2FnZSB3aXRoIHRoZSBuYW1lIG9mIHRoZSBsaW50ZXIgdXNlZC5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG0gb2YgbXNncykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbWFnaWMgY29tbWFuZHMgZnJvbSBqdXB5dGVyLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzSnVweXRlckNvZGVDZWxscyAmJiBkb2N1bWVudC5saW5lQXQobS5saW5lIC0gMSkudGV4dC50cmltKCkuc3RhcnRzV2l0aCgnJScpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAobS5jb2RlID09PSBjb25zdGFudHNfMS5MaW50ZXJFcnJvcnMucHlsaW50LkludmFsaWRTeW50YXggfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvZGUgPT09IGNvbnN0YW50c18xLkxpbnRlckVycm9ycy5wcm9zcGVjdG9yLkludmFsaWRTeW50YXggfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvZGUgPT09IGNvbnN0YW50c18xLkxpbnRlckVycm9ycy5mbGFrZTguSW52YWxpZFN5bnRheCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWdub3N0aWNzLnB1c2godGhpcy5jcmVhdGVEaWFnbm9zdGljcyhtLCBkb2N1bWVudCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBMaW1pdCB0aGUgbnVtYmVyIG9mIG1lc3NhZ2VzIHRvIHRoZSBtYXggdmFsdWUuXHJcbiAgICAgICAgICAgICAgICAgICAgZGlhZ25vc3RpY3MgPSBkaWFnbm9zdGljcy5maWx0ZXIoKHZhbHVlLCBpbmRleCkgPT4gaW5kZXggPD0gc2V0dGluZ3MubGludGluZy5tYXhOdW1iZXJPZlByb2JsZW1zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBTZXQgYWxsIGRpYWdub3N0aWNzIGZvdW5kIGluIHRoaXMgcGFzcywgYXMgdGhpcyBtZXRob2QgYWx3YXlzIGNsZWFycyBleGlzdGluZyBkaWFnbm9zdGljcy5cclxuICAgICAgICAgICAgdGhpcy5kaWFnbm9zdGljQ29sbGVjdGlvbi5zZXQoZG9jdW1lbnQudXJpLCBkaWFnbm9zdGljcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICBsaW5rSnVweXRlckV4dGVuc2lvbihqdXB5dGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgaWYgKCFqdXB5dGVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFqdXB5dGVyLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCBqdXB5dGVyLmFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuc2FmZS1hbnlcclxuICAgICAgICAgICAganVweXRlci5leHBvcnRzLnJlZ2lzdGVyTGFuZ3VhZ2VQcm92aWRlcihQWVRIT04ubGFuZ3VhZ2UsIG5ldyBwcm92aWRlcl8xLkp1cHl0ZXJQcm92aWRlcigpKTtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuc2FmZS1hbnlcclxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudEhhc0p1cHl0ZXJDb2RlQ2VsbHMgPSBqdXB5dGVyLmV4cG9ydHMuaGFzQ29kZUNlbGxzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2VuZExpbnRlclJ1blRlbGVtZXRyeShpbmZvLCByZXNvdXJjZSwgcHJvbWlzZSwgc3RvcFdhdGNoLCB0cmlnZ2VyKSB7XHJcbiAgICAgICAgY29uc3QgbGludGVyRXhlY3V0YWJsZVBhdGhOYW1lID0gaW5mby5wYXRoTmFtZShyZXNvdXJjZSk7XHJcbiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHtcclxuICAgICAgICAgICAgdG9vbDogaW5mby5pZCxcclxuICAgICAgICAgICAgaGFzQ3VzdG9tQXJnczogaW5mby5saW50ZXJBcmdzKHJlc291cmNlKS5sZW5ndGggPiAwLFxyXG4gICAgICAgICAgICB0cmlnZ2VyLFxyXG4gICAgICAgICAgICBleGVjdXRhYmxlU3BlY2lmaWVkOiBsaW50ZXJFeGVjdXRhYmxlUGF0aE5hbWUubGVuZ3RoID4gMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGVsZW1ldHJ5XzEuc2VuZFRlbGVtZXRyeVdoZW5Eb25lKGNvbnN0YW50c18yLkxJTlRJTkcsIHByb21pc2UsIHN0b3BXYXRjaCwgcHJvcGVydGllcyk7XHJcbiAgICB9XHJcbiAgICBpc0RvY3VtZW50T3Blbih1cmkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudHMudGV4dERvY3VtZW50cy5zb21lKGRvY3VtZW50ID0+IGRvY3VtZW50LnVyaS5mc1BhdGggPT09IHVyaS5mc1BhdGgpO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlRGlhZ25vc3RpY3MobWVzc2FnZSwgZG9jdW1lbnQpIHtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5ldyB2c2NvZGUuUG9zaXRpb24obWVzc2FnZS5saW5lIC0gMSwgbWVzc2FnZS5jb2x1bW4pO1xyXG4gICAgICAgIGNvbnN0IHJhbmdlID0gbmV3IHZzY29kZS5SYW5nZShwb3NpdGlvbiwgcG9zaXRpb24pO1xyXG4gICAgICAgIGNvbnN0IHNldmVyaXR5ID0gbGludFNldmVyaXR5VG9WU1NldmVyaXR5LmdldChtZXNzYWdlLnNldmVyaXR5KTtcclxuICAgICAgICBjb25zdCBkaWFnbm9zdGljID0gbmV3IHZzY29kZS5EaWFnbm9zdGljKHJhbmdlLCBtZXNzYWdlLm1lc3NhZ2UsIHNldmVyaXR5KTtcclxuICAgICAgICBkaWFnbm9zdGljLmNvZGUgPSBtZXNzYWdlLmNvZGU7XHJcbiAgICAgICAgZGlhZ25vc3RpYy5zb3VyY2UgPSBtZXNzYWdlLnByb3ZpZGVyO1xyXG4gICAgICAgIHJldHVybiBkaWFnbm9zdGljO1xyXG4gICAgfVxyXG4gICAgc2hvdWxkTGludERvY3VtZW50KGRvY3VtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgaWYgKCEoeWllbGQgdGhpcy5saW50ZXJNYW5hZ2VyLmlzTGludGluZ0VuYWJsZWQoZmFsc2UsIGRvY3VtZW50LnVyaSkpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWdub3N0aWNDb2xsZWN0aW9uLnNldChkb2N1bWVudC51cmksIFtdKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQubGFuZ3VhZ2VJZCAhPT0gUFlUSE9OLmxhbmd1YWdlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyID0gdGhpcy53b3Jrc3BhY2UuZ2V0V29ya3NwYWNlRm9sZGVyKGRvY3VtZW50LnVyaSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZVJvb3RQYXRoID0gKHdvcmtzcGFjZUZvbGRlciAmJiB0eXBlb2Ygd29ya3NwYWNlRm9sZGVyLnVyaS5mc1BhdGggPT09ICdzdHJpbmcnKSA/IHdvcmtzcGFjZUZvbGRlci51cmkuZnNQYXRoIDogdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBjb25zdCByZWxhdGl2ZUZpbGVOYW1lID0gdHlwZW9mIHdvcmtzcGFjZVJvb3RQYXRoID09PSAnc3RyaW5nJyA/IHBhdGgucmVsYXRpdmUod29ya3NwYWNlUm9vdFBhdGgsIGRvY3VtZW50LmZpbGVOYW1lKSA6IGRvY3VtZW50LmZpbGVOYW1lO1xyXG4gICAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuY29uZmlndXJhdGlvblNlcnZpY2UuZ2V0U2V0dGluZ3MoZG9jdW1lbnQudXJpKTtcclxuICAgICAgICAgICAgY29uc3QgaWdub3JlTWlubWF0Y2hlcyA9IHNldHRpbmdzLmxpbnRpbmcuaWdub3JlUGF0dGVybnMubWFwKHBhdHRlcm4gPT4gbmV3IG1pbmltYXRjaF8xLk1pbmltYXRjaChwYXR0ZXJuKSk7XHJcbiAgICAgICAgICAgIGlmIChpZ25vcmVNaW5tYXRjaGVzLnNvbWUobWF0Y2hlciA9PiBtYXRjaGVyLm1hdGNoKGRvY3VtZW50LmZpbGVOYW1lKSB8fCBtYXRjaGVyLm1hdGNoKHJlbGF0aXZlRmlsZU5hbWUpKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC51cmkuc2NoZW1lICE9PSAnZmlsZScgfHwgIWRvY3VtZW50LnVyaS5mc1BhdGgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlU3lzdGVtLmZpbGVFeGlzdHMoZG9jdW1lbnQudXJpLmZzUGF0aCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcbkxpbnRpbmdFbmdpbmUgPSBfX2RlY29yYXRlKFtcclxuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcclxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzQuSVNlcnZpY2VDb250YWluZXIpKVxyXG5dLCBMaW50aW5nRW5naW5lKTtcclxuZXhwb3J0cy5MaW50aW5nRW5naW5lID0gTGludGluZ0VuZ2luZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGludGluZ0VuZ2luZS5qcy5tYXAiXX0=