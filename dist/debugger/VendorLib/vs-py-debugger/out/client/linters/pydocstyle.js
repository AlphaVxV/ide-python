"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

require("../common/extensions");

const types_1 = require("../common/types");

const util_1 = require("./../common/util");

const baseLinter_1 = require("./baseLinter");

const types_2 = require("./types");

class PyDocStyle extends baseLinter_1.BaseLinter {
  constructor(outputChannel, serviceContainer) {
    super(types_1.Product.pydocstyle, outputChannel, serviceContainer);
  }

  runLinter(document, cancellation) {
    return __awaiter(this, void 0, void 0, function* () {
      const messages = yield this.run([document.uri.fsPath], document, cancellation); // All messages in pep8 are treated as warnings for now.

      messages.forEach(msg => {
        msg.severity = types_2.LintMessageSeverity.Warning;
      });
      return messages;
    });
  }

  parseMessages(output, document, token, regEx) {
    return __awaiter(this, void 0, void 0, function* () {
      let outputLines = output.split(/\r?\n/g);
      const baseFileName = path.basename(document.uri.fsPath); // Remember, the first line of the response contains the file name and line number, the next line contains the error message.
      // So we have two lines per message, hence we need to take lines in pairs.

      const maxLines = this.pythonSettings.linting.maxNumberOfProblems * 2; // First line is almost always empty.

      const oldOutputLines = outputLines.filter(line => line.length > 0);
      outputLines = [];

      for (let counter = 0; counter < oldOutputLines.length / 2; counter += 1) {
        outputLines.push(oldOutputLines[2 * counter] + oldOutputLines[2 * counter + 1]);
      }

      return outputLines.filter((value, index) => index < maxLines && value.indexOf(':') >= 0).map(line => {
        // Windows will have a : after the drive letter (e.g. c:\).
        if (util_1.IS_WINDOWS) {
          return line.substring(line.indexOf(`${baseFileName}:`) + baseFileName.length + 1).trim();
        }

        return line.substring(line.indexOf(':') + 1).trim();
      }) // Iterate through the lines (skipping the messages).
      // So, just iterate the response in pairs.
      .map(line => {
        try {
          if (line.trim().length === 0) {
            return;
          }

          const lineNumber = parseInt(line.substring(0, line.indexOf(' ')), 10);
          const part = line.substring(line.indexOf(':') + 1).trim();
          const code = part.substring(0, part.indexOf(':')).trim();
          const message = part.substring(part.indexOf(':') + 1).trim();
          const sourceLine = document.lineAt(lineNumber - 1).text;
          const trmmedSourceLine = sourceLine.trim();
          const sourceStart = sourceLine.indexOf(trmmedSourceLine); // tslint:disable-next-line:no-object-literal-type-assertion

          return {
            code: code,
            message: message,
            column: sourceStart,
            line: lineNumber,
            type: '',
            provider: this.info.id
          };
        } catch (ex) {
          this.logger.logError(`Failed to parse pydocstyle line '${line}'`, ex);
          return;
        }
      }).filter(item => item !== undefined).map(item => item);
    });
  }

}

exports.PyDocStyle = PyDocStyle;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5ZG9jc3R5bGUuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInBhdGgiLCJyZXF1aXJlIiwidHlwZXNfMSIsInV0aWxfMSIsImJhc2VMaW50ZXJfMSIsInR5cGVzXzIiLCJQeURvY1N0eWxlIiwiQmFzZUxpbnRlciIsImNvbnN0cnVjdG9yIiwib3V0cHV0Q2hhbm5lbCIsInNlcnZpY2VDb250YWluZXIiLCJQcm9kdWN0IiwicHlkb2NzdHlsZSIsInJ1bkxpbnRlciIsImRvY3VtZW50IiwiY2FuY2VsbGF0aW9uIiwibWVzc2FnZXMiLCJydW4iLCJ1cmkiLCJmc1BhdGgiLCJmb3JFYWNoIiwibXNnIiwic2V2ZXJpdHkiLCJMaW50TWVzc2FnZVNldmVyaXR5IiwiV2FybmluZyIsInBhcnNlTWVzc2FnZXMiLCJvdXRwdXQiLCJ0b2tlbiIsInJlZ0V4Iiwib3V0cHV0TGluZXMiLCJzcGxpdCIsImJhc2VGaWxlTmFtZSIsImJhc2VuYW1lIiwibWF4TGluZXMiLCJweXRob25TZXR0aW5ncyIsImxpbnRpbmciLCJtYXhOdW1iZXJPZlByb2JsZW1zIiwib2xkT3V0cHV0TGluZXMiLCJmaWx0ZXIiLCJsaW5lIiwibGVuZ3RoIiwiY291bnRlciIsInB1c2giLCJpbmRleCIsImluZGV4T2YiLCJtYXAiLCJJU19XSU5ET1dTIiwic3Vic3RyaW5nIiwidHJpbSIsImxpbmVOdW1iZXIiLCJwYXJzZUludCIsInBhcnQiLCJjb2RlIiwibWVzc2FnZSIsInNvdXJjZUxpbmUiLCJsaW5lQXQiLCJ0ZXh0IiwidHJtbWVkU291cmNlTGluZSIsInNvdXJjZVN0YXJ0IiwiY29sdW1uIiwidHlwZSIsInByb3ZpZGVyIiwiaW5mbyIsImlkIiwiZXgiLCJsb2dnZXIiLCJsb2dFcnJvciIsIml0ZW0iLCJ1bmRlZmluZWQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzNGLGFBQVNDLFFBQVQsQ0FBa0JKLEtBQWxCLEVBQXlCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQyxPQUFELENBQVQsQ0FBbUJLLEtBQW5CLENBQUQsQ0FBSjtBQUFrQyxPQUF4QyxDQUF5QyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUM5RixhQUFTRixJQUFULENBQWNJLE1BQWQsRUFBc0I7QUFBRUEsTUFBQUEsTUFBTSxDQUFDQyxJQUFQLEdBQWNULE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQXJCLEdBQXNDLElBQUlOLENBQUosQ0FBTSxVQUFVRyxPQUFWLEVBQW1CO0FBQUVBLFFBQUFBLE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQVA7QUFBd0IsT0FBbkQsRUFBcURPLElBQXJELENBQTBEUixTQUExRCxFQUFxRUssUUFB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TCxDQUFlSSxJQUFJLENBQUNQLE9BQUwsQ0FBYSxHQUFiLElBQW9CLENBQW5DLEVBQXNDSSxJQUF0QyxFQUFoQjtBQUNBLGdCQUFNTSxVQUFVLEdBQUd4QyxRQUFRLENBQUN5QyxNQUFULENBQWdCTixVQUFVLEdBQUcsQ0FBN0IsRUFBZ0NPLElBQW5EO0FBQ0EsZ0JBQU1DLGdCQUFnQixHQUFHSCxVQUFVLENBQUNOLElBQVgsRUFBekI7QUFDQSxnQkFBTVUsV0FBVyxHQUFHSixVQUFVLENBQUNWLE9BQVgsQ0FBbUJhLGdCQUFuQixDQUFwQixDQVZBLENBV0E7O0FBQ0EsaUJBQU87QUFDSEwsWUFBQUEsSUFBSSxFQUFFQSxJQURIO0FBRUhDLFlBQUFBLE9BQU8sRUFBRUEsT0FGTjtBQUdITSxZQUFBQSxNQUFNLEVBQUVELFdBSEw7QUFJSG5CLFlBQUFBLElBQUksRUFBRVUsVUFKSDtBQUtIVyxZQUFBQSxJQUFJLEVBQUUsRUFMSDtBQU1IQyxZQUFBQSxRQUFRLEVBQUUsS0FBS0MsSUFBTCxDQUFVQztBQU5qQixXQUFQO0FBUUgsU0FwQkQsQ0FxQkEsT0FBT0MsRUFBUCxFQUFXO0FBQ1AsZUFBS0MsTUFBTCxDQUFZQyxRQUFaLENBQXNCLG9DQUFtQzNCLElBQUssR0FBOUQsRUFBa0V5QixFQUFsRTtBQUNBO0FBQ0g7QUFDSixPQXJDTSxFQXNDRjFCLE1BdENFLENBc0NLNkIsSUFBSSxJQUFJQSxJQUFJLEtBQUtDLFNBdEN0QixFQXVDRnZCLEdBdkNFLENBdUNFc0IsSUFBSSxJQUFJQSxJQXZDVixDQUFQO0FBd0NILEtBcERlLENBQWhCO0FBcURIOztBQXBFNEM7O0FBc0VqRHBFLE9BQU8sQ0FBQ08sVUFBUixHQUFxQkEsVUFBckIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbnJlcXVpcmUoXCIuLi9jb21tb24vZXh0ZW5zaW9uc1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IHV0aWxfMSA9IHJlcXVpcmUoXCIuLy4uL2NvbW1vbi91dGlsXCIpO1xyXG5jb25zdCBiYXNlTGludGVyXzEgPSByZXF1aXJlKFwiLi9iYXNlTGludGVyXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4vdHlwZXNcIik7XHJcbmNsYXNzIFB5RG9jU3R5bGUgZXh0ZW5kcyBiYXNlTGludGVyXzEuQmFzZUxpbnRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihvdXRwdXRDaGFubmVsLCBzZXJ2aWNlQ29udGFpbmVyKSB7XHJcbiAgICAgICAgc3VwZXIodHlwZXNfMS5Qcm9kdWN0LnB5ZG9jc3R5bGUsIG91dHB1dENoYW5uZWwsIHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgfVxyXG4gICAgcnVuTGludGVyKGRvY3VtZW50LCBjYW5jZWxsYXRpb24pIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlcyA9IHlpZWxkIHRoaXMucnVuKFtkb2N1bWVudC51cmkuZnNQYXRoXSwgZG9jdW1lbnQsIGNhbmNlbGxhdGlvbik7XHJcbiAgICAgICAgICAgIC8vIEFsbCBtZXNzYWdlcyBpbiBwZXA4IGFyZSB0cmVhdGVkIGFzIHdhcm5pbmdzIGZvciBub3cuXHJcbiAgICAgICAgICAgIG1lc3NhZ2VzLmZvckVhY2gobXNnID0+IHtcclxuICAgICAgICAgICAgICAgIG1zZy5zZXZlcml0eSA9IHR5cGVzXzIuTGludE1lc3NhZ2VTZXZlcml0eS5XYXJuaW5nO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcGFyc2VNZXNzYWdlcyhvdXRwdXQsIGRvY3VtZW50LCB0b2tlbiwgcmVnRXgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBsZXQgb3V0cHV0TGluZXMgPSBvdXRwdXQuc3BsaXQoL1xccj9cXG4vZyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJhc2VGaWxlTmFtZSA9IHBhdGguYmFzZW5hbWUoZG9jdW1lbnQudXJpLmZzUGF0aCk7XHJcbiAgICAgICAgICAgIC8vIFJlbWVtYmVyLCB0aGUgZmlyc3QgbGluZSBvZiB0aGUgcmVzcG9uc2UgY29udGFpbnMgdGhlIGZpbGUgbmFtZSBhbmQgbGluZSBudW1iZXIsIHRoZSBuZXh0IGxpbmUgY29udGFpbnMgdGhlIGVycm9yIG1lc3NhZ2UuXHJcbiAgICAgICAgICAgIC8vIFNvIHdlIGhhdmUgdHdvIGxpbmVzIHBlciBtZXNzYWdlLCBoZW5jZSB3ZSBuZWVkIHRvIHRha2UgbGluZXMgaW4gcGFpcnMuXHJcbiAgICAgICAgICAgIGNvbnN0IG1heExpbmVzID0gdGhpcy5weXRob25TZXR0aW5ncy5saW50aW5nLm1heE51bWJlck9mUHJvYmxlbXMgKiAyO1xyXG4gICAgICAgICAgICAvLyBGaXJzdCBsaW5lIGlzIGFsbW9zdCBhbHdheXMgZW1wdHkuXHJcbiAgICAgICAgICAgIGNvbnN0IG9sZE91dHB1dExpbmVzID0gb3V0cHV0TGluZXMuZmlsdGVyKGxpbmUgPT4gbGluZS5sZW5ndGggPiAwKTtcclxuICAgICAgICAgICAgb3V0cHV0TGluZXMgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgY291bnRlciA9IDA7IGNvdW50ZXIgPCBvbGRPdXRwdXRMaW5lcy5sZW5ndGggLyAyOyBjb3VudGVyICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIG91dHB1dExpbmVzLnB1c2gob2xkT3V0cHV0TGluZXNbMiAqIGNvdW50ZXJdICsgb2xkT3V0cHV0TGluZXNbKDIgKiBjb3VudGVyKSArIDFdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0TGluZXNcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHZhbHVlLCBpbmRleCkgPT4gaW5kZXggPCBtYXhMaW5lcyAmJiB2YWx1ZS5pbmRleE9mKCc6JykgPj0gMClcclxuICAgICAgICAgICAgICAgIC5tYXAobGluZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBXaW5kb3dzIHdpbGwgaGF2ZSBhIDogYWZ0ZXIgdGhlIGRyaXZlIGxldHRlciAoZS5nLiBjOlxcKS5cclxuICAgICAgICAgICAgICAgIGlmICh1dGlsXzEuSVNfV0lORE9XUykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5lLnN1YnN0cmluZyhsaW5lLmluZGV4T2YoYCR7YmFzZUZpbGVOYW1lfTpgKSArIGJhc2VGaWxlTmFtZS5sZW5ndGggKyAxKS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbGluZS5zdWJzdHJpbmcobGluZS5pbmRleE9mKCc6JykgKyAxKS50cmltKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggdGhlIGxpbmVzIChza2lwcGluZyB0aGUgbWVzc2FnZXMpLlxyXG4gICAgICAgICAgICAgICAgLy8gU28sIGp1c3QgaXRlcmF0ZSB0aGUgcmVzcG9uc2UgaW4gcGFpcnMuXHJcbiAgICAgICAgICAgICAgICAubWFwKGxpbmUgPT4ge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobGluZS50cmltKCkubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGluZU51bWJlciA9IHBhcnNlSW50KGxpbmUuc3Vic3RyaW5nKDAsIGxpbmUuaW5kZXhPZignICcpKSwgMTApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnQgPSBsaW5lLnN1YnN0cmluZyhsaW5lLmluZGV4T2YoJzonKSArIDEpLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2RlID0gcGFydC5zdWJzdHJpbmcoMCwgcGFydC5pbmRleE9mKCc6JykpLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gcGFydC5zdWJzdHJpbmcocGFydC5pbmRleE9mKCc6JykgKyAxKS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTGluZSA9IGRvY3VtZW50LmxpbmVBdChsaW5lTnVtYmVyIC0gMSkudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0cm1tZWRTb3VyY2VMaW5lID0gc291cmNlTGluZS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlU3RhcnQgPSBzb3VyY2VMaW5lLmluZGV4T2YodHJtbWVkU291cmNlTGluZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW9iamVjdC1saXRlcmFsLXR5cGUtYXNzZXJ0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogY29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBzb3VyY2VTdGFydCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogbGluZU51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiB0aGlzLmluZm8uaWRcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nRXJyb3IoYEZhaWxlZCB0byBwYXJzZSBweWRvY3N0eWxlIGxpbmUgJyR7bGluZX0nYCwgZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoaXRlbSA9PiBpdGVtICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAubWFwKGl0ZW0gPT4gaXRlbSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5QeURvY1N0eWxlID0gUHlEb2NTdHlsZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHlkb2NzdHlsZS5qcy5tYXAiXX0=