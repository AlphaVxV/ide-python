"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

require("../common/extensions");

const types_1 = require("../common/types");

const baseLinter_1 = require("./baseLinter");

class Prospector extends baseLinter_1.BaseLinter {
  constructor(outputChannel, serviceContainer) {
    super(types_1.Product.prospector, outputChannel, serviceContainer);
  }

  runLinter(document, cancellation) {
    return __awaiter(this, void 0, void 0, function* () {
      const cwd = this.getWorkspaceRootPath(document);
      const relativePath = path.relative(cwd, document.uri.fsPath);
      return this.run(['--absolute-paths', '--output-format=json', relativePath], document, cancellation);
    });
  }

  parseMessages(output, document, token, regEx) {
    return __awaiter(this, void 0, void 0, function* () {
      let parsedData;

      try {
        parsedData = JSON.parse(output);
      } catch (ex) {
        this.outputChannel.appendLine(`${'#'.repeat(10)}Linting Output - ${this.info.id}${'#'.repeat(10)}`);
        this.outputChannel.append(output);
        this.logger.logError('Failed to parse Prospector output', ex);
        return [];
      }

      return parsedData.messages.filter((value, index) => index <= this.pythonSettings.linting.maxNumberOfProblems).map(msg => {
        const lineNumber = msg.location.line === null || isNaN(msg.location.line) ? 1 : msg.location.line;
        return {
          code: msg.code,
          message: msg.message,
          column: msg.location.character,
          line: lineNumber,
          type: msg.code,
          provider: `${this.info.id} - ${msg.source}`
        };
      });
    });
  }

}

exports.Prospector = Prospector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb3NwZWN0b3IuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInBhdGgiLCJyZXF1aXJlIiwidHlwZXNfMSIsImJhc2VMaW50ZXJfMSIsIlByb3NwZWN0b3IiLCJCYXNlTGludGVyIiwiY29uc3RydWN0b3IiLCJvdXRwdXRDaGFubmVsIiwic2VydmljZUNvbnRhaW5lciIsIlByb2R1Y3QiLCJwcm9zcGVjdG9yIiwicnVuTGludGVyIiwiZG9jdW1lbnQiLCJjYW5jZWxsYXRpb24iLCJjd2QiLCJnZXRXb3Jrc3BhY2VSb290UGF0aCIsInJlbGF0aXZlUGF0aCIsInJlbGF0aXZlIiwidXJpIiwiZnNQYXRoIiwicnVuIiwicGFyc2VNZXNzYWdlcyIsIm91dHB1dCIsInRva2VuIiwicmVnRXgiLCJwYXJzZWREYXRhIiwiSlNPTiIsInBhcnNlIiwiZXgiLCJhcHBlbmRMaW5lIiwicmVwZWF0IiwiaW5mbyIsImlkIiwiYXBwZW5kIiwibG9nZ2VyIiwibG9nRXJyb3IiLCJtZXNzYWdlcyIsImZpbHRlciIsImluZGV4IiwicHl0aG9uU2V0dGluZ3MiLCJsaW50aW5nIiwibWF4TnVtYmVyT2ZQcm9ibGVtcyIsIm1hcCIsIm1zZyIsImxpbmVOdW1iZXIiLCJsb2NhdGlvbiIsImxpbmUiLCJpc05hTiIsImNvZGUiLCJtZXNzYWdlIiwiY29sdW1uIiwiY2hhcmFjdGVyIiwidHlwZSIsInByb3ZpZGVyIiwic291cmNlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9B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RUFBRVQsR0FBRyxDQUFDSyxJQUxQO0FBTUhLLFVBQUFBLFFBQVEsRUFBRyxHQUFFLEtBQUt0QixJQUFMLENBQVVDLEVBQUcsTUFBS1csR0FBRyxDQUFDVyxNQUFPO0FBTnZDLFNBQVA7QUFRSCxPQVpNLENBQVA7QUFhSCxLQXhCZSxDQUFoQjtBQXlCSDs7QUFyQzRDOztBQXVDakR2RCxPQUFPLENBQUNLLFVBQVIsR0FBcUJBLFVBQXJCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5yZXF1aXJlKFwiLi4vY29tbW9uL2V4dGVuc2lvbnNcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBiYXNlTGludGVyXzEgPSByZXF1aXJlKFwiLi9iYXNlTGludGVyXCIpO1xyXG5jbGFzcyBQcm9zcGVjdG9yIGV4dGVuZHMgYmFzZUxpbnRlcl8xLkJhc2VMaW50ZXIge1xyXG4gICAgY29uc3RydWN0b3Iob3V0cHV0Q2hhbm5lbCwgc2VydmljZUNvbnRhaW5lcikge1xyXG4gICAgICAgIHN1cGVyKHR5cGVzXzEuUHJvZHVjdC5wcm9zcGVjdG9yLCBvdXRwdXRDaGFubmVsLCBzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgIH1cclxuICAgIHJ1bkxpbnRlcihkb2N1bWVudCwgY2FuY2VsbGF0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgY3dkID0gdGhpcy5nZXRXb3Jrc3BhY2VSb290UGF0aChkb2N1bWVudCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGgucmVsYXRpdmUoY3dkLCBkb2N1bWVudC51cmkuZnNQYXRoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucnVuKFsnLS1hYnNvbHV0ZS1wYXRocycsICctLW91dHB1dC1mb3JtYXQ9anNvbicsIHJlbGF0aXZlUGF0aF0sIGRvY3VtZW50LCBjYW5jZWxsYXRpb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcGFyc2VNZXNzYWdlcyhvdXRwdXQsIGRvY3VtZW50LCB0b2tlbiwgcmVnRXgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBsZXQgcGFyc2VkRGF0YTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHBhcnNlZERhdGEgPSBKU09OLnBhcnNlKG91dHB1dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm91dHB1dENoYW5uZWwuYXBwZW5kTGluZShgJHsnIycucmVwZWF0KDEwKX1MaW50aW5nIE91dHB1dCAtICR7dGhpcy5pbmZvLmlkfSR7JyMnLnJlcGVhdCgxMCl9YCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm91dHB1dENoYW5uZWwuYXBwZW5kKG91dHB1dCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2dFcnJvcignRmFpbGVkIHRvIHBhcnNlIFByb3NwZWN0b3Igb3V0cHV0JywgZXgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJzZWREYXRhLm1lc3NhZ2VzXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKCh2YWx1ZSwgaW5kZXgpID0+IGluZGV4IDw9IHRoaXMucHl0aG9uU2V0dGluZ3MubGludGluZy5tYXhOdW1iZXJPZlByb2JsZW1zKVxyXG4gICAgICAgICAgICAgICAgLm1hcChtc2cgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGluZU51bWJlciA9IG1zZy5sb2NhdGlvbi5saW5lID09PSBudWxsIHx8IGlzTmFOKG1zZy5sb2NhdGlvbi5saW5lKSA/IDEgOiBtc2cubG9jYXRpb24ubGluZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZTogbXNnLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbXNnLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBtc2cubG9jYXRpb24uY2hhcmFjdGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbmU6IGxpbmVOdW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbXNnLmNvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXI6IGAke3RoaXMuaW5mby5pZH0gLSAke21zZy5zb3VyY2V9YFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5Qcm9zcGVjdG9yID0gUHJvc3BlY3RvcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvc3BlY3Rvci5qcy5tYXAiXX0=