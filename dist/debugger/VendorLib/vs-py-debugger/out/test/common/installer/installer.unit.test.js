"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length no-invalid-this

const chai_1 = require("chai");

const chaiAsPromised = require("chai-as-promised");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../../client/common/application/types");

require("../../../client/common/extensions");

const productInstaller_1 = require("../../../client/common/installer/productInstaller");

const productService_1 = require("../../../client/common/installer/productService");

const types_2 = require("../../../client/common/installer/types");

const types_3 = require("../../../client/common/types");

const async_1 = require("../../../client/common/utils/async");

const enum_1 = require("../../../client/common/utils/enum");

chai_1.use(chaiAsPromised);
suite('Module Installer', () => {
  [undefined, vscode_1.Uri.file('resource')].forEach(resource => {
    enum_1.getNamesAndValues(types_3.Product).forEach(product => {
      let disposables = [];
      let installer;
      let installationChannel;
      let moduleInstaller;
      let serviceContainer;
      let app;
      let promptDeferred;
      let workspaceService;
      setup(() => {
        promptDeferred = async_1.createDeferred();
        serviceContainer = TypeMoq.Mock.ofType();
        const outputChannel = TypeMoq.Mock.ofType();
        disposables = [];
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IDisposableRegistry), TypeMoq.It.isAny())).returns(() => disposables);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IProductService), TypeMoq.It.isAny())).returns(() => new productService_1.ProductService());
        installationChannel = TypeMoq.Mock.ofType();
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IInstallationChannelManager), TypeMoq.It.isAny())).returns(() => installationChannel.object);
        app = TypeMoq.Mock.ofType();
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IApplicationShell), TypeMoq.It.isAny())).returns(() => app.object);
        workspaceService = TypeMoq.Mock.ofType();
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IWorkspaceService), TypeMoq.It.isAny())).returns(() => workspaceService.object);
        moduleInstaller = TypeMoq.Mock.ofType(); // tslint:disable-next-line:no-any

        moduleInstaller.setup(x => x.then).returns(() => undefined);
        installationChannel.setup(i => i.getInstallationChannel(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve(moduleInstaller.object));
        installationChannel.setup(i => i.getInstallationChannel(TypeMoq.It.isAny())).returns(() => Promise.resolve(moduleInstaller.object));
        const productPathService = TypeMoq.Mock.ofType();
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IProductPathService), TypeMoq.It.isAny())).returns(() => productPathService.object);
        productPathService.setup(p => p.getExecutableNameFromSettings(TypeMoq.It.isAny(), TypeMoq.It.isValue(resource))).returns(() => 'xyz');
        productPathService.setup(p => p.isExecutableAModule(TypeMoq.It.isAny(), TypeMoq.It.isValue(resource))).returns(() => true);
        installer = new productInstaller_1.ProductInstaller(serviceContainer.object, outputChannel.object);
      });
      teardown(() => {
        // This must be resolved, else all subsequent tests will fail (as this same promise will be used for other tests).
        promptDeferred.resolve();
        disposables.forEach(disposable => {
          if (disposable) {
            disposable.dispose();
          }
        });
      });

      switch (product.value) {
        case types_3.Product.isort:
        case types_3.Product.ctags:
          {
            return;
          }

        case types_3.Product.unittest:
          {
            test(`Ensure resource info is passed into the module installer ${product.name} (${resource ? 'With a resource' : 'without a resource'})`, () => __awaiter(void 0, void 0, void 0, function* () {
              const response = yield installer.install(product.value, resource);
              chai_1.expect(response).to.be.equal(types_3.InstallerResponse.Installed);
            }));
            test(`Ensure resource info is passed into the module installer  (created using ProductInstaller) ${product.name} (${resource ? 'With a resource' : 'without a resource'})`, () => __awaiter(void 0, void 0, void 0, function* () {
              const response = yield installer.install(product.value, resource);
              chai_1.expect(response).to.be.equal(types_3.InstallerResponse.Installed);
            }));
          }

        default:
          {
            test(`Ensure resource info is passed into the module installer ${product.name} (${resource ? 'With a resource' : 'without a resource'})`, () => __awaiter(void 0, void 0, void 0, function* () {
              const moduleName = installer.translateProductToModuleName(product.value, types_3.ModuleNamePurpose.install);
              const logger = TypeMoq.Mock.ofType();
              logger.setup(l => l.logError(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => new Error('UnitTesting'));
              serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.ILogger), TypeMoq.It.isAny())).returns(() => logger.object);
              moduleInstaller.setup(m => m.installModule(TypeMoq.It.isValue(moduleName), TypeMoq.It.isValue(resource))).returns(() => Promise.reject(new Error('UnitTesting')));

              try {
                yield installer.install(product.value, resource);
              } catch (ex) {
                moduleInstaller.verify(m => m.installModule(TypeMoq.It.isValue(moduleName), TypeMoq.It.isValue(resource)), TypeMoq.Times.once());
              }
            }));
            test(`Ensure resource info is passed into the module installer (created using ProductInstaller) ${product.name} (${resource ? 'With a resource' : 'without a resource'})`, () => __awaiter(void 0, void 0, void 0, function* () {
              const moduleName = installer.translateProductToModuleName(product.value, types_3.ModuleNamePurpose.install);
              const logger = TypeMoq.Mock.ofType();
              logger.setup(l => l.logError(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => new Error('UnitTesting'));
              serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.ILogger), TypeMoq.It.isAny())).returns(() => logger.object);
              moduleInstaller.setup(m => m.installModule(TypeMoq.It.isValue(moduleName), TypeMoq.It.isValue(resource))).returns(() => Promise.reject(new Error('UnitTesting')));

              try {
                yield installer.install(product.value, resource);
              } catch (ex) {
                moduleInstaller.verify(m => m.installModule(TypeMoq.It.isValue(moduleName), TypeMoq.It.isValue(resource)), TypeMoq.Times.once());
              }
            }));

            if (product.value !== types_3.Product.unittest) {
              test(`Ensure the prompt is displayed only once, untill the prompt is closed, ${product.name} (${resource ? 'With a resource' : 'without a resource'})`, () => __awaiter(void 0, void 0, void 0, function* () {
                workspaceService.setup(w => w.getWorkspaceFolder(TypeMoq.It.isValue(resource))).returns(() => TypeMoq.Mock.ofType().object).verifiable(TypeMoq.Times.exactly(resource ? 5 : 0));
                app.setup(a => a.showErrorMessage(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => promptDeferred.promise).verifiable(TypeMoq.Times.once()); // Display first prompt.

                installer.promptToInstall(product.value, resource).ignoreErrors(); // Display a few more prompts.

                installer.promptToInstall(product.value, resource).ignoreErrors();
                installer.promptToInstall(product.value, resource).ignoreErrors();
                installer.promptToInstall(product.value, resource).ignoreErrors();
                installer.promptToInstall(product.value, resource).ignoreErrors();
                app.verifyAll();
                workspaceService.verifyAll();
              }));
              test(`Ensure the prompt is displayed again when previous prompt has been closed, ${product.name} (${resource ? 'With a resource' : 'without a resource'})`, () => __awaiter(void 0, void 0, void 0, function* () {
                workspaceService.setup(w => w.getWorkspaceFolder(TypeMoq.It.isValue(resource))).returns(() => TypeMoq.Mock.ofType().object).verifiable(TypeMoq.Times.exactly(resource ? 3 : 0));
                app.setup(a => a.showErrorMessage(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve(undefined)).verifiable(TypeMoq.Times.exactly(3));
                yield installer.promptToInstall(product.value, resource);
                yield installer.promptToInstall(product.value, resource);
                yield installer.promptToInstall(product.value, resource);
                app.verifyAll();
                workspaceService.verifyAll();
              }));
            }
          }
      }
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbGxlci51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJjaGFpQXNQcm9taXNlZCIsIlR5cGVNb3EiLCJ2c2NvZGVfMSIsInR5cGVzXzEiLCJwcm9kdWN0SW5zdGFsbGVyXzEiLCJwcm9kdWN0U2VydmljZV8xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJhc3luY18xIiwiZW51bV8xIiwidXNlIiwic3VpdGUiLCJ1bmRlZmluZWQiLCJVcmkiLCJmaWxlIiwiZm9yRWFjaCIsInJlc291cmNlIiwiZ2V0TmFtZXNBbmRWYWx1ZXMiLCJQcm9kdWN0IiwicHJvZHVjdCIsImRpc3Bvc2FibGVzIiwiaW5zdGFsbGVyIiwiaW5zdGFsbGF0aW9uQ2hhbm5lbCIsIm1vZHVsZUluc3RhbGxlciIsInNlcnZpY2VDb250YWluZXIiLCJhcHAiLCJwcm9tcHREZWZlcnJlZCIsIndvcmtzcGFjZVNlcnZpY2UiLCJzZXR1cCIsImNyZWF0ZURlZmVycmVkIiwiTW9jayIsIm9mVHlwZSIsIm91dHB1dENoYW5uZWwiLCJjIiwiZ2V0IiwiSXQiLCJpc1ZhbHVlIiwiSURpc3Bvc2FibGVSZWdpc3RyeSIsImlzQW55IiwicmV0dXJucyIsIklQcm9kdWN0U2VydmljZSIsIlByb2R1Y3RTZXJ2aWNlIiwiSUluc3RhbGxhdGlvbkNoYW5uZWxNYW5hZ2VyIiwib2JqZWN0IiwiSUFwcGxpY2F0aW9uU2hlbGwiLCJJV29ya3NwYWNlU2VydmljZSIsIngiLCJpIiwiZ2V0SW5zdGFsbGF0aW9uQ2hhbm5lbCIsInByb2R1Y3RQYXRoU2VydmljZSIsIklQcm9kdWN0UGF0aFNlcnZpY2UiLCJwIiwiZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MiLCJpc0V4ZWN1dGFibGVBTW9kdWxlIiwiUHJvZHVjdEluc3RhbGxlciIsInRlYXJkb3duIiwiZGlzcG9zYWJsZSIsImRpc3Bvc2UiLCJpc29ydCIsImN0YWdzIiwidW5pdHRlc3QiLCJ0ZXN0IiwibmFtZSIsInJlc3BvbnNlIiwiaW5zdGFsbCIsImV4cGVjdCIsInRvIiwiYmUiLCJlcXVhbCIsIkluc3RhbGxlclJlc3BvbnNlIiwiSW5zdGFsbGVkIiwibW9kdWxlTmFtZSIsInRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUiLCJNb2R1bGVOYW1lUHVycG9zZSIsImxvZ2dlciIsImwiLCJsb2dFcnJvciIsIkVycm9yIiwiSUxvZ2dlciIsIm0iLCJpbnN0YWxsTW9kdWxlIiwiZXgiLCJ2ZXJpZnkiLCJUaW1lcyIsIm9uY2UiLCJ3IiwiZ2V0V29ya3NwYWNlRm9sZGVyIiwidmVyaWZpYWJsZSIsImV4YWN0bHkiLCJhIiwic2hvd0Vycm9yTWVzc2FnZSIsInByb21pc2UiLCJwcm9tcHRUb0luc3RhbGwiLCJpZ25vcmVFcnJvcnMiLCJ2ZXJpZnlBbGwiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENB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QUEySXJDLE9BQU8sQ0FBQ2tDLEVBQVIsQ0FBV0csS0FBWCxFQUEzSSxFQUErSnJDLE9BQU8sQ0FBQ2tDLEVBQVIsQ0FBV0csS0FBWCxFQUEvSixDQUFmLEVBQ0tDLE9BREwsQ0FDYSxNQUFNekQsT0FBTyxDQUFDQyxPQUFSLENBQWdCNkIsU0FBaEIsQ0FEbkIsRUFFSzJFLFVBRkwsQ0FFZ0J0RixPQUFPLENBQUNrRixLQUFSLENBQWNLLE9BQWQsQ0FBc0IsQ0FBdEIsQ0FGaEI7QUFHQSxzQkFBTW5FLFNBQVMsQ0FBQ3VFLGVBQVYsQ0FBMEJ6RSxPQUFPLENBQUNqQyxLQUFsQyxFQUF5QzhCLFFBQXpDLENBQU47QUFDQSxzQkFBTUssU0FBUyxDQUFDdUUsZUFBVixDQUEwQnpFLE9BQU8sQ0FBQ2pDLEtBQWxDLEVBQXlDOEIsUUFBekMsQ0FBTjtBQUNBLHNCQUFNSyxTQUFTLENBQUN1RSxlQUFWLENBQTBCekUsT0FBTyxDQUFDakMsS0FBbEMsRUFBeUM4QixRQUF6QyxDQUFOO0FBQ0FTLGdCQUFBQSxHQUFHLENBQUNxRSxTQUFKO0FBQ0FuRSxnQkFBQUEsZ0JBQWdCLENBQUNtRSxTQUFqQjtBQUNILGVBWjBLLENBQXZLLENBQUo7QUFhSDtBQUNKO0FBMUVMO0FBNEVILEtBdEhEO0FBdUhILEdBeEhEO0FBeUhILENBMUhJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZnVuYy1ib2R5LWxlbmd0aCBuby1pbnZhbGlkLXRoaXNcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IGNoYWlBc1Byb21pc2VkID0gcmVxdWlyZShcImNoYWktYXMtcHJvbWlzZWRcIik7XHJcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbnJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL2V4dGVuc2lvbnNcIik7XHJcbmNvbnN0IHByb2R1Y3RJbnN0YWxsZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL2luc3RhbGxlci9wcm9kdWN0SW5zdGFsbGVyXCIpO1xyXG5jb25zdCBwcm9kdWN0U2VydmljZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vaW5zdGFsbGVyL3Byb2R1Y3RTZXJ2aWNlXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vaW5zdGFsbGVyL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGFzeW5jXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9hc3luY1wiKTtcclxuY29uc3QgZW51bV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdXRpbHMvZW51bVwiKTtcclxuY2hhaV8xLnVzZShjaGFpQXNQcm9taXNlZCk7XHJcbnN1aXRlKCdNb2R1bGUgSW5zdGFsbGVyJywgKCkgPT4ge1xyXG4gICAgW3VuZGVmaW5lZCwgdnNjb2RlXzEuVXJpLmZpbGUoJ3Jlc291cmNlJyldLmZvckVhY2gocmVzb3VyY2UgPT4ge1xyXG4gICAgICAgIGVudW1fMS5nZXROYW1lc0FuZFZhbHVlcyh0eXBlc18zLlByb2R1Y3QpLmZvckVhY2gocHJvZHVjdCA9PiB7XHJcbiAgICAgICAgICAgIGxldCBkaXNwb3NhYmxlcyA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgaW5zdGFsbGVyO1xyXG4gICAgICAgICAgICBsZXQgaW5zdGFsbGF0aW9uQ2hhbm5lbDtcclxuICAgICAgICAgICAgbGV0IG1vZHVsZUluc3RhbGxlcjtcclxuICAgICAgICAgICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICAgICAgICAgIGxldCBhcHA7XHJcbiAgICAgICAgICAgIGxldCBwcm9tcHREZWZlcnJlZDtcclxuICAgICAgICAgICAgbGV0IHdvcmtzcGFjZVNlcnZpY2U7XHJcbiAgICAgICAgICAgIHNldHVwKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHByb21wdERlZmVycmVkID0gYXN5bmNfMS5jcmVhdGVEZWZlcnJlZCgpO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dENoYW5uZWwgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBkaXNwb3NhYmxlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18zLklEaXNwb3NhYmxlUmVnaXN0cnkpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IGRpc3Bvc2FibGVzKTtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JUHJvZHVjdFNlcnZpY2UpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IG5ldyBwcm9kdWN0U2VydmljZV8xLlByb2R1Y3RTZXJ2aWNlKCkpO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFsbGF0aW9uQ2hhbm5lbCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JSW5zdGFsbGF0aW9uQ2hhbm5lbE1hbmFnZXIpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IGluc3RhbGxhdGlvbkNoYW5uZWwub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIGFwcCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JQXBwbGljYXRpb25TaGVsbCksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gYXBwLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlKSwgVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiB3b3Jrc3BhY2VTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGVJbnN0YWxsZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgICAgICAgICBtb2R1bGVJbnN0YWxsZXIuc2V0dXAoKHgpID0+IHgudGhlbikucmV0dXJucygoKSA9PiB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFsbGF0aW9uQ2hhbm5lbC5zZXR1cChpID0+IGkuZ2V0SW5zdGFsbGF0aW9uQ2hhbm5lbChUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG1vZHVsZUluc3RhbGxlci5vYmplY3QpKTtcclxuICAgICAgICAgICAgICAgIGluc3RhbGxhdGlvbkNoYW5uZWwuc2V0dXAoaSA9PiBpLmdldEluc3RhbGxhdGlvbkNoYW5uZWwoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUobW9kdWxlSW5zdGFsbGVyLm9iamVjdCkpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJvZHVjdFBhdGhTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklQcm9kdWN0UGF0aFNlcnZpY2UpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHByb2R1Y3RQYXRoU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgcHJvZHVjdFBhdGhTZXJ2aWNlLnNldHVwKHAgPT4gcC5nZXRFeGVjdXRhYmxlTmFtZUZyb21TZXR0aW5ncyhUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZShyZXNvdXJjZSkpKS5yZXR1cm5zKCgpID0+ICd4eXonKTtcclxuICAgICAgICAgICAgICAgIHByb2R1Y3RQYXRoU2VydmljZS5zZXR1cChwID0+IHAuaXNFeGVjdXRhYmxlQU1vZHVsZShUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZShyZXNvdXJjZSkpKS5yZXR1cm5zKCgpID0+IHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFsbGVyID0gbmV3IHByb2R1Y3RJbnN0YWxsZXJfMS5Qcm9kdWN0SW5zdGFsbGVyKHNlcnZpY2VDb250YWluZXIub2JqZWN0LCBvdXRwdXRDaGFubmVsLm9iamVjdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0ZWFyZG93bigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG11c3QgYmUgcmVzb2x2ZWQsIGVsc2UgYWxsIHN1YnNlcXVlbnQgdGVzdHMgd2lsbCBmYWlsIChhcyB0aGlzIHNhbWUgcHJvbWlzZSB3aWxsIGJlIHVzZWQgZm9yIG90aGVyIHRlc3RzKS5cclxuICAgICAgICAgICAgICAgIHByb21wdERlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIGRpc3Bvc2FibGVzLmZvckVhY2goZGlzcG9zYWJsZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3Bvc2FibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcG9zYWJsZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHByb2R1Y3QudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMy5Qcm9kdWN0Lmlzb3J0OlxyXG4gICAgICAgICAgICAgICAgY2FzZSB0eXBlc18zLlByb2R1Y3QuY3RhZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzMuUHJvZHVjdC51bml0dGVzdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlc3QoYEVuc3VyZSByZXNvdXJjZSBpbmZvIGlzIHBhc3NlZCBpbnRvIHRoZSBtb2R1bGUgaW5zdGFsbGVyICR7cHJvZHVjdC5uYW1lfSAoJHtyZXNvdXJjZSA/ICdXaXRoIGEgcmVzb3VyY2UnIDogJ3dpdGhvdXQgYSByZXNvdXJjZSd9KWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBpbnN0YWxsZXIuaW5zdGFsbChwcm9kdWN0LnZhbHVlLCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3QocmVzcG9uc2UpLnRvLmJlLmVxdWFsKHR5cGVzXzMuSW5zdGFsbGVyUmVzcG9uc2UuSW5zdGFsbGVkKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdChgRW5zdXJlIHJlc291cmNlIGluZm8gaXMgcGFzc2VkIGludG8gdGhlIG1vZHVsZSBpbnN0YWxsZXIgIChjcmVhdGVkIHVzaW5nIFByb2R1Y3RJbnN0YWxsZXIpICR7cHJvZHVjdC5uYW1lfSAoJHtyZXNvdXJjZSA/ICdXaXRoIGEgcmVzb3VyY2UnIDogJ3dpdGhvdXQgYSByZXNvdXJjZSd9KWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBpbnN0YWxsZXIuaW5zdGFsbChwcm9kdWN0LnZhbHVlLCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3QocmVzcG9uc2UpLnRvLmJlLmVxdWFsKHR5cGVzXzMuSW5zdGFsbGVyUmVzcG9uc2UuSW5zdGFsbGVkKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdChgRW5zdXJlIHJlc291cmNlIGluZm8gaXMgcGFzc2VkIGludG8gdGhlIG1vZHVsZSBpbnN0YWxsZXIgJHtwcm9kdWN0Lm5hbWV9ICgke3Jlc291cmNlID8gJ1dpdGggYSByZXNvdXJjZScgOiAnd2l0aG91dCBhIHJlc291cmNlJ30pYCwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVOYW1lID0gaW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdC52YWx1ZSwgdHlwZXNfMy5Nb2R1bGVOYW1lUHVycG9zZS5pbnN0YWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9nZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc2V0dXAobCA9PiBsLmxvZ0Vycm9yKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBuZXcgRXJyb3IoJ1VuaXRUZXN0aW5nJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSUxvZ2dlciksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gbG9nZ2VyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZUluc3RhbGxlci5zZXR1cChtID0+IG0uaW5zdGFsbE1vZHVsZShUeXBlTW9xLkl0LmlzVmFsdWUobW9kdWxlTmFtZSksIFR5cGVNb3EuSXQuaXNWYWx1ZShyZXNvdXJjZSkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignVW5pdFRlc3RpbmcnKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgaW5zdGFsbGVyLmluc3RhbGwocHJvZHVjdC52YWx1ZSwgcmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSW5zdGFsbGVyLnZlcmlmeShtID0+IG0uaW5zdGFsbE1vZHVsZShUeXBlTW9xLkl0LmlzVmFsdWUobW9kdWxlTmFtZSksIFR5cGVNb3EuSXQuaXNWYWx1ZShyZXNvdXJjZSkpLCBUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVzdChgRW5zdXJlIHJlc291cmNlIGluZm8gaXMgcGFzc2VkIGludG8gdGhlIG1vZHVsZSBpbnN0YWxsZXIgKGNyZWF0ZWQgdXNpbmcgUHJvZHVjdEluc3RhbGxlcikgJHtwcm9kdWN0Lm5hbWV9ICgke3Jlc291cmNlID8gJ1dpdGggYSByZXNvdXJjZScgOiAnd2l0aG91dCBhIHJlc291cmNlJ30pYCwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2R1bGVOYW1lID0gaW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdC52YWx1ZSwgdHlwZXNfMy5Nb2R1bGVOYW1lUHVycG9zZS5pbnN0YWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9nZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc2V0dXAobCA9PiBsLmxvZ0Vycm9yKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBuZXcgRXJyb3IoJ1VuaXRUZXN0aW5nJykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSUxvZ2dlciksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gbG9nZ2VyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZUluc3RhbGxlci5zZXR1cChtID0+IG0uaW5zdGFsbE1vZHVsZShUeXBlTW9xLkl0LmlzVmFsdWUobW9kdWxlTmFtZSksIFR5cGVNb3EuSXQuaXNWYWx1ZShyZXNvdXJjZSkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignVW5pdFRlc3RpbmcnKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgaW5zdGFsbGVyLmluc3RhbGwocHJvZHVjdC52YWx1ZSwgcmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlSW5zdGFsbGVyLnZlcmlmeShtID0+IG0uaW5zdGFsbE1vZHVsZShUeXBlTW9xLkl0LmlzVmFsdWUobW9kdWxlTmFtZSksIFR5cGVNb3EuSXQuaXNWYWx1ZShyZXNvdXJjZSkpLCBUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2R1Y3QudmFsdWUgIT09IHR5cGVzXzMuUHJvZHVjdC51bml0dGVzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXN0KGBFbnN1cmUgdGhlIHByb21wdCBpcyBkaXNwbGF5ZWQgb25seSBvbmNlLCB1bnRpbGwgdGhlIHByb21wdCBpcyBjbG9zZWQsICR7cHJvZHVjdC5uYW1lfSAoJHtyZXNvdXJjZSA/ICdXaXRoIGEgcmVzb3VyY2UnIDogJ3dpdGhvdXQgYSByZXNvdXJjZSd9KWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LmdldFdvcmtzcGFjZUZvbGRlcihUeXBlTW9xLkl0LmlzVmFsdWUocmVzb3VyY2UpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBUeXBlTW9xLk1vY2sub2ZUeXBlKCkub2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMuZXhhY3RseShyZXNvdXJjZSA/IDUgOiAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAuc2V0dXAoYSA9PiBhLnNob3dFcnJvck1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHByb21wdERlZmVycmVkLnByb21pc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGlzcGxheSBmaXJzdCBwcm9tcHQuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YWxsZXIucHJvbXB0VG9JbnN0YWxsKHByb2R1Y3QudmFsdWUsIHJlc291cmNlKS5pZ25vcmVFcnJvcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgYSBmZXcgbW9yZSBwcm9tcHRzLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbGVyLnByb21wdFRvSW5zdGFsbChwcm9kdWN0LnZhbHVlLCByZXNvdXJjZSkuaWdub3JlRXJyb3JzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YWxsZXIucHJvbXB0VG9JbnN0YWxsKHByb2R1Y3QudmFsdWUsIHJlc291cmNlKS5pZ25vcmVFcnJvcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbGxlci5wcm9tcHRUb0luc3RhbGwocHJvZHVjdC52YWx1ZSwgcmVzb3VyY2UpLmlnbm9yZUVycm9ycygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbGVyLnByb21wdFRvSW5zdGFsbChwcm9kdWN0LnZhbHVlLCByZXNvdXJjZSkuaWdub3JlRXJyb3JzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QoYEVuc3VyZSB0aGUgcHJvbXB0IGlzIGRpc3BsYXllZCBhZ2FpbiB3aGVuIHByZXZpb3VzIHByb21wdCBoYXMgYmVlbiBjbG9zZWQsICR7cHJvZHVjdC5uYW1lfSAoJHtyZXNvdXJjZSA/ICdXaXRoIGEgcmVzb3VyY2UnIDogJ3dpdGhvdXQgYSByZXNvdXJjZSd9KWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LmdldFdvcmtzcGFjZUZvbGRlcihUeXBlTW9xLkl0LmlzVmFsdWUocmVzb3VyY2UpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBUeXBlTW9xLk1vY2sub2ZUeXBlKCkub2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMuZXhhY3RseShyZXNvdXJjZSA/IDMgOiAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAuc2V0dXAoYSA9PiBhLnNob3dFcnJvck1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMuZXhhY3RseSgzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCBpbnN0YWxsZXIucHJvbXB0VG9JbnN0YWxsKHByb2R1Y3QudmFsdWUsIHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIGluc3RhbGxlci5wcm9tcHRUb0luc3RhbGwocHJvZHVjdC52YWx1ZSwgcmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgaW5zdGFsbGVyLnByb21wdFRvSW5zdGFsbChwcm9kdWN0LnZhbHVlLCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluc3RhbGxlci51bml0LnRlc3QuanMubWFwIl19