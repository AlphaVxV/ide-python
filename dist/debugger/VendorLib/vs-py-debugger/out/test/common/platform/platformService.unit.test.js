// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const os = require("os");

const platformService_1 = require("../../../client/common/platform/platformService");

const platform_1 = require("../../../client/common/utils/platform"); // tslint:disable-next-line:max-func-body-length


suite('PlatformService', () => {
  test('local info', () => __awaiter(void 0, void 0, void 0, function* () {
    const expected = platform_1.getInfo();
    const svc = new platformService_1.PlatformService();
    const info = svc.info;
    chai_1.expect(info).to.deep.equal(expected, 'invalid value');
  }));
  test('pathVariableName', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected = 'PATH';

    if (/^win/.test(process.platform)) {
      expected = 'Path';
    }

    const svc = new platformService_1.PlatformService();
    const result = svc.pathVariableName;
    chai_1.expect(result).to.be.equal(expected, 'invalid value');
  }));
  test('virtualEnvBinName - Windows', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected = 'bin';

    if (/^win/.test(process.platform)) {
      expected = 'scripts';
    }

    const svc = new platformService_1.PlatformService();
    const result = svc.virtualEnvBinName;
    chai_1.expect(result).to.be.equal(expected, 'invalid value');
  }));
  test('isWindows', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected = false;

    if (/^win/.test(process.platform)) {
      expected = true;
    }

    const svc = new platformService_1.PlatformService();
    const result = svc.isWindows;
    chai_1.expect(result).to.be.equal(expected, 'invalid value');
  }));
  test('isMac', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected = false;

    if (/^darwin/.test(process.platform)) {
      expected = true;
    }

    const svc = new platformService_1.PlatformService();
    const result = svc.isMac;
    chai_1.expect(result).to.be.equal(expected, 'invalid value');
  }));
  test('isLinux', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected = false;

    if (/^linux/.test(process.platform)) {
      expected = true;
    }

    const svc = new platformService_1.PlatformService();
    const result = svc.isLinux;
    chai_1.expect(result).to.be.equal(expected, 'invalid value');
  }));
  test('is64bit', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected = true;

    if (os.arch() !== 'x64') {
      expected = false;
    }

    const svc = new platformService_1.PlatformService();
    const result = svc.is64bit;
    chai_1.expect(result).to.be.equal(expected, 'invalid value');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsYXRmb3JtU2VydmljZS51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJvcyIsInBsYXRmb3JtU2VydmljZV8xIiwicGxhdGZvcm1fMSIsInN1aXRlIiwidGVzdCIsImV4cGVjdGVkIiwiZ2V0SW5mbyIsInN2YyIsIlBsYXRmb3JtU2VydmljZSIsImluZm8iLCJleHBlY3QiLCJ0byIsImRlZXAiLCJlcXVhbCIsInByb2Nlc3MiLCJwbGF0Zm9ybSIsInBhdGhWYXJpYWJsZU5hbWUiLCJiZSIsInZpcnR1YWxFbnZCaW5OYW1lIiwiaXNXaW5kb3dzIiwiaXNNYWMiLCJpc0xpbnV4IiwiYXJjaCIsImlzNjRiaXQiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFyQixHQUFzQyxJQUFJTixDQUFKLENBQU0sVUFBVUcsT0FBVixFQUFtQjtBQUFFQSxRQUFBQSxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFQO0FBQXdCLE9BQW5ELEVBQXFETyxJQUFyRCxDQUEwRFIsU0FBMUQsRUFBcUVLLFFBQXJFLENBQXRDO0FBQXVIOztBQUMvSUgsSUFBQUEsSUFBSSxDQUFDLENBQUNOLFNBQVMsR0FBR0EsU0FBUyxDQUFDYSxLQUFWLENBQWdCaEIsT0FBaEIsRUFBeUJDLFVBQVUsSUFBSSxFQUF2QyxDQUFiLEVBQXlEUyxJQUF6RCxFQUFELENBQUo7QUFDSCxHQUxNLENBQVA7QUFNSCxDQVBEOztBQVFBTyxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVYLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1ZLE1BQU0sR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBdEI7O0FBQ0EsTUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUMsSUFBRCxDQUFsQjs7QUFDQSxNQUFNRSxpQkFBaUIsR0FBR0YsT0FBTyxDQUFDLGlEQUFELENBQWpDOztBQUNBLE1BQU1HLFVBQVUsR0FBR0gsT0FBTyxDQUFDLHVDQUFELENBQTFCLEMsQ0FDQTs7O0FBQ0FJLEtBQUssQ0FBQyxpQkFBRCxFQUFvQixNQUFNO0FBQzNCQyxFQUFBQSxJQUFJLENBQUMsWUFBRCxFQUFlLE1BQU0zQixTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ2xFLFVBQU00QixRQUFRLEdBQUdILFVBQVUsQ0FBQ0ksT0FBWCxFQUFqQjtBQUNBLFVBQU1DLEdBQUcsR0FBRyxJQUFJTixpQkFBaUIsQ0FBQ08sZUFBdEIsRUFBWjtBQUNBLFVBQU1DLElBQUksR0FBR0YsR0FBRyxDQUFDRSxJQUFqQjtBQUNBWCxJQUFBQSxNQUFNLENBQUNZLE1BQVAsQ0FBY0QsSUFBZCxFQUFvQkUsRUFBcEIsQ0FBdUJDLElBQXZCLENBQTRCQyxLQUE1QixDQUFrQ1IsUUFBbEMsRUFBNEMsZUFBNUM7QUFDSCxHQUxpQyxDQUE5QixDQUFKO0FBTUFELEVBQUFBLElBQUksQ0FBQyxrQkFBRCxFQUFxQixNQUFNM0IsU0FBUyxTQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUN4RSxRQUFJNEIsUUFBUSxHQUFHLE1BQWY7O0FBQ0EsUUFBSSxPQUFPRCxJQUFQLENBQVlVLE9BQU8sQ0FBQ0MsUUFBcEIsQ0FBSixFQUFtQztBQUMvQlYsTUFBQUEsUUFBUSxHQUFHLE1BQVg7QUFDSDs7QUFDRCxVQUFNRSxHQUFHLEdBQUcsSUFBSU4saUJBQWlCLENBQUNPLGVBQXRCLEVBQVo7QUFDQSxVQUFNakIsTUFBTSxHQUFHZ0IsR0FBRyxDQUFDUyxnQkFBbkI7QUFDQWxCLElBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjbkIsTUFBZCxFQUFzQm9CLEVBQXRCLENBQXlCTSxFQUF6QixDQUE0QkosS0FBNUIsQ0FBa0NSLFFBQWxDLEVBQTRDLGVBQTVDO0FBQ0gsR0FSdUMsQ0FBcEMsQ0FBSjtBQVNBRCxFQUFBQSxJQUFJLENBQUMsNkJBQUQsRUFBZ0MsTUFBTTNCLFNBQVMsU0FBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDbkYsUUFBSTRCLFFBQVEsR0FBRyxLQUFmOztBQUNBLFFBQUksT0FBT0QsSUFBUCxDQUFZVSxPQUFPLENBQUNDLFFBQXBCLENBQUosRUFBbUM7QUFDL0JWLE1BQUFBLFFBQVEsR0FBRyxTQUFYO0FBQ0g7O0FBQ0QsVUFBTUUsR0FBRyxHQUFHLElBQUlOLGlCQUFpQixDQUFDTyxlQUF0QixFQUFaO0FBQ0EsVUFBTWpCLE1BQU0sR0FBR2dCLEdBQUcsQ0FBQ1csaUJBQW5CO0FBQ0FwQixJQUFBQSxNQUFNLENBQUNZLE1BQVAsQ0FBY25CLE1BQWQsRUFBc0JvQixFQUF0QixDQUF5Qk0sRUFBekIsQ0FBNEJKLEtBQTVCLENBQWtDUixRQUFsQyxFQUE0QyxlQUE1QztBQUNILEdBUmtELENBQS9DLENBQUo7QUFTQUQsRUFBQUEsSUFBSSxDQUFDLFdBQUQsRUFBYyxNQUFNM0IsU0FBUyxTQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUNqRSxRQUFJNEIsUUFBUSxHQUFHLEtBQWY7O0FBQ0EsUUFBSSxPQUFPRCxJQUFQLENBQVlVLE9BQU8sQ0FBQ0MsUUFBcEIsQ0FBSixFQUFtQztBQUMvQlYsTUFBQUEsUUFBUSxHQUFHLElBQVg7QUFDSDs7QUFDRCxVQUFNRSxHQUFHLEdBQUcsSUFBSU4saUJBQWlCLENBQUNPLGVBQXRCLEVBQVo7QUFDQSxVQUFNakIsTUFBTSxHQUFHZ0IsR0FBRyxDQUFDWSxTQUFuQjtBQUNBckIsSUFBQUEsTUFBTSxDQUFDWSxNQUFQLENBQWNuQixNQUFkLEVBQXNCb0IsRUFBdEIsQ0FBeUJNLEVBQXpCLENBQTRCSixLQUE1QixDQUFrQ1IsUUFBbEMsRUFBNEMsZUFBNUM7QUFDSCxHQVJnQyxDQUE3QixDQUFKO0FBU0FELEVBQUFBLElBQUksQ0FBQyxPQUFELEVBQVUsTUFBTTNCLFNBQVMsU0FBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDN0QsUUFBSTRCLFFBQVEsR0FBRyxLQUFmOztBQUNBLFFBQUksVUFBVUQsSUFBVixDQUFlVSxPQUFPLENBQUNDLFFBQXZCLENBQUosRUFBc0M7QUFDbENWLE1BQUFBLFFBQVEsR0FBRyxJQUFYO0FBQ0g7O0FBQ0QsVUFBTUUsR0FBRyxHQUFHLElBQUlOLGlCQUFpQixDQUFDTyxlQUF0QixFQUFaO0FBQ0EsVUFBTWpCLE1BQU0sR0FBR2dCLEdBQUcsQ0FBQ2EsS0FBbkI7QUFDQXRCLElBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjbkIsTUFBZCxFQUFzQm9CLEVBQXRCLENBQXlCTSxFQUF6QixDQUE0QkosS0FBNUIsQ0FBa0NSLFFBQWxDLEVBQTRDLGVBQTVDO0FBQ0gsR0FSNEIsQ0FBekIsQ0FBSjtBQVNBRCxFQUFBQSxJQUFJLENBQUMsU0FBRCxFQUFZLE1BQU0zQixTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQy9ELFFBQUk0QixRQUFRLEdBQUcsS0FBZjs7QUFDQSxRQUFJLFNBQVNELElBQVQsQ0FBY1UsT0FBTyxDQUFDQyxRQUF0QixDQUFKLEVBQXFDO0FBQ2pDVixNQUFBQSxRQUFRLEdBQUcsSUFBWDtBQUNIOztBQUNELFVBQU1FLEdBQUcsR0FBRyxJQUFJTixpQkFBaUIsQ0FBQ08sZUFBdEIsRUFBWjtBQUNBLFVBQU1qQixNQUFNLEdBQUdnQixHQUFHLENBQUNjLE9BQW5CO0FBQ0F2QixJQUFBQSxNQUFNLENBQUNZLE1BQVAsQ0FBY25CLE1BQWQsRUFBc0JvQixFQUF0QixDQUF5Qk0sRUFBekIsQ0FBNEJKLEtBQTVCLENBQWtDUixRQUFsQyxFQUE0QyxlQUE1QztBQUNILEdBUjhCLENBQTNCLENBQUo7QUFTQUQsRUFBQUEsSUFBSSxDQUFDLFNBQUQsRUFBWSxNQUFNM0IsU0FBUyxTQUFPLEtBQUssQ0FBWixFQUFlLEtBQUssQ0FBcEIsRUFBdUIsYUFBYTtBQUMvRCxRQUFJNEIsUUFBUSxHQUFHLElBQWY7O0FBQ0EsUUFBSUwsRUFBRSxDQUFDc0IsSUFBSCxPQUFjLEtBQWxCLEVBQXlCO0FBQ3JCakIsTUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDSDs7QUFDRCxVQUFNRSxHQUFHLEdBQUcsSUFBSU4saUJBQWlCLENBQUNPLGVBQXRCLEVBQVo7QUFDQSxVQUFNakIsTUFBTSxHQUFHZ0IsR0FBRyxDQUFDZ0IsT0FBbkI7QUFDQXpCLElBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjbkIsTUFBZCxFQUFzQm9CLEVBQXRCLENBQXlCTSxFQUF6QixDQUE0QkosS0FBNUIsQ0FBa0NSLFFBQWxDLEVBQTRDLGVBQTVDO0FBQ0gsR0FSOEIsQ0FBM0IsQ0FBSjtBQVNILENBN0RJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IG9zID0gcmVxdWlyZShcIm9zXCIpO1xyXG5jb25zdCBwbGF0Zm9ybVNlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL3BsYXRmb3JtU2VydmljZVwiKTtcclxuY29uc3QgcGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL3BsYXRmb3JtXCIpO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ1BsYXRmb3JtU2VydmljZScsICgpID0+IHtcclxuICAgIHRlc3QoJ2xvY2FsIGluZm8nLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBwbGF0Zm9ybV8xLmdldEluZm8oKTtcclxuICAgICAgICBjb25zdCBzdmMgPSBuZXcgcGxhdGZvcm1TZXJ2aWNlXzEuUGxhdGZvcm1TZXJ2aWNlKCk7XHJcbiAgICAgICAgY29uc3QgaW5mbyA9IHN2Yy5pbmZvO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoaW5mbykudG8uZGVlcC5lcXVhbChleHBlY3RlZCwgJ2ludmFsaWQgdmFsdWUnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ3BhdGhWYXJpYWJsZU5hbWUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgbGV0IGV4cGVjdGVkID0gJ1BBVEgnO1xyXG4gICAgICAgIGlmICgvXndpbi8udGVzdChwcm9jZXNzLnBsYXRmb3JtKSkge1xyXG4gICAgICAgICAgICBleHBlY3RlZCA9ICdQYXRoJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc3ZjID0gbmV3IHBsYXRmb3JtU2VydmljZV8xLlBsYXRmb3JtU2VydmljZSgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHN2Yy5wYXRoVmFyaWFibGVOYW1lO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzdWx0KS50by5iZS5lcXVhbChleHBlY3RlZCwgJ2ludmFsaWQgdmFsdWUnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ3ZpcnR1YWxFbnZCaW5OYW1lIC0gV2luZG93cycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBsZXQgZXhwZWN0ZWQgPSAnYmluJztcclxuICAgICAgICBpZiAoL153aW4vLnRlc3QocHJvY2Vzcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgICAgICAgZXhwZWN0ZWQgPSAnc2NyaXB0cyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHN2YyA9IG5ldyBwbGF0Zm9ybVNlcnZpY2VfMS5QbGF0Zm9ybVNlcnZpY2UoKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBzdmMudmlydHVhbEVudkJpbk5hbWU7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChyZXN1bHQpLnRvLmJlLmVxdWFsKGV4cGVjdGVkLCAnaW52YWxpZCB2YWx1ZScpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnaXNXaW5kb3dzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGxldCBleHBlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICgvXndpbi8udGVzdChwcm9jZXNzLnBsYXRmb3JtKSkge1xyXG4gICAgICAgICAgICBleHBlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHN2YyA9IG5ldyBwbGF0Zm9ybVNlcnZpY2VfMS5QbGF0Zm9ybVNlcnZpY2UoKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBzdmMuaXNXaW5kb3dzO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzdWx0KS50by5iZS5lcXVhbChleHBlY3RlZCwgJ2ludmFsaWQgdmFsdWUnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ2lzTWFjJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGxldCBleHBlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICgvXmRhcndpbi8udGVzdChwcm9jZXNzLnBsYXRmb3JtKSkge1xyXG4gICAgICAgICAgICBleHBlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHN2YyA9IG5ldyBwbGF0Zm9ybVNlcnZpY2VfMS5QbGF0Zm9ybVNlcnZpY2UoKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBzdmMuaXNNYWM7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChyZXN1bHQpLnRvLmJlLmVxdWFsKGV4cGVjdGVkLCAnaW52YWxpZCB2YWx1ZScpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnaXNMaW51eCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBsZXQgZXhwZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAoL15saW51eC8udGVzdChwcm9jZXNzLnBsYXRmb3JtKSkge1xyXG4gICAgICAgICAgICBleHBlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHN2YyA9IG5ldyBwbGF0Zm9ybVNlcnZpY2VfMS5QbGF0Zm9ybVNlcnZpY2UoKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBzdmMuaXNMaW51eDtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkudG8uYmUuZXF1YWwoZXhwZWN0ZWQsICdpbnZhbGlkIHZhbHVlJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdpczY0Yml0JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGxldCBleHBlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKG9zLmFyY2goKSAhPT0gJ3g2NCcpIHtcclxuICAgICAgICAgICAgZXhwZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgc3ZjID0gbmV3IHBsYXRmb3JtU2VydmljZV8xLlBsYXRmb3JtU2VydmljZSgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHN2Yy5pczY0Yml0O1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzdWx0KS50by5iZS5lcXVhbChleHBlY3RlZCwgJ2ludmFsaWQgdmFsdWUnKTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBsYXRmb3JtU2VydmljZS51bml0LnRlc3QuanMubWFwIl19