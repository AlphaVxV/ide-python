"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const TypeMoq = require("typemoq");

const types_1 = require("../../../client/common/application/types");

const types_2 = require("../../../client/common/platform/types");

const helper_1 = require("../../../client/common/terminal/helper");

const types_3 = require("../../../client/common/terminal/types");

const types_4 = require("../../../client/common/types");

const enum_1 = require("../../../client/common/utils/enum");

const contracts_1 = require("../../../client/interpreter/contracts"); // tslint:disable-next-line:max-func-body-length


suite('Terminal Service helpers', () => {
  let helper;
  let terminalManager;
  let platformService;
  let workspaceService;
  let disposables = [];
  let serviceContainer;
  let interpreterService;
  setup(() => {
    terminalManager = TypeMoq.Mock.ofType();
    platformService = TypeMoq.Mock.ofType();
    workspaceService = TypeMoq.Mock.ofType();
    interpreterService = TypeMoq.Mock.ofType();
    disposables = [];
    serviceContainer = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(types_1.ITerminalManager)).returns(() => terminalManager.object);
    serviceContainer.setup(c => c.get(types_2.IPlatformService)).returns(() => platformService.object);
    serviceContainer.setup(c => c.get(types_4.IDisposableRegistry)).returns(() => disposables);
    serviceContainer.setup(c => c.get(types_1.IWorkspaceService)).returns(() => workspaceService.object);
    serviceContainer.setup(c => c.get(contracts_1.IInterpreterService)).returns(() => interpreterService.object);
    helper = new helper_1.TerminalHelper(serviceContainer.object);
  });
  teardown(() => {
    disposables.filter(item => !!item).forEach(item => item.dispose());
  });
  test('Test identification of Terminal Shells', () => __awaiter(void 0, void 0, void 0, function* () {
    const shellPathsAndIdentification = new Map();
    shellPathsAndIdentification.set('c:\\windows\\system32\\cmd.exe', types_3.TerminalShellType.commandPrompt);
    shellPathsAndIdentification.set('c:\\windows\\system32\\bash.exe', types_3.TerminalShellType.bash);
    shellPathsAndIdentification.set('c:\\windows\\system32\\wsl.exe', types_3.TerminalShellType.wsl);
    shellPathsAndIdentification.set('c:\\windows\\system32\\gitbash.exe', types_3.TerminalShellType.gitbash);
    shellPathsAndIdentification.set('/usr/bin/bash', types_3.TerminalShellType.bash);
    shellPathsAndIdentification.set('/usr/bin/zsh', types_3.TerminalShellType.zsh);
    shellPathsAndIdentification.set('/usr/bin/ksh', types_3.TerminalShellType.ksh);
    shellPathsAndIdentification.set('c:\\windows\\system32\\powershell.exe', types_3.TerminalShellType.powershell);
    shellPathsAndIdentification.set('c:\\windows\\system32\\pwsh.exe', types_3.TerminalShellType.powershellCore);
    shellPathsAndIdentification.set('/usr/microsoft/xxx/powershell/powershell', types_3.TerminalShellType.powershell);
    shellPathsAndIdentification.set('/usr/microsoft/xxx/powershell/pwsh', types_3.TerminalShellType.powershellCore);
    shellPathsAndIdentification.set('/usr/bin/fish', types_3.TerminalShellType.fish);
    shellPathsAndIdentification.set('c:\\windows\\system32\\shell.exe', types_3.TerminalShellType.other);
    shellPathsAndIdentification.set('/usr/bin/shell', types_3.TerminalShellType.other);
    shellPathsAndIdentification.set('/usr/bin/csh', types_3.TerminalShellType.cshell);
    shellPathsAndIdentification.set('/usr/bin/tcsh', types_3.TerminalShellType.tcshell);
    shellPathsAndIdentification.forEach((shellType, shellPath) => {
      chai_1.expect(helper.identifyTerminalShell(shellPath)).to.equal(shellType, `Incorrect Shell Type for path '${shellPath}'`);
    });
  }));

  function ensurePathForShellIsCorrectlyRetrievedFromSettings(os, expectedShellPat) {
    return __awaiter(this, void 0, void 0, function* () {
      const shellPath = 'abcd';
      workspaceService.setup(w => w.getConfiguration(TypeMoq.It.isValue('terminal.integrated.shell'))).returns(() => {
        const workspaceConfig = TypeMoq.Mock.ofType();
        workspaceConfig.setup(c => c.get(os)).returns(() => shellPath);
        return workspaceConfig.object;
      });
      platformService.setup(p => p.isWindows).returns(() => os === 'windows');
      platformService.setup(p => p.isLinux).returns(() => os === 'linux');
      platformService.setup(p => p.isMac).returns(() => os === 'osx');
      chai_1.expect(helper.getTerminalShellPath()).to.equal(shellPath, 'Incorrect path for Osx');
    });
  }

  test('Ensure path for shell is correctly retrieved from settings (osx)', () => __awaiter(void 0, void 0, void 0, function* () {
    yield ensurePathForShellIsCorrectlyRetrievedFromSettings('osx', 'abcd');
  }));
  test('Ensure path for shell is correctly retrieved from settings (linux)', () => __awaiter(void 0, void 0, void 0, function* () {
    yield ensurePathForShellIsCorrectlyRetrievedFromSettings('linux', 'abcd');
  }));
  test('Ensure path for shell is correctly retrieved from settings (windows)', () => __awaiter(void 0, void 0, void 0, function* () {
    yield ensurePathForShellIsCorrectlyRetrievedFromSettings('windows', 'abcd');
  }));
  test('Ensure path for shell is correctly retrieved from settings (unknown os)', () => __awaiter(void 0, void 0, void 0, function* () {
    yield ensurePathForShellIsCorrectlyRetrievedFromSettings('windows', '');
  }));
  test('Ensure spaces in command is quoted', () => __awaiter(void 0, void 0, void 0, function* () {
    enum_1.getNamesAndValues(types_3.TerminalShellType).forEach(item => {
      const command = 'c:\\python 3.7.exe';
      const args = ['1', '2'];
      const commandPrefix = item.value === types_3.TerminalShellType.powershell || item.value === types_3.TerminalShellType.powershellCore ? '& ' : '';
      const expectedTerminalCommand = `${commandPrefix}${command.fileToCommandArgument()} 1 2`;
      const terminalCommand = helper.buildCommandForTerminal(item.value, command, args);
      chai_1.expect(terminalCommand).to.equal(expectedTerminalCommand, `Incorrect command for Shell ${item.name}`);
    });
  }));
  test('Ensure empty args are ignored', () => __awaiter(void 0, void 0, void 0, function* () {
    enum_1.getNamesAndValues(types_3.TerminalShellType).forEach(item => {
      const command = 'python3.7.exe';
      const args = [];
      const commandPrefix = item.value === types_3.TerminalShellType.powershell || item.value === types_3.TerminalShellType.powershellCore ? '& ' : '';
      const expectedTerminalCommand = `${commandPrefix}${command}`;
      const terminalCommand = helper.buildCommandForTerminal(item.value, command, args);
      chai_1.expect(terminalCommand).to.equal(expectedTerminalCommand, `Incorrect command for Shell '${item.name}'`);
    });
  }));
  test('Ensure empty args are ignored with s in command', () => __awaiter(void 0, void 0, void 0, function* () {
    enum_1.getNamesAndValues(types_3.TerminalShellType).forEach(item => {
      const command = 'c:\\python 3.7.exe';
      const args = [];
      const commandPrefix = item.value === types_3.TerminalShellType.powershell || item.value === types_3.TerminalShellType.powershellCore ? '& ' : '';
      const expectedTerminalCommand = `${commandPrefix}${command.fileToCommandArgument()}`;
      const terminalCommand = helper.buildCommandForTerminal(item.value, command, args);
      chai_1.expect(terminalCommand).to.equal(expectedTerminalCommand, `Incorrect command for Shell ${item.name}`);
    });
  }));
  test('Ensure a terminal is created (without a title)', () => {
    helper.createTerminal();
    terminalManager.verify(t => t.createTerminal(TypeMoq.It.isValue({
      name: undefined
    })), TypeMoq.Times.once());
  });
  test('Ensure a terminal is created with the provided title', () => {
    helper.createTerminal('1234');
    terminalManager.verify(t => t.createTerminal(TypeMoq.It.isValue({
      name: '1234'
    })), TypeMoq.Times.once());
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlci51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJUeXBlTW9xIiwidHlwZXNfMSIsInR5cGVzXzIiLCJoZWxwZXJfMSIsInR5cGVzXzMiLCJ0eXBlc180IiwiZW51bV8xIiwiY29udHJhY3RzXzEiLCJzdWl0ZSIsImhlbHBlciIsInRlcm1pbmFsTWFuYWdlciIsInBsYXRmb3JtU2VydmljZSIsIndvcmtzcGFjZVNlcnZpY2UiLCJkaXNwb3NhYmxlcyIsInNlcnZpY2VDb250YWluZXIiLCJpbnRlcnByZXRlclNlcnZpY2UiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJjIiwiZ2V0IiwiSVRlcm1pbmFsTWFuYWdlciIsInJldHVybnMiLCJvYmplY3QiLCJJUGxhdGZvcm1TZXJ2aWNlIiwiSURpc3Bvc2FibGVSZWdpc3RyeSIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwiSUludGVycHJldGVyU2VydmljZSIsIlRlcm1pbmFsSGVscGVyIiwidGVhcmRvd24iLCJmaWx0ZXIiLCJpdGVtIiwiZm9yRWFjaCIsImRpc3Bvc2UiLCJ0ZXN0Iiwic2hlbGxQYXRoc0FuZElkZW50aWZpY2F0aW9uIiwiTWFwIiwic2V0IiwiVGVybWluYWxTaGVsbFR5cGUiLCJjb21tYW5kUHJvbXB0IiwiYmFzaCIsIndzbCIsImdpdGJhc2giLCJ6c2giLCJrc2giLCJwb3dlcnNoZWxsIiwicG93ZXJzaGVsbENvcmUiLCJmaXNoIiwib3RoZXIiLCJjc2hlbGwiLCJ0Y3NoZWxsIiwic2hlbGxUeXBlIiwic2hlbGxQYXRoIiwiZXhwZWN0IiwiaWRlbnRpZnlUZXJtaW5hbFNoZWxsIiwidG8iLCJlcXVhbCIsImVuc3VyZVBhdGhGb3JTaGVsbElzQ29ycmVjdGx5UmV0cmlldmVkRnJvbVNldHRpbmdzIiwib3MiLCJleHBlY3RlZFNoZWxsUGF0IiwidyIsImdldENvbmZpZ3VyYXRpb24iLCJJdCIsImlzVmFsdWUiLCJ3b3Jrc3BhY2VDb25maWciLCJwIiwiaXNXaW5kb3dzIiwiaXNMaW51eCIsImlzTWFjIiwiZ2V0VGVybWluYWxTaGVsbFBhdGgiLCJnZXROYW1lc0FuZFZhbHVlcyIsImNvbW1hbmQiLCJhcmdzIiwiY29tbWFuZFByZWZpeCIsImV4cGVjdGVkVGVybWluYWxDb21tYW5kIiwiZmlsZVRvQ29tbWFuZEFyZ3VtZW50IiwidGVybWluYWxDb21tYW5kIiwiYnVpbGRDb21tYW5kRm9yVGVybWluYWwiLCJuYW1lIiwiY3JlYXRlVGVybWluYWwiLCJ2ZXJpZnkiLCJ0IiwidW5kZWZpbmVkIiwiVGltZXMiLCJvbmNlIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7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QVdDLE9BQVgsQ0FBbUI7QUFBRWUsTUFBQUEsSUFBSSxFQUFFSTtBQUFSLEtBQW5CLENBQWpCLENBQTVCLEVBQXVGbEYsT0FBTyxDQUFDbUYsS0FBUixDQUFjQyxJQUFkLEVBQXZGO0FBQ0gsR0FIRyxDQUFKO0FBSUFsRCxFQUFBQSxJQUFJLENBQUMsc0RBQUQsRUFBeUQsTUFBTTtBQUMvRHpCLElBQUFBLE1BQU0sQ0FBQ3NFLGNBQVAsQ0FBc0IsTUFBdEI7QUFDQXJFLElBQUFBLGVBQWUsQ0FBQ3NFLE1BQWhCLENBQXVCQyxDQUFDLElBQUlBLENBQUMsQ0FBQ0YsY0FBRixDQUFpQi9FLE9BQU8sQ0FBQzhELEVBQVIsQ0FBV0MsT0FBWCxDQUFtQjtBQUFFZSxNQUFBQSxJQUFJLEVBQUU7QUFBUixLQUFuQixDQUFqQixDQUE1QixFQUFvRjlFLE9BQU8sQ0FBQ21GLEtBQVIsQ0FBY0MsSUFBZCxFQUFwRjtBQUNILEdBSEcsQ0FBSjtBQUlILENBL0dJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9wbGF0Zm9ybS90eXBlc1wiKTtcclxuY29uc3QgaGVscGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90ZXJtaW5hbC9oZWxwZXJcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90ZXJtaW5hbC90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBlbnVtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9lbnVtXCIpO1xyXG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvaW50ZXJwcmV0ZXIvY29udHJhY3RzXCIpO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ1Rlcm1pbmFsIFNlcnZpY2UgaGVscGVycycsICgpID0+IHtcclxuICAgIGxldCBoZWxwZXI7XHJcbiAgICBsZXQgdGVybWluYWxNYW5hZ2VyO1xyXG4gICAgbGV0IHBsYXRmb3JtU2VydmljZTtcclxuICAgIGxldCB3b3Jrc3BhY2VTZXJ2aWNlO1xyXG4gICAgbGV0IGRpc3Bvc2FibGVzID0gW107XHJcbiAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgIGxldCBpbnRlcnByZXRlclNlcnZpY2U7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgdGVybWluYWxNYW5hZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHBsYXRmb3JtU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGludGVycHJldGVyU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBkaXNwb3NhYmxlcyA9IFtdO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVzXzEuSVRlcm1pbmFsTWFuYWdlcikpLnJldHVybnMoKCkgPT4gdGVybWluYWxNYW5hZ2VyLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVzXzIuSVBsYXRmb3JtU2VydmljZSkpLnJldHVybnMoKCkgPT4gcGxhdGZvcm1TZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVzXzQuSURpc3Bvc2FibGVSZWdpc3RyeSkpLnJldHVybnMoKCkgPT4gZGlzcG9zYWJsZXMpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlKSkucmV0dXJucygoKSA9PiB3b3Jrc3BhY2VTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KGNvbnRyYWN0c18xLklJbnRlcnByZXRlclNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IGludGVycHJldGVyU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIGhlbHBlciA9IG5ldyBoZWxwZXJfMS5UZXJtaW5hbEhlbHBlcihzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIHRlYXJkb3duKCgpID0+IHtcclxuICAgICAgICBkaXNwb3NhYmxlcy5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0pLmZvckVhY2goaXRlbSA9PiBpdGVtLmRpc3Bvc2UoKSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ1Rlc3QgaWRlbnRpZmljYXRpb24gb2YgVGVybWluYWwgU2hlbGxzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHNoZWxsUGF0aHNBbmRJZGVudGlmaWNhdGlvbiA9IG5ldyBNYXAoKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCdjOlxcXFx3aW5kb3dzXFxcXHN5c3RlbTMyXFxcXGNtZC5leGUnLCB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLmNvbW1hbmRQcm9tcHQpO1xyXG4gICAgICAgIHNoZWxsUGF0aHNBbmRJZGVudGlmaWNhdGlvbi5zZXQoJ2M6XFxcXHdpbmRvd3NcXFxcc3lzdGVtMzJcXFxcYmFzaC5leGUnLCB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLmJhc2gpO1xyXG4gICAgICAgIHNoZWxsUGF0aHNBbmRJZGVudGlmaWNhdGlvbi5zZXQoJ2M6XFxcXHdpbmRvd3NcXFxcc3lzdGVtMzJcXFxcd3NsLmV4ZScsIHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUud3NsKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCdjOlxcXFx3aW5kb3dzXFxcXHN5c3RlbTMyXFxcXGdpdGJhc2guZXhlJywgdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5naXRiYXNoKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCcvdXNyL2Jpbi9iYXNoJywgdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5iYXNoKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCcvdXNyL2Jpbi96c2gnLCB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLnpzaCk7XHJcbiAgICAgICAgc2hlbGxQYXRoc0FuZElkZW50aWZpY2F0aW9uLnNldCgnL3Vzci9iaW4va3NoJywgdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5rc2gpO1xyXG4gICAgICAgIHNoZWxsUGF0aHNBbmRJZGVudGlmaWNhdGlvbi5zZXQoJ2M6XFxcXHdpbmRvd3NcXFxcc3lzdGVtMzJcXFxccG93ZXJzaGVsbC5leGUnLCB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGwpO1xyXG4gICAgICAgIHNoZWxsUGF0aHNBbmRJZGVudGlmaWNhdGlvbi5zZXQoJ2M6XFxcXHdpbmRvd3NcXFxcc3lzdGVtMzJcXFxccHdzaC5leGUnLCB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGxDb3JlKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCcvdXNyL21pY3Jvc29mdC94eHgvcG93ZXJzaGVsbC9wb3dlcnNoZWxsJywgdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCcvdXNyL21pY3Jvc29mdC94eHgvcG93ZXJzaGVsbC9wd3NoJywgdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsQ29yZSk7XHJcbiAgICAgICAgc2hlbGxQYXRoc0FuZElkZW50aWZpY2F0aW9uLnNldCgnL3Vzci9iaW4vZmlzaCcsIHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUuZmlzaCk7XHJcbiAgICAgICAgc2hlbGxQYXRoc0FuZElkZW50aWZpY2F0aW9uLnNldCgnYzpcXFxcd2luZG93c1xcXFxzeXN0ZW0zMlxcXFxzaGVsbC5leGUnLCB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLm90aGVyKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCcvdXNyL2Jpbi9zaGVsbCcsIHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUub3RoZXIpO1xyXG4gICAgICAgIHNoZWxsUGF0aHNBbmRJZGVudGlmaWNhdGlvbi5zZXQoJy91c3IvYmluL2NzaCcsIHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUuY3NoZWxsKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uc2V0KCcvdXNyL2Jpbi90Y3NoJywgdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS50Y3NoZWxsKTtcclxuICAgICAgICBzaGVsbFBhdGhzQW5kSWRlbnRpZmljYXRpb24uZm9yRWFjaCgoc2hlbGxUeXBlLCBzaGVsbFBhdGgpID0+IHtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChoZWxwZXIuaWRlbnRpZnlUZXJtaW5hbFNoZWxsKHNoZWxsUGF0aCkpLnRvLmVxdWFsKHNoZWxsVHlwZSwgYEluY29ycmVjdCBTaGVsbCBUeXBlIGZvciBwYXRoICcke3NoZWxsUGF0aH0nYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KSk7XHJcbiAgICBmdW5jdGlvbiBlbnN1cmVQYXRoRm9yU2hlbGxJc0NvcnJlY3RseVJldHJpZXZlZEZyb21TZXR0aW5ncyhvcywgZXhwZWN0ZWRTaGVsbFBhdCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNoZWxsUGF0aCA9ICdhYmNkJztcclxuICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuZ2V0Q29uZmlndXJhdGlvbihUeXBlTW9xLkl0LmlzVmFsdWUoJ3Rlcm1pbmFsLmludGVncmF0ZWQuc2hlbGwnKSkpLnJldHVybnMoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnNldHVwKGMgPT4gYy5nZXQob3MpKS5yZXR1cm5zKCgpID0+IHNoZWxsUGF0aCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gd29ya3NwYWNlQ29uZmlnLm9iamVjdDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHBsYXRmb3JtU2VydmljZS5zZXR1cChwID0+IHAuaXNXaW5kb3dzKS5yZXR1cm5zKCgpID0+IG9zID09PSAnd2luZG93cycpO1xyXG4gICAgICAgICAgICBwbGF0Zm9ybVNlcnZpY2Uuc2V0dXAocCA9PiBwLmlzTGludXgpLnJldHVybnMoKCkgPT4gb3MgPT09ICdsaW51eCcpO1xyXG4gICAgICAgICAgICBwbGF0Zm9ybVNlcnZpY2Uuc2V0dXAocCA9PiBwLmlzTWFjKS5yZXR1cm5zKCgpID0+IG9zID09PSAnb3N4Jyk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoaGVscGVyLmdldFRlcm1pbmFsU2hlbGxQYXRoKCkpLnRvLmVxdWFsKHNoZWxsUGF0aCwgJ0luY29ycmVjdCBwYXRoIGZvciBPc3gnKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHRlc3QoJ0Vuc3VyZSBwYXRoIGZvciBzaGVsbCBpcyBjb3JyZWN0bHkgcmV0cmlldmVkIGZyb20gc2V0dGluZ3MgKG9zeCknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgZW5zdXJlUGF0aEZvclNoZWxsSXNDb3JyZWN0bHlSZXRyaWV2ZWRGcm9tU2V0dGluZ3MoJ29zeCcsICdhYmNkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdFbnN1cmUgcGF0aCBmb3Igc2hlbGwgaXMgY29ycmVjdGx5IHJldHJpZXZlZCBmcm9tIHNldHRpbmdzIChsaW51eCknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgZW5zdXJlUGF0aEZvclNoZWxsSXNDb3JyZWN0bHlSZXRyaWV2ZWRGcm9tU2V0dGluZ3MoJ2xpbnV4JywgJ2FiY2QnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBwYXRoIGZvciBzaGVsbCBpcyBjb3JyZWN0bHkgcmV0cmlldmVkIGZyb20gc2V0dGluZ3MgKHdpbmRvd3MpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGVuc3VyZVBhdGhGb3JTaGVsbElzQ29ycmVjdGx5UmV0cmlldmVkRnJvbVNldHRpbmdzKCd3aW5kb3dzJywgJ2FiY2QnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBwYXRoIGZvciBzaGVsbCBpcyBjb3JyZWN0bHkgcmV0cmlldmVkIGZyb20gc2V0dGluZ3MgKHVua25vd24gb3MpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGVuc3VyZVBhdGhGb3JTaGVsbElzQ29ycmVjdGx5UmV0cmlldmVkRnJvbVNldHRpbmdzKCd3aW5kb3dzJywgJycpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIHNwYWNlcyBpbiBjb21tYW5kIGlzIHF1b3RlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBlbnVtXzEuZ2V0TmFtZXNBbmRWYWx1ZXModHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZSkuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9ICdjOlxcXFxweXRob24gMy43LmV4ZSc7XHJcbiAgICAgICAgICAgIGNvbnN0IGFyZ3MgPSBbJzEnLCAnMiddO1xyXG4gICAgICAgICAgICBjb25zdCBjb21tYW5kUHJlZml4ID0gKGl0ZW0udmFsdWUgPT09IHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbCB8fCBpdGVtLnZhbHVlID09PSB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGxDb3JlKSA/ICcmICcgOiAnJztcclxuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRUZXJtaW5hbENvbW1hbmQgPSBgJHtjb21tYW5kUHJlZml4fSR7Y29tbWFuZC5maWxlVG9Db21tYW5kQXJndW1lbnQoKX0gMSAyYDtcclxuICAgICAgICAgICAgY29uc3QgdGVybWluYWxDb21tYW5kID0gaGVscGVyLmJ1aWxkQ29tbWFuZEZvclRlcm1pbmFsKGl0ZW0udmFsdWUsIGNvbW1hbmQsIGFyZ3MpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KHRlcm1pbmFsQ29tbWFuZCkudG8uZXF1YWwoZXhwZWN0ZWRUZXJtaW5hbENvbW1hbmQsIGBJbmNvcnJlY3QgY29tbWFuZCBmb3IgU2hlbGwgJHtpdGVtLm5hbWV9YCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdFbnN1cmUgZW1wdHkgYXJncyBhcmUgaWdub3JlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBlbnVtXzEuZ2V0TmFtZXNBbmRWYWx1ZXModHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZSkuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9ICdweXRob24zLjcuZXhlJztcclxuICAgICAgICAgICAgY29uc3QgYXJncyA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCBjb21tYW5kUHJlZml4ID0gKGl0ZW0udmFsdWUgPT09IHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbCB8fCBpdGVtLnZhbHVlID09PSB0eXBlc18zLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGxDb3JlKSA/ICcmICcgOiAnJztcclxuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRUZXJtaW5hbENvbW1hbmQgPSBgJHtjb21tYW5kUHJlZml4fSR7Y29tbWFuZH1gO1xyXG4gICAgICAgICAgICBjb25zdCB0ZXJtaW5hbENvbW1hbmQgPSBoZWxwZXIuYnVpbGRDb21tYW5kRm9yVGVybWluYWwoaXRlbS52YWx1ZSwgY29tbWFuZCwgYXJncyk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QodGVybWluYWxDb21tYW5kKS50by5lcXVhbChleHBlY3RlZFRlcm1pbmFsQ29tbWFuZCwgYEluY29ycmVjdCBjb21tYW5kIGZvciBTaGVsbCAnJHtpdGVtLm5hbWV9J2ApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIGVtcHR5IGFyZ3MgYXJlIGlnbm9yZWQgd2l0aCBzIGluIGNvbW1hbmQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgZW51bV8xLmdldE5hbWVzQW5kVmFsdWVzKHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUpLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSAnYzpcXFxccHl0aG9uIDMuNy5leGUnO1xyXG4gICAgICAgICAgICBjb25zdCBhcmdzID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRQcmVmaXggPSAoaXRlbS52YWx1ZSA9PT0gdHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsIHx8IGl0ZW0udmFsdWUgPT09IHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbENvcmUpID8gJyYgJyA6ICcnO1xyXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZFRlcm1pbmFsQ29tbWFuZCA9IGAke2NvbW1hbmRQcmVmaXh9JHtjb21tYW5kLmZpbGVUb0NvbW1hbmRBcmd1bWVudCgpfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlcm1pbmFsQ29tbWFuZCA9IGhlbHBlci5idWlsZENvbW1hbmRGb3JUZXJtaW5hbChpdGVtLnZhbHVlLCBjb21tYW5kLCBhcmdzKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdCh0ZXJtaW5hbENvbW1hbmQpLnRvLmVxdWFsKGV4cGVjdGVkVGVybWluYWxDb21tYW5kLCBgSW5jb3JyZWN0IGNvbW1hbmQgZm9yIFNoZWxsICR7aXRlbS5uYW1lfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIGEgdGVybWluYWwgaXMgY3JlYXRlZCAod2l0aG91dCBhIHRpdGxlKScsICgpID0+IHtcclxuICAgICAgICBoZWxwZXIuY3JlYXRlVGVybWluYWwoKTtcclxuICAgICAgICB0ZXJtaW5hbE1hbmFnZXIudmVyaWZ5KHQgPT4gdC5jcmVhdGVUZXJtaW5hbChUeXBlTW9xLkl0LmlzVmFsdWUoeyBuYW1lOiB1bmRlZmluZWQgfSkpLCBUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBhIHRlcm1pbmFsIGlzIGNyZWF0ZWQgd2l0aCB0aGUgcHJvdmlkZWQgdGl0bGUnLCAoKSA9PiB7XHJcbiAgICAgICAgaGVscGVyLmNyZWF0ZVRlcm1pbmFsKCcxMjM0Jyk7XHJcbiAgICAgICAgdGVybWluYWxNYW5hZ2VyLnZlcmlmeSh0ID0+IHQuY3JlYXRlVGVybWluYWwoVHlwZU1vcS5JdC5pc1ZhbHVlKHsgbmFtZTogJzEyMzQnIH0pKSwgVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1oZWxwZXIudW5pdC50ZXN0LmpzLm1hcCJdfQ==