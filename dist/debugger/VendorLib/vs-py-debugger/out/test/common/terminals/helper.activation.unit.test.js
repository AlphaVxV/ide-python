"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const TypeMoq = require("typemoq");

const types_1 = require("../../../client/common/application/types");

const types_2 = require("../../../client/common/platform/types");

const bash_1 = require("../../../client/common/terminal/environmentActivationProviders/bash");

const commandPrompt_1 = require("../../../client/common/terminal/environmentActivationProviders/commandPrompt");

const helper_1 = require("../../../client/common/terminal/helper");

const types_3 = require("../../../client/common/terminal/types");

const types_4 = require("../../../client/common/types");

const enum_1 = require("../../../client/common/utils/enum");

const contracts_1 = require("../../../client/interpreter/contracts"); // tslint:disable-next-line:max-func-body-length


suite('Terminal Service helpers', () => {
  let helper;
  let terminalManager;
  let platformService;
  let workspaceService;
  let disposables = [];
  let serviceContainer;
  let interpreterService;
  let terminalSettings;
  setup(() => {
    terminalManager = TypeMoq.Mock.ofType();
    platformService = TypeMoq.Mock.ofType();
    workspaceService = TypeMoq.Mock.ofType();
    interpreterService = TypeMoq.Mock.ofType();
    terminalSettings = TypeMoq.Mock.ofType();
    disposables = [];
    serviceContainer = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(types_1.ITerminalManager)).returns(() => terminalManager.object);
    serviceContainer.setup(c => c.get(types_2.IPlatformService)).returns(() => platformService.object);
    serviceContainer.setup(c => c.get(types_4.IDisposableRegistry)).returns(() => disposables);
    serviceContainer.setup(c => c.get(types_1.IWorkspaceService)).returns(() => workspaceService.object);
    serviceContainer.setup(c => c.get(contracts_1.IInterpreterService)).returns(() => interpreterService.object);
    const configService = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(types_4.IConfigurationService)).returns(() => configService.object);
    const settings = TypeMoq.Mock.ofType();
    configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
    settings.setup(s => s.terminal).returns(() => terminalSettings.object);
    const condaService = TypeMoq.Mock.ofType();
    condaService.setup(c => c.isCondaEnvironment(TypeMoq.It.isAny())).returns(() => Promise.resolve(false));
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(contracts_1.ICondaService))).returns(() => condaService.object);
    helper = new helper_1.TerminalHelper(serviceContainer.object);
  });
  teardown(() => {
    disposables.filter(item => !!item).forEach(item => item.dispose());
  });
  test('Activation command is undefined when terminal activation is disabled', () => __awaiter(void 0, void 0, void 0, function* () {
    terminalSettings.setup(t => t.activateEnvironment).returns(() => false);
    const commands = yield helper.getEnvironmentActivationCommands(types_3.TerminalShellType.other);
    chai_1.expect(commands).to.equal(undefined, 'Activation command should be undefined if terminal type cannot be determined');
  }));
  test('Activation command is undefined for unknown terminal', () => __awaiter(void 0, void 0, void 0, function* () {
    terminalSettings.setup(t => t.activateEnvironment).returns(() => true);
    const bashActivation = new bash_1.Bash(serviceContainer.object);
    const commandPromptActivation = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
    serviceContainer.setup(c => c.getAll(types_3.ITerminalActivationCommandProvider)).returns(() => [bashActivation, commandPromptActivation]);
    const commands = yield helper.getEnvironmentActivationCommands(types_3.TerminalShellType.other);
    chai_1.expect(commands).to.equal(undefined, 'Activation command should be undefined if terminal type cannot be determined');
  }));
});
enum_1.getNamesAndValues(types_3.TerminalShellType).forEach(terminalShell => {
  suite(`Terminal Service helpers (${terminalShell.name})`, () => {
    let helper;
    let terminalManager;
    let platformService;
    let workspaceService;
    let disposables = [];
    let serviceContainer;
    let interpreterService;
    setup(() => {
      terminalManager = TypeMoq.Mock.ofType();
      platformService = TypeMoq.Mock.ofType();
      workspaceService = TypeMoq.Mock.ofType();
      interpreterService = TypeMoq.Mock.ofType();
      disposables = [];
      serviceContainer = TypeMoq.Mock.ofType();
      serviceContainer.setup(c => c.get(types_1.ITerminalManager)).returns(() => terminalManager.object);
      serviceContainer.setup(c => c.get(types_2.IPlatformService)).returns(() => platformService.object);
      serviceContainer.setup(c => c.get(types_4.IDisposableRegistry)).returns(() => disposables);
      serviceContainer.setup(c => c.get(types_1.IWorkspaceService)).returns(() => workspaceService.object);
      serviceContainer.setup(c => c.get(contracts_1.IInterpreterService)).returns(() => interpreterService.object);
      const configService = TypeMoq.Mock.ofType();
      serviceContainer.setup(c => c.get(types_4.IConfigurationService)).returns(() => configService.object);
      const settings = TypeMoq.Mock.ofType();
      configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
      const terminalSettings = TypeMoq.Mock.ofType();
      settings.setup(s => s.terminal).returns(() => terminalSettings.object);
      terminalSettings.setup(t => t.activateEnvironment).returns(() => true);
      const condaService = TypeMoq.Mock.ofType();
      condaService.setup(c => c.isCondaEnvironment(TypeMoq.It.isAny())).returns(() => Promise.resolve(false));
      serviceContainer.setup(c => c.get(TypeMoq.It.isValue(contracts_1.ICondaService))).returns(() => condaService.object);
      helper = new helper_1.TerminalHelper(serviceContainer.object);
    });
    teardown(() => {
      disposables.filter(disposable => !!disposable).forEach(disposable => disposable.dispose());
    });

    function activationCommandShouldReturnCorrectly(shellType, expectedActivationCommand) {
      return __awaiter(this, void 0, void 0, function* () {
        // This will only work for the current shell type.
        const validProvider = TypeMoq.Mock.ofType();
        validProvider.setup(p => p.isShellSupported(TypeMoq.It.isValue(shellType))).returns(() => true);
        validProvider.setup(p => p.getActivationCommands(TypeMoq.It.isValue(undefined), TypeMoq.It.isValue(shellType))).returns(() => Promise.resolve(expectedActivationCommand)); // This will support other providers.

        const invalidProvider = TypeMoq.Mock.ofType();
        invalidProvider.setup(p => p.isShellSupported(TypeMoq.It.isAny())).returns(item => shellType !== shellType);
        serviceContainer.setup(c => c.getAll(types_3.ITerminalActivationCommandProvider)).returns(() => [validProvider.object, invalidProvider.object]);
        const commands = yield helper.getEnvironmentActivationCommands(shellType);
        validProvider.verify(p => p.getActivationCommands(TypeMoq.It.isValue(undefined), TypeMoq.It.isValue(shellType)), TypeMoq.Times.once());
        validProvider.verify(p => p.isShellSupported(TypeMoq.It.isValue(shellType)), TypeMoq.Times.once());
        invalidProvider.verify(p => p.getActivationCommands(TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
        invalidProvider.verify(p => p.isShellSupported(TypeMoq.It.isValue(shellType)), TypeMoq.Times.once());
        chai_1.expect(commands).to.deep.equal(expectedActivationCommand, 'Incorrect activation command');
      });
    }

    test(`Activation command should be correctly identified for ${terminalShell.name} (command array)`, () => __awaiter(void 0, void 0, void 0, function* () {
      yield activationCommandShouldReturnCorrectly(terminalShell.value, ['a', 'b']);
    }));
    test(`Activation command should be correctly identified for ${terminalShell.name} (command string)`, () => __awaiter(void 0, void 0, void 0, function* () {
      yield activationCommandShouldReturnCorrectly(terminalShell.value, ['command to be executed']);
    }));
    test(`Activation command should be correctly identified for ${terminalShell.name} (undefined)`, () => __awaiter(void 0, void 0, void 0, function* () {
      yield activationCommandShouldReturnCorrectly(terminalShell.value);
    }));

    function activationCommandShouldReturnUndefined(shellType) {
      return __awaiter(this, void 0, void 0, function* () {
        // This will support other providers.
        const invalidProvider = TypeMoq.Mock.ofType();
        invalidProvider.setup(p => p.isShellSupported(TypeMoq.It.isAny())).returns(item => shellType !== shellType);
        serviceContainer.setup(c => c.getAll(types_3.ITerminalActivationCommandProvider)).returns(() => [invalidProvider.object]);
        const commands = yield helper.getEnvironmentActivationCommands(shellType);
        invalidProvider.verify(p => p.getActivationCommands(TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
        chai_1.expect(commands).to.deep.equal(undefined, 'Incorrect activation command');
      });
    }

    test(`Activation command should return undefined ${terminalShell.name} (no matching providers)`, () => __awaiter(void 0, void 0, void 0, function* () {
      yield activationCommandShouldReturnUndefined(terminalShell.value);
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlci5hY3RpdmF0aW9uLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiY2hhaV8xIiwicmVxdWlyZSIsIlR5cGVNb3EiLCJ0eXBlc18xIiwidHlwZXNfMiIsImJhc2hfMSIsImNvbW1hbmRQcm9tcHRfMSIsImhlbHBlcl8xIiwidHlwZXNfMyIsInR5cGVzXzQiLCJlbnVtXzEiLCJjb250cmFjdHNfMSIsInN1aXRlIiwiaGVscGVyIiwidGVybWluYWxNYW5hZ2VyIiwicGxhdGZvcm1TZXJ2aWNlIiwid29ya3NwYWNlU2VydmljZSIsImRpc3Bvc2FibGVzIiwic2VydmljZUNvbnRhaW5lciIsImludGVycHJldGVyU2VydmljZSIsInRlcm1pbmFsU2V0dGluZ3MiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJjIiwiZ2V0IiwiSVRlcm1pbmFsTWFuYWdlciIsInJldHVybnMiLCJvYmplY3QiLCJJUGxhdGZvcm1TZXJ2aWNlIiwiSURpc3Bvc2FibGVSZWdpc3RyeSIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwiSUludGVycHJldGVyU2VydmljZSIsImNvbmZpZ1NlcnZpY2UiLCJJQ29uZmlndXJhdGlvblNlcnZpY2UiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwiSXQiLCJpc0FueSIsInMiLCJ0ZXJtaW5hbCIsImNvbmRhU2VydmljZSIsImlzQ29uZGFFbnZpcm9ubWVudCIsImlzVmFsdWUiLCJJQ29uZGFTZXJ2aWNlIiwiVGVybWluYWxIZWxwZXIiLCJ0ZWFyZG93biIsImZpbHRlciIsIml0ZW0iLCJmb3JFYWNoIiwiZGlzcG9zZSIsInRlc3QiLCJ0IiwiYWN0aXZhdGVFbnZpcm9ubWVudCIsImNvbW1hbmRzIiwiZ2V0RW52aXJvbm1lbnRBY3RpdmF0aW9uQ29tbWFuZHMiLCJUZXJtaW5hbFNoZWxsVHlwZSIsIm90aGVyIiwiZXhwZWN0IiwidG8iLCJlcXVhbCIsInVuZGVmaW5lZCIsImJhc2hBY3RpdmF0aW9uIiwiQmFzaCIsImNvbW1hbmRQcm9tcHRBY3RpdmF0aW9uIiwiQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwiLCJnZXRBbGwiLCJJVGVybWluYWxBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyIiwiZ2V0TmFtZXNBbmRWYWx1ZXMiLCJ0ZXJtaW5hbFNoZWxsIiwibmFtZSIsImRpc3Bvc2FibGUiLCJhY3RpdmF0aW9uQ29tbWFuZFNob3VsZFJldHVybkNvcnJlY3RseSIsInNoZWxsVHlwZSIsImV4cGVjdGVkQWN0aXZhdGlvbkNvbW1hbmQiLCJ2YWxpZFByb3ZpZGVyIiwicCIsImlzU2hlbGxTdXBwb3J0ZWQiLCJnZXRBY3RpdmF0aW9uQ29tbWFuZHMiLCJpbnZhbGlkUHJvdmlkZXIiLCJ2ZXJpZnkiLCJUaW1lcyIsIm9uY2UiLCJuZXZlciIsImRlZXAiLCJhY3RpdmF0aW9uQ29tbWFuZFNob3VsZFJldHVyblVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8sSUFBckQsQ0FBMERSLFNBQTFELEVBQXFFSyxRQUFyRSxDQUF0QztBQUF1SDs7QUFDL0lILElBQUFBLElBQUksQ0FBQyxDQUFDTixTQUFTLEdBQUdBLFNBQVMsQ0FBQ2EsS0FBVixDQUFnQmhCLE9BQWhCLEVBQXlCQyxVQUFVLElBQUksRUFBdkMsQ0FBYixFQUF5RFMsSUFBekQsRUFBRCxDQUFKO0FBQ0gsR0FMTSxDQUFQO0FBTUgsQ0FQRDs7QUFRQU8sTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUFFWCxFQUFBQSxLQUFLLEVBQUU7QUFBVCxDQUE3Qzs7QUFDQSxNQUFNWSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXRCOztBQUNBLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLFNBQUQsQ0FBdkI7O0FBQ0EsTUFBTUUsT0FBTyxHQUFHRixPQUFPLENBQUMsMENBQUQsQ0FBdkI7O0FBQ0EsTUFBTUcsT0FBTyxHQUFHSCxPQUFPLENBQUMsdUNBQUQsQ0FBdkI7O0FBQ0EsTUFBTUksTUFBTSxHQUFHSixPQUFPLENBQUMscUVBQUQsQ0FBdEI7O0FBQ0EsTUFBTUssZUFBZSxHQUFHTCxPQUFPLENBQUMsOEVBQUQsQ0FBL0I7O0FBQ0EsTUFBTU0sUUFBUSxHQUFHTixPQUFPLENBQUMsd0NBQUQsQ0FBeEI7O0FBQ0EsTUFBTU8sT0FBTyxHQUFHUCxPQUFPLENBQUMsdUNBQUQsQ0FBdkI7O0FBQ0EsTUFBTVEsT0FBTyxHQUFHUixPQUFPLENBQUMsOEJBQUQsQ0FBdkI7O0FBQ0EsTUFBTVMsTUFBTSxHQUFHVCxPQUFPLENBQUMsbUNBQUQsQ0FBdEI7O0FBQ0EsTUFBTVUsV0FBVyxHQUFHVixPQUFPLENBQUMsdUNBQUQsQ0FBM0IsQyxDQUNBOzs7QUFDQVcsS0FBSyxDQUFDLDBCQUFELEVBQTZCLE1BQU07QUFDcEMsTUFBSUMsTUFBSjtBQUNBLE1BQUlDLGVBQUo7QUFDQSxNQUFJQyxlQUFKO0FBQ0EsTUFBSUMsZ0JBQUo7QUFDQSxNQUFJQyxXQUFXLEdBQUcsRUFBbEI7QUFDQSxNQUFJQyxnQkFBSjtBQUNBLE1BQUlDLGtCQUFKO0FBQ0EsTUFBSUMsZ0JBQUo7QUFDQUMsRUFBQUEsS0FBSyxDQUFDLE1BQU07QUFDUlAsSUFBQUEsZUFBZSxHQUFHWixPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBbEI7QUFDQVIsSUFBQUEsZUFBZSxHQUFHYixPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBbEI7QUFDQVAsSUFBQUEsZ0JBQWdCLEdBQUdkLE9BQU8sQ0FBQ29CLElBQVIsQ0FBYUMsTUFBYixFQUFuQjtBQUNBSixJQUFBQSxrQkFBa0IsR0FBR2pCLE9BQU8sQ0FBQ29CLElBQVIsQ0FBYUMsTUFBYixFQUFyQjtBQUNBSCxJQUFBQSxnQkFBZ0IsR0FBR2xCLE9BQU8sQ0FBQ29CLElBQVIsQ0FBYUMsTUFBYixFQUFuQjtBQUNBTixJQUFBQSxXQUFXLEdBQUcsRUFBZDtBQUNBQyxJQUFBQSxnQkFBZ0IsR0FBR2hCLE9BQU8sQ0FBQ29CLElBQVIsQ0FBYUMsTUFBYixFQUFuQjtBQUNBTCxJQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxHQUFGLENBQU10QixPQUFPLENBQUN1QixnQkFBZCxDQUE1QixFQUE2REMsT0FBN0QsQ0FBcUUsTUFBTWIsZUFBZSxDQUFDYyxNQUEzRjtBQUNBVixJQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxHQUFGLENBQU1yQixPQUFPLENBQUN5QixnQkFBZCxDQUE1QixFQUE2REYsT0FBN0QsQ0FBcUUsTUFBTVosZUFBZSxDQUFDYSxNQUEzRjtBQUNBVixJQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxHQUFGLENBQU1oQixPQUFPLENBQUNxQixtQkFBZCxDQUE1QixFQUFnRUgsT0FBaEUsQ0FBd0UsTUFBTVYsV0FBOUU7QUFDQUMsSUFBQUEsZ0JBQWdCLENBQUNHLEtBQWpCLENBQXVCRyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsR0FBRixDQUFNdEIsT0FBTyxDQUFDNEIsaUJBQWQsQ0FBNUIsRUFBOERKLE9BQTlELENBQXNFLE1BQU1YLGdCQUFnQixDQUFDWSxNQUE3RjtBQUNBVixJQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxHQUFGLENBQU1kLFdBQVcsQ0FBQ3FCLG1CQUFsQixDQUE1QixFQUFvRUwsT0FBcEUsQ0FBNEUsTUFBTVIsa0JBQWtCLENBQUNTLE1BQXJHO0FBQ0EsVUFBTUssYUFBYSxHQUFHL0IsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQXRCO0FBQ0FMLElBQUFBLGdCQUFnQixDQUFDRyxLQUFqQixDQUF1QkcsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLEdBQUYsQ0FBTWhCLE9BQU8sQ0FBQ3lCLHFCQUFkLENBQTVCLEVBQWtFUCxPQUFsRSxDQUEwRSxNQUFNTSxhQUFhLENBQUNMLE1BQTlGO0FBQ0EsVUFBTU8sUUFBUSxHQUFHakMsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQWpCO0FBQ0FVLElBQUFBLGFBQWEsQ0FBQ1osS0FBZCxDQUFvQkcsQ0FBQyxJQUFJQSxDQUFDLENBQUNZLFdBQUYsQ0FBY2xDLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV0MsS0FBWCxFQUFkLENBQXpCLEVBQTREWCxPQUE1RCxDQUFvRSxNQUFNUSxRQUFRLENBQUNQLE1BQW5GO0FBQ0FPLElBQUFBLFFBQVEsQ0FBQ2QsS0FBVCxDQUFla0IsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLFFBQXRCLEVBQWdDYixPQUFoQyxDQUF3QyxNQUFNUCxnQkFBZ0IsQ0FBQ1EsTUFBL0Q7QUFDQSxVQUFNYSxZQUFZLEdBQUd2QyxPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBckI7QUFDQWtCLElBQUFBLFlBQVksQ0FBQ3BCLEtBQWIsQ0FBbUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDa0Isa0JBQUYsQ0FBcUJ4QyxPQUFPLENBQUNtQyxFQUFSLENBQVdDLEtBQVgsRUFBckIsQ0FBeEIsRUFBa0VYLE9BQWxFLENBQTBFLE1BQU0zQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0IsS0FBaEIsQ0FBaEY7QUFDQWlDLElBQUFBLGdCQUFnQixDQUFDRyxLQUFqQixDQUF1QkcsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLEdBQUYsQ0FBTXZCLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV00sT0FBWCxDQUFtQmhDLFdBQVcsQ0FBQ2lDLGFBQS9CLENBQU4sQ0FBNUIsRUFBa0ZqQixPQUFsRixDQUEwRixNQUFNYyxZQUFZLENBQUNiLE1BQTdHO0FBQ0FmLElBQUFBLE1BQU0sR0FBRyxJQUFJTixRQUFRLENBQUNzQyxjQUFiLENBQTRCM0IsZ0JBQWdCLENBQUNVLE1BQTdDLENBQVQ7QUFDSCxHQXRCSSxDQUFMO0FBdUJBa0IsRUFBQUEsUUFBUSxDQUFDLE1BQU07QUFDWDdCLElBQUFBLFdBQVcsQ0FBQzhCLE1BQVosQ0FBbUJDLElBQUksSUFBSSxDQUFDLENBQUNBLElBQTdCLEVBQW1DQyxPQUFuQyxDQUEyQ0QsSUFBSSxJQUFJQSxJQUFJLENBQUNFLE9BQUwsRUFBbkQ7QUFDSCxHQUZPLENBQVI7QUFHQUMsRUFBQUEsSUFBSSxDQUFDLHNFQUFELEVBQXlFLE1BQU14RSxTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQzVIeUMsSUFBQUEsZ0JBQWdCLENBQUNDLEtBQWpCLENBQXVCK0IsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLG1CQUE5QixFQUFtRDFCLE9BQW5ELENBQTJELE1BQU0sS0FBakU7QUFDQSxVQUFNMkIsUUFBUSxHQUFHLE1BQU16QyxNQUFNLENBQUMwQyxnQ0FBUCxDQUF3Qy9DLE9BQU8sQ0FBQ2dELGlCQUFSLENBQTBCQyxLQUFsRSxDQUF2QjtBQUNBekQsSUFBQUEsTUFBTSxDQUFDMEQsTUFBUCxDQUFjSixRQUFkLEVBQXdCSyxFQUF4QixDQUEyQkMsS0FBM0IsQ0FBaUNDLFNBQWpDLEVBQTRDLDhFQUE1QztBQUNILEdBSjJGLENBQXhGLENBQUo7QUFLQVYsRUFBQUEsSUFBSSxDQUFDLHNEQUFELEVBQXlELE1BQU14RSxTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQzVHeUMsSUFBQUEsZ0JBQWdCLENBQUNDLEtBQWpCLENBQXVCK0IsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLG1CQUE5QixFQUFtRDFCLE9BQW5ELENBQTJELE1BQU0sSUFBakU7QUFDQSxVQUFNbUMsY0FBYyxHQUFHLElBQUl6RCxNQUFNLENBQUMwRCxJQUFYLENBQWdCN0MsZ0JBQWdCLENBQUNVLE1BQWpDLENBQXZCO0FBQ0EsVUFBTW9DLHVCQUF1QixHQUFHLElBQUkxRCxlQUFlLENBQUMyRCwwQkFBcEIsQ0FBK0MvQyxnQkFBZ0IsQ0FBQ1UsTUFBaEUsQ0FBaEM7QUFDQVYsSUFBQUEsZ0JBQWdCLENBQUNHLEtBQWpCLENBQXVCRyxDQUFDLElBQUlBLENBQUMsQ0FBQzBDLE1BQUYsQ0FBUzFELE9BQU8sQ0FBQzJELGtDQUFqQixDQUE1QixFQUFrRnhDLE9BQWxGLENBQTBGLE1BQU0sQ0FBQ21DLGNBQUQsRUFBaUJFLHVCQUFqQixDQUFoRztBQUNBLFVBQU1WLFFBQVEsR0FBRyxNQUFNekMsTUFBTSxDQUFDMEMsZ0NBQVAsQ0FBd0MvQyxPQUFPLENBQUNnRCxpQkFBUixDQUEwQkMsS0FBbEUsQ0FBdkI7QUFDQXpELElBQUFBLE1BQU0sQ0FBQzBELE1BQVAsQ0FBY0osUUFBZCxFQUF3QkssRUFBeEIsQ0FBMkJDLEtBQTNCLENBQWlDQyxTQUFqQyxFQUE0Qyw4RUFBNUM7QUFDSCxHQVAyRSxDQUF4RSxDQUFKO0FBUUgsQ0FoREksQ0FBTDtBQWlEQW5ELE1BQU0sQ0FBQzBELGlCQUFQLENBQXlCNUQsT0FBTyxDQUFDZ0QsaUJBQWpDLEVBQW9EUCxPQUFwRCxDQUE0RG9CLGFBQWEsSUFBSTtBQUN6RXpELEVBQUFBLEtBQUssQ0FBRSw2QkFBNEJ5RCxhQUFhLENBQUNDLElBQUssR0FBakQsRUFBcUQsTUFBTTtBQUM1RCxRQUFJekQsTUFBSjtBQUNBLFFBQUlDLGVBQUo7QUFDQSxRQUFJQyxlQUFKO0FBQ0EsUUFBSUMsZ0JBQUo7QUFDQSxRQUFJQyxXQUFXLEdBQUcsRUFBbEI7QUFDQSxRQUFJQyxnQkFBSjtBQUNBLFFBQUlDLGtCQUFKO0FBQ0FFLElBQUFBLEtBQUssQ0FBQyxNQUFNO0FBQ1JQLE1BQUFBLGVBQWUsR0FBR1osT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQWxCO0FBQ0FSLE1BQUFBLGVBQWUsR0FBR2IsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQWxCO0FBQ0FQLE1BQUFBLGdCQUFnQixHQUFHZCxPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBbkI7QUFDQUosTUFBQUEsa0JBQWtCLEdBQUdqQixPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBckI7QUFDQU4sTUFBQUEsV0FBVyxHQUFHLEVBQWQ7QUFDQUMsTUFBQUEsZ0JBQWdCLEdBQUdoQixPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBbkI7QUFDQUwsTUFBQUEsZ0JBQWdCLENBQUNHLEtBQWpCLENBQXVCRyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsR0FBRixDQUFNdEIsT0FBTyxDQUFDdUIsZ0JBQWQsQ0FBNUIsRUFBNkRDLE9BQTdELENBQXFFLE1BQU1iLGVBQWUsQ0FBQ2MsTUFBM0Y7QUFDQVYsTUFBQUEsZ0JBQWdCLENBQUNHLEtBQWpCLENBQXVCRyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsR0FBRixDQUFNckIsT0FBTyxDQUFDeUIsZ0JBQWQsQ0FBNUIsRUFBNkRGLE9BQTdELENBQXFFLE1BQU1aLGVBQWUsQ0FBQ2EsTUFBM0Y7QUFDQVYsTUFBQUEsZ0JBQWdCLENBQUNHLEtBQWpCLENBQXVCRyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsR0FBRixDQUFNaEIsT0FBTyxDQUFDcUIsbUJBQWQsQ0FBNUIsRUFBZ0VILE9BQWhFLENBQXdFLE1BQU1WLFdBQTlFO0FBQ0FDLE1BQUFBLGdCQUFnQixDQUFDRyxLQUFqQixDQUF1QkcsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLEdBQUYsQ0FBTXRCLE9BQU8sQ0FBQzRCLGlCQUFkLENBQTVCLEVBQThESixPQUE5RCxDQUFzRSxNQUFNWCxnQkFBZ0IsQ0FBQ1ksTUFBN0Y7QUFDQVYsTUFBQUEsZ0JBQWdCLENBQUNHLEtBQWpCLENBQXVCRyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsR0FBRixDQUFNZCxXQUFXLENBQUNxQixtQkFBbEIsQ0FBNUIsRUFBb0VMLE9BQXBFLENBQTRFLE1BQU1SLGtCQUFrQixDQUFDUyxNQUFyRztBQUNBLFlBQU1LLGFBQWEsR0FBRy9CLE9BQU8sQ0FBQ29CLElBQVIsQ0FBYUMsTUFBYixFQUF0QjtBQUNBTCxNQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxHQUFGLENBQU1oQixPQUFPLENBQUN5QixxQkFBZCxDQUE1QixFQUFrRVAsT0FBbEUsQ0FBMEUsTUFBTU0sYUFBYSxDQUFDTCxNQUE5RjtBQUNBLFlBQU1PLFFBQVEsR0FBR2pDLE9BQU8sQ0FBQ29CLElBQVIsQ0FBYUMsTUFBYixFQUFqQjtBQUNBVSxNQUFBQSxhQUFhLENBQUNaLEtBQWQsQ0FBb0JHLENBQUMsSUFBSUEsQ0FBQyxDQUFDWSxXQUFGLENBQWNsQyxPQUFPLENBQUNtQyxFQUFSLENBQVdDLEtBQVgsRUFBZCxDQUF6QixFQUE0RFgsT0FBNUQsQ0FBb0UsTUFBTVEsUUFBUSxDQUFDUCxNQUFuRjtBQUNBLFlBQU1SLGdCQUFnQixHQUFHbEIsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQXpCO0FBQ0FZLE1BQUFBLFFBQVEsQ0FBQ2QsS0FBVCxDQUFla0IsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLFFBQXRCLEVBQWdDYixPQUFoQyxDQUF3QyxNQUFNUCxnQkFBZ0IsQ0FBQ1EsTUFBL0Q7QUFDQVIsTUFBQUEsZ0JBQWdCLENBQUNDLEtBQWpCLENBQXVCK0IsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLG1CQUE5QixFQUFtRDFCLE9BQW5ELENBQTJELE1BQU0sSUFBakU7QUFDQSxZQUFNYyxZQUFZLEdBQUd2QyxPQUFPLENBQUNvQixJQUFSLENBQWFDLE1BQWIsRUFBckI7QUFDQWtCLE1BQUFBLFlBQVksQ0FBQ3BCLEtBQWIsQ0FBbUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDa0Isa0JBQUYsQ0FBcUJ4QyxPQUFPLENBQUNtQyxFQUFSLENBQVdDLEtBQVgsRUFBckIsQ0FBeEIsRUFBa0VYLE9BQWxFLENBQTBFLE1BQU0zQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0IsS0FBaEIsQ0FBaEY7QUFDQWlDLE1BQUFBLGdCQUFnQixDQUFDRyxLQUFqQixDQUF1QkcsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLEdBQUYsQ0FBTXZCLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV00sT0FBWCxDQUFtQmhDLFdBQVcsQ0FBQ2lDLGFBQS9CLENBQU4sQ0FBNUIsRUFBa0ZqQixPQUFsRixDQUEwRixNQUFNYyxZQUFZLENBQUNiLE1BQTdHO0FBQ0FmLE1BQUFBLE1BQU0sR0FBRyxJQUFJTixRQUFRLENBQUNzQyxjQUFiLENBQTRCM0IsZ0JBQWdCLENBQUNVLE1BQTdDLENBQVQ7QUFDSCxLQXZCSSxDQUFMO0FBd0JBa0IsSUFBQUEsUUFBUSxDQUFDLE1BQU07QUFDWDdCLE1BQUFBLFdBQVcsQ0FBQzhCLE1BQVosQ0FBbUJ3QixVQUFVLElBQUksQ0FBQyxDQUFDQSxVQUFuQyxFQUErQ3RCLE9BQS9DLENBQXVEc0IsVUFBVSxJQUFJQSxVQUFVLENBQUNyQixPQUFYLEVBQXJFO0FBQ0gsS0FGTyxDQUFSOztBQUdBLGFBQVNzQixzQ0FBVCxDQUFnREMsU0FBaEQsRUFBMkRDLHlCQUEzRCxFQUFzRjtBQUNsRixhQUFPL0YsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEQ7QUFDQSxjQUFNZ0csYUFBYSxHQUFHekUsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQXRCO0FBQ0FvRCxRQUFBQSxhQUFhLENBQUN0RCxLQUFkLENBQW9CdUQsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLGdCQUFGLENBQW1CM0UsT0FBTyxDQUFDbUMsRUFBUixDQUFXTSxPQUFYLENBQW1COEIsU0FBbkIsQ0FBbkIsQ0FBekIsRUFBNEU5QyxPQUE1RSxDQUFvRixNQUFNLElBQTFGO0FBQ0FnRCxRQUFBQSxhQUFhLENBQUN0RCxLQUFkLENBQW9CdUQsQ0FBQyxJQUFJQSxDQUFDLENBQUNFLHFCQUFGLENBQXdCNUUsT0FBTyxDQUFDbUMsRUFBUixDQUFXTSxPQUFYLENBQW1Ca0IsU0FBbkIsQ0FBeEIsRUFBdUQzRCxPQUFPLENBQUNtQyxFQUFSLENBQVdNLE9BQVgsQ0FBbUI4QixTQUFuQixDQUF2RCxDQUF6QixFQUFnSDlDLE9BQWhILENBQXdILE1BQU0zQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0J5Rix5QkFBaEIsQ0FBOUgsRUFKZ0QsQ0FLaEQ7O0FBQ0EsY0FBTUssZUFBZSxHQUFHN0UsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQXhCO0FBQ0F3RCxRQUFBQSxlQUFlLENBQUMxRCxLQUFoQixDQUFzQnVELENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxnQkFBRixDQUFtQjNFLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV0MsS0FBWCxFQUFuQixDQUEzQixFQUFtRVgsT0FBbkUsQ0FBMkVxQixJQUFJLElBQUl5QixTQUFTLEtBQUtBLFNBQWpHO0FBQ0F2RCxRQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDMEMsTUFBRixDQUFTMUQsT0FBTyxDQUFDMkQsa0NBQWpCLENBQTVCLEVBQWtGeEMsT0FBbEYsQ0FBMEYsTUFBTSxDQUFDZ0QsYUFBYSxDQUFDL0MsTUFBZixFQUF1Qm1ELGVBQWUsQ0FBQ25ELE1BQXZDLENBQWhHO0FBQ0EsY0FBTTBCLFFBQVEsR0FBRyxNQUFNekMsTUFBTSxDQUFDMEMsZ0NBQVAsQ0FBd0NrQixTQUF4QyxDQUF2QjtBQUNBRSxRQUFBQSxhQUFhLENBQUNLLE1BQWQsQ0FBcUJKLENBQUMsSUFBSUEsQ0FBQyxDQUFDRSxxQkFBRixDQUF3QjVFLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV00sT0FBWCxDQUFtQmtCLFNBQW5CLENBQXhCLEVBQXVEM0QsT0FBTyxDQUFDbUMsRUFBUixDQUFXTSxPQUFYLENBQW1COEIsU0FBbkIsQ0FBdkQsQ0FBMUIsRUFBaUh2RSxPQUFPLENBQUMrRSxLQUFSLENBQWNDLElBQWQsRUFBakg7QUFDQVAsUUFBQUEsYUFBYSxDQUFDSyxNQUFkLENBQXFCSixDQUFDLElBQUlBLENBQUMsQ0FBQ0MsZ0JBQUYsQ0FBbUIzRSxPQUFPLENBQUNtQyxFQUFSLENBQVdNLE9BQVgsQ0FBbUI4QixTQUFuQixDQUFuQixDQUExQixFQUE2RXZFLE9BQU8sQ0FBQytFLEtBQVIsQ0FBY0MsSUFBZCxFQUE3RTtBQUNBSCxRQUFBQSxlQUFlLENBQUNDLE1BQWhCLENBQXVCSixDQUFDLElBQUlBLENBQUMsQ0FBQ0UscUJBQUYsQ0FBd0I1RSxPQUFPLENBQUNtQyxFQUFSLENBQVdDLEtBQVgsRUFBeEIsRUFBNENwQyxPQUFPLENBQUNtQyxFQUFSLENBQVdDLEtBQVgsRUFBNUMsQ0FBNUIsRUFBNkZwQyxPQUFPLENBQUMrRSxLQUFSLENBQWNFLEtBQWQsRUFBN0Y7QUFDQUosUUFBQUEsZUFBZSxDQUFDQyxNQUFoQixDQUF1QkosQ0FBQyxJQUFJQSxDQUFDLENBQUNDLGdCQUFGLENBQW1CM0UsT0FBTyxDQUFDbUMsRUFBUixDQUFXTSxPQUFYLENBQW1COEIsU0FBbkIsQ0FBbkIsQ0FBNUIsRUFBK0V2RSxPQUFPLENBQUMrRSxLQUFSLENBQWNDLElBQWQsRUFBL0U7QUFDQWxGLFFBQUFBLE1BQU0sQ0FBQzBELE1BQVAsQ0FBY0osUUFBZCxFQUF3QkssRUFBeEIsQ0FBMkJ5QixJQUEzQixDQUFnQ3hCLEtBQWhDLENBQXNDYyx5QkFBdEMsRUFBaUUsOEJBQWpFO0FBQ0gsT0FmZSxDQUFoQjtBQWdCSDs7QUFDRHZCLElBQUFBLElBQUksQ0FBRSx5REFBd0RrQixhQUFhLENBQUNDLElBQUssa0JBQTdFLEVBQWdHLE1BQU0zRixTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ25KLFlBQU02RixzQ0FBc0MsQ0FBQ0gsYUFBYSxDQUFDakYsS0FBZixFQUFzQixDQUFDLEdBQUQsRUFBTSxHQUFOLENBQXRCLENBQTVDO0FBQ0gsS0FGa0gsQ0FBL0csQ0FBSjtBQUdBK0QsSUFBQUEsSUFBSSxDQUFFLHlEQUF3RGtCLGFBQWEsQ0FBQ0MsSUFBSyxtQkFBN0UsRUFBaUcsTUFBTTNGLFNBQVMsU0FBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDcEosWUFBTTZGLHNDQUFzQyxDQUFDSCxhQUFhLENBQUNqRixLQUFmLEVBQXNCLENBQUMsd0JBQUQsQ0FBdEIsQ0FBNUM7QUFDSCxLQUZtSCxDQUFoSCxDQUFKO0FBR0ErRCxJQUFBQSxJQUFJLENBQUUseURBQXdEa0IsYUFBYSxDQUFDQyxJQUFLLGNBQTdFLEVBQTRGLE1BQU0zRixTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQy9JLFlBQU02RixzQ0FBc0MsQ0FBQ0gsYUFBYSxDQUFDakYsS0FBZixDQUE1QztBQUNILEtBRjhHLENBQTNHLENBQUo7O0FBR0EsYUFBU2lHLHNDQUFULENBQWdEWixTQUFoRCxFQUEyRDtBQUN2RCxhQUFPOUYsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEQ7QUFDQSxjQUFNb0csZUFBZSxHQUFHN0UsT0FBTyxDQUFDb0IsSUFBUixDQUFhQyxNQUFiLEVBQXhCO0FBQ0F3RCxRQUFBQSxlQUFlLENBQUMxRCxLQUFoQixDQUFzQnVELENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxnQkFBRixDQUFtQjNFLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV0MsS0FBWCxFQUFuQixDQUEzQixFQUFtRVgsT0FBbkUsQ0FBMkVxQixJQUFJLElBQUl5QixTQUFTLEtBQUtBLFNBQWpHO0FBQ0F2RCxRQUFBQSxnQkFBZ0IsQ0FBQ0csS0FBakIsQ0FBdUJHLENBQUMsSUFBSUEsQ0FBQyxDQUFDMEMsTUFBRixDQUFTMUQsT0FBTyxDQUFDMkQsa0NBQWpCLENBQTVCLEVBQWtGeEMsT0FBbEYsQ0FBMEYsTUFBTSxDQUFDb0QsZUFBZSxDQUFDbkQsTUFBakIsQ0FBaEc7QUFDQSxjQUFNMEIsUUFBUSxHQUFHLE1BQU16QyxNQUFNLENBQUMwQyxnQ0FBUCxDQUF3Q2tCLFNBQXhDLENBQXZCO0FBQ0FNLFFBQUFBLGVBQWUsQ0FBQ0MsTUFBaEIsQ0FBdUJKLENBQUMsSUFBSUEsQ0FBQyxDQUFDRSxxQkFBRixDQUF3QjVFLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV0MsS0FBWCxFQUF4QixFQUE0Q3BDLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV0MsS0FBWCxFQUE1QyxDQUE1QixFQUE2RnBDLE9BQU8sQ0FBQytFLEtBQVIsQ0FBY0UsS0FBZCxFQUE3RjtBQUNBbkYsUUFBQUEsTUFBTSxDQUFDMEQsTUFBUCxDQUFjSixRQUFkLEVBQXdCSyxFQUF4QixDQUEyQnlCLElBQTNCLENBQWdDeEIsS0FBaEMsQ0FBc0NDLFNBQXRDLEVBQWlELDhCQUFqRDtBQUNILE9BUmUsQ0FBaEI7QUFTSDs7QUFDRFYsSUFBQUEsSUFBSSxDQUFFLDhDQUE2Q2tCLGFBQWEsQ0FBQ0MsSUFBSywwQkFBbEUsRUFBNkYsTUFBTTNGLFNBQVMsU0FBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEosWUFBTTBHLHNDQUFzQyxDQUFDaEIsYUFBYSxDQUFDakYsS0FBZixDQUE1QztBQUNILEtBRitHLENBQTVHLENBQUo7QUFHSCxHQTVFSSxDQUFMO0FBNkVILENBOUVEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IGJhc2hfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3Rlcm1pbmFsL2Vudmlyb25tZW50QWN0aXZhdGlvblByb3ZpZGVycy9iYXNoXCIpO1xyXG5jb25zdCBjb21tYW5kUHJvbXB0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90ZXJtaW5hbC9lbnZpcm9ubWVudEFjdGl2YXRpb25Qcm92aWRlcnMvY29tbWFuZFByb21wdFwiKTtcclxuY29uc3QgaGVscGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90ZXJtaW5hbC9oZWxwZXJcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90ZXJtaW5hbC90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBlbnVtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9lbnVtXCIpO1xyXG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvaW50ZXJwcmV0ZXIvY29udHJhY3RzXCIpO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ1Rlcm1pbmFsIFNlcnZpY2UgaGVscGVycycsICgpID0+IHtcclxuICAgIGxldCBoZWxwZXI7XHJcbiAgICBsZXQgdGVybWluYWxNYW5hZ2VyO1xyXG4gICAgbGV0IHBsYXRmb3JtU2VydmljZTtcclxuICAgIGxldCB3b3Jrc3BhY2VTZXJ2aWNlO1xyXG4gICAgbGV0IGRpc3Bvc2FibGVzID0gW107XHJcbiAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgIGxldCBpbnRlcnByZXRlclNlcnZpY2U7XHJcbiAgICBsZXQgdGVybWluYWxTZXR0aW5ncztcclxuICAgIHNldHVwKCgpID0+IHtcclxuICAgICAgICB0ZXJtaW5hbE1hbmFnZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgcGxhdGZvcm1TZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHRlcm1pbmFsU2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgZGlzcG9zYWJsZXMgPSBbXTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc18xLklUZXJtaW5hbE1hbmFnZXIpKS5yZXR1cm5zKCgpID0+IHRlcm1pbmFsTWFuYWdlci5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc18yLklQbGF0Zm9ybVNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IHBsYXRmb3JtU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc180LklEaXNwb3NhYmxlUmVnaXN0cnkpKS5yZXR1cm5zKCgpID0+IGRpc3Bvc2FibGVzKTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChjb250cmFjdHNfMS5JSW50ZXJwcmV0ZXJTZXJ2aWNlKSkucmV0dXJucygoKSA9PiBpbnRlcnByZXRlclNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBjb25zdCBjb25maWdTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc180LklDb25maWd1cmF0aW9uU2VydmljZSkpLnJldHVybnMoKCkgPT4gY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbmZpZ1NlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gc2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICBzZXR0aW5ncy5zZXR1cChzID0+IHMudGVybWluYWwpLnJldHVybnMoKCkgPT4gdGVybWluYWxTZXR0aW5ncy5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IGNvbmRhU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25kYVNlcnZpY2Uuc2V0dXAoYyA9PiBjLmlzQ29uZGFFbnZpcm9ubWVudChUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShmYWxzZSkpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUoY29udHJhY3RzXzEuSUNvbmRhU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IGNvbmRhU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIGhlbHBlciA9IG5ldyBoZWxwZXJfMS5UZXJtaW5hbEhlbHBlcihzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIHRlYXJkb3duKCgpID0+IHtcclxuICAgICAgICBkaXNwb3NhYmxlcy5maWx0ZXIoaXRlbSA9PiAhIWl0ZW0pLmZvckVhY2goaXRlbSA9PiBpdGVtLmRpc3Bvc2UoKSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ0FjdGl2YXRpb24gY29tbWFuZCBpcyB1bmRlZmluZWQgd2hlbiB0ZXJtaW5hbCBhY3RpdmF0aW9uIGlzIGRpc2FibGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHRlcm1pbmFsU2V0dGluZ3Muc2V0dXAodCA9PiB0LmFjdGl2YXRlRW52aXJvbm1lbnQpLnJldHVybnMoKCkgPT4gZmFsc2UpO1xyXG4gICAgICAgIGNvbnN0IGNvbW1hbmRzID0geWllbGQgaGVscGVyLmdldEVudmlyb25tZW50QWN0aXZhdGlvbkNvbW1hbmRzKHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUub3RoZXIpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoY29tbWFuZHMpLnRvLmVxdWFsKHVuZGVmaW5lZCwgJ0FjdGl2YXRpb24gY29tbWFuZCBzaG91bGQgYmUgdW5kZWZpbmVkIGlmIHRlcm1pbmFsIHR5cGUgY2Fubm90IGJlIGRldGVybWluZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0FjdGl2YXRpb24gY29tbWFuZCBpcyB1bmRlZmluZWQgZm9yIHVua25vd24gdGVybWluYWwnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgdGVybWluYWxTZXR0aW5ncy5zZXR1cCh0ID0+IHQuYWN0aXZhdGVFbnZpcm9ubWVudCkucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICBjb25zdCBiYXNoQWN0aXZhdGlvbiA9IG5ldyBiYXNoXzEuQmFzaChzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgY29tbWFuZFByb21wdEFjdGl2YXRpb24gPSBuZXcgY29tbWFuZFByb21wdF8xLkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXRBbGwodHlwZXNfMy5JVGVybWluYWxBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyKSkucmV0dXJucygoKSA9PiBbYmFzaEFjdGl2YXRpb24sIGNvbW1hbmRQcm9tcHRBY3RpdmF0aW9uXSk7XHJcbiAgICAgICAgY29uc3QgY29tbWFuZHMgPSB5aWVsZCBoZWxwZXIuZ2V0RW52aXJvbm1lbnRBY3RpdmF0aW9uQ29tbWFuZHModHlwZXNfMy5UZXJtaW5hbFNoZWxsVHlwZS5vdGhlcik7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChjb21tYW5kcykudG8uZXF1YWwodW5kZWZpbmVkLCAnQWN0aXZhdGlvbiBjb21tYW5kIHNob3VsZCBiZSB1bmRlZmluZWQgaWYgdGVybWluYWwgdHlwZSBjYW5ub3QgYmUgZGV0ZXJtaW5lZCcpO1xyXG4gICAgfSkpO1xyXG59KTtcclxuZW51bV8xLmdldE5hbWVzQW5kVmFsdWVzKHR5cGVzXzMuVGVybWluYWxTaGVsbFR5cGUpLmZvckVhY2godGVybWluYWxTaGVsbCA9PiB7XHJcbiAgICBzdWl0ZShgVGVybWluYWwgU2VydmljZSBoZWxwZXJzICgke3Rlcm1pbmFsU2hlbGwubmFtZX0pYCwgKCkgPT4ge1xyXG4gICAgICAgIGxldCBoZWxwZXI7XHJcbiAgICAgICAgbGV0IHRlcm1pbmFsTWFuYWdlcjtcclxuICAgICAgICBsZXQgcGxhdGZvcm1TZXJ2aWNlO1xyXG4gICAgICAgIGxldCB3b3Jrc3BhY2VTZXJ2aWNlO1xyXG4gICAgICAgIGxldCBkaXNwb3NhYmxlcyA9IFtdO1xyXG4gICAgICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgICAgIGxldCBpbnRlcnByZXRlclNlcnZpY2U7XHJcbiAgICAgICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgICAgICB0ZXJtaW5hbE1hbmFnZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgIHBsYXRmb3JtU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICBkaXNwb3NhYmxlcyA9IFtdO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZXNfMS5JVGVybWluYWxNYW5hZ2VyKSkucmV0dXJucygoKSA9PiB0ZXJtaW5hbE1hbmFnZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVzXzIuSVBsYXRmb3JtU2VydmljZSkpLnJldHVybnMoKCkgPT4gcGxhdGZvcm1TZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc180LklEaXNwb3NhYmxlUmVnaXN0cnkpKS5yZXR1cm5zKCgpID0+IGRpc3Bvc2FibGVzKTtcclxuICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVzXzEuSVdvcmtzcGFjZVNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KGNvbnRyYWN0c18xLklJbnRlcnByZXRlclNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IGludGVycHJldGVyU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICBjb25zdCBjb25maWdTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZXNfNC5JQ29uZmlndXJhdGlvblNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IGNvbmZpZ1NlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgIGNvbmZpZ1NlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gc2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICAgICAgY29uc3QgdGVybWluYWxTZXR0aW5ncyA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgc2V0dGluZ3Muc2V0dXAocyA9PiBzLnRlcm1pbmFsKS5yZXR1cm5zKCgpID0+IHRlcm1pbmFsU2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICAgICAgdGVybWluYWxTZXR0aW5ncy5zZXR1cCh0ID0+IHQuYWN0aXZhdGVFbnZpcm9ubWVudCkucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICAgICAgY29uc3QgY29uZGFTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICBjb25kYVNlcnZpY2Uuc2V0dXAoYyA9PiBjLmlzQ29uZGFFbnZpcm9ubWVudChUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShmYWxzZSkpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKGNvbnRyYWN0c18xLklDb25kYVNlcnZpY2UpKSkucmV0dXJucygoKSA9PiBjb25kYVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICAgICAgaGVscGVyID0gbmV3IGhlbHBlcl8xLlRlcm1pbmFsSGVscGVyKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0ZWFyZG93bigoKSA9PiB7XHJcbiAgICAgICAgICAgIGRpc3Bvc2FibGVzLmZpbHRlcihkaXNwb3NhYmxlID0+ICEhZGlzcG9zYWJsZSkuZm9yRWFjaChkaXNwb3NhYmxlID0+IGRpc3Bvc2FibGUuZGlzcG9zZSgpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0aW9uQ29tbWFuZFNob3VsZFJldHVybkNvcnJlY3RseShzaGVsbFR5cGUsIGV4cGVjdGVkQWN0aXZhdGlvbkNvbW1hbmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBvbmx5IHdvcmsgZm9yIHRoZSBjdXJyZW50IHNoZWxsIHR5cGUuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZFByb3ZpZGVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgdmFsaWRQcm92aWRlci5zZXR1cChwID0+IHAuaXNTaGVsbFN1cHBvcnRlZChUeXBlTW9xLkl0LmlzVmFsdWUoc2hlbGxUeXBlKSkpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB2YWxpZFByb3ZpZGVyLnNldHVwKHAgPT4gcC5nZXRBY3RpdmF0aW9uQ29tbWFuZHMoVHlwZU1vcS5JdC5pc1ZhbHVlKHVuZGVmaW5lZCksIFR5cGVNb3EuSXQuaXNWYWx1ZShzaGVsbFR5cGUpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoZXhwZWN0ZWRBY3RpdmF0aW9uQ29tbWFuZCkpO1xyXG4gICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIHN1cHBvcnQgb3RoZXIgcHJvdmlkZXJzLlxyXG4gICAgICAgICAgICAgICAgY29uc3QgaW52YWxpZFByb3ZpZGVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgaW52YWxpZFByb3ZpZGVyLnNldHVwKHAgPT4gcC5pc1NoZWxsU3VwcG9ydGVkKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoaXRlbSA9PiBzaGVsbFR5cGUgIT09IHNoZWxsVHlwZSk7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXRBbGwodHlwZXNfMy5JVGVybWluYWxBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyKSkucmV0dXJucygoKSA9PiBbdmFsaWRQcm92aWRlci5vYmplY3QsIGludmFsaWRQcm92aWRlci5vYmplY3RdKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmRzID0geWllbGQgaGVscGVyLmdldEVudmlyb25tZW50QWN0aXZhdGlvbkNvbW1hbmRzKHNoZWxsVHlwZSk7XHJcbiAgICAgICAgICAgICAgICB2YWxpZFByb3ZpZGVyLnZlcmlmeShwID0+IHAuZ2V0QWN0aXZhdGlvbkNvbW1hbmRzKFR5cGVNb3EuSXQuaXNWYWx1ZSh1bmRlZmluZWQpLCBUeXBlTW9xLkl0LmlzVmFsdWUoc2hlbGxUeXBlKSksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgIHZhbGlkUHJvdmlkZXIudmVyaWZ5KHAgPT4gcC5pc1NoZWxsU3VwcG9ydGVkKFR5cGVNb3EuSXQuaXNWYWx1ZShzaGVsbFR5cGUpKSwgVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgaW52YWxpZFByb3ZpZGVyLnZlcmlmeShwID0+IHAuZ2V0QWN0aXZhdGlvbkNvbW1hbmRzKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgICAgICAgICAgICAgIGludmFsaWRQcm92aWRlci52ZXJpZnkocCA9PiBwLmlzU2hlbGxTdXBwb3J0ZWQoVHlwZU1vcS5JdC5pc1ZhbHVlKHNoZWxsVHlwZSkpLCBUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmRzKS50by5kZWVwLmVxdWFsKGV4cGVjdGVkQWN0aXZhdGlvbkNvbW1hbmQsICdJbmNvcnJlY3QgYWN0aXZhdGlvbiBjb21tYW5kJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0ZXN0KGBBY3RpdmF0aW9uIGNvbW1hbmQgc2hvdWxkIGJlIGNvcnJlY3RseSBpZGVudGlmaWVkIGZvciAke3Rlcm1pbmFsU2hlbGwubmFtZX0gKGNvbW1hbmQgYXJyYXkpYCwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB5aWVsZCBhY3RpdmF0aW9uQ29tbWFuZFNob3VsZFJldHVybkNvcnJlY3RseSh0ZXJtaW5hbFNoZWxsLnZhbHVlLCBbJ2EnLCAnYiddKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGVzdChgQWN0aXZhdGlvbiBjb21tYW5kIHNob3VsZCBiZSBjb3JyZWN0bHkgaWRlbnRpZmllZCBmb3IgJHt0ZXJtaW5hbFNoZWxsLm5hbWV9IChjb21tYW5kIHN0cmluZylgLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHlpZWxkIGFjdGl2YXRpb25Db21tYW5kU2hvdWxkUmV0dXJuQ29ycmVjdGx5KHRlcm1pbmFsU2hlbGwudmFsdWUsIFsnY29tbWFuZCB0byBiZSBleGVjdXRlZCddKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGVzdChgQWN0aXZhdGlvbiBjb21tYW5kIHNob3VsZCBiZSBjb3JyZWN0bHkgaWRlbnRpZmllZCBmb3IgJHt0ZXJtaW5hbFNoZWxsLm5hbWV9ICh1bmRlZmluZWQpYCwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB5aWVsZCBhY3RpdmF0aW9uQ29tbWFuZFNob3VsZFJldHVybkNvcnJlY3RseSh0ZXJtaW5hbFNoZWxsLnZhbHVlKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGlvbkNvbW1hbmRTaG91bGRSZXR1cm5VbmRlZmluZWQoc2hlbGxUeXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgc3VwcG9ydCBvdGhlciBwcm92aWRlcnMuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnZhbGlkUHJvdmlkZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBpbnZhbGlkUHJvdmlkZXIuc2V0dXAocCA9PiBwLmlzU2hlbGxTdXBwb3J0ZWQoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucyhpdGVtID0+IHNoZWxsVHlwZSAhPT0gc2hlbGxUeXBlKTtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldEFsbCh0eXBlc18zLklUZXJtaW5hbEFjdGl2YXRpb25Db21tYW5kUHJvdmlkZXIpKS5yZXR1cm5zKCgpID0+IFtpbnZhbGlkUHJvdmlkZXIub2JqZWN0XSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kcyA9IHlpZWxkIGhlbHBlci5nZXRFbnZpcm9ubWVudEFjdGl2YXRpb25Db21tYW5kcyhzaGVsbFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgaW52YWxpZFByb3ZpZGVyLnZlcmlmeShwID0+IHAuZ2V0QWN0aXZhdGlvbkNvbW1hbmRzKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoY29tbWFuZHMpLnRvLmRlZXAuZXF1YWwodW5kZWZpbmVkLCAnSW5jb3JyZWN0IGFjdGl2YXRpb24gY29tbWFuZCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGVzdChgQWN0aXZhdGlvbiBjb21tYW5kIHNob3VsZCByZXR1cm4gdW5kZWZpbmVkICR7dGVybWluYWxTaGVsbC5uYW1lfSAobm8gbWF0Y2hpbmcgcHJvdmlkZXJzKWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgeWllbGQgYWN0aXZhdGlvbkNvbW1hbmRTaG91bGRSZXR1cm5VbmRlZmluZWQodGVybWluYWxTaGVsbC52YWx1ZSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1oZWxwZXIuYWN0aXZhdGlvbi51bml0LnRlc3QuanMubWFwIl19