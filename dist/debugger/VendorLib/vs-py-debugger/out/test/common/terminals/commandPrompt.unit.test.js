// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const path = require("path");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const commandPrompt_1 = require("../../../client/common/terminal/commandPrompt");

suite('Terminal Command Prompt', () => {
  let currentProc;
  let configService;
  setup(() => {
    currentProc = TypeMoq.Mock.ofType();
    configService = TypeMoq.Mock.ofType();
  });
  test('Getting Path Command Prompt executable (32 on 64Win)', () => __awaiter(void 0, void 0, void 0, function* () {
    const env = {
      windir: 'windir'
    };
    currentProc.setup(p => p.env).returns(() => env).verifiable(TypeMoq.Times.atLeastOnce());
    const cmdPath = commandPrompt_1.getCommandPromptLocation(currentProc.object);
    chai_1.expect(cmdPath).to.be.deep.equal(path.join('windir', 'System32', 'cmd.exe'));
    currentProc.verifyAll();
  }));
  test('Getting Path Command Prompt executable (not 32 on 64Win)', () => __awaiter(void 0, void 0, void 0, function* () {
    const env = {
      PROCESSOR_ARCHITEW6432: 'x',
      windir: 'windir'
    };
    currentProc.setup(p => p.env).returns(() => env).verifiable(TypeMoq.Times.atLeastOnce());
    const cmdPath = commandPrompt_1.getCommandPromptLocation(currentProc.object);
    chai_1.expect(cmdPath).to.be.deep.equal(path.join('windir', 'Sysnative', 'cmd.exe'));
    currentProc.verifyAll();
  }));
  test('Use command prompt as default shell', () => __awaiter(void 0, void 0, void 0, function* () {
    const env = {
      windir: 'windir'
    };
    currentProc.setup(p => p.env).returns(() => env).verifiable(TypeMoq.Times.atLeastOnce());
    const cmdPromptPath = path.join('windir', 'System32', 'cmd.exe');
    configService.setup(c => c.updateSectionSetting(TypeMoq.It.isValue('terminal'), TypeMoq.It.isValue('integrated.shell.windows'), TypeMoq.It.isValue(cmdPromptPath), TypeMoq.It.isAny(), TypeMoq.It.isValue(vscode_1.ConfigurationTarget.Global))).returns(() => Promise.resolve()).verifiable(TypeMoq.Times.once());
    yield commandPrompt_1.useCommandPromptAsDefaultShell(currentProc.object, configService.object);
    configService.verifyAll();
    currentProc.verifyAll();
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1hbmRQcm9tcHQudW5pdC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwicGF0aCIsIlR5cGVNb3EiLCJ2c2NvZGVfMSIsImNvbW1hbmRQcm9tcHRfMSIsInN1aXRlIiwiY3VycmVudFByb2MiLCJjb25maWdTZXJ2aWNlIiwic2V0dXAiLCJNb2NrIiwib2ZUeXBlIiwidGVzdCIsImVudiIsIndpbmRpciIsInAiLCJyZXR1cm5zIiwidmVyaWZpYWJsZSIsIlRpbWVzIiwiYXRMZWFzdE9uY2UiLCJjbWRQYXRoIiwiZ2V0Q29tbWFuZFByb21wdExvY2F0aW9uIiwib2JqZWN0IiwiZXhwZWN0IiwidG8iLCJiZSIsImRlZXAiLCJlcXVhbCIsImpvaW4iLCJ2ZXJpZnlBbGwiLCJQUk9DRVNTT1JfQVJDSElURVc2NDMyIiwiY21kUHJvbXB0UGF0aCIsImMiLCJ1cGRhdGVTZWN0aW9uU2V0dGluZyIsIkl0IiwiaXNWYWx1ZSIsImlzQW55IiwiQ29uZmlndXJhdGlvblRhcmdldCIsIkdsb2JhbCIsIm9uY2UiLCJ1c2VDb21tYW5kUHJvbXB0QXNEZWZhdWx0U2hlbGwiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlC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LEVBQ0tHLE9BREwsQ0FDYSxNQUFNSCxHQURuQixFQUVLSSxVQUZMLENBRWdCZCxPQUFPLENBQUNlLEtBQVIsQ0FBY0MsV0FBZCxFQUZoQjtBQUdBLFVBQU1ZLGFBQWEsR0FBRzdCLElBQUksQ0FBQzBCLElBQUwsQ0FBVSxRQUFWLEVBQW9CLFVBQXBCLEVBQWdDLFNBQWhDLENBQXRCO0FBQ0FwQixJQUFBQSxhQUFhLENBQ1JDLEtBREwsQ0FDV3VCLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxvQkFBRixDQUF1QjlCLE9BQU8sQ0FBQytCLEVBQVIsQ0FBV0MsT0FBWCxDQUFtQixVQUFuQixDQUF2QixFQUF1RGhDLE9BQU8sQ0FBQytCLEVBQVIsQ0FBV0MsT0FBWCxDQUFtQiwwQkFBbkIsQ0FBdkQsRUFBdUdoQyxPQUFPLENBQUMrQixFQUFSLENBQVdDLE9BQVgsQ0FBbUJKLGFBQW5CLENBQXZHLEVBQTBJNUIsT0FBTyxDQUFDK0IsRUFBUixDQUFXRSxLQUFYLEVBQTFJLEVBQThKakMsT0FBTyxDQUFDK0IsRUFBUixDQUFXQyxPQUFYLENBQW1CL0IsUUFBUSxDQUFDaUMsbUJBQVQsQ0FBNkJDLE1BQWhELENBQTlKLENBRGhCLEVBRUt0QixPQUZMLENBRWEsTUFBTWhDLE9BQU8sQ0FBQ0MsT0FBUixFQUZuQixFQUdLZ0MsVUFITCxDQUdnQmQsT0FBTyxDQUFDZSxLQUFSLENBQWNxQixJQUFkLEVBSGhCO0FBSUEsVUFBTWxDLGVBQWUsQ0FBQ21DLDhCQUFoQixDQUErQ2pDLFdBQVcsQ0FBQ2UsTUFBM0QsRUFBbUVkLGFBQWEsQ0FBQ2MsTUFBakYsQ0FBTjtBQUNBZCxJQUFBQSxhQUFhLENBQUNxQixTQUFkO0FBQ0F0QixJQUFBQSxXQUFXLENBQUNzQixTQUFaO0FBQ0gsR0FiMEQsQ0FBdkQsQ0FBSjtBQWNILENBdkNJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IGNvbW1hbmRQcm9tcHRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3Rlcm1pbmFsL2NvbW1hbmRQcm9tcHRcIik7XHJcbnN1aXRlKCdUZXJtaW5hbCBDb21tYW5kIFByb21wdCcsICgpID0+IHtcclxuICAgIGxldCBjdXJyZW50UHJvYztcclxuICAgIGxldCBjb25maWdTZXJ2aWNlO1xyXG4gICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgIGN1cnJlbnRQcm9jID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbmZpZ1NlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ0dldHRpbmcgUGF0aCBDb21tYW5kIFByb21wdCBleGVjdXRhYmxlICgzMiBvbiA2NFdpbiknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZW52ID0geyB3aW5kaXI6ICd3aW5kaXInIH07XHJcbiAgICAgICAgY3VycmVudFByb2Muc2V0dXAocCA9PiBwLmVudilcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gZW52KVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgIGNvbnN0IGNtZFBhdGggPSBjb21tYW5kUHJvbXB0XzEuZ2V0Q29tbWFuZFByb21wdExvY2F0aW9uKGN1cnJlbnRQcm9jLm9iamVjdCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChjbWRQYXRoKS50by5iZS5kZWVwLmVxdWFsKHBhdGguam9pbignd2luZGlyJywgJ1N5c3RlbTMyJywgJ2NtZC5leGUnKSk7XHJcbiAgICAgICAgY3VycmVudFByb2MudmVyaWZ5QWxsKCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdHZXR0aW5nIFBhdGggQ29tbWFuZCBQcm9tcHQgZXhlY3V0YWJsZSAobm90IDMyIG9uIDY0V2luKScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBlbnYgPSB7IFBST0NFU1NPUl9BUkNISVRFVzY0MzI6ICd4Jywgd2luZGlyOiAnd2luZGlyJyB9O1xyXG4gICAgICAgIGN1cnJlbnRQcm9jLnNldHVwKHAgPT4gcC5lbnYpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IGVudilcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5hdExlYXN0T25jZSgpKTtcclxuICAgICAgICBjb25zdCBjbWRQYXRoID0gY29tbWFuZFByb21wdF8xLmdldENvbW1hbmRQcm9tcHRMb2NhdGlvbihjdXJyZW50UHJvYy5vYmplY3QpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoY21kUGF0aCkudG8uYmUuZGVlcC5lcXVhbChwYXRoLmpvaW4oJ3dpbmRpcicsICdTeXNuYXRpdmUnLCAnY21kLmV4ZScpKTtcclxuICAgICAgICBjdXJyZW50UHJvYy52ZXJpZnlBbGwoKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1VzZSBjb21tYW5kIHByb21wdCBhcyBkZWZhdWx0IHNoZWxsJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGVudiA9IHsgd2luZGlyOiAnd2luZGlyJyB9O1xyXG4gICAgICAgIGN1cnJlbnRQcm9jLnNldHVwKHAgPT4gcC5lbnYpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IGVudilcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5hdExlYXN0T25jZSgpKTtcclxuICAgICAgICBjb25zdCBjbWRQcm9tcHRQYXRoID0gcGF0aC5qb2luKCd3aW5kaXInLCAnU3lzdGVtMzInLCAnY21kLmV4ZScpO1xyXG4gICAgICAgIGNvbmZpZ1NlcnZpY2VcclxuICAgICAgICAgICAgLnNldHVwKGMgPT4gYy51cGRhdGVTZWN0aW9uU2V0dGluZyhUeXBlTW9xLkl0LmlzVmFsdWUoJ3Rlcm1pbmFsJyksIFR5cGVNb3EuSXQuaXNWYWx1ZSgnaW50ZWdyYXRlZC5zaGVsbC53aW5kb3dzJyksIFR5cGVNb3EuSXQuaXNWYWx1ZShjbWRQcm9tcHRQYXRoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzVmFsdWUodnNjb2RlXzEuQ29uZmlndXJhdGlvblRhcmdldC5HbG9iYWwpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICB5aWVsZCBjb21tYW5kUHJvbXB0XzEudXNlQ29tbWFuZFByb21wdEFzRGVmYXVsdFNoZWxsKGN1cnJlbnRQcm9jLm9iamVjdCwgY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIGNvbmZpZ1NlcnZpY2UudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgY3VycmVudFByb2MudmVyaWZ5QWxsKCk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tYW5kUHJvbXB0LnVuaXQudGVzdC5qcy5tYXAiXX0=