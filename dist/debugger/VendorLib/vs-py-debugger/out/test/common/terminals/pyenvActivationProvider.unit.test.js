// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const TypeMoq = require("typemoq");

require("../../../client/common/extensions");

const pyenvActivationProvider_1 = require("../../../client/common/terminal/environmentActivationProviders/pyenvActivationProvider");

const types_1 = require("../../../client/common/terminal/types");

const enum_1 = require("../../../client/common/utils/enum");

const platform_1 = require("../../../client/common/utils/platform");

const contracts_1 = require("../../../client/interpreter/contracts");

suite('Terminal Environment Activation pyenv', () => {
  let serviceContainer;
  let interpreterService;
  let activationProvider;
  setup(() => {
    serviceContainer = TypeMoq.Mock.ofType();
    interpreterService = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(contracts_1.IInterpreterService), TypeMoq.It.isAny())).returns(() => interpreterService.object);
    activationProvider = new pyenvActivationProvider_1.PyEnvActivationCommandProvider(serviceContainer.object);
  });
  test('All shells should be supported', () => __awaiter(void 0, void 0, void 0, function* () {
    for (const item of enum_1.getNamesAndValues(types_1.TerminalShellType)) {
      chai_1.expect(activationProvider.isShellSupported(item.value)).to.equal(true, 'All shells should be supported');
    }
  }));
  test('Ensure no activation commands are returned if intrepreter info is not found', () => __awaiter(void 0, void 0, void 0, function* () {
    interpreterService.setup(i => i.getActiveInterpreter(TypeMoq.It.isAny())).returns(() => Promise.resolve(undefined)).verifiable(TypeMoq.Times.once());
    const activationCommands = yield activationProvider.getActivationCommands(undefined, types_1.TerminalShellType.bash);
    chai_1.expect(activationCommands).to.equal(undefined, 'Activation commands should be undefined');
  }));
  test('Ensure no activation commands are returned if intrepreter is not pyenv', () => __awaiter(void 0, void 0, void 0, function* () {
    const intepreterInfo = {
      architecture: platform_1.Architecture.Unknown,
      path: '',
      sysPrefix: '',
      version: '',
      version_info: [1, 1, 1, 'alpha'],
      sysVersion: '',
      type: contracts_1.InterpreterType.Unknown
    };
    interpreterService.setup(i => i.getActiveInterpreter(TypeMoq.It.isAny())).returns(() => Promise.resolve(intepreterInfo)).verifiable(TypeMoq.Times.once());
    const activationCommands = yield activationProvider.getActivationCommands(undefined, types_1.TerminalShellType.bash);
    chai_1.expect(activationCommands).to.equal(undefined, 'Activation commands should be undefined');
  }));
  test('Ensure no activation commands are returned if intrepreter envName is empty', () => __awaiter(void 0, void 0, void 0, function* () {
    const intepreterInfo = {
      architecture: platform_1.Architecture.Unknown,
      path: '',
      sysPrefix: '',
      version: '',
      version_info: [1, 1, 1, 'alpha'],
      sysVersion: '',
      type: contracts_1.InterpreterType.Pyenv
    };
    interpreterService.setup(i => i.getActiveInterpreter(TypeMoq.It.isAny())).returns(() => Promise.resolve(intepreterInfo)).verifiable(TypeMoq.Times.once());
    const activationCommands = yield activationProvider.getActivationCommands(undefined, types_1.TerminalShellType.bash);
    chai_1.expect(activationCommands).to.equal(undefined, 'Activation commands should be undefined');
  }));
  test('Ensure activation command is returned', () => __awaiter(void 0, void 0, void 0, function* () {
    const intepreterInfo = {
      architecture: platform_1.Architecture.Unknown,
      path: '',
      sysPrefix: '',
      version: '',
      version_info: [1, 1, 1, 'alpha'],
      sysVersion: '',
      type: contracts_1.InterpreterType.Pyenv,
      envName: 'my env name'
    };
    interpreterService.setup(i => i.getActiveInterpreter(TypeMoq.It.isAny())).returns(() => Promise.resolve(intepreterInfo)).verifiable(TypeMoq.Times.once());
    const activationCommands = yield activationProvider.getActivationCommands(undefined, types_1.TerminalShellType.bash);
    chai_1.expect(activationCommands).to.deep.equal([`pyenv shell ${intepreterInfo.envName}`], 'Invalid Activation command');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5ZW52QWN0aXZhdGlvblByb3ZpZGVyLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiY2hhaV8xIiwicmVxdWlyZSIsIlR5cGVNb3EiLCJweWVudkFjdGl2YXRpb25Qcm92aWRlcl8xIiwidHlwZXNfMSIsImVudW1fMSIsInBsYXRmb3JtXzEiLCJjb250cmFjdHNfMSIsInN1aXRlIiwic2VydmljZUNvbnRhaW5lciIsImludGVycHJldGVyU2VydmljZSIsImFjdGl2YXRpb25Qcm92aWRlciIsInNldHVwIiwiTW9jayIsIm9mVHlwZSIsImMiLCJnZXQiLCJJdCIsImlzVmFsdWUiLCJJSW50ZXJwcmV0ZXJTZXJ2aWNlIiwiaXNBbnkiLCJyZXR1cm5zIiwib2JqZWN0IiwiUHlFbnZBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyIiwidGVzdCIsIml0ZW0iLCJnZXROYW1lc0FuZFZhbHVlcyIsIlRlcm1pbmFsU2hlbGxUeXBlIiwiZXhwZWN0IiwiaXNTaGVsbFN1cHBvcnRlZCIsInRvIiwiZXF1YWwiLCJpIiwiZ2V0QWN0aXZlSW50ZXJwcmV0ZXIiLCJ1bmRlZmluZWQiLCJ2ZXJpZmlhYmxlIiwiVGltZXMiLCJvbmNlIiwiYWN0aXZhdGlvbkNvbW1hbmRzIiwiZ2V0QWN0aXZhdGlvbkNvbW1hbmRzIiwiYmFzaCIsImludGVwcmV0ZXJJbmZvIiwiYXJjaGl0ZWN0dXJlIiwiQXJjaGl0ZWN0dXJlIiwiVW5rbm93biIsInBhdGgiLCJzeXNQcmVmaXgiLCJ2ZXJzaW9uIiwidmVyc2lvbl9pbmZvIiwic3lzVmVyc2lvbiIs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QUFQLENBQWNVLGtCQUFkLEVBQWtDUixFQUFsQyxDQUFxQ3dCLElBQXJDLENBQTBDdkIsS0FBMUMsQ0FBZ0QsQ0FBRSxlQUFjVSxjQUFjLENBQUNZLE9BQVEsRUFBdkMsQ0FBaEQsRUFBMkYsNEJBQTNGO0FBQ0gsR0FqQjRELENBQXpELENBQUo7QUFrQkgsQ0EzRUksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5yZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9leHRlbnNpb25zXCIpO1xyXG5jb25zdCBweWVudkFjdGl2YXRpb25Qcm92aWRlcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdGVybWluYWwvZW52aXJvbm1lbnRBY3RpdmF0aW9uUHJvdmlkZXJzL3B5ZW52QWN0aXZhdGlvblByb3ZpZGVyXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdGVybWluYWwvdHlwZXNcIik7XHJcbmNvbnN0IGVudW1fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL2VudW1cIik7XHJcbmNvbnN0IHBsYXRmb3JtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9wbGF0Zm9ybVwiKTtcclxuY29uc3QgY29udHJhY3RzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2ludGVycHJldGVyL2NvbnRyYWN0c1wiKTtcclxuc3VpdGUoJ1Rlcm1pbmFsIEVudmlyb25tZW50IEFjdGl2YXRpb24gcHllbnYnLCAoKSA9PiB7XHJcbiAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgIGxldCBpbnRlcnByZXRlclNlcnZpY2U7XHJcbiAgICBsZXQgYWN0aXZhdGlvblByb3ZpZGVyO1xyXG4gICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUoY29udHJhY3RzXzEuSUludGVycHJldGVyU2VydmljZSksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gaW50ZXJwcmV0ZXJTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgYWN0aXZhdGlvblByb3ZpZGVyID0gbmV3IHB5ZW52QWN0aXZhdGlvblByb3ZpZGVyXzEuUHlFbnZBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnQWxsIHNoZWxscyBzaG91bGQgYmUgc3VwcG9ydGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBlbnVtXzEuZ2V0TmFtZXNBbmRWYWx1ZXModHlwZXNfMS5UZXJtaW5hbFNoZWxsVHlwZSkpIHtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChhY3RpdmF0aW9uUHJvdmlkZXIuaXNTaGVsbFN1cHBvcnRlZChpdGVtLnZhbHVlKSkudG8uZXF1YWwodHJ1ZSwgJ0FsbCBzaGVsbHMgc2hvdWxkIGJlIHN1cHBvcnRlZCcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBubyBhY3RpdmF0aW9uIGNvbW1hbmRzIGFyZSByZXR1cm5lZCBpZiBpbnRyZXByZXRlciBpbmZvIGlzIG5vdCBmb3VuZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBpbnRlcnByZXRlclNlcnZpY2VcclxuICAgICAgICAgICAgLnNldHVwKGkgPT4gaS5nZXRBY3RpdmVJbnRlcnByZXRlcihUeXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2YXRpb25Db21tYW5kcyA9IHlpZWxkIGFjdGl2YXRpb25Qcm92aWRlci5nZXRBY3RpdmF0aW9uQ29tbWFuZHModW5kZWZpbmVkLCB0eXBlc18xLlRlcm1pbmFsU2hlbGxUeXBlLmJhc2gpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoYWN0aXZhdGlvbkNvbW1hbmRzKS50by5lcXVhbCh1bmRlZmluZWQsICdBY3RpdmF0aW9uIGNvbW1hbmRzIHNob3VsZCBiZSB1bmRlZmluZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBubyBhY3RpdmF0aW9uIGNvbW1hbmRzIGFyZSByZXR1cm5lZCBpZiBpbnRyZXByZXRlciBpcyBub3QgcHllbnYnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgaW50ZXByZXRlckluZm8gPSB7XHJcbiAgICAgICAgICAgIGFyY2hpdGVjdHVyZTogcGxhdGZvcm1fMS5BcmNoaXRlY3R1cmUuVW5rbm93bixcclxuICAgICAgICAgICAgcGF0aDogJycsXHJcbiAgICAgICAgICAgIHN5c1ByZWZpeDogJycsXHJcbiAgICAgICAgICAgIHZlcnNpb246ICcnLFxyXG4gICAgICAgICAgICB2ZXJzaW9uX2luZm86IFsxLCAxLCAxLCAnYWxwaGEnXSxcclxuICAgICAgICAgICAgc3lzVmVyc2lvbjogJycsXHJcbiAgICAgICAgICAgIHR5cGU6IGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5Vbmtub3duXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpbnRlcnByZXRlclNlcnZpY2VcclxuICAgICAgICAgICAgLnNldHVwKGkgPT4gaS5nZXRBY3RpdmVJbnRlcnByZXRlcihUeXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoaW50ZXByZXRlckluZm8pKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgY29uc3QgYWN0aXZhdGlvbkNvbW1hbmRzID0geWllbGQgYWN0aXZhdGlvblByb3ZpZGVyLmdldEFjdGl2YXRpb25Db21tYW5kcyh1bmRlZmluZWQsIHR5cGVzXzEuVGVybWluYWxTaGVsbFR5cGUuYmFzaCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChhY3RpdmF0aW9uQ29tbWFuZHMpLnRvLmVxdWFsKHVuZGVmaW5lZCwgJ0FjdGl2YXRpb24gY29tbWFuZHMgc2hvdWxkIGJlIHVuZGVmaW5lZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIG5vIGFjdGl2YXRpb24gY29tbWFuZHMgYXJlIHJldHVybmVkIGlmIGludHJlcHJldGVyIGVudk5hbWUgaXMgZW1wdHknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgaW50ZXByZXRlckluZm8gPSB7XHJcbiAgICAgICAgICAgIGFyY2hpdGVjdHVyZTogcGxhdGZvcm1fMS5BcmNoaXRlY3R1cmUuVW5rbm93bixcclxuICAgICAgICAgICAgcGF0aDogJycsXHJcbiAgICAgICAgICAgIHN5c1ByZWZpeDogJycsXHJcbiAgICAgICAgICAgIHZlcnNpb246ICcnLFxyXG4gICAgICAgICAgICB2ZXJzaW9uX2luZm86IFsxLCAxLCAxLCAnYWxwaGEnXSxcclxuICAgICAgICAgICAgc3lzVmVyc2lvbjogJycsXHJcbiAgICAgICAgICAgIHR5cGU6IGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5QeWVudlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlXHJcbiAgICAgICAgICAgIC5zZXR1cChpID0+IGkuZ2V0QWN0aXZlSW50ZXJwcmV0ZXIoVHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKGludGVwcmV0ZXJJbmZvKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2YXRpb25Db21tYW5kcyA9IHlpZWxkIGFjdGl2YXRpb25Qcm92aWRlci5nZXRBY3RpdmF0aW9uQ29tbWFuZHModW5kZWZpbmVkLCB0eXBlc18xLlRlcm1pbmFsU2hlbGxUeXBlLmJhc2gpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoYWN0aXZhdGlvbkNvbW1hbmRzKS50by5lcXVhbCh1bmRlZmluZWQsICdBY3RpdmF0aW9uIGNvbW1hbmRzIHNob3VsZCBiZSB1bmRlZmluZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBhY3RpdmF0aW9uIGNvbW1hbmQgaXMgcmV0dXJuZWQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgaW50ZXByZXRlckluZm8gPSB7XHJcbiAgICAgICAgICAgIGFyY2hpdGVjdHVyZTogcGxhdGZvcm1fMS5BcmNoaXRlY3R1cmUuVW5rbm93bixcclxuICAgICAgICAgICAgcGF0aDogJycsXHJcbiAgICAgICAgICAgIHN5c1ByZWZpeDogJycsXHJcbiAgICAgICAgICAgIHZlcnNpb246ICcnLFxyXG4gICAgICAgICAgICB2ZXJzaW9uX2luZm86IFsxLCAxLCAxLCAnYWxwaGEnXSxcclxuICAgICAgICAgICAgc3lzVmVyc2lvbjogJycsXHJcbiAgICAgICAgICAgIHR5cGU6IGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5QeWVudixcclxuICAgICAgICAgICAgZW52TmFtZTogJ215IGVudiBuYW1lJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlXHJcbiAgICAgICAgICAgIC5zZXR1cChpID0+IGkuZ2V0QWN0aXZlSW50ZXJwcmV0ZXIoVHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKGludGVwcmV0ZXJJbmZvKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2YXRpb25Db21tYW5kcyA9IHlpZWxkIGFjdGl2YXRpb25Qcm92aWRlci5nZXRBY3RpdmF0aW9uQ29tbWFuZHModW5kZWZpbmVkLCB0eXBlc18xLlRlcm1pbmFsU2hlbGxUeXBlLmJhc2gpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoYWN0aXZhdGlvbkNvbW1hbmRzKS50by5kZWVwLmVxdWFsKFtgcHllbnYgc2hlbGwgJHtpbnRlcHJldGVySW5mby5lbnZOYW1lfWBdLCAnSW52YWxpZCBBY3RpdmF0aW9uIGNvbW1hbmQnKTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXB5ZW52QWN0aXZhdGlvblByb3ZpZGVyLnVuaXQudGVzdC5qcy5tYXAiXX0=