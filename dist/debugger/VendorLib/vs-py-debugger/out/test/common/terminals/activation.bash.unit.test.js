"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const path = require("path");

const TypeMoq = require("typemoq");

require("../../../client/common/extensions");

const types_1 = require("../../../client/common/platform/types");

const bash_1 = require("../../../client/common/terminal/environmentActivationProviders/bash");

const types_2 = require("../../../client/common/terminal/types");

const types_3 = require("../../../client/common/types");

const enum_1 = require("../../../client/common/utils/enum"); // tslint:disable-next-line:max-func-body-length


suite('Terminal Environment Activation (bash)', () => {
  ['usr/bin/python', 'usr/bin/env with spaces/env more/python', 'c:\\users\\windows paths\\conda\\python.exe'].forEach(pythonPath => {
    const hasSpaces = pythonPath.indexOf(' ') > 0;
    const suiteTitle = hasSpaces ? 'and there are spaces in the script file (pythonpath),' : 'and there are no spaces in the script file (pythonpath),';
    suite(suiteTitle, () => {
      ['activate', 'activate.sh', 'activate.csh', 'activate.fish', 'activate.bat', 'activate.ps1'].forEach(scriptFileName => {
        suite(`and script file is ${scriptFileName}`, () => {
          let serviceContainer;
          let fileSystem;
          setup(() => {
            serviceContainer = TypeMoq.Mock.ofType();
            fileSystem = TypeMoq.Mock.ofType();
            serviceContainer.setup(c => c.get(types_1.IFileSystem)).returns(() => fileSystem.object);
            const configService = TypeMoq.Mock.ofType();
            serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService))).returns(() => configService.object);
            const settings = TypeMoq.Mock.ofType();
            settings.setup(s => s.pythonPath).returns(() => pythonPath);
            configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
          });
          enum_1.getNamesAndValues(types_2.TerminalShellType).forEach(shellType => {
            let isScriptFileSupported = false;

            switch (shellType.value) {
              case types_2.TerminalShellType.zsh:
              case types_2.TerminalShellType.ksh:
              case types_2.TerminalShellType.wsl:
              case types_2.TerminalShellType.gitbash:
              case types_2.TerminalShellType.bash:
                {
                  isScriptFileSupported = ['activate', 'activate.sh'].indexOf(scriptFileName) >= 0;
                  break;
                }

              case types_2.TerminalShellType.fish:
                {
                  isScriptFileSupported = ['activate.fish'].indexOf(scriptFileName) >= 0;
                  break;
                }

              case types_2.TerminalShellType.tcshell:
              case types_2.TerminalShellType.cshell:
                {
                  isScriptFileSupported = ['activate.csh'].indexOf(scriptFileName) >= 0;
                  break;
                }

              default:
                {
                  isScriptFileSupported = false;
                }
            }

            const titleTitle = isScriptFileSupported ? `Ensure bash Activation command returns activation command (Shell: ${shellType.name})` : `Ensure bash Activation command returns undefined (Shell: ${shellType.name})`;
            test(titleTitle, () => __awaiter(void 0, void 0, void 0, function* () {
              const bash = new bash_1.Bash(serviceContainer.object);
              const supported = bash.isShellSupported(shellType.value);

              switch (shellType.value) {
                case types_2.TerminalShellType.wsl:
                case types_2.TerminalShellType.zsh:
                case types_2.TerminalShellType.ksh:
                case types_2.TerminalShellType.bash:
                case types_2.TerminalShellType.gitbash:
                case types_2.TerminalShellType.tcshell:
                case types_2.TerminalShellType.cshell:
                case types_2.TerminalShellType.fish:
                  {
                    chai_1.expect(supported).to.be.equal(true, `${shellType.name} shell not supported (it should be)`);
                    break;
                  }

                default:
                  {
                    chai_1.expect(supported).to.be.equal(false, `${shellType.name} incorrectly supported (should not be)`); // No point proceeding with other tests.

                    return;
                  }
              }

              const pathToScriptFile = path.join(path.dirname(pythonPath), scriptFileName);
              fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
              const command = yield bash.getActivationCommands(undefined, shellType.value);

              if (isScriptFileSupported) {
                // Ensure the script file is of the following form:
                // source "<path to script file>" <environment name>
                // Ensure the path is quoted if it contains any spaces.
                // Ensure it contains the name of the environment as an argument to the script file.
                chai_1.expect(command).to.be.deep.equal([`source ${pathToScriptFile.fileToCommandArgument()}`.trim()], 'Invalid command');
              } else {
                chai_1.expect(command).to.be.equal(undefined, 'Command should be undefined');
              }
            }));
          });
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2YXRpb24uYmFzaC51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJwYXRoIiwiVHlwZU1vcSIsInR5cGVzXzEiLCJiYXNoXzEiLCJ0eXBlc18yIiwidHlwZXNfMyIsImVudW1fMSIsInN1aXRlIiwiZm9yRWFjaCIsInB5dGhvblBhdGgiLCJoYXNTcGFjZXMiLCJpbmRleE9mIiwic3VpdGVUaXRsZSIsInNjcmlwdEZpbGVOYW1lIiwic2VydmljZUNvbnRhaW5lciIsImZpbGVTeXN0ZW0iLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJjIiwiZ2V0IiwiSUZpbGVTeXN0ZW0iLCJyZXR1cm5zIiwib2JqZWN0IiwiY29uZmlnU2VydmljZSIsIkl0IiwiaXNWYWx1ZSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsInNldHRpbmdzIiwicyIsImdldFNldHRpbmdzIiwiaXNBbnkiLCJnZXROYW1lc0FuZFZhbHVlcyIsIlRlcm1pbmFsU2hlbGxUeXBlIiwic2hlbGxUeXBlIiwiaXNTY3JpcHRGaWxlU3VwcG9ydGVkIiwienNoIiwia3NoIiwid3NsIiwiZ2l0YmFzaCIsImJhc2giLCJmaXNoIiwidGNzaGVsbCIsImNzaGVsbCIsInRpdGxlVGl0bGUiLCJuYW1lIiwidGVzdCIsIkJhc2giLCJzdXBwb3J0ZWQiLCJpc1NoZWxsU3VwcG9ydGVkIiwiZXhwZWN0IiwidG8iLCJiZSIsImVxdWFsIiwicGF0aFRvU2NyaXB0RmlsZSIsImpvaW4iLCJkaXJuYW1lIiwiZnMiLCJmaWxlRXhpc3RzIiwiY29tbWFuZCIsImdldEFjdGl2YXRpb25Db21tYW5kcyIsInVuZGVmaW5lZCIsImRlZXAiLCJmaWxlVG9Db21tYW5kQXJndW1lbnQiLCJ0cmltIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFyQixHQUFzQyxJQUFJTixDQUFKLENBQU0sVUFBVUcsT0FBVixFQUFtQjtBQUFFQSxRQUFBQSxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFQO0FBQXdCLE9BQW5ELEVBQXFETyxJQUFyRCxDQUEwRFIsU0FBMUQsRUFB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RUFBMUIsQ0FBNkJDLEtBQTdCLENBQW1DUSxTQUFuQyxFQUE4Qyw2QkFBOUM7QUFDSDtBQUNKLGFBbEMrQixDQUE1QixDQUFKO0FBbUNILFdBN0REO0FBOERILFNBM0VJLENBQUw7QUE0RUgsT0E3RUQ7QUE4RUgsS0EvRUksQ0FBTDtBQWdGSCxHQW5GRDtBQW9GSCxDQXJGSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5yZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9leHRlbnNpb25zXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IGJhc2hfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3Rlcm1pbmFsL2Vudmlyb25tZW50QWN0aXZhdGlvblByb3ZpZGVycy9iYXNoXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdGVybWluYWwvdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgZW51bV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdXRpbHMvZW51bVwiKTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbnN1aXRlKCdUZXJtaW5hbCBFbnZpcm9ubWVudCBBY3RpdmF0aW9uIChiYXNoKScsICgpID0+IHtcclxuICAgIFsndXNyL2Jpbi9weXRob24nLCAndXNyL2Jpbi9lbnYgd2l0aCBzcGFjZXMvZW52IG1vcmUvcHl0aG9uJywgJ2M6XFxcXHVzZXJzXFxcXHdpbmRvd3MgcGF0aHNcXFxcY29uZGFcXFxccHl0aG9uLmV4ZSddLmZvckVhY2gocHl0aG9uUGF0aCA9PiB7XHJcbiAgICAgICAgY29uc3QgaGFzU3BhY2VzID0gcHl0aG9uUGF0aC5pbmRleE9mKCcgJykgPiAwO1xyXG4gICAgICAgIGNvbnN0IHN1aXRlVGl0bGUgPSBoYXNTcGFjZXMgPyAnYW5kIHRoZXJlIGFyZSBzcGFjZXMgaW4gdGhlIHNjcmlwdCBmaWxlIChweXRob25wYXRoKSwnIDogJ2FuZCB0aGVyZSBhcmUgbm8gc3BhY2VzIGluIHRoZSBzY3JpcHQgZmlsZSAocHl0aG9ucGF0aCksJztcclxuICAgICAgICBzdWl0ZShzdWl0ZVRpdGxlLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIFsnYWN0aXZhdGUnLCAnYWN0aXZhdGUuc2gnLCAnYWN0aXZhdGUuY3NoJywgJ2FjdGl2YXRlLmZpc2gnLCAnYWN0aXZhdGUuYmF0JywgJ2FjdGl2YXRlLnBzMSddLmZvckVhY2goc2NyaXB0RmlsZU5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3VpdGUoYGFuZCBzY3JpcHQgZmlsZSBpcyAke3NjcmlwdEZpbGVOYW1lfWAsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZVN5c3RlbTtcclxuICAgICAgICAgICAgICAgICAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0gPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc18xLklGaWxlU3lzdGVtKSkucmV0dXJucygoKSA9PiBmaWxlU3lzdGVtLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZ1NlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMy5JQ29uZmlndXJhdGlvblNlcnZpY2UpKSkucmV0dXJucygoKSA9PiBjb25maWdTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5zZXR1cChzID0+IHMucHl0aG9uUGF0aCkucmV0dXJucygoKSA9PiBweXRob25QYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnU2VydmljZS5zZXR1cChjID0+IGMuZ2V0U2V0dGluZ3MoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBzZXR0aW5ncy5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGVudW1fMS5nZXROYW1lc0FuZFZhbHVlcyh0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlKS5mb3JFYWNoKHNoZWxsVHlwZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpc1NjcmlwdEZpbGVTdXBwb3J0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChzaGVsbFR5cGUudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS56c2g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUua3NoOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLndzbDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5naXRiYXNoOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmJhc2g6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1NjcmlwdEZpbGVTdXBwb3J0ZWQgPSBbJ2FjdGl2YXRlJywgJ2FjdGl2YXRlLnNoJ10uaW5kZXhPZihzY3JpcHRGaWxlTmFtZSkgPj0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5maXNoOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTY3JpcHRGaWxlU3VwcG9ydGVkID0gWydhY3RpdmF0ZS5maXNoJ10uaW5kZXhPZihzY3JpcHRGaWxlTmFtZSkgPj0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS50Y3NoZWxsOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmNzaGVsbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU2NyaXB0RmlsZVN1cHBvcnRlZCA9IFsnYWN0aXZhdGUuY3NoJ10uaW5kZXhPZihzY3JpcHRGaWxlTmFtZSkgPj0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1NjcmlwdEZpbGVTdXBwb3J0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aXRsZVRpdGxlID0gaXNTY3JpcHRGaWxlU3VwcG9ydGVkID8gYEVuc3VyZSBiYXNoIEFjdGl2YXRpb24gY29tbWFuZCByZXR1cm5zIGFjdGl2YXRpb24gY29tbWFuZCAoU2hlbGw6ICR7c2hlbGxUeXBlLm5hbWV9KWAgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYEVuc3VyZSBiYXNoIEFjdGl2YXRpb24gY29tbWFuZCByZXR1cm5zIHVuZGVmaW5lZCAoU2hlbGw6ICR7c2hlbGxUeXBlLm5hbWV9KWA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3QodGl0bGVUaXRsZSwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzaCA9IG5ldyBiYXNoXzEuQmFzaChzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdXBwb3J0ZWQgPSBiYXNoLmlzU2hlbGxTdXBwb3J0ZWQoc2hlbGxUeXBlLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc2hlbGxUeXBlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLndzbDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUuenNoOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5rc2g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmJhc2g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmdpdGJhc2g6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLnRjc2hlbGw6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmNzaGVsbDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUuZmlzaDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KHN1cHBvcnRlZCkudG8uYmUuZXF1YWwodHJ1ZSwgYCR7c2hlbGxUeXBlLm5hbWV9IHNoZWxsIG5vdCBzdXBwb3J0ZWQgKGl0IHNob3VsZCBiZSlgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChzdXBwb3J0ZWQpLnRvLmJlLmVxdWFsKGZhbHNlLCBgJHtzaGVsbFR5cGUubmFtZX0gaW5jb3JyZWN0bHkgc3VwcG9ydGVkIChzaG91bGQgbm90IGJlKWApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBObyBwb2ludCBwcm9jZWVkaW5nIHdpdGggb3RoZXIgdGVzdHMuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoVG9TY3JpcHRGaWxlID0gcGF0aC5qb2luKHBhdGguZGlybmFtZShweXRob25QYXRoKSwgc2NyaXB0RmlsZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS5zZXR1cChmcyA9PiBmcy5maWxlRXhpc3RzKFR5cGVNb3EuSXQuaXNWYWx1ZShwYXRoVG9TY3JpcHRGaWxlKSkpLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSB5aWVsZCBiYXNoLmdldEFjdGl2YXRpb25Db21tYW5kcyh1bmRlZmluZWQsIHNoZWxsVHlwZS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNTY3JpcHRGaWxlU3VwcG9ydGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5zdXJlIHRoZSBzY3JpcHQgZmlsZSBpcyBvZiB0aGUgZm9sbG93aW5nIGZvcm06XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc291cmNlIFwiPHBhdGggdG8gc2NyaXB0IGZpbGU+XCIgPGVudmlyb25tZW50IG5hbWU+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5zdXJlIHRoZSBwYXRoIGlzIHF1b3RlZCBpZiBpdCBjb250YWlucyBhbnkgc3BhY2VzLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBpdCBjb250YWlucyB0aGUgbmFtZSBvZiB0aGUgZW52aXJvbm1lbnQgYXMgYW4gYXJndW1lbnQgdG8gdGhlIHNjcmlwdCBmaWxlLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoY29tbWFuZCkudG8uYmUuZGVlcC5lcXVhbChbYHNvdXJjZSAke3BhdGhUb1NjcmlwdEZpbGUuZmlsZVRvQ29tbWFuZEFyZ3VtZW50KCl9YC50cmltKCldLCAnSW52YWxpZCBjb21tYW5kJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmQpLnRvLmJlLmVxdWFsKHVuZGVmaW5lZCwgJ0NvbW1hbmQgc2hvdWxkIGJlIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFjdGl2YXRpb24uYmFzaC51bml0LnRlc3QuanMubWFwIl19