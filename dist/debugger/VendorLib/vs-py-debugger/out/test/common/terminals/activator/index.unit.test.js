// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const TypeMoq = require("typemoq");

const activator_1 = require("../../../../client/common/terminal/activator"); // tslint:disable-next-line:max-func-body-length


suite('Terminal Activator', () => {
  let activator;
  let baseActivator;
  let handler1;
  let handler2;
  setup(() => {
    baseActivator = TypeMoq.Mock.ofType();
    handler1 = TypeMoq.Mock.ofType();
    handler2 = TypeMoq.Mock.ofType();
    activator = new class extends activator_1.TerminalActivator {
      initialize() {
        this.baseActivator = baseActivator.object;
      }

    }(TypeMoq.Mock.ofType().object, [handler1.object, handler2.object]);
  });

  function testActivationAndHandlers(activationSuccessful) {
    return __awaiter(this, void 0, void 0, function* () {
      baseActivator.setup(b => b.activateEnvironmentInTerminal(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve(activationSuccessful)).verifiable(TypeMoq.Times.once());
      handler1.setup(h => h.handleActivation(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isValue(activationSuccessful))).returns(() => Promise.resolve()).verifiable(TypeMoq.Times.once());
      handler2.setup(h => h.handleActivation(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isValue(activationSuccessful))).returns(() => Promise.resolve()).verifiable(TypeMoq.Times.once());
      const terminal = TypeMoq.Mock.ofType();
      yield activator.activateEnvironmentInTerminal(terminal.object, undefined, activationSuccessful);
      baseActivator.verifyAll();
      handler1.verifyAll();
      handler2.verifyAll();
    });
  }

  test('Terminal is activated and handlers are invoked', () => testActivationAndHandlers(true));
  test('Terminal is not activated and handlers are invoked', () => testActivationAndHandlers(false));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiVHlwZU1vcSIsInJlcXVpcmUiLCJhY3RpdmF0b3JfMSIsInN1aXRlIiwiYWN0aXZhdG9yIiwiYmFzZUFjdGl2YXRvciIsImhhbmRsZXIxIiwiaGFuZGxlcjIiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJUZXJtaW5hbEFjdGl2YXRvciIsImluaXRpYWxpemUiLCJvYmplY3QiLCJ0ZXN0QWN0aXZhdGlvbkFuZEhhbmRsZXJzIiwiYWN0aXZhdGlvblN1Y2Nlc3NmdWwiLCJiIiwiYWN0aXZhdGVFbnZpcm9ubWVudEluVGVybWluYWwiLCJJdCIsImlzQW55IiwicmV0dXJucyIsInZlcmlmaWFibGUiLCJUaW1lcyIsIm9uY2UiLCJoIiwiaGFuZGxlQWN0aXZhdGlvbiIsImlzVmFsdWUiLCJ0ZXJtaW5hbCIsInVuZGVmaW5lZCIsInZlcmlmeUFsbCIsInRlc3QiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENB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QUNBVixNQUFBQSxhQUFhLENBQUN3QixTQUFkO0FBQ0F2QixNQUFBQSxRQUFRLENBQUN1QixTQUFUO0FBQ0F0QixNQUFBQSxRQUFRLENBQUNzQixTQUFUO0FBQ0gsS0FoQmUsQ0FBaEI7QUFpQkg7O0FBQ0RDLEVBQUFBLElBQUksQ0FBQyxnREFBRCxFQUFtRCxNQUFNaEIseUJBQXlCLENBQUMsSUFBRCxDQUFsRixDQUFKO0FBQ0FnQixFQUFBQSxJQUFJLENBQUMsb0RBQUQsRUFBdUQsTUFBTWhCLHlCQUF5QixDQUFDLEtBQUQsQ0FBdEYsQ0FBSjtBQUNILENBcENJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCBhY3RpdmF0b3JfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9jbGllbnQvY29tbW9uL3Rlcm1pbmFsL2FjdGl2YXRvclwiKTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbnN1aXRlKCdUZXJtaW5hbCBBY3RpdmF0b3InLCAoKSA9PiB7XHJcbiAgICBsZXQgYWN0aXZhdG9yO1xyXG4gICAgbGV0IGJhc2VBY3RpdmF0b3I7XHJcbiAgICBsZXQgaGFuZGxlcjE7XHJcbiAgICBsZXQgaGFuZGxlcjI7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgYmFzZUFjdGl2YXRvciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBoYW5kbGVyMSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBoYW5kbGVyMiA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBhY3RpdmF0b3IgPSBuZXcgY2xhc3MgZXh0ZW5kcyBhY3RpdmF0b3JfMS5UZXJtaW5hbEFjdGl2YXRvciB7XHJcbiAgICAgICAgICAgIGluaXRpYWxpemUoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJhc2VBY3RpdmF0b3IgPSBiYXNlQWN0aXZhdG9yLm9iamVjdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0oVHlwZU1vcS5Nb2NrLm9mVHlwZSgpLm9iamVjdCwgW2hhbmRsZXIxLm9iamVjdCwgaGFuZGxlcjIub2JqZWN0XSk7XHJcbiAgICB9KTtcclxuICAgIGZ1bmN0aW9uIHRlc3RBY3RpdmF0aW9uQW5kSGFuZGxlcnMoYWN0aXZhdGlvblN1Y2Nlc3NmdWwpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBiYXNlQWN0aXZhdG9yXHJcbiAgICAgICAgICAgICAgICAuc2V0dXAoYiA9PiBiLmFjdGl2YXRlRW52aXJvbm1lbnRJblRlcm1pbmFsKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKGFjdGl2YXRpb25TdWNjZXNzZnVsKSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgaGFuZGxlcjEuc2V0dXAoaCA9PiBoLmhhbmRsZUFjdGl2YXRpb24oVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKGFjdGl2YXRpb25TdWNjZXNzZnVsKSkpXHJcbiAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoKSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgaGFuZGxlcjIuc2V0dXAoaCA9PiBoLmhhbmRsZUFjdGl2YXRpb24oVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKGFjdGl2YXRpb25TdWNjZXNzZnVsKSkpXHJcbiAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoKSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgY29uc3QgdGVybWluYWwgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgIHlpZWxkIGFjdGl2YXRvci5hY3RpdmF0ZUVudmlyb25tZW50SW5UZXJtaW5hbCh0ZXJtaW5hbC5vYmplY3QsIHVuZGVmaW5lZCwgYWN0aXZhdGlvblN1Y2Nlc3NmdWwpO1xyXG4gICAgICAgICAgICBiYXNlQWN0aXZhdG9yLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICBoYW5kbGVyMS52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgaGFuZGxlcjIudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICB0ZXN0KCdUZXJtaW5hbCBpcyBhY3RpdmF0ZWQgYW5kIGhhbmRsZXJzIGFyZSBpbnZva2VkJywgKCkgPT4gdGVzdEFjdGl2YXRpb25BbmRIYW5kbGVycyh0cnVlKSk7XHJcbiAgICB0ZXN0KCdUZXJtaW5hbCBpcyBub3QgYWN0aXZhdGVkIGFuZCBoYW5kbGVycyBhcmUgaW52b2tlZCcsICgpID0+IHRlc3RBY3RpdmF0aW9uQW5kSGFuZGxlcnMoZmFsc2UpKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LnVuaXQudGVzdC5qcy5tYXAiXX0=