"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length

const chai_1 = require("chai");

const path = require("path");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../../client/common/platform/types");

const commandPrompt_1 = require("../../../client/common/terminal/environmentActivationProviders/commandPrompt");

const types_2 = require("../../../client/common/terminal/types");

const types_3 = require("../../../client/common/types");

const enum_1 = require("../../../client/common/utils/enum");

suite('Terminal Environment Activation (cmd/powershell)', () => {
  ['c:/programfiles/python/python', 'c:/program files/python/python', 'c:\\users\\windows paths\\conda\\python.exe'].forEach(pythonPath => {
    const hasSpaces = pythonPath.indexOf(' ') > 0;
    const resource = vscode_1.Uri.file('a');
    const suiteTitle = hasSpaces ? 'and there are spaces in the script file (pythonpath),' : 'and there are no spaces in the script file (pythonpath),';
    suite(suiteTitle, () => {
      ['activate', 'activate.sh', 'activate.csh', 'activate.fish', 'activate.bat', 'activate.ps1'].forEach(scriptFileName => {
        suite(`and script file is ${scriptFileName}`, () => {
          let serviceContainer;
          let fileSystem;
          setup(() => {
            serviceContainer = TypeMoq.Mock.ofType();
            fileSystem = TypeMoq.Mock.ofType();
            serviceContainer.setup(c => c.get(types_1.IFileSystem)).returns(() => fileSystem.object);
            const configService = TypeMoq.Mock.ofType();
            serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService))).returns(() => configService.object);
            const settings = TypeMoq.Mock.ofType();
            settings.setup(s => s.pythonPath).returns(() => pythonPath);
            configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
          });
          enum_1.getNamesAndValues(types_2.TerminalShellType).forEach(shellType => {
            const isScriptFileSupported = ['activate.bat', 'activate.ps1'].indexOf(scriptFileName) >= 0;
            const titleTitle = isScriptFileSupported ? `Ensure terminal type is supported (Shell: ${shellType.name})` : `Ensure terminal type is not supported (Shell: ${shellType.name})`;
            test(titleTitle, () => __awaiter(void 0, void 0, void 0, function* () {
              const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
              const supported = bash.isShellSupported(shellType.value);

              switch (shellType.value) {
                case types_2.TerminalShellType.commandPrompt:
                case types_2.TerminalShellType.powershellCore:
                case types_2.TerminalShellType.powershell:
                  {
                    chai_1.expect(supported).to.be.equal(true, `${shellType.name} shell not supported (it should be)`);
                    break;
                  }

                default:
                  {
                    chai_1.expect(supported).to.be.equal(false, `${shellType.name} incorrectly supported (should not be)`);
                  }
              }
            }));
          });
        });
      });
      suite('and script file is activate.bat', () => {
        let serviceContainer;
        let fileSystem;
        let platform;
        setup(() => {
          serviceContainer = TypeMoq.Mock.ofType();
          fileSystem = TypeMoq.Mock.ofType();
          platform = TypeMoq.Mock.ofType();
          serviceContainer.setup(c => c.get(types_1.IFileSystem)).returns(() => fileSystem.object);
          serviceContainer.setup(c => c.get(types_1.IPlatformService)).returns(() => platform.object);
          const configService = TypeMoq.Mock.ofType();
          serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService))).returns(() => configService.object);
          const settings = TypeMoq.Mock.ofType();
          settings.setup(s => s.pythonPath).returns(() => pythonPath);
          configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
        });
        test('Ensure batch files are supported by command prompt', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.bat');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const commands = yield bash.getActivationCommands(resource, types_2.TerminalShellType.commandPrompt); // Ensure the script file is of the following form:
          // source "<path to script file>" <environment name>
          // Ensure the path is quoted if it contains any spaces.
          // Ensure it contains the name of the environment as an argument to the script file.

          chai_1.expect(commands).to.be.deep.equal([pathToScriptFile.fileToCommandArgument()], 'Invalid command');
        }));
        test('Ensure batch files are not supported by powershell (on windows)', () => __awaiter(void 0, void 0, void 0, function* () {
          const batch = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => true);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.bat');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield batch.getActivationCommands(resource, types_2.TerminalShellType.powershell);
          chai_1.expect(command).to.be.equal(undefined, 'Invalid');
        }));
        test('Ensure batch files are not supported by powershell core (on windows)', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => true);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.bat');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield bash.getActivationCommands(resource, types_2.TerminalShellType.powershellCore);
          chai_1.expect(command).to.be.equal(undefined, 'Invalid');
        }));
        test('Ensure batch files are not supported by powershell (on non-windows)', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => false);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.bat');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield bash.getActivationCommands(resource, types_2.TerminalShellType.powershell);
          chai_1.expect(command).to.be.equal(undefined, 'Invalid command');
        }));
        test('Ensure batch files are not supported by powershell core (on non-windows)', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => false);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.bat');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield bash.getActivationCommands(resource, types_2.TerminalShellType.powershellCore);
          chai_1.expect(command).to.be.equal(undefined, 'Invalid command');
        }));
      });
      suite('and script file is activate.ps1', () => {
        let serviceContainer;
        let fileSystem;
        let platform;
        setup(() => {
          serviceContainer = TypeMoq.Mock.ofType();
          fileSystem = TypeMoq.Mock.ofType();
          platform = TypeMoq.Mock.ofType();
          serviceContainer.setup(c => c.get(types_1.IFileSystem)).returns(() => fileSystem.object);
          serviceContainer.setup(c => c.get(types_1.IPlatformService)).returns(() => platform.object);
          const configService = TypeMoq.Mock.ofType();
          serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService))).returns(() => configService.object);
          const settings = TypeMoq.Mock.ofType();
          settings.setup(s => s.pythonPath).returns(() => pythonPath);
          configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
        });
        test('Ensure powershell files are not supported by command prompt', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => true);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.ps1');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield bash.getActivationCommands(resource, types_2.TerminalShellType.commandPrompt);
          chai_1.expect(command).to.be.deep.equal([], 'Invalid command (running powershell files are not supported on command prompt)');
        }));
        test('Ensure powershell files are supported by powershell', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => true);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.ps1');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield bash.getActivationCommands(resource, types_2.TerminalShellType.powershell);
          chai_1.expect(command).to.be.deep.equal([`& ${pathToScriptFile.fileToCommandArgument()}`.trim()], 'Invalid command');
        }));
        test('Ensure powershell files are supported by powershell core', () => __awaiter(void 0, void 0, void 0, function* () {
          const bash = new commandPrompt_1.CommandPromptAndPowerShell(serviceContainer.object);
          platform.setup(p => p.isWindows).returns(() => true);
          const pathToScriptFile = path.join(path.dirname(pythonPath), 'activate.ps1');
          fileSystem.setup(fs => fs.fileExists(TypeMoq.It.isValue(pathToScriptFile))).returns(() => Promise.resolve(true));
          const command = yield bash.getActivationCommands(resource, types_2.TerminalShellType.powershellCore);
          chai_1.expect(command).to.be.deep.equal([`& ${pathToScriptFile.fileToCommandArgument()}`.trim()], 'Invalid command');
        }));
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2YXRpb24uY29tbWFuZFByb21wdC51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJwYXRoIiwiVHlwZU1vcSIsInZzY29kZV8xIiwidHlwZXNfMSIsImNvbW1hbmRQcm9tcHRfMSIsInR5cGVzXzIiLCJ0eXBlc18zIiwiZW51bV8xIiwic3VpdGUiLCJmb3JFYWNoIiwicHl0aG9uUGF0aCIsImhhc1NwYWNlcyIsImluZGV4T2YiLCJyZXNvdXJjZSIsIlVyaSIsImZpbGUiLCJzdWl0ZVRpdGxlIiwic2NyaXB0RmlsZU5hbWUiLCJzZXJ2aWNlQ29udGFpbmVyIiwiZmlsZVN5c3RlbSIsInNldHVwIiwiTW9jayIsIm9mVHlwZSIsImMiLCJnZXQiLCJJRmlsZVN5c3RlbSIsInJldHVybnMiLCJvYmplY3QiLCJjb25maWdTZXJ2aWNlIiwiSXQiLCJpc1ZhbHVlIiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwic2V0dGluZ3MiLCJzIiwiZ2V0U2V0dGluZ3MiLCJpc0FueSIsImdldE5hbWVzQW5kVmFsdWVzIiwiVGVybWluYWxTaGVsbFR5cGUiLCJzaGVsbFR5cGUiLCJpc1NjcmlwdEZpbGVTdXBwb3J0ZWQiLCJ0aXRsZVRpdGxlIiwibmFtZSIsInRlc3QiLCJiYXNoIiwiQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwiLCJzdXBwb3J0ZWQiLCJpc1NoZWxsU3VwcG9ydGVkIiwiY29tbWFuZFByb21wdCIsInBvd2Vyc2hlbGxDb3JlIiwicG93ZXJzaGVsbCIsImV4cGVjdCIsInRvIiwiYmUiLCJlcXVhbCIsInBsYXRmb3JtIiwiSVBsYXRmb3JtU2VydmljZSIsInBhdGhUb1NjcmlwdEZpbGUiLCJqb2luIiwiZGlybmFtZSIsImZzIiwiZmlsZUV4aXN0cyIsImNvbW1hbmRzIiwiZ2V0QWN0aXZhdGlvbkNvbW1hbmRzIiwiZGVlcCIsImZpbGVUb0NvbW1hbmRBcmd1bWVudCIsImJhdGNoIiwicCIsImlzV2luZG93cyIsImNvbW1hbmQiLCJ1bmRlZmluZWQiLCJ0cmltIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FB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LENBQTBCVyxjQUEvRCxDQUF0QjtBQUNBbEQsVUFBQUEsTUFBTSxDQUFDb0QsTUFBUCxDQUFja0IsT0FBZCxFQUF1QmpCLEVBQXZCLENBQTBCQyxFQUExQixDQUE2QlcsSUFBN0IsQ0FBa0NWLEtBQWxDLENBQXdDLENBQUUsS0FBSUcsZ0JBQWdCLENBQUNRLHFCQUFqQixFQUF5QyxFQUE5QyxDQUFnRE0sSUFBaEQsRUFBRCxDQUF4QyxFQUFrRyxpQkFBbEc7QUFDSCxTQVArRSxDQUE1RSxDQUFKO0FBUUgsT0F4Q0ksQ0FBTDtBQXlDSCxLQTFJSSxDQUFMO0FBMklILEdBaEpEO0FBaUpILENBbEpJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL3R5cGVzXCIpO1xyXG5jb25zdCBjb21tYW5kUHJvbXB0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90ZXJtaW5hbC9lbnZpcm9ubWVudEFjdGl2YXRpb25Qcm92aWRlcnMvY29tbWFuZFByb21wdFwiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3Rlcm1pbmFsL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGVudW1fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL2VudW1cIik7XHJcbnN1aXRlKCdUZXJtaW5hbCBFbnZpcm9ubWVudCBBY3RpdmF0aW9uIChjbWQvcG93ZXJzaGVsbCknLCAoKSA9PiB7XHJcbiAgICBbJ2M6L3Byb2dyYW1maWxlcy9weXRob24vcHl0aG9uJywgJ2M6L3Byb2dyYW0gZmlsZXMvcHl0aG9uL3B5dGhvbicsXHJcbiAgICAgICAgJ2M6XFxcXHVzZXJzXFxcXHdpbmRvd3MgcGF0aHNcXFxcY29uZGFcXFxccHl0aG9uLmV4ZSddLmZvckVhY2gocHl0aG9uUGF0aCA9PiB7XHJcbiAgICAgICAgY29uc3QgaGFzU3BhY2VzID0gcHl0aG9uUGF0aC5pbmRleE9mKCcgJykgPiAwO1xyXG4gICAgICAgIGNvbnN0IHJlc291cmNlID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2EnKTtcclxuICAgICAgICBjb25zdCBzdWl0ZVRpdGxlID0gaGFzU3BhY2VzID8gJ2FuZCB0aGVyZSBhcmUgc3BhY2VzIGluIHRoZSBzY3JpcHQgZmlsZSAocHl0aG9ucGF0aCksJyA6ICdhbmQgdGhlcmUgYXJlIG5vIHNwYWNlcyBpbiB0aGUgc2NyaXB0IGZpbGUgKHB5dGhvbnBhdGgpLCc7XHJcbiAgICAgICAgc3VpdGUoc3VpdGVUaXRsZSwgKCkgPT4ge1xyXG4gICAgICAgICAgICBbJ2FjdGl2YXRlJywgJ2FjdGl2YXRlLnNoJywgJ2FjdGl2YXRlLmNzaCcsICdhY3RpdmF0ZS5maXNoJywgJ2FjdGl2YXRlLmJhdCcsICdhY3RpdmF0ZS5wczEnXS5mb3JFYWNoKHNjcmlwdEZpbGVOYW1lID0+IHtcclxuICAgICAgICAgICAgICAgIHN1aXRlKGBhbmQgc2NyaXB0IGZpbGUgaXMgJHtzY3JpcHRGaWxlTmFtZX1gLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVTeXN0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZXNfMS5JRmlsZVN5c3RlbSkpLnJldHVybnMoKCkgPT4gZmlsZVN5c3RlbS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb25maWdTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Muc2V0dXAocyA9PiBzLnB5dGhvblBhdGgpLnJldHVybnMoKCkgPT4gcHl0aG9uUGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ1NlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gc2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBlbnVtXzEuZ2V0TmFtZXNBbmRWYWx1ZXModHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZSkuZm9yRWFjaChzaGVsbFR5cGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1NjcmlwdEZpbGVTdXBwb3J0ZWQgPSBbJ2FjdGl2YXRlLmJhdCcsICdhY3RpdmF0ZS5wczEnXS5pbmRleE9mKHNjcmlwdEZpbGVOYW1lKSA+PSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aXRsZVRpdGxlID0gaXNTY3JpcHRGaWxlU3VwcG9ydGVkID8gYEVuc3VyZSB0ZXJtaW5hbCB0eXBlIGlzIHN1cHBvcnRlZCAoU2hlbGw6ICR7c2hlbGxUeXBlLm5hbWV9KWAgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYEVuc3VyZSB0ZXJtaW5hbCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQgKFNoZWxsOiAke3NoZWxsVHlwZS5uYW1lfSlgO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXN0KHRpdGxlVGl0bGUsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2ggPSBuZXcgY29tbWFuZFByb21wdF8xLkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1cHBvcnRlZCA9IGJhc2guaXNTaGVsbFN1cHBvcnRlZChzaGVsbFR5cGUudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChzaGVsbFR5cGUudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUuY29tbWFuZFByb21wdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbENvcmU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChzdXBwb3J0ZWQpLnRvLmJlLmVxdWFsKHRydWUsIGAke3NoZWxsVHlwZS5uYW1lfSBzaGVsbCBub3Qgc3VwcG9ydGVkIChpdCBzaG91bGQgYmUpYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3Qoc3VwcG9ydGVkKS50by5iZS5lcXVhbChmYWxzZSwgYCR7c2hlbGxUeXBlLm5hbWV9IGluY29ycmVjdGx5IHN1cHBvcnRlZCAoc2hvdWxkIG5vdCBiZSlgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc3VpdGUoJ2FuZCBzY3JpcHQgZmlsZSBpcyBhY3RpdmF0ZS5iYXQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgICAgICAgICAgICAgIGxldCBmaWxlU3lzdGVtO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBsYXRmb3JtO1xyXG4gICAgICAgICAgICAgICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZXNfMS5JRmlsZVN5c3RlbSkpLnJldHVybnMoKCkgPT4gZmlsZVN5c3RlbS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc18xLklQbGF0Zm9ybVNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IHBsYXRmb3JtLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnNldHVwKHMgPT4gcy5weXRob25QYXRoKS5yZXR1cm5zKCgpID0+IHB5dGhvblBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ1NlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gc2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnRW5zdXJlIGJhdGNoIGZpbGVzIGFyZSBzdXBwb3J0ZWQgYnkgY29tbWFuZCBwcm9tcHQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzaCA9IG5ldyBjb21tYW5kUHJvbXB0XzEuQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhUb1NjcmlwdEZpbGUgPSBwYXRoLmpvaW4ocGF0aC5kaXJuYW1lKHB5dGhvblBhdGgpLCAnYWN0aXZhdGUuYmF0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS5zZXR1cChmcyA9PiBmcy5maWxlRXhpc3RzKFR5cGVNb3EuSXQuaXNWYWx1ZShwYXRoVG9TY3JpcHRGaWxlKSkpLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kcyA9IHlpZWxkIGJhc2guZ2V0QWN0aXZhdGlvbkNvbW1hbmRzKHJlc291cmNlLCB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmNvbW1hbmRQcm9tcHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUgc2NyaXB0IGZpbGUgaXMgb2YgdGhlIGZvbGxvd2luZyBmb3JtOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNvdXJjZSBcIjxwYXRoIHRvIHNjcmlwdCBmaWxlPlwiIDxlbnZpcm9ubWVudCBuYW1lPlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUgcGF0aCBpcyBxdW90ZWQgaWYgaXQgY29udGFpbnMgYW55IHNwYWNlcy5cclxuICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgaXQgY29udGFpbnMgdGhlIG5hbWUgb2YgdGhlIGVudmlyb25tZW50IGFzIGFuIGFyZ3VtZW50IHRvIHRoZSBzY3JpcHQgZmlsZS5cclxuICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmRzKS50by5iZS5kZWVwLmVxdWFsKFtwYXRoVG9TY3JpcHRGaWxlLmZpbGVUb0NvbW1hbmRBcmd1bWVudCgpXSwgJ0ludmFsaWQgY29tbWFuZCcpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnRW5zdXJlIGJhdGNoIGZpbGVzIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IHBvd2Vyc2hlbGwgKG9uIHdpbmRvd3MpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gbmV3IGNvbW1hbmRQcm9tcHRfMS5Db21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbChzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm0uc2V0dXAocCA9PiBwLmlzV2luZG93cykucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoVG9TY3JpcHRGaWxlID0gcGF0aC5qb2luKHBhdGguZGlybmFtZShweXRob25QYXRoKSwgJ2FjdGl2YXRlLmJhdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0uc2V0dXAoZnMgPT4gZnMuZmlsZUV4aXN0cyhUeXBlTW9xLkl0LmlzVmFsdWUocGF0aFRvU2NyaXB0RmlsZSkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IHlpZWxkIGJhdGNoLmdldEFjdGl2YXRpb25Db21tYW5kcyhyZXNvdXJjZSwgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmQpLnRvLmJlLmVxdWFsKHVuZGVmaW5lZCwgJ0ludmFsaWQnKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIHRlc3QoJ0Vuc3VyZSBiYXRjaCBmaWxlcyBhcmUgbm90IHN1cHBvcnRlZCBieSBwb3dlcnNoZWxsIGNvcmUgKG9uIHdpbmRvd3MpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2ggPSBuZXcgY29tbWFuZFByb21wdF8xLkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybS5zZXR1cChwID0+IHAuaXNXaW5kb3dzKS5yZXR1cm5zKCgpID0+IHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhUb1NjcmlwdEZpbGUgPSBwYXRoLmpvaW4ocGF0aC5kaXJuYW1lKHB5dGhvblBhdGgpLCAnYWN0aXZhdGUuYmF0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbS5zZXR1cChmcyA9PiBmcy5maWxlRXhpc3RzKFR5cGVNb3EuSXQuaXNWYWx1ZShwYXRoVG9TY3JpcHRGaWxlKSkpLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kID0geWllbGQgYmFzaC5nZXRBY3RpdmF0aW9uQ29tbWFuZHMocmVzb3VyY2UsIHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbENvcmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoY29tbWFuZCkudG8uYmUuZXF1YWwodW5kZWZpbmVkLCAnSW52YWxpZCcpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnRW5zdXJlIGJhdGNoIGZpbGVzIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IHBvd2Vyc2hlbGwgKG9uIG5vbi13aW5kb3dzKScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNoID0gbmV3IGNvbW1hbmRQcm9tcHRfMS5Db21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbChzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm0uc2V0dXAocCA9PiBwLmlzV2luZG93cykucmV0dXJucygoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aFRvU2NyaXB0RmlsZSA9IHBhdGguam9pbihwYXRoLmRpcm5hbWUocHl0aG9uUGF0aCksICdhY3RpdmF0ZS5iYXQnKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnNldHVwKGZzID0+IGZzLmZpbGVFeGlzdHMoVHlwZU1vcS5JdC5pc1ZhbHVlKHBhdGhUb1NjcmlwdEZpbGUpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSB5aWVsZCBiYXNoLmdldEFjdGl2YXRpb25Db21tYW5kcyhyZXNvdXJjZSwgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmQpLnRvLmJlLmVxdWFsKHVuZGVmaW5lZCwgJ0ludmFsaWQgY29tbWFuZCcpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnRW5zdXJlIGJhdGNoIGZpbGVzIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IHBvd2Vyc2hlbGwgY29yZSAob24gbm9uLXdpbmRvd3MpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2ggPSBuZXcgY29tbWFuZFByb21wdF8xLkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybS5zZXR1cChwID0+IHAuaXNXaW5kb3dzKS5yZXR1cm5zKCgpID0+IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoVG9TY3JpcHRGaWxlID0gcGF0aC5qb2luKHBhdGguZGlybmFtZShweXRob25QYXRoKSwgJ2FjdGl2YXRlLmJhdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0uc2V0dXAoZnMgPT4gZnMuZmlsZUV4aXN0cyhUeXBlTW9xLkl0LmlzVmFsdWUocGF0aFRvU2NyaXB0RmlsZSkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IHlpZWxkIGJhc2guZ2V0QWN0aXZhdGlvbkNvbW1hbmRzKHJlc291cmNlLCB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGxDb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmQpLnRvLmJlLmVxdWFsKHVuZGVmaW5lZCwgJ0ludmFsaWQgY29tbWFuZCcpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc3VpdGUoJ2FuZCBzY3JpcHQgZmlsZSBpcyBhY3RpdmF0ZS5wczEnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgICAgICAgICAgICAgIGxldCBmaWxlU3lzdGVtO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBsYXRmb3JtO1xyXG4gICAgICAgICAgICAgICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZVN5c3RlbSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZXNfMS5JRmlsZVN5c3RlbSkpLnJldHVybnMoKCkgPT4gZmlsZVN5c3RlbS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlc18xLklQbGF0Zm9ybVNlcnZpY2UpKS5yZXR1cm5zKCgpID0+IHBsYXRmb3JtLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnNldHVwKHMgPT4gcy5weXRob25QYXRoKS5yZXR1cm5zKCgpID0+IHB5dGhvblBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ1NlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gc2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnRW5zdXJlIHBvd2Vyc2hlbGwgZmlsZXMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgY29tbWFuZCBwcm9tcHQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzaCA9IG5ldyBjb21tYW5kUHJvbXB0XzEuQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtLnNldHVwKHAgPT4gcC5pc1dpbmRvd3MpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aFRvU2NyaXB0RmlsZSA9IHBhdGguam9pbihwYXRoLmRpcm5hbWUocHl0aG9uUGF0aCksICdhY3RpdmF0ZS5wczEnKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnNldHVwKGZzID0+IGZzLmZpbGVFeGlzdHMoVHlwZU1vcS5JdC5pc1ZhbHVlKHBhdGhUb1NjcmlwdEZpbGUpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSB5aWVsZCBiYXNoLmdldEFjdGl2YXRpb25Db21tYW5kcyhyZXNvdXJjZSwgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5jb21tYW5kUHJvbXB0KTtcclxuICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGNvbW1hbmQpLnRvLmJlLmRlZXAuZXF1YWwoW10sICdJbnZhbGlkIGNvbW1hbmQgKHJ1bm5pbmcgcG93ZXJzaGVsbCBmaWxlcyBhcmUgbm90IHN1cHBvcnRlZCBvbiBjb21tYW5kIHByb21wdCknKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIHRlc3QoJ0Vuc3VyZSBwb3dlcnNoZWxsIGZpbGVzIGFyZSBzdXBwb3J0ZWQgYnkgcG93ZXJzaGVsbCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXNoID0gbmV3IGNvbW1hbmRQcm9tcHRfMS5Db21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbChzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm0uc2V0dXAocCA9PiBwLmlzV2luZG93cykucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoVG9TY3JpcHRGaWxlID0gcGF0aC5qb2luKHBhdGguZGlybmFtZShweXRob25QYXRoKSwgJ2FjdGl2YXRlLnBzMScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVTeXN0ZW0uc2V0dXAoZnMgPT4gZnMuZmlsZUV4aXN0cyhUeXBlTW9xLkl0LmlzVmFsdWUocGF0aFRvU2NyaXB0RmlsZSkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IHlpZWxkIGJhc2guZ2V0QWN0aXZhdGlvbkNvbW1hbmRzKHJlc291cmNlLCB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoY29tbWFuZCkudG8uYmUuZGVlcC5lcXVhbChbYCYgJHtwYXRoVG9TY3JpcHRGaWxlLmZpbGVUb0NvbW1hbmRBcmd1bWVudCgpfWAudHJpbSgpXSwgJ0ludmFsaWQgY29tbWFuZCcpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnRW5zdXJlIHBvd2Vyc2hlbGwgZmlsZXMgYXJlIHN1cHBvcnRlZCBieSBwb3dlcnNoZWxsIGNvcmUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzaCA9IG5ldyBjb21tYW5kUHJvbXB0XzEuQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtLnNldHVwKHAgPT4gcC5pc1dpbmRvd3MpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aFRvU2NyaXB0RmlsZSA9IHBhdGguam9pbihwYXRoLmRpcm5hbWUocHl0aG9uUGF0aCksICdhY3RpdmF0ZS5wczEnKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlU3lzdGVtLnNldHVwKGZzID0+IGZzLmZpbGVFeGlzdHMoVHlwZU1vcS5JdC5pc1ZhbHVlKHBhdGhUb1NjcmlwdEZpbGUpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSB5aWVsZCBiYXNoLmdldEFjdGl2YXRpb25Db21tYW5kcyhyZXNvdXJjZSwgdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsQ29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChjb21tYW5kKS50by5iZS5kZWVwLmVxdWFsKFtgJiAke3BhdGhUb1NjcmlwdEZpbGUuZmlsZVRvQ29tbWFuZEFyZ3VtZW50KCl9YC50cmltKCldLCAnSW52YWxpZCBjb21tYW5kJyk7XHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hY3RpdmF0aW9uLmNvbW1hbmRQcm9tcHQudW5pdC50ZXN0LmpzLm1hcCJdfQ==