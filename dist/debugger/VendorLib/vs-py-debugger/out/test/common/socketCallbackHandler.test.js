"use strict"; // tslint:disable:no-any max-classes-per-file max-func-body-length no-stateless-class no-require-imports no-var-requires no-empty

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const getFreePort = require("get-port");

const net = require("net");

const socketCallbackHandler_1 = require("../../client/common/net/socket/socketCallbackHandler");

const socketServer_1 = require("../../client/common/net/socket/socketServer");

const SocketStream_1 = require("../../client/common/net/socket/SocketStream");

const async_1 = require("../../client/common/utils/async");

const uint64be = require('uint64be'); // tslint:disable-next-line:no-unnecessary-class


class Commands {}

Commands.ExitCommandBytes = new Buffer('exit');
Commands.PingBytes = new Buffer('ping');
var ResponseCommands;

(function (ResponseCommands) {
  ResponseCommands.Pong = 'PONG';
  ResponseCommands.ListKernels = 'LSTK';
  ResponseCommands.Error = 'EROR';
})(ResponseCommands || (ResponseCommands = {}));

const GUID = 'This is the Guid';
const PID = 1234;

class MockSocketCallbackHandler extends socketCallbackHandler_1.SocketCallbackHandler {
  constructor(socketServer) {
    super(socketServer);
    this.registerCommandHandler(ResponseCommands.Pong, this.onPong.bind(this));
    this.registerCommandHandler(ResponseCommands.Error, this.onError.bind(this));
  }

  ping(message) {
    this.SendRawCommand(Commands.PingBytes);
    const stringBuffer = new Buffer(message);
    const buffer = Buffer.concat([Buffer.concat([new Buffer('U'), uint64be.encode(stringBuffer.byteLength)]), stringBuffer]);
    this.stream.Write(buffer);
  }

  handleHandshake() {
    if (!this.guid) {
      this.guid = this.stream.readStringInTransaction();

      if (typeof this.guid !== 'string') {
        return false;
      }
    }

    if (!this.pid) {
      this.pid = this.stream.readInt32InTransaction();

      if (typeof this.pid !== 'number') {
        return false;
      }
    }

    if (this.guid !== GUID) {
      this.emit('error', this.guid, GUID, 'Guids not the same');
      return true;
    }

    if (this.pid !== PID) {
      this.emit('error', this.pid, PID, 'pids not the same');
      return true;
    }

    this.emit('handshake');
    return true;
  }

  onError() {
    const message = this.stream.readStringInTransaction();

    if (typeof message !== 'string') {
      return;
    }

    this.emit('error', '', '', message);
  }

  onPong() {
    const message = this.stream.readStringInTransaction();

    if (typeof message !== 'string') {
      return;
    }

    this.emit('pong', message);
  }

}

class MockSocketClient {
  constructor(port) {
    this.port = port;
  }

  get SocketStream() {
    if (this.socketStream === undefined) {
      throw Error('not listening');
    }

    return this.socketStream;
  }

  start() {
    this.def = async_1.createDeferred();
    this.socket = net.connect(this.port, this.connectionListener.bind(this));
    return this.def.promise;
  }

  connectionListener() {
    if (this.socket === undefined || this.def === undefined) {
      throw Error('not started');
    }

    this.socketStream = new SocketStream_1.SocketStream(this.socket, new Buffer(''));
    this.def.resolve();
    this.socket.on('error', () => {});
    this.socket.on('data', data => {
      try {
        this.SocketStream.Append(data); // We can only receive ping messages

        this.SocketStream.BeginTransaction();
        const cmdIdBytes = [];

        for (let counter = 0; counter < 4; counter += 1) {
          const _byte = this.SocketStream.ReadByte();

          if (typeof _byte !== 'number') {
            this.SocketStream.RollBackTransaction();
            return;
          }

          cmdIdBytes.push(_byte);
        }

        const cmdId = new Buffer(cmdIdBytes).toString();
        const message = this.SocketStream.ReadString();

        if (typeof message !== 'string') {
          this.SocketStream.RollBackTransaction();
          return;
        }

        this.SocketStream.EndTransaction();

        if (cmdId !== 'ping') {
          this.SocketStream.Write(new Buffer(ResponseCommands.Error));
          const errorMessage = `Received unknown command '${cmdId}'`;
          const errorBuffer = Buffer.concat([Buffer.concat([new Buffer('A'), uint64be.encode(errorMessage.length)]), new Buffer(errorMessage)]);
          this.SocketStream.Write(errorBuffer);
          return;
        }

        this.SocketStream.Write(new Buffer(ResponseCommands.Pong));
        const messageBuffer = new Buffer(message);
        const pongBuffer = Buffer.concat([Buffer.concat([new Buffer('U'), uint64be.encode(messageBuffer.byteLength)]), messageBuffer]);
        this.SocketStream.Write(pongBuffer);
      } catch (ex) {
        this.SocketStream.Write(new Buffer(ResponseCommands.Error));
        const errorMessage = `Fatal error in handling data at socket client. Error: ${ex.message}`;
        const errorBuffer = Buffer.concat([Buffer.concat([new Buffer('A'), uint64be.encode(errorMessage.length)]), new Buffer(errorMessage)]);
        this.SocketStream.Write(errorBuffer);
      }
    });
  }

} // Defines a Mocha test suite to group tests of similar kind together


suite('SocketCallbackHandler', () => {
  let socketServer;
  setup(() => socketServer = new socketServer_1.SocketServer());
  teardown(() => socketServer.Stop());
  test('Succesfully starts without any specific host or port', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start();
    chai_1.expect(port).to.be.greaterThan(0);
  }));
  test('Succesfully starts with port=0 and no host', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start({
      port: 0
    });
    chai_1.expect(port).to.be.greaterThan(0);
  }));
  test('Succesfully starts with port=0 and host=localhost', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start({
      port: 0,
      host: 'localhost'
    });
    chai_1.expect(port).to.be.greaterThan(0);
  }));
  test('Succesfully starts with host=127.0.0.1', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start({
      host: '127.0.0.1'
    });
    chai_1.expect(port).to.be.greaterThan(0);
  }));
  test('Succesfully starts with port=0 and host=127.0.0.1', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start({
      port: 0,
      host: '127.0.0.1'
    });
    chai_1.expect(port).to.be.greaterThan(0);
  }));
  test('Succesfully starts with specific port', () => __awaiter(void 0, void 0, void 0, function* () {
    const availablePort = yield getFreePort({
      host: 'localhost'
    });
    const port = yield socketServer.Start({
      port: availablePort,
      host: 'localhost'
    });
    chai_1.expect(port).to.be.equal(availablePort);
  }));
  test('Succesful Handshake', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start();
    const callbackHandler = new MockSocketCallbackHandler(socketServer);
    const socketClient = new MockSocketClient(port);
    yield socketClient.start();
    const def = async_1.createDeferred();
    callbackHandler.on('handshake', () => {
      def.resolve();
    });
    callbackHandler.on('error', (actual, expected, message) => {
      if (!def.completed) {
        def.reject({
          actual: actual,
          expected: expected,
          message: message
        });
      }
    }); // Client has connected, now send information to the callback handler via sockets

    const guidBuffer = Buffer.concat([new Buffer('A'), uint64be.encode(GUID.length), new Buffer(GUID)]);
    socketClient.SocketStream.Write(guidBuffer);
    socketClient.SocketStream.WriteInt32(PID);
    yield def.promise;
  }));
  test('Unsuccesful Handshake', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start();
    const callbackHandler = new MockSocketCallbackHandler(socketServer);
    const socketClient = new MockSocketClient(port);
    yield socketClient.start();
    const def = async_1.createDeferred();
    let timeOut = setTimeout(() => {
      def.reject('Handshake not completed in allocated time');
    }, 5000);
    callbackHandler.on('handshake', () => {
      if (timeOut) {
        clearTimeout(timeOut);
        timeOut = undefined;
      }

      def.reject('handshake should fail, but it succeeded!');
    });
    callbackHandler.on('error', (actual, expected, message) => {
      if (timeOut) {
        clearTimeout(timeOut);
        timeOut = undefined;
      }

      if (actual === 0 && message === 'pids not the same') {
        def.resolve();
      } else {
        def.reject({
          actual: actual,
          expected: expected,
          message: message
        });
      }
    }); // Client has connected, now send information to the callback handler via sockets

    const guidBuffer = Buffer.concat([new Buffer('A'), uint64be.encode(GUID.length), new Buffer(GUID)]);
    socketClient.SocketStream.Write(guidBuffer); // Send the wrong pid

    socketClient.SocketStream.WriteInt32(0);
    yield def.promise;
  }));
  test('Ping with message', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start();
    const callbackHandler = new MockSocketCallbackHandler(socketServer);
    const socketClient = new MockSocketClient(port);
    yield socketClient.start();
    const def = async_1.createDeferred();
    const PING_MESSAGE = 'This is the Ping Message - Функция проверки ИНН и КПП - 说明';
    callbackHandler.on('handshake', () => {
      // Send a custom message (only after handshake has been done)
      callbackHandler.ping(PING_MESSAGE);
    });
    callbackHandler.on('pong', message => {
      try {
        chai_1.expect(message).to.be.equal(PING_MESSAGE);
        def.resolve();
      } catch (ex) {
        def.reject(ex);
      }
    });
    callbackHandler.on('error', (actual, expected, message) => {
      if (!def.completed) {
        def.reject({
          actual: actual,
          expected: expected,
          message: message
        });
      }
    }); // Client has connected, now send information to the callback handler via sockets

    const guidBuffer = Buffer.concat([new Buffer('A'), uint64be.encode(GUID.length), new Buffer(GUID)]);
    socketClient.SocketStream.Write(guidBuffer); // Send the wrong pid

    socketClient.SocketStream.WriteInt32(PID);
    yield def.promise;
  }));
  test('Succesful Handshake with port=0 and host=localhost', () => __awaiter(void 0, void 0, void 0, function* () {
    const port = yield socketServer.Start({
      port: 0,
      host: 'localhost'
    });
    const callbackHandler = new MockSocketCallbackHandler(socketServer);
    const socketClient = new MockSocketClient(port);
    yield socketClient.start();
    const def = async_1.createDeferred();
    callbackHandler.on('handshake', () => def.resolve());
    callbackHandler.on('error', (actual, expected, message) => {
      if (!def.completed) {
        def.reject({
          actual: actual,
          expected: expected,
          message: message
        });
      }
    }); // Client has connected, now send information to the callback handler via sockets

    const guidBuffer = Buffer.concat([new Buffer('A'), uint64be.encode(GUID.length), new Buffer(GUID)]);
    socketClient.SocketStream.Write(guidBuffer);
    socketClient.SocketStream.WriteInt32(PID);
    yield def.promise;
  }));
  test('Succesful Handshake with specific port', () => __awaiter(void 0, void 0, void 0, function* () {
    const availablePort = yield new Promise((resolve, reject) => getFreePort({
      host: 'localhost'
    }).then(resolve, reject));
    const port = yield socketServer.Start({
      port: availablePort,
      host: 'localhost'
    });
    chai_1.expect(port).to.be.equal(availablePort, 'Server is not listening on the provided port number');
    const callbackHandler = new MockSocketCallbackHandler(socketServer);
    const socketClient = new MockSocketClient(port);
    yield socketClient.start();
    const def = async_1.createDeferred();
    callbackHandler.on('handshake', () => def.resolve());
    callbackHandler.on('error', (actual, expected, message) => {
      if (!def.completed) {
        def.reject({
          actual: actual,
          expected: expected,
          message: message
        });
      }
    }); // Client has connected, now send information to the callback handler via sockets

    const guidBuffer = Buffer.concat([new Buffer('A'), uint64be.encode(GUID.length), new Buffer(GUID)]);
    socketClient.SocketStream.Write(guidBuffer);
    socketClient.SocketStream.WriteInt32(PID);
    yield def.promise;
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvY2tldENhbGxiYWNrSGFuZGxlci50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwiZ2V0RnJlZVBvcnQiLCJuZXQiLCJzb2NrZXRDYWxsYmFja0hhbmRsZXJfMSIsInNvY2tldFNlcnZlcl8xIiwiU29ja2V0U3RyZWFtXzEiLCJhc3luY18xIiwidWludDY0YmUiLCJDb21tYW5kcyIsIkV4aXRDb21tYW5kQnl0ZXMiLCJCdWZmZXIiLCJQaW5nQnl0ZXMiLCJSZXNwb25zZUNvbW1hbmRzIiwiUG9uZyIsIkxpc3RLZXJuZWxzIiwiRXJyb3IiLCJHVUlEIiwiUElEIiwiTW9ja1NvY2tldENhbGxiYWNrSGFuZGxlciIsIlNvY2tldENhbGxiYWNrSGFuZGxlciIsImNvbnN0cnVjdG9yIiwic29ja2V0U2VydmVyIiwicmVnaXN0ZXJDb21tYW5kSGFuZGxlciIsIm9uUG9uZyIsImJpbmQiLCJvbkVycm9yIiwicGluZyIsIm1lc3NhZ2UiLCJTZW5kUmF3Q29tbWFuZCIsInN0cmluZ0J1ZmZlciIsImJ1ZmZlciIsImNvbmNhdCIsImVuY29kZSIsImJ5dGVMZW5ndGgiLCJzdHJlYW0iLCJXcml0ZSIsImhhbmRsZUhhbmRzaGFrZSIsImd1aWQiLCJyZWFkU3RyaW5nSW5UcmFuc2FjdGlvbiIsInBpZCIsInJlYWRJbnQzMkluVHJhbnNhY3Rpb24iLCJlbWl0IiwiTW9ja1NvY2tldENsaWVudCIsInBvcnQiLCJTb2NrZXRTdHJlYW0iLCJzb2NrZXRTdHJlYW0iLCJ1bmRlZmluZWQiLCJzdGFydCIsImRlZiIsImNyZWF0ZURlZmVycmVkIiwic29ja2V0IiwiY29ubmVjdCIsImNvbm5lY3Rpb25MaXN0ZW5lciIsInByb21pc2UiLCJvbiIsImRhdGEiLCJBcHBlbmQiLCJCZWdpblRyYW5zYWN0aW9uIiwiY21kSWRCeXRlcyIsImNvdW50ZXIiLCJieXRlIiwiUmVhZEJ5dGUiLCJSb2xsQmFja1RyYW5zYWN0aW9uIiwicHVzaCIsImNtZElkIiwidG9TdHJpbmciLCJSZWFkU3RyaW5nIiwiRW5kVHJhbnNhY3Rpb24iLCJlcnJvck1lc3NhZ2UiLCJlcnJvckJ1ZmZlciIsImxlbmd0aCIsIm1lc3NhZ2VCdWZmZXIiLCJwb25nQnVmZmVyIiwiZXgiLCJzdWl0ZSIsInNldHVwIiwiU29ja2V0U2VydmVyIiwidGVhcmRvd24iLCJTdG9wIiwidGVzdCIsIlN0YXJ0IiwiZXhwZWN0IiwidG8iLCJiZSIsImdyZWF0ZXJUaGFuIiwiaG9zdCIsImF2YWlsYWJsZVBvcnQiLCJlcXVhbCIsImNhbGxiYWNrSGFuZGxlciIsInNvY2tldENsaWVudCIsImFjdHVhbCIsImV4cGVjdGVkIiwiY29tcGxldGVkIiwiZ3VpZEJ1ZmZlciIsIldyaXRlSW50MzIiLCJ0aW1lT3V0Iiwic2V0VGltZW91dCIsImNsZWFyVGltZW91dCIsIlBJTkdfTUVTU0FHRSJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBD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bkI2RCxDQUExRCxDQUFKO0FBb0JILENBMUpJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gdHNsaW50OmRpc2FibGU6bm8tYW55IG1heC1jbGFzc2VzLXBlci1maWxlIG1heC1mdW5jLWJvZHktbGVuZ3RoIG5vLXN0YXRlbGVzcy1jbGFzcyBuby1yZXF1aXJlLWltcG9ydHMgbm8tdmFyLXJlcXVpcmVzIG5vLWVtcHR5XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IGdldEZyZWVQb3J0ID0gcmVxdWlyZShcImdldC1wb3J0XCIpO1xyXG5jb25zdCBuZXQgPSByZXF1aXJlKFwibmV0XCIpO1xyXG5jb25zdCBzb2NrZXRDYWxsYmFja0hhbmRsZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL25ldC9zb2NrZXQvc29ja2V0Q2FsbGJhY2tIYW5kbGVyXCIpO1xyXG5jb25zdCBzb2NrZXRTZXJ2ZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL25ldC9zb2NrZXQvc29ja2V0U2VydmVyXCIpO1xyXG5jb25zdCBTb2NrZXRTdHJlYW1fMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL25ldC9zb2NrZXQvU29ja2V0U3RyZWFtXCIpO1xyXG5jb25zdCBhc3luY18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vdXRpbHMvYXN5bmNcIik7XHJcbmNvbnN0IHVpbnQ2NGJlID0gcmVxdWlyZSgndWludDY0YmUnKTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVubmVjZXNzYXJ5LWNsYXNzXHJcbmNsYXNzIENvbW1hbmRzIHtcclxufVxyXG5Db21tYW5kcy5FeGl0Q29tbWFuZEJ5dGVzID0gbmV3IEJ1ZmZlcignZXhpdCcpO1xyXG5Db21tYW5kcy5QaW5nQnl0ZXMgPSBuZXcgQnVmZmVyKCdwaW5nJyk7XHJcbnZhciBSZXNwb25zZUNvbW1hbmRzO1xyXG4oZnVuY3Rpb24gKFJlc3BvbnNlQ29tbWFuZHMpIHtcclxuICAgIFJlc3BvbnNlQ29tbWFuZHMuUG9uZyA9ICdQT05HJztcclxuICAgIFJlc3BvbnNlQ29tbWFuZHMuTGlzdEtlcm5lbHMgPSAnTFNUSyc7XHJcbiAgICBSZXNwb25zZUNvbW1hbmRzLkVycm9yID0gJ0VST1InO1xyXG59KShSZXNwb25zZUNvbW1hbmRzIHx8IChSZXNwb25zZUNvbW1hbmRzID0ge30pKTtcclxuY29uc3QgR1VJRCA9ICdUaGlzIGlzIHRoZSBHdWlkJztcclxuY29uc3QgUElEID0gMTIzNDtcclxuY2xhc3MgTW9ja1NvY2tldENhbGxiYWNrSGFuZGxlciBleHRlbmRzIHNvY2tldENhbGxiYWNrSGFuZGxlcl8xLlNvY2tldENhbGxiYWNrSGFuZGxlciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihzb2NrZXRTZXJ2ZXIpIHtcclxuICAgICAgICBzdXBlcihzb2NrZXRTZXJ2ZXIpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJDb21tYW5kSGFuZGxlcihSZXNwb25zZUNvbW1hbmRzLlBvbmcsIHRoaXMub25Qb25nLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJDb21tYW5kSGFuZGxlcihSZXNwb25zZUNvbW1hbmRzLkVycm9yLCB0aGlzLm9uRXJyb3IuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcbiAgICBwaW5nKG1lc3NhZ2UpIHtcclxuICAgICAgICB0aGlzLlNlbmRSYXdDb21tYW5kKENvbW1hbmRzLlBpbmdCeXRlcyk7XHJcbiAgICAgICAgY29uc3Qgc3RyaW5nQnVmZmVyID0gbmV3IEJ1ZmZlcihtZXNzYWdlKTtcclxuICAgICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuY29uY2F0KFtuZXcgQnVmZmVyKCdVJyksIHVpbnQ2NGJlLmVuY29kZShzdHJpbmdCdWZmZXIuYnl0ZUxlbmd0aCldKSwgc3RyaW5nQnVmZmVyXSk7XHJcbiAgICAgICAgdGhpcy5zdHJlYW0uV3JpdGUoYnVmZmVyKTtcclxuICAgIH1cclxuICAgIGhhbmRsZUhhbmRzaGFrZSgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZ3VpZCkge1xyXG4gICAgICAgICAgICB0aGlzLmd1aWQgPSB0aGlzLnN0cmVhbS5yZWFkU3RyaW5nSW5UcmFuc2FjdGlvbigpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuZ3VpZCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMucGlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGlkID0gdGhpcy5zdHJlYW0ucmVhZEludDMySW5UcmFuc2FjdGlvbigpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMucGlkICE9PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmd1aWQgIT09IEdVSUQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIHRoaXMuZ3VpZCwgR1VJRCwgJ0d1aWRzIG5vdCB0aGUgc2FtZScpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMucGlkICE9PSBQSUQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIHRoaXMucGlkLCBQSUQsICdwaWRzIG5vdCB0aGUgc2FtZScpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbWl0KCdoYW5kc2hha2UnKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIG9uRXJyb3IoKSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuc3RyZWFtLnJlYWRTdHJpbmdJblRyYW5zYWN0aW9uKCk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCAnJywgJycsIG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gICAgb25Qb25nKCkge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLnN0cmVhbS5yZWFkU3RyaW5nSW5UcmFuc2FjdGlvbigpO1xyXG4gICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVtaXQoJ3BvbmcnLCBtZXNzYWdlKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBNb2NrU29ja2V0Q2xpZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKHBvcnQpIHtcclxuICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xyXG4gICAgfVxyXG4gICAgZ2V0IFNvY2tldFN0cmVhbSgpIHtcclxuICAgICAgICBpZiAodGhpcy5zb2NrZXRTdHJlYW0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignbm90IGxpc3RlbmluZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5zb2NrZXRTdHJlYW07XHJcbiAgICB9XHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICB0aGlzLmRlZiA9IGFzeW5jXzEuY3JlYXRlRGVmZXJyZWQoKTtcclxuICAgICAgICB0aGlzLnNvY2tldCA9IG5ldC5jb25uZWN0KHRoaXMucG9ydCwgdGhpcy5jb25uZWN0aW9uTGlzdGVuZXIuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmLnByb21pc2U7XHJcbiAgICB9XHJcbiAgICBjb25uZWN0aW9uTGlzdGVuZXIoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc29ja2V0ID09PSB1bmRlZmluZWQgfHwgdGhpcy5kZWYgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignbm90IHN0YXJ0ZWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zb2NrZXRTdHJlYW0gPSBuZXcgU29ja2V0U3RyZWFtXzEuU29ja2V0U3RyZWFtKHRoaXMuc29ja2V0LCBuZXcgQnVmZmVyKCcnKSk7XHJcbiAgICAgICAgdGhpcy5kZWYucmVzb2x2ZSgpO1xyXG4gICAgICAgIHRoaXMuc29ja2V0Lm9uKCdlcnJvcicsICgpID0+IHsgfSk7XHJcbiAgICAgICAgdGhpcy5zb2NrZXQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5Tb2NrZXRTdHJlYW0uQXBwZW5kKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgY2FuIG9ubHkgcmVjZWl2ZSBwaW5nIG1lc3NhZ2VzXHJcbiAgICAgICAgICAgICAgICB0aGlzLlNvY2tldFN0cmVhbS5CZWdpblRyYW5zYWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjbWRJZEJ5dGVzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjb3VudGVyID0gMDsgY291bnRlciA8IDQ7IGNvdW50ZXIgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ5dGUgPSB0aGlzLlNvY2tldFN0cmVhbS5SZWFkQnl0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYnl0ZSAhPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5Tb2NrZXRTdHJlYW0uUm9sbEJhY2tUcmFuc2FjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNtZElkQnl0ZXMucHVzaChieXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IGNtZElkID0gbmV3IEJ1ZmZlcihjbWRJZEJ5dGVzKS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuU29ja2V0U3RyZWFtLlJlYWRTdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLlNvY2tldFN0cmVhbS5Sb2xsQmFja1RyYW5zYWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5Tb2NrZXRTdHJlYW0uRW5kVHJhbnNhY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgIGlmIChjbWRJZCAhPT0gJ3BpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5Tb2NrZXRTdHJlYW0uV3JpdGUobmV3IEJ1ZmZlcihSZXNwb25zZUNvbW1hbmRzLkVycm9yKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYFJlY2VpdmVkIHVua25vd24gY29tbWFuZCAnJHtjbWRJZH0nYDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnJvckJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoW0J1ZmZlci5jb25jYXQoW25ldyBCdWZmZXIoJ0EnKSwgdWludDY0YmUuZW5jb2RlKGVycm9yTWVzc2FnZS5sZW5ndGgpXSksIG5ldyBCdWZmZXIoZXJyb3JNZXNzYWdlKV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuU29ja2V0U3RyZWFtLldyaXRlKGVycm9yQnVmZmVyKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLlNvY2tldFN0cmVhbS5Xcml0ZShuZXcgQnVmZmVyKFJlc3BvbnNlQ29tbWFuZHMuUG9uZykpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUJ1ZmZlciA9IG5ldyBCdWZmZXIobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb25nQnVmZmVyID0gQnVmZmVyLmNvbmNhdChbQnVmZmVyLmNvbmNhdChbbmV3IEJ1ZmZlcignVScpLCB1aW50NjRiZS5lbmNvZGUobWVzc2FnZUJ1ZmZlci5ieXRlTGVuZ3RoKV0pLCBtZXNzYWdlQnVmZmVyXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlNvY2tldFN0cmVhbS5Xcml0ZShwb25nQnVmZmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuU29ja2V0U3RyZWFtLldyaXRlKG5ldyBCdWZmZXIoUmVzcG9uc2VDb21tYW5kcy5FcnJvcikpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYEZhdGFsIGVycm9yIGluIGhhbmRsaW5nIGRhdGEgYXQgc29ja2V0IGNsaWVudC4gRXJyb3I6ICR7ZXgubWVzc2FnZX1gO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3JCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuY29uY2F0KFtuZXcgQnVmZmVyKCdBJyksIHVpbnQ2NGJlLmVuY29kZShlcnJvck1lc3NhZ2UubGVuZ3RoKV0pLCBuZXcgQnVmZmVyKGVycm9yTWVzc2FnZSldKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuU29ja2V0U3RyZWFtLldyaXRlKGVycm9yQnVmZmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbi8vIERlZmluZXMgYSBNb2NoYSB0ZXN0IHN1aXRlIHRvIGdyb3VwIHRlc3RzIG9mIHNpbWlsYXIga2luZCB0b2dldGhlclxyXG5zdWl0ZSgnU29ja2V0Q2FsbGJhY2tIYW5kbGVyJywgKCkgPT4ge1xyXG4gICAgbGV0IHNvY2tldFNlcnZlcjtcclxuICAgIHNldHVwKCgpID0+IHNvY2tldFNlcnZlciA9IG5ldyBzb2NrZXRTZXJ2ZXJfMS5Tb2NrZXRTZXJ2ZXIoKSk7XHJcbiAgICB0ZWFyZG93bigoKSA9PiBzb2NrZXRTZXJ2ZXIuU3RvcCgpKTtcclxuICAgIHRlc3QoJ1N1Y2Nlc2Z1bGx5IHN0YXJ0cyB3aXRob3V0IGFueSBzcGVjaWZpYyBob3N0IG9yIHBvcnQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IHlpZWxkIHNvY2tldFNlcnZlci5TdGFydCgpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocG9ydCkudG8uYmUuZ3JlYXRlclRoYW4oMCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdTdWNjZXNmdWxseSBzdGFydHMgd2l0aCBwb3J0PTAgYW5kIG5vIGhvc3QnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IHlpZWxkIHNvY2tldFNlcnZlci5TdGFydCh7IHBvcnQ6IDAgfSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChwb3J0KS50by5iZS5ncmVhdGVyVGhhbigwKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1N1Y2Nlc2Z1bGx5IHN0YXJ0cyB3aXRoIHBvcnQ9MCBhbmQgaG9zdD1sb2NhbGhvc3QnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IHlpZWxkIHNvY2tldFNlcnZlci5TdGFydCh7IHBvcnQ6IDAsIGhvc3Q6ICdsb2NhbGhvc3QnIH0pO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocG9ydCkudG8uYmUuZ3JlYXRlclRoYW4oMCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdTdWNjZXNmdWxseSBzdGFydHMgd2l0aCBob3N0PTEyNy4wLjAuMScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBwb3J0ID0geWllbGQgc29ja2V0U2VydmVyLlN0YXJ0KHsgaG9zdDogJzEyNy4wLjAuMScgfSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChwb3J0KS50by5iZS5ncmVhdGVyVGhhbigwKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1N1Y2Nlc2Z1bGx5IHN0YXJ0cyB3aXRoIHBvcnQ9MCBhbmQgaG9zdD0xMjcuMC4wLjEnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IHlpZWxkIHNvY2tldFNlcnZlci5TdGFydCh7IHBvcnQ6IDAsIGhvc3Q6ICcxMjcuMC4wLjEnIH0pO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocG9ydCkudG8uYmUuZ3JlYXRlclRoYW4oMCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdTdWNjZXNmdWxseSBzdGFydHMgd2l0aCBzcGVjaWZpYyBwb3J0JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZVBvcnQgPSB5aWVsZCBnZXRGcmVlUG9ydCh7IGhvc3Q6ICdsb2NhbGhvc3QnIH0pO1xyXG4gICAgICAgIGNvbnN0IHBvcnQgPSB5aWVsZCBzb2NrZXRTZXJ2ZXIuU3RhcnQoeyBwb3J0OiBhdmFpbGFibGVQb3J0LCBob3N0OiAnbG9jYWxob3N0JyB9KTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHBvcnQpLnRvLmJlLmVxdWFsKGF2YWlsYWJsZVBvcnQpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnU3VjY2VzZnVsIEhhbmRzaGFrZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBwb3J0ID0geWllbGQgc29ja2V0U2VydmVyLlN0YXJ0KCk7XHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2tIYW5kbGVyID0gbmV3IE1vY2tTb2NrZXRDYWxsYmFja0hhbmRsZXIoc29ja2V0U2VydmVyKTtcclxuICAgICAgICBjb25zdCBzb2NrZXRDbGllbnQgPSBuZXcgTW9ja1NvY2tldENsaWVudChwb3J0KTtcclxuICAgICAgICB5aWVsZCBzb2NrZXRDbGllbnQuc3RhcnQoKTtcclxuICAgICAgICBjb25zdCBkZWYgPSBhc3luY18xLmNyZWF0ZURlZmVycmVkKCk7XHJcbiAgICAgICAgY2FsbGJhY2tIYW5kbGVyLm9uKCdoYW5kc2hha2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGRlZi5yZXNvbHZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY2FsbGJhY2tIYW5kbGVyLm9uKCdlcnJvcicsIChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZGVmLmNvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgZGVmLnJlamVjdCh7IGFjdHVhbDogYWN0dWFsLCBleHBlY3RlZDogZXhwZWN0ZWQsIG1lc3NhZ2U6IG1lc3NhZ2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDbGllbnQgaGFzIGNvbm5lY3RlZCwgbm93IHNlbmQgaW5mb3JtYXRpb24gdG8gdGhlIGNhbGxiYWNrIGhhbmRsZXIgdmlhIHNvY2tldHNcclxuICAgICAgICBjb25zdCBndWlkQnVmZmVyID0gQnVmZmVyLmNvbmNhdChbbmV3IEJ1ZmZlcignQScpLCB1aW50NjRiZS5lbmNvZGUoR1VJRC5sZW5ndGgpLCBuZXcgQnVmZmVyKEdVSUQpXSk7XHJcbiAgICAgICAgc29ja2V0Q2xpZW50LlNvY2tldFN0cmVhbS5Xcml0ZShndWlkQnVmZmVyKTtcclxuICAgICAgICBzb2NrZXRDbGllbnQuU29ja2V0U3RyZWFtLldyaXRlSW50MzIoUElEKTtcclxuICAgICAgICB5aWVsZCBkZWYucHJvbWlzZTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1Vuc3VjY2VzZnVsIEhhbmRzaGFrZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBwb3J0ID0geWllbGQgc29ja2V0U2VydmVyLlN0YXJ0KCk7XHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2tIYW5kbGVyID0gbmV3IE1vY2tTb2NrZXRDYWxsYmFja0hhbmRsZXIoc29ja2V0U2VydmVyKTtcclxuICAgICAgICBjb25zdCBzb2NrZXRDbGllbnQgPSBuZXcgTW9ja1NvY2tldENsaWVudChwb3J0KTtcclxuICAgICAgICB5aWVsZCBzb2NrZXRDbGllbnQuc3RhcnQoKTtcclxuICAgICAgICBjb25zdCBkZWYgPSBhc3luY18xLmNyZWF0ZURlZmVycmVkKCk7XHJcbiAgICAgICAgbGV0IHRpbWVPdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgZGVmLnJlamVjdCgnSGFuZHNoYWtlIG5vdCBjb21wbGV0ZWQgaW4gYWxsb2NhdGVkIHRpbWUnKTtcclxuICAgICAgICB9LCA1MDAwKTtcclxuICAgICAgICBjYWxsYmFja0hhbmRsZXIub24oJ2hhbmRzaGFrZScsICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRpbWVPdXQpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lT3V0KTtcclxuICAgICAgICAgICAgICAgIHRpbWVPdXQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGVmLnJlamVjdCgnaGFuZHNoYWtlIHNob3VsZCBmYWlsLCBidXQgaXQgc3VjY2VlZGVkIScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNhbGxiYWNrSGFuZGxlci5vbignZXJyb3InLCAoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGltZU91dCkge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVPdXQpO1xyXG4gICAgICAgICAgICAgICAgdGltZU91dCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYWN0dWFsID09PSAwICYmIG1lc3NhZ2UgPT09ICdwaWRzIG5vdCB0aGUgc2FtZScpIHtcclxuICAgICAgICAgICAgICAgIGRlZi5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkZWYucmVqZWN0KHsgYWN0dWFsOiBhY3R1YWwsIGV4cGVjdGVkOiBleHBlY3RlZCwgbWVzc2FnZTogbWVzc2FnZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIENsaWVudCBoYXMgY29ubmVjdGVkLCBub3cgc2VuZCBpbmZvcm1hdGlvbiB0byB0aGUgY2FsbGJhY2sgaGFuZGxlciB2aWEgc29ja2V0c1xyXG4gICAgICAgIGNvbnN0IGd1aWRCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtuZXcgQnVmZmVyKCdBJyksIHVpbnQ2NGJlLmVuY29kZShHVUlELmxlbmd0aCksIG5ldyBCdWZmZXIoR1VJRCldKTtcclxuICAgICAgICBzb2NrZXRDbGllbnQuU29ja2V0U3RyZWFtLldyaXRlKGd1aWRCdWZmZXIpO1xyXG4gICAgICAgIC8vIFNlbmQgdGhlIHdyb25nIHBpZFxyXG4gICAgICAgIHNvY2tldENsaWVudC5Tb2NrZXRTdHJlYW0uV3JpdGVJbnQzMigwKTtcclxuICAgICAgICB5aWVsZCBkZWYucHJvbWlzZTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1Bpbmcgd2l0aCBtZXNzYWdlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHBvcnQgPSB5aWVsZCBzb2NrZXRTZXJ2ZXIuU3RhcnQoKTtcclxuICAgICAgICBjb25zdCBjYWxsYmFja0hhbmRsZXIgPSBuZXcgTW9ja1NvY2tldENhbGxiYWNrSGFuZGxlcihzb2NrZXRTZXJ2ZXIpO1xyXG4gICAgICAgIGNvbnN0IHNvY2tldENsaWVudCA9IG5ldyBNb2NrU29ja2V0Q2xpZW50KHBvcnQpO1xyXG4gICAgICAgIHlpZWxkIHNvY2tldENsaWVudC5zdGFydCgpO1xyXG4gICAgICAgIGNvbnN0IGRlZiA9IGFzeW5jXzEuY3JlYXRlRGVmZXJyZWQoKTtcclxuICAgICAgICBjb25zdCBQSU5HX01FU1NBR0UgPSAnVGhpcyBpcyB0aGUgUGluZyBNZXNzYWdlIC0g0KTRg9C90LrRhtC40Y8g0L/RgNC+0LLQtdGA0LrQuCDQmNCd0J0g0Lgg0JrQn9CfIC0g6K+05piOJztcclxuICAgICAgICBjYWxsYmFja0hhbmRsZXIub24oJ2hhbmRzaGFrZScsICgpID0+IHtcclxuICAgICAgICAgICAgLy8gU2VuZCBhIGN1c3RvbSBtZXNzYWdlIChvbmx5IGFmdGVyIGhhbmRzaGFrZSBoYXMgYmVlbiBkb25lKVxyXG4gICAgICAgICAgICBjYWxsYmFja0hhbmRsZXIucGluZyhQSU5HX01FU1NBR0UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNhbGxiYWNrSGFuZGxlci5vbigncG9uZycsIChtZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KG1lc3NhZ2UpLnRvLmJlLmVxdWFsKFBJTkdfTUVTU0FHRSk7XHJcbiAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgZGVmLnJlamVjdChleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjYWxsYmFja0hhbmRsZXIub24oJ2Vycm9yJywgKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFkZWYuY29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICBkZWYucmVqZWN0KHsgYWN0dWFsOiBhY3R1YWwsIGV4cGVjdGVkOiBleHBlY3RlZCwgbWVzc2FnZTogbWVzc2FnZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIENsaWVudCBoYXMgY29ubmVjdGVkLCBub3cgc2VuZCBpbmZvcm1hdGlvbiB0byB0aGUgY2FsbGJhY2sgaGFuZGxlciB2aWEgc29ja2V0c1xyXG4gICAgICAgIGNvbnN0IGd1aWRCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtuZXcgQnVmZmVyKCdBJyksIHVpbnQ2NGJlLmVuY29kZShHVUlELmxlbmd0aCksIG5ldyBCdWZmZXIoR1VJRCldKTtcclxuICAgICAgICBzb2NrZXRDbGllbnQuU29ja2V0U3RyZWFtLldyaXRlKGd1aWRCdWZmZXIpO1xyXG4gICAgICAgIC8vIFNlbmQgdGhlIHdyb25nIHBpZFxyXG4gICAgICAgIHNvY2tldENsaWVudC5Tb2NrZXRTdHJlYW0uV3JpdGVJbnQzMihQSUQpO1xyXG4gICAgICAgIHlpZWxkIGRlZi5wcm9taXNlO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnU3VjY2VzZnVsIEhhbmRzaGFrZSB3aXRoIHBvcnQ9MCBhbmQgaG9zdD1sb2NhbGhvc3QnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IHlpZWxkIHNvY2tldFNlcnZlci5TdGFydCh7IHBvcnQ6IDAsIGhvc3Q6ICdsb2NhbGhvc3QnIH0pO1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrSGFuZGxlciA9IG5ldyBNb2NrU29ja2V0Q2FsbGJhY2tIYW5kbGVyKHNvY2tldFNlcnZlcik7XHJcbiAgICAgICAgY29uc3Qgc29ja2V0Q2xpZW50ID0gbmV3IE1vY2tTb2NrZXRDbGllbnQocG9ydCk7XHJcbiAgICAgICAgeWllbGQgc29ja2V0Q2xpZW50LnN0YXJ0KCk7XHJcbiAgICAgICAgY29uc3QgZGVmID0gYXN5bmNfMS5jcmVhdGVEZWZlcnJlZCgpO1xyXG4gICAgICAgIGNhbGxiYWNrSGFuZGxlci5vbignaGFuZHNoYWtlJywgKCkgPT4gZGVmLnJlc29sdmUoKSk7XHJcbiAgICAgICAgY2FsbGJhY2tIYW5kbGVyLm9uKCdlcnJvcicsIChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZGVmLmNvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgZGVmLnJlamVjdCh7IGFjdHVhbDogYWN0dWFsLCBleHBlY3RlZDogZXhwZWN0ZWQsIG1lc3NhZ2U6IG1lc3NhZ2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDbGllbnQgaGFzIGNvbm5lY3RlZCwgbm93IHNlbmQgaW5mb3JtYXRpb24gdG8gdGhlIGNhbGxiYWNrIGhhbmRsZXIgdmlhIHNvY2tldHNcclxuICAgICAgICBjb25zdCBndWlkQnVmZmVyID0gQnVmZmVyLmNvbmNhdChbbmV3IEJ1ZmZlcignQScpLCB1aW50NjRiZS5lbmNvZGUoR1VJRC5sZW5ndGgpLCBuZXcgQnVmZmVyKEdVSUQpXSk7XHJcbiAgICAgICAgc29ja2V0Q2xpZW50LlNvY2tldFN0cmVhbS5Xcml0ZShndWlkQnVmZmVyKTtcclxuICAgICAgICBzb2NrZXRDbGllbnQuU29ja2V0U3RyZWFtLldyaXRlSW50MzIoUElEKTtcclxuICAgICAgICB5aWVsZCBkZWYucHJvbWlzZTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1N1Y2Nlc2Z1bCBIYW5kc2hha2Ugd2l0aCBzcGVjaWZpYyBwb3J0JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZVBvcnQgPSB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiBnZXRGcmVlUG9ydCh7IGhvc3Q6ICdsb2NhbGhvc3QnIH0pLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KSk7XHJcbiAgICAgICAgY29uc3QgcG9ydCA9IHlpZWxkIHNvY2tldFNlcnZlci5TdGFydCh7IHBvcnQ6IGF2YWlsYWJsZVBvcnQsIGhvc3Q6ICdsb2NhbGhvc3QnIH0pO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocG9ydCkudG8uYmUuZXF1YWwoYXZhaWxhYmxlUG9ydCwgJ1NlcnZlciBpcyBub3QgbGlzdGVuaW5nIG9uIHRoZSBwcm92aWRlZCBwb3J0IG51bWJlcicpO1xyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrSGFuZGxlciA9IG5ldyBNb2NrU29ja2V0Q2FsbGJhY2tIYW5kbGVyKHNvY2tldFNlcnZlcik7XHJcbiAgICAgICAgY29uc3Qgc29ja2V0Q2xpZW50ID0gbmV3IE1vY2tTb2NrZXRDbGllbnQocG9ydCk7XHJcbiAgICAgICAgeWllbGQgc29ja2V0Q2xpZW50LnN0YXJ0KCk7XHJcbiAgICAgICAgY29uc3QgZGVmID0gYXN5bmNfMS5jcmVhdGVEZWZlcnJlZCgpO1xyXG4gICAgICAgIGNhbGxiYWNrSGFuZGxlci5vbignaGFuZHNoYWtlJywgKCkgPT4gZGVmLnJlc29sdmUoKSk7XHJcbiAgICAgICAgY2FsbGJhY2tIYW5kbGVyLm9uKCdlcnJvcicsIChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghZGVmLmNvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgZGVmLnJlamVjdCh7IGFjdHVhbDogYWN0dWFsLCBleHBlY3RlZDogZXhwZWN0ZWQsIG1lc3NhZ2U6IG1lc3NhZ2UgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBDbGllbnQgaGFzIGNvbm5lY3RlZCwgbm93IHNlbmQgaW5mb3JtYXRpb24gdG8gdGhlIGNhbGxiYWNrIGhhbmRsZXIgdmlhIHNvY2tldHNcclxuICAgICAgICBjb25zdCBndWlkQnVmZmVyID0gQnVmZmVyLmNvbmNhdChbbmV3IEJ1ZmZlcignQScpLCB1aW50NjRiZS5lbmNvZGUoR1VJRC5sZW5ndGgpLCBuZXcgQnVmZmVyKEdVSUQpXSk7XHJcbiAgICAgICAgc29ja2V0Q2xpZW50LlNvY2tldFN0cmVhbS5Xcml0ZShndWlkQnVmZmVyKTtcclxuICAgICAgICBzb2NrZXRDbGllbnQuU29ja2V0U3RyZWFtLldyaXRlSW50MzIoUElEKTtcclxuICAgICAgICB5aWVsZCBkZWYucHJvbWlzZTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNvY2tldENhbGxiYWNrSGFuZGxlci50ZXN0LmpzLm1hcCJdfQ==