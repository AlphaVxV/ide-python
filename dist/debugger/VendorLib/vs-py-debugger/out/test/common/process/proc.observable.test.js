"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const chaiAsPromised = require("chai-as-promised");

const vscode_1 = require("vscode");

const configSettings_1 = require("../../../client/common/configSettings");

const decoder_1 = require("../../../client/common/process/decoder");

const proc_1 = require("../../../client/common/process/proc");

const async_1 = require("../../../client/common/utils/async");

const initialize_1 = require("./../../initialize");

chai_1.use(chaiAsPromised); // tslint:disable-next-line:max-func-body-length

suite('ProcessService', () => {
  let pythonPath;
  suiteSetup(() => {
    pythonPath = configSettings_1.PythonSettings.getInstance().pythonPath;
    return initialize_1.initialize();
  });
  setup(initialize_1.initialize);
  teardown(initialize_1.initialize);
  test('execObservable should stream output with new lines', function (done) {
    // tslint:disable-next-line:no-invalid-this
    this.timeout(10000);
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'import time', 'print("1")', 'sys.stdout.flush()', 'time.sleep(2)', 'print("2")', 'sys.stdout.flush()', 'time.sleep(2)', 'print("3")', 'sys.stdout.flush()', 'time.sleep(2)'];
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')]);
    const outputs = ['1', '2', '3'];
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined');
    result.out.subscribe(output => {
      // Ignore line breaks.
      if (output.out.trim().length === 0) {
        return;
      }

      const expectedValue = outputs.shift();

      if (expectedValue !== output.out.trim() && expectedValue === output.out) {
        done(`Received value ${output.out} is not same as the expectd value ${expectedValue}`);
      }

      if (output.source !== 'stdout') {
        done(`Source is not stdout. Value received is ${output.source}`);
      }
    }, done, done);
  });
  test('execObservable should stream output without new lines', function (done) {
    // tslint:disable-next-line:no-invalid-this
    this.timeout(10000);
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'import time', 'sys.stdout.write("1")', 'sys.stdout.flush()', 'time.sleep(2)', 'sys.stdout.write("2")', 'sys.stdout.flush()', 'time.sleep(2)', 'sys.stdout.write("3")', 'sys.stdout.flush()', 'time.sleep(2)'];
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')]);
    const outputs = ['1', '2', '3'];
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined');
    result.out.subscribe(output => {
      // Ignore line breaks.
      if (output.out.trim().length === 0) {
        return;
      }

      const expectedValue = outputs.shift();

      if (expectedValue !== output.out) {
        done(`Received value ${output.out} is not same as the expectd value ${expectedValue}`);
      }

      if (output.source !== 'stdout') {
        done(`Source is not stdout. Value received is ${output.source}`);
      }
    }, done, done);
  });
  test('execObservable should end when cancellationToken is cancelled', function (done) {
    // tslint:disable-next-line:no-invalid-this
    this.timeout(15000);
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'import time', 'print("1")', 'sys.stdout.flush()', 'time.sleep(10)', 'print("2")', 'sys.stdout.flush()', 'time.sleep(2)'];
    const cancellationToken = new vscode_1.CancellationTokenSource();
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')], {
      token: cancellationToken.token
    });
    const def = async_1.createDeferred();
    def.promise.then(done).catch(done);
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined');
    result.out.subscribe(output => {
      const value = output.out.trim();

      if (value === '1') {
        cancellationToken.cancel();
      } else {
        if (!def.completed) {
          def.reject('Output received when we shouldn\'t have.');
        }
      }
    }, done, () => {
      if (def.completed) {
        return;
      }

      if (cancellationToken.token.isCancellationRequested) {
        def.resolve();
      } else {
        def.reject('Program terminated even before cancelling it.');
      }
    });
  });
  test('execObservable should end when process is killed', function (done) {
    // tslint:disable-next-line:no-invalid-this
    this.timeout(15000);
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'import time', 'print("1")', 'sys.stdout.flush()', 'time.sleep(10)', 'print("2")', 'sys.stdout.flush()', 'time.sleep(2)'];
    const cancellationToken = new vscode_1.CancellationTokenSource();
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')], {
      token: cancellationToken.token
    });
    let procKilled = false;
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined');
    result.out.subscribe(output => {
      const value = output.out.trim(); // Ignore line breaks.

      if (value.length === 0) {
        return;
      }

      if (value === '1') {
        procKilled = true;
        result.proc.kill();
      } else {
        done('Output received when we shouldn\'t have.');
      }
    }, done, () => {
      const errorMsg = procKilled ? undefined : 'Program terminated even before killing it.';
      done(errorMsg);
    });
  });
  test('execObservable should stream stdout and stderr separately', function (done) {
    // tslint:disable-next-line:no-invalid-this
    this.timeout(20000);
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'import time', 'print("1")', 'sys.stdout.flush()', 'time.sleep(2)', 'sys.stderr.write("a")', 'sys.stderr.flush()', 'time.sleep(2)', 'print("2")', 'sys.stdout.flush()', 'time.sleep(2)', 'sys.stderr.write("b")', 'sys.stderr.flush()', 'time.sleep(2)', 'print("3")', 'sys.stdout.flush()', 'time.sleep(2)', 'sys.stderr.write("c")', 'sys.stderr.flush()', 'time.sleep(2)'];
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')]);
    const outputs = [{
      out: '1',
      source: 'stdout'
    }, {
      out: 'a',
      source: 'stderr'
    }, {
      out: '2',
      source: 'stdout'
    }, {
      out: 'b',
      source: 'stderr'
    }, {
      out: '3',
      source: 'stdout'
    }, {
      out: 'c',
      source: 'stderr'
    }];
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined');
    result.out.subscribe(output => {
      const value = output.out.trim(); // Ignore line breaks.

      if (value.length === 0) {
        return;
      }

      const expectedOutput = outputs.shift();
      chai_1.expect(value).to.be.equal(expectedOutput.out, 'Expected output is incorrect');
      chai_1.expect(output.source).to.be.equal(expectedOutput.source, 'Expected sopurce is incorrect');
    }, done, done);
  });
  test('execObservable should send stdout and stderr streams separately', function (done) {
    // tslint:disable-next-line:no-invalid-this
    this.timeout(7000);
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'import time', 'print("1")', 'sys.stdout.flush()', 'time.sleep(1)', 'sys.stderr.write("a")', 'sys.stderr.flush()', 'time.sleep(1)', 'print("2")', 'sys.stdout.flush()', 'time.sleep(1)', 'sys.stderr.write("b")', 'sys.stderr.flush()', 'time.sleep(1)', 'print("3")', 'sys.stdout.flush()', 'time.sleep(1)', 'sys.stderr.write("c")', 'sys.stderr.flush()', 'time.sleep(1)'];
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')], {
      mergeStdOutErr: true
    });
    const outputs = [{
      out: '1',
      source: 'stdout'
    }, {
      out: 'a',
      source: 'stderr'
    }, {
      out: '2',
      source: 'stdout'
    }, {
      out: 'b',
      source: 'stderr'
    }, {
      out: '3',
      source: 'stdout'
    }, {
      out: 'c',
      source: 'stderr'
    }];
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined');
    result.out.subscribe(output => {
      const value = output.out.trim(); // Ignore line breaks.

      if (value.length === 0) {
        return;
      }

      const expectedOutput = outputs.shift();
      chai_1.expect(value).to.be.equal(expectedOutput.out, 'Expected output is incorrect');
      chai_1.expect(output.source).to.be.equal(expectedOutput.source, 'Expected sopurce is incorrect');
    }, done, done);
  });
  test('execObservable should throw an error with stderr output', done => {
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const pythonCode = ['import sys', 'sys.stderr.write("a")', 'sys.stderr.flush()'];
    const result = procService.execObservable(pythonPath, ['-c', pythonCode.join(';')], {
      throwOnStdErr: true
    });
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined.');
    result.out.subscribe(output => {
      done('Output received, when we\'re expecting an error to be thrown.');
    }, ex => {
      chai_1.expect(ex).to.have.property('message', 'a', 'Invalid error thrown');
      done();
    }, () => {
      done('Completed, when we\'re expecting an error to be thrown.');
    });
  });
  test('execObservable should throw an error when spawn file not found', done => {
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const result = procService.execObservable(Date.now().toString(), []);
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined.');
    result.out.subscribe(output => {
      done('Output received, when we\'re expecting an error to be thrown.');
    }, ex => {
      chai_1.expect(ex).to.have.property('code', 'ENOENT', 'Invalid error code');
      done();
    }, () => {
      done('Completed, when we\'re expecting an error to be thrown.');
    });
  });
  test('execObservable should exit without no output', done => {
    const procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
    const result = procService.execObservable(pythonPath, ['-c', 'import sys', 'sys.exit()']);
    chai_1.expect(result).not.to.be.an('undefined', 'result is undefined.');
    result.out.subscribe(output => {
      done(`Output received, when we\'re not expecting any, ${JSON.stringify(output)}`);
    }, done, done);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2Mub2JzZXJ2YWJsZS50ZXN0LmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY2hhaV8xIiwicmVxdWlyZSIsImNoYWlBc1Byb21pc2VkIiwidnNjb2RlXzEiLCJjb25maWdTZXR0aW5nc18xIiwiZGVjb2Rlcl8xIiwicHJvY18xIiwiYXN5bmNfMSIsImluaXRpYWxpemVfMSIsInVzZSIsInN1aXRlIiwicHl0aG9uUGF0aCIsInN1aXRlU2V0dXAiLCJQeXRob25TZXR0aW5ncyIsImdldEluc3RhbmNlIiwiaW5pdGlhbGl6ZSIsInNldHVwIiwidGVhcmRvd24iLCJ0ZXN0IiwiZG9uZSIsInRpbWVvdXQiLCJwcm9jU2VydmljZSIsIlByb2Nlc3NTZXJ2aWNlIiwiQnVmZmVyRGVjb2RlciIsInB5dGhvbkNvZGUiLCJyZXN1bHQiLCJleGVjT2JzZXJ2YWJsZSIsImpvaW4iLCJvdXRwdXRzIiwiZXhwZWN0Iiwibm90IiwidG8iLCJiZSIsImFuIiwib3V0Iiwic3Vic2NyaWJlIiwib3V0cHV0IiwidHJpbSIsImxlbmd0aCIsImV4cGVjdGVkVmFsdWUiLCJzaGlmdCIsInNvdXJjZSIsImNhbmNlbGxhdGlvblRva2VuIiwiQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UiLCJ0b2tlbiIsImRlZiIsImNyZWF0ZURlZmVycmVkIiwicHJvbWlzZSIsInRoZW4iLCJjYXRjaCIsImNhbmNlbCIsImNvbXBsZXRlZCIsInJlamVjdCIsImlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkIiwicmVzb2x2ZSIsInByb2NLaWxsZWQiLCJwcm9jIiwia2lsbCIsImVycm9yTXNnIiwidW5kZWZpbmVkIiwiZXhwZWN0ZWRPdXRwdXQiLCJlcXVhbCIsIm1lcmdlU3RkT3V0RXJyIiwidGhyb3dPblN0ZEVyciIsImV4IiwiaGF2ZSIsInByb3BlcnR5IiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSJdLCJtYXBw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TUFBQUEsSUFBSSxDQUFDLCtEQUFELENBQUo7QUFDSCxLQUZELEVBRUc2QyxFQUFFLElBQUk7QUFDTGhFLE1BQUFBLE1BQU0sQ0FBQzZCLE1BQVAsQ0FBY21DLEVBQWQsRUFBa0JqQyxFQUFsQixDQUFxQmtDLElBQXJCLENBQTBCQyxRQUExQixDQUFtQyxNQUFuQyxFQUEyQyxRQUEzQyxFQUFxRCxvQkFBckQ7QUFDQS9DLE1BQUFBLElBQUk7QUFDUCxLQUxELEVBS0csTUFBTTtBQUNMQSxNQUFBQSxJQUFJLENBQUMseURBQUQsQ0FBSjtBQUNILEtBUEQ7QUFRSCxHQVpHLENBQUo7QUFhQUQsRUFBQUEsSUFBSSxDQUFDLDhDQUFELEVBQWtEQyxJQUFELElBQVU7QUFDM0QsVUFBTUUsV0FBVyxHQUFHLElBQUlmLE1BQU0sQ0FBQ2dCLGNBQVgsQ0FBMEIsSUFBSWpCLFNBQVMsQ0FBQ2tCLGFBQWQsRUFBMUIsQ0FBcEI7QUFDQSxVQUFNRSxNQUFNLEdBQUdKLFdBQVcsQ0FBQ0ssY0FBWixDQUEyQmYsVUFBM0IsRUFBdUMsQ0FBQyxJQUFELEVBQU8sWUFBUCxFQUFxQixZQUFyQixDQUF2QyxDQUFmO0FBQ0FYLElBQUFBLE1BQU0sQ0FBQzZCLE1BQVAsQ0FBY0osTUFBZCxFQUFzQkssR0FBdEIsQ0FBMEJDLEVBQTFCLENBQTZCQyxFQUE3QixDQUFnQ0MsRUFBaEMsQ0FBbUMsV0FBbkMsRUFBZ0Qsc0JBQWhEO0FBQ0FSLElBQUFBLE1BQU0sQ0FBQ1MsR0FBUCxDQUFXQyxTQUFYLENBQXFCQyxNQUFNLElBQUk7QUFDM0JqQixNQUFBQSxJQUFJLENBQUUsbURBQWtEbUQsSUFBSSxDQUFDQyxTQUFMLENBQWVuQyxNQUFmLENBQXVCLEVBQTNFLENBQUo7QUFDSCxLQUZELEVBRUdqQixJQUZILEVBRVNBLElBRlQ7QUFHSCxHQVBHLENBQUo7QUFRSCxDQXROSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IGNoYWlBc1Byb21pc2VkID0gcmVxdWlyZShcImNoYWktYXMtcHJvbWlzZWRcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgY29uZmlnU2V0dGluZ3NfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL2NvbmZpZ1NldHRpbmdzXCIpO1xyXG5jb25zdCBkZWNvZGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL2RlY29kZXJcIik7XHJcbmNvbnN0IHByb2NfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3Byb2Nlc3MvcHJvY1wiKTtcclxuY29uc3QgYXN5bmNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL2FzeW5jXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi8uLi8uLi9pbml0aWFsaXplXCIpO1xyXG5jaGFpXzEudXNlKGNoYWlBc1Byb21pc2VkKTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbnN1aXRlKCdQcm9jZXNzU2VydmljZScsICgpID0+IHtcclxuICAgIGxldCBweXRob25QYXRoO1xyXG4gICAgc3VpdGVTZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgcHl0aG9uUGF0aCA9IGNvbmZpZ1NldHRpbmdzXzEuUHl0aG9uU2V0dGluZ3MuZ2V0SW5zdGFuY2UoKS5weXRob25QYXRoO1xyXG4gICAgICAgIHJldHVybiBpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSgpO1xyXG4gICAgfSk7XHJcbiAgICBzZXR1cChpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSk7XHJcbiAgICB0ZWFyZG93bihpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSk7XHJcbiAgICB0ZXN0KCdleGVjT2JzZXJ2YWJsZSBzaG91bGQgc3RyZWFtIG91dHB1dCB3aXRoIG5ldyBsaW5lcycsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpc1xyXG4gICAgICAgIHRoaXMudGltZW91dCgxMDAwMCk7XHJcbiAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSBuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpKTtcclxuICAgICAgICBjb25zdCBweXRob25Db2RlID0gWydpbXBvcnQgc3lzJywgJ2ltcG9ydCB0aW1lJyxcclxuICAgICAgICAgICAgJ3ByaW50KFwiMVwiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgyKScsXHJcbiAgICAgICAgICAgICdwcmludChcIjJcIiknLCAnc3lzLnN0ZG91dC5mbHVzaCgpJywgJ3RpbWUuc2xlZXAoMiknLFxyXG4gICAgICAgICAgICAncHJpbnQoXCIzXCIpJywgJ3N5cy5zdGRvdXQuZmx1c2goKScsICd0aW1lLnNsZWVwKDIpJ107XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvY1NlcnZpY2UuZXhlY09ic2VydmFibGUocHl0aG9uUGF0aCwgWyctYycsIHB5dGhvbkNvZGUuam9pbignOycpXSk7XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0cyA9IFsnMScsICcyJywgJzMnXTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkubm90LnRvLmJlLmFuKCd1bmRlZmluZWQnLCAncmVzdWx0IGlzIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgIHJlc3VsdC5vdXQuc3Vic2NyaWJlKG91dHB1dCA9PiB7XHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBsaW5lIGJyZWFrcy5cclxuICAgICAgICAgICAgaWYgKG91dHB1dC5vdXQudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkVmFsdWUgPSBvdXRwdXRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIGlmIChleHBlY3RlZFZhbHVlICE9PSBvdXRwdXQub3V0LnRyaW0oKSAmJiBleHBlY3RlZFZhbHVlID09PSBvdXRwdXQub3V0KSB7XHJcbiAgICAgICAgICAgICAgICBkb25lKGBSZWNlaXZlZCB2YWx1ZSAke291dHB1dC5vdXR9IGlzIG5vdCBzYW1lIGFzIHRoZSBleHBlY3RkIHZhbHVlICR7ZXhwZWN0ZWRWYWx1ZX1gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAob3V0cHV0LnNvdXJjZSAhPT0gJ3N0ZG91dCcpIHtcclxuICAgICAgICAgICAgICAgIGRvbmUoYFNvdXJjZSBpcyBub3Qgc3Rkb3V0LiBWYWx1ZSByZWNlaXZlZCBpcyAke291dHB1dC5zb3VyY2V9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCBkb25lLCBkb25lKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnZXhlY09ic2VydmFibGUgc2hvdWxkIHN0cmVhbSBvdXRwdXQgd2l0aG91dCBuZXcgbGluZXMnLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICB0aGlzLnRpbWVvdXQoMTAwMDApO1xyXG4gICAgICAgIGNvbnN0IHByb2NTZXJ2aWNlID0gbmV3IHByb2NfMS5Qcm9jZXNzU2VydmljZShuZXcgZGVjb2Rlcl8xLkJ1ZmZlckRlY29kZXIoKSk7XHJcbiAgICAgICAgY29uc3QgcHl0aG9uQ29kZSA9IFsnaW1wb3J0IHN5cycsICdpbXBvcnQgdGltZScsXHJcbiAgICAgICAgICAgICdzeXMuc3Rkb3V0LndyaXRlKFwiMVwiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgyKScsXHJcbiAgICAgICAgICAgICdzeXMuc3Rkb3V0LndyaXRlKFwiMlwiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgyKScsXHJcbiAgICAgICAgICAgICdzeXMuc3Rkb3V0LndyaXRlKFwiM1wiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgyKSddO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb2NTZXJ2aWNlLmV4ZWNPYnNlcnZhYmxlKHB5dGhvblBhdGgsIFsnLWMnLCBweXRob25Db2RlLmpvaW4oJzsnKV0pO1xyXG4gICAgICAgIGNvbnN0IG91dHB1dHMgPSBbJzEnLCAnMicsICczJ107XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChyZXN1bHQpLm5vdC50by5iZS5hbigndW5kZWZpbmVkJywgJ3Jlc3VsdCBpcyB1bmRlZmluZWQnKTtcclxuICAgICAgICByZXN1bHQub3V0LnN1YnNjcmliZShvdXRwdXQgPT4ge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgbGluZSBicmVha3MuXHJcbiAgICAgICAgICAgIGlmIChvdXRwdXQub3V0LnRyaW0oKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZFZhbHVlID0gb3V0cHV0cy5zaGlmdCgpO1xyXG4gICAgICAgICAgICBpZiAoZXhwZWN0ZWRWYWx1ZSAhPT0gb3V0cHV0Lm91dCkge1xyXG4gICAgICAgICAgICAgICAgZG9uZShgUmVjZWl2ZWQgdmFsdWUgJHtvdXRwdXQub3V0fSBpcyBub3Qgc2FtZSBhcyB0aGUgZXhwZWN0ZCB2YWx1ZSAke2V4cGVjdGVkVmFsdWV9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG91dHB1dC5zb3VyY2UgIT09ICdzdGRvdXQnKSB7XHJcbiAgICAgICAgICAgICAgICBkb25lKGBTb3VyY2UgaXMgbm90IHN0ZG91dC4gVmFsdWUgcmVjZWl2ZWQgaXMgJHtvdXRwdXQuc291cmNlfWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZG9uZSwgZG9uZSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ2V4ZWNPYnNlcnZhYmxlIHNob3VsZCBlbmQgd2hlbiBjYW5jZWxsYXRpb25Ub2tlbiBpcyBjYW5jZWxsZWQnLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICB0aGlzLnRpbWVvdXQoMTUwMDApO1xyXG4gICAgICAgIGNvbnN0IHByb2NTZXJ2aWNlID0gbmV3IHByb2NfMS5Qcm9jZXNzU2VydmljZShuZXcgZGVjb2Rlcl8xLkJ1ZmZlckRlY29kZXIoKSk7XHJcbiAgICAgICAgY29uc3QgcHl0aG9uQ29kZSA9IFsnaW1wb3J0IHN5cycsICdpbXBvcnQgdGltZScsXHJcbiAgICAgICAgICAgICdwcmludChcIjFcIiknLCAnc3lzLnN0ZG91dC5mbHVzaCgpJywgJ3RpbWUuc2xlZXAoMTApJyxcclxuICAgICAgICAgICAgJ3ByaW50KFwiMlwiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgyKSddO1xyXG4gICAgICAgIGNvbnN0IGNhbmNlbGxhdGlvblRva2VuID0gbmV3IHZzY29kZV8xLkNhbmNlbGxhdGlvblRva2VuU291cmNlKCk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvY1NlcnZpY2UuZXhlY09ic2VydmFibGUocHl0aG9uUGF0aCwgWyctYycsIHB5dGhvbkNvZGUuam9pbignOycpXSwgeyB0b2tlbjogY2FuY2VsbGF0aW9uVG9rZW4udG9rZW4gfSk7XHJcbiAgICAgICAgY29uc3QgZGVmID0gYXN5bmNfMS5jcmVhdGVEZWZlcnJlZCgpO1xyXG4gICAgICAgIGRlZi5wcm9taXNlLnRoZW4oZG9uZSkuY2F0Y2goZG9uZSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChyZXN1bHQpLm5vdC50by5iZS5hbigndW5kZWZpbmVkJywgJ3Jlc3VsdCBpcyB1bmRlZmluZWQnKTtcclxuICAgICAgICByZXN1bHQub3V0LnN1YnNjcmliZShvdXRwdXQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG91dHB1dC5vdXQudHJpbSgpO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgY2FuY2VsbGF0aW9uVG9rZW4uY2FuY2VsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWRlZi5jb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWYucmVqZWN0KCdPdXRwdXQgcmVjZWl2ZWQgd2hlbiB3ZSBzaG91bGRuXFwndCBoYXZlLicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgZG9uZSwgKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZGVmLmNvbXBsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjYW5jZWxsYXRpb25Ub2tlbi50b2tlbi5pc0NhbmNlbGxhdGlvblJlcXVlc3RlZCkge1xyXG4gICAgICAgICAgICAgICAgZGVmLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRlZi5yZWplY3QoJ1Byb2dyYW0gdGVybWluYXRlZCBldmVuIGJlZm9yZSBjYW5jZWxsaW5nIGl0LicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ2V4ZWNPYnNlcnZhYmxlIHNob3VsZCBlbmQgd2hlbiBwcm9jZXNzIGlzIGtpbGxlZCcsIGZ1bmN0aW9uIChkb25lKSB7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpc1xyXG4gICAgICAgIHRoaXMudGltZW91dCgxNTAwMCk7XHJcbiAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSBuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpKTtcclxuICAgICAgICBjb25zdCBweXRob25Db2RlID0gWydpbXBvcnQgc3lzJywgJ2ltcG9ydCB0aW1lJyxcclxuICAgICAgICAgICAgJ3ByaW50KFwiMVwiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgxMCknLFxyXG4gICAgICAgICAgICAncHJpbnQoXCIyXCIpJywgJ3N5cy5zdGRvdXQuZmx1c2goKScsICd0aW1lLnNsZWVwKDIpJ107XHJcbiAgICAgICAgY29uc3QgY2FuY2VsbGF0aW9uVG9rZW4gPSBuZXcgdnNjb2RlXzEuQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UoKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9jU2VydmljZS5leGVjT2JzZXJ2YWJsZShweXRob25QYXRoLCBbJy1jJywgcHl0aG9uQ29kZS5qb2luKCc7JyldLCB7IHRva2VuOiBjYW5jZWxsYXRpb25Ub2tlbi50b2tlbiB9KTtcclxuICAgICAgICBsZXQgcHJvY0tpbGxlZCA9IGZhbHNlO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzdWx0KS5ub3QudG8uYmUuYW4oJ3VuZGVmaW5lZCcsICdyZXN1bHQgaXMgdW5kZWZpbmVkJyk7XHJcbiAgICAgICAgcmVzdWx0Lm91dC5zdWJzY3JpYmUob3V0cHV0ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBvdXRwdXQub3V0LnRyaW0oKTtcclxuICAgICAgICAgICAgLy8gSWdub3JlIGxpbmUgYnJlYWtzLlxyXG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnMScpIHtcclxuICAgICAgICAgICAgICAgIHByb2NLaWxsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnByb2Mua2lsbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9uZSgnT3V0cHV0IHJlY2VpdmVkIHdoZW4gd2Ugc2hvdWxkblxcJ3QgaGF2ZS4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGRvbmUsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JNc2cgPSBwcm9jS2lsbGVkID8gdW5kZWZpbmVkIDogJ1Byb2dyYW0gdGVybWluYXRlZCBldmVuIGJlZm9yZSBraWxsaW5nIGl0Lic7XHJcbiAgICAgICAgICAgIGRvbmUoZXJyb3JNc2cpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdleGVjT2JzZXJ2YWJsZSBzaG91bGQgc3RyZWFtIHN0ZG91dCBhbmQgc3RkZXJyIHNlcGFyYXRlbHknLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICB0aGlzLnRpbWVvdXQoMjAwMDApO1xyXG4gICAgICAgIGNvbnN0IHByb2NTZXJ2aWNlID0gbmV3IHByb2NfMS5Qcm9jZXNzU2VydmljZShuZXcgZGVjb2Rlcl8xLkJ1ZmZlckRlY29kZXIoKSk7XHJcbiAgICAgICAgY29uc3QgcHl0aG9uQ29kZSA9IFsnaW1wb3J0IHN5cycsICdpbXBvcnQgdGltZScsXHJcbiAgICAgICAgICAgICdwcmludChcIjFcIiknLCAnc3lzLnN0ZG91dC5mbHVzaCgpJywgJ3RpbWUuc2xlZXAoMiknLFxyXG4gICAgICAgICAgICAnc3lzLnN0ZGVyci53cml0ZShcImFcIiknLCAnc3lzLnN0ZGVyci5mbHVzaCgpJywgJ3RpbWUuc2xlZXAoMiknLFxyXG4gICAgICAgICAgICAncHJpbnQoXCIyXCIpJywgJ3N5cy5zdGRvdXQuZmx1c2goKScsICd0aW1lLnNsZWVwKDIpJyxcclxuICAgICAgICAgICAgJ3N5cy5zdGRlcnIud3JpdGUoXCJiXCIpJywgJ3N5cy5zdGRlcnIuZmx1c2goKScsICd0aW1lLnNsZWVwKDIpJyxcclxuICAgICAgICAgICAgJ3ByaW50KFwiM1wiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgyKScsXHJcbiAgICAgICAgICAgICdzeXMuc3RkZXJyLndyaXRlKFwiY1wiKScsICdzeXMuc3RkZXJyLmZsdXNoKCknLCAndGltZS5zbGVlcCgyKSddO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb2NTZXJ2aWNlLmV4ZWNPYnNlcnZhYmxlKHB5dGhvblBhdGgsIFsnLWMnLCBweXRob25Db2RlLmpvaW4oJzsnKV0pO1xyXG4gICAgICAgIGNvbnN0IG91dHB1dHMgPSBbXHJcbiAgICAgICAgICAgIHsgb3V0OiAnMScsIHNvdXJjZTogJ3N0ZG91dCcgfSwgeyBvdXQ6ICdhJywgc291cmNlOiAnc3RkZXJyJyB9LFxyXG4gICAgICAgICAgICB7IG91dDogJzInLCBzb3VyY2U6ICdzdGRvdXQnIH0sIHsgb3V0OiAnYicsIHNvdXJjZTogJ3N0ZGVycicgfSxcclxuICAgICAgICAgICAgeyBvdXQ6ICczJywgc291cmNlOiAnc3Rkb3V0JyB9LCB7IG91dDogJ2MnLCBzb3VyY2U6ICdzdGRlcnInIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzdWx0KS5ub3QudG8uYmUuYW4oJ3VuZGVmaW5lZCcsICdyZXN1bHQgaXMgdW5kZWZpbmVkJyk7XHJcbiAgICAgICAgcmVzdWx0Lm91dC5zdWJzY3JpYmUob3V0cHV0ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBvdXRwdXQub3V0LnRyaW0oKTtcclxuICAgICAgICAgICAgLy8gSWdub3JlIGxpbmUgYnJlYWtzLlxyXG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRPdXRwdXQgPSBvdXRwdXRzLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QodmFsdWUpLnRvLmJlLmVxdWFsKGV4cGVjdGVkT3V0cHV0Lm91dCwgJ0V4cGVjdGVkIG91dHB1dCBpcyBpbmNvcnJlY3QnKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChvdXRwdXQuc291cmNlKS50by5iZS5lcXVhbChleHBlY3RlZE91dHB1dC5zb3VyY2UsICdFeHBlY3RlZCBzb3B1cmNlIGlzIGluY29ycmVjdCcpO1xyXG4gICAgICAgIH0sIGRvbmUsIGRvbmUpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdleGVjT2JzZXJ2YWJsZSBzaG91bGQgc2VuZCBzdGRvdXQgYW5kIHN0ZGVyciBzdHJlYW1zIHNlcGFyYXRlbHknLCBmdW5jdGlvbiAoZG9uZSkge1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICB0aGlzLnRpbWVvdXQoNzAwMCk7XHJcbiAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSBuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpKTtcclxuICAgICAgICBjb25zdCBweXRob25Db2RlID0gWydpbXBvcnQgc3lzJywgJ2ltcG9ydCB0aW1lJyxcclxuICAgICAgICAgICAgJ3ByaW50KFwiMVwiKScsICdzeXMuc3Rkb3V0LmZsdXNoKCknLCAndGltZS5zbGVlcCgxKScsXHJcbiAgICAgICAgICAgICdzeXMuc3RkZXJyLndyaXRlKFwiYVwiKScsICdzeXMuc3RkZXJyLmZsdXNoKCknLCAndGltZS5zbGVlcCgxKScsXHJcbiAgICAgICAgICAgICdwcmludChcIjJcIiknLCAnc3lzLnN0ZG91dC5mbHVzaCgpJywgJ3RpbWUuc2xlZXAoMSknLFxyXG4gICAgICAgICAgICAnc3lzLnN0ZGVyci53cml0ZShcImJcIiknLCAnc3lzLnN0ZGVyci5mbHVzaCgpJywgJ3RpbWUuc2xlZXAoMSknLFxyXG4gICAgICAgICAgICAncHJpbnQoXCIzXCIpJywgJ3N5cy5zdGRvdXQuZmx1c2goKScsICd0aW1lLnNsZWVwKDEpJyxcclxuICAgICAgICAgICAgJ3N5cy5zdGRlcnIud3JpdGUoXCJjXCIpJywgJ3N5cy5zdGRlcnIuZmx1c2goKScsICd0aW1lLnNsZWVwKDEpJ107XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvY1NlcnZpY2UuZXhlY09ic2VydmFibGUocHl0aG9uUGF0aCwgWyctYycsIHB5dGhvbkNvZGUuam9pbignOycpXSwgeyBtZXJnZVN0ZE91dEVycjogdHJ1ZSB9KTtcclxuICAgICAgICBjb25zdCBvdXRwdXRzID0gW1xyXG4gICAgICAgICAgICB7IG91dDogJzEnLCBzb3VyY2U6ICdzdGRvdXQnIH0sIHsgb3V0OiAnYScsIHNvdXJjZTogJ3N0ZGVycicgfSxcclxuICAgICAgICAgICAgeyBvdXQ6ICcyJywgc291cmNlOiAnc3Rkb3V0JyB9LCB7IG91dDogJ2InLCBzb3VyY2U6ICdzdGRlcnInIH0sXHJcbiAgICAgICAgICAgIHsgb3V0OiAnMycsIHNvdXJjZTogJ3N0ZG91dCcgfSwgeyBvdXQ6ICdjJywgc291cmNlOiAnc3RkZXJyJyB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkubm90LnRvLmJlLmFuKCd1bmRlZmluZWQnLCAncmVzdWx0IGlzIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgIHJlc3VsdC5vdXQuc3Vic2NyaWJlKG91dHB1dCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gb3V0cHV0Lm91dC50cmltKCk7XHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBsaW5lIGJyZWFrcy5cclxuICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkT3V0cHV0ID0gb3V0cHV0cy5zaGlmdCgpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KHZhbHVlKS50by5iZS5lcXVhbChleHBlY3RlZE91dHB1dC5vdXQsICdFeHBlY3RlZCBvdXRwdXQgaXMgaW5jb3JyZWN0Jyk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3Qob3V0cHV0LnNvdXJjZSkudG8uYmUuZXF1YWwoZXhwZWN0ZWRPdXRwdXQuc291cmNlLCAnRXhwZWN0ZWQgc29wdXJjZSBpcyBpbmNvcnJlY3QnKTtcclxuICAgICAgICB9LCBkb25lLCBkb25lKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnZXhlY09ic2VydmFibGUgc2hvdWxkIHRocm93IGFuIGVycm9yIHdpdGggc3RkZXJyIG91dHB1dCcsIChkb25lKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSBuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpKTtcclxuICAgICAgICBjb25zdCBweXRob25Db2RlID0gWydpbXBvcnQgc3lzJywgJ3N5cy5zdGRlcnIud3JpdGUoXCJhXCIpJywgJ3N5cy5zdGRlcnIuZmx1c2goKSddO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb2NTZXJ2aWNlLmV4ZWNPYnNlcnZhYmxlKHB5dGhvblBhdGgsIFsnLWMnLCBweXRob25Db2RlLmpvaW4oJzsnKV0sIHsgdGhyb3dPblN0ZEVycjogdHJ1ZSB9KTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkubm90LnRvLmJlLmFuKCd1bmRlZmluZWQnLCAncmVzdWx0IGlzIHVuZGVmaW5lZC4nKTtcclxuICAgICAgICByZXN1bHQub3V0LnN1YnNjcmliZShvdXRwdXQgPT4ge1xyXG4gICAgICAgICAgICBkb25lKCdPdXRwdXQgcmVjZWl2ZWQsIHdoZW4gd2VcXCdyZSBleHBlY3RpbmcgYW4gZXJyb3IgdG8gYmUgdGhyb3duLicpO1xyXG4gICAgICAgIH0sIChleCkgPT4ge1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGV4KS50by5oYXZlLnByb3BlcnR5KCdtZXNzYWdlJywgJ2EnLCAnSW52YWxpZCBlcnJvciB0aHJvd24nKTtcclxuICAgICAgICAgICAgZG9uZSgpO1xyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgICAgZG9uZSgnQ29tcGxldGVkLCB3aGVuIHdlXFwncmUgZXhwZWN0aW5nIGFuIGVycm9yIHRvIGJlIHRocm93bi4nKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnZXhlY09ic2VydmFibGUgc2hvdWxkIHRocm93IGFuIGVycm9yIHdoZW4gc3Bhd24gZmlsZSBub3QgZm91bmQnLCAoZG9uZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByb2NTZXJ2aWNlID0gbmV3IHByb2NfMS5Qcm9jZXNzU2VydmljZShuZXcgZGVjb2Rlcl8xLkJ1ZmZlckRlY29kZXIoKSk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvY1NlcnZpY2UuZXhlY09ic2VydmFibGUoRGF0ZS5ub3coKS50b1N0cmluZygpLCBbXSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChyZXN1bHQpLm5vdC50by5iZS5hbigndW5kZWZpbmVkJywgJ3Jlc3VsdCBpcyB1bmRlZmluZWQuJyk7XHJcbiAgICAgICAgcmVzdWx0Lm91dC5zdWJzY3JpYmUob3V0cHV0ID0+IHtcclxuICAgICAgICAgICAgZG9uZSgnT3V0cHV0IHJlY2VpdmVkLCB3aGVuIHdlXFwncmUgZXhwZWN0aW5nIGFuIGVycm9yIHRvIGJlIHRocm93bi4nKTtcclxuICAgICAgICB9LCBleCA9PiB7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoZXgpLnRvLmhhdmUucHJvcGVydHkoJ2NvZGUnLCAnRU5PRU5UJywgJ0ludmFsaWQgZXJyb3IgY29kZScpO1xyXG4gICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgfSwgKCkgPT4ge1xyXG4gICAgICAgICAgICBkb25lKCdDb21wbGV0ZWQsIHdoZW4gd2VcXCdyZSBleHBlY3RpbmcgYW4gZXJyb3IgdG8gYmUgdGhyb3duLicpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdleGVjT2JzZXJ2YWJsZSBzaG91bGQgZXhpdCB3aXRob3V0IG5vIG91dHB1dCcsIChkb25lKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSBuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9jU2VydmljZS5leGVjT2JzZXJ2YWJsZShweXRob25QYXRoLCBbJy1jJywgJ2ltcG9ydCBzeXMnLCAnc3lzLmV4aXQoKSddKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkubm90LnRvLmJlLmFuKCd1bmRlZmluZWQnLCAncmVzdWx0IGlzIHVuZGVmaW5lZC4nKTtcclxuICAgICAgICByZXN1bHQub3V0LnN1YnNjcmliZShvdXRwdXQgPT4ge1xyXG4gICAgICAgICAgICBkb25lKGBPdXRwdXQgcmVjZWl2ZWQsIHdoZW4gd2VcXCdyZSBub3QgZXhwZWN0aW5nIGFueSwgJHtKU09OLnN0cmluZ2lmeShvdXRwdXQpfWApO1xyXG4gICAgICAgIH0sIGRvbmUsIGRvbmUpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9jLm9ic2VydmFibGUudGVzdC5qcy5tYXAiXX0=