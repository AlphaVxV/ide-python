"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length no-any

const chai_1 = require("chai");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../../client/common/platform/types");

const types_2 = require("../../../client/common/process/types");

const types_3 = require("../../../client/common/types");

const types_4 = require("../../../client/common/variables/types");

const interpreterVersion_1 = require("../../../client/interpreter/interpreterVersion");

suite('PythonExecutableService', () => {
  let serviceContainer;
  let configService;
  let procService;
  let procServiceFactory;
  setup(() => {
    serviceContainer = TypeMoq.Mock.ofType();
    const envVarsProvider = TypeMoq.Mock.ofType();
    procServiceFactory = TypeMoq.Mock.ofType();
    procService = TypeMoq.Mock.ofType();
    configService = TypeMoq.Mock.ofType();
    const fileSystem = TypeMoq.Mock.ofType();
    fileSystem.setup(f => f.fileExists(TypeMoq.It.isAny())).returns(() => Promise.resolve(false));
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IFileSystem))).returns(() => fileSystem.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.IEnvironmentVariablesProvider))).returns(() => envVarsProvider.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IProcessServiceFactory))).returns(() => procServiceFactory.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService))).returns(() => configService.object);
    procService.setup(x => x.then).returns(() => undefined);
    procServiceFactory.setup(p => p.create(TypeMoq.It.isAny())).returns(() => Promise.resolve(procService.object));
    envVarsProvider.setup(v => v.getEnvironmentVariables(TypeMoq.It.isAny())).returns(() => Promise.resolve({}));
  });
  test('Ensure resource is used when getting configuration service settings (undefined resource)', () => __awaiter(void 0, void 0, void 0, function* () {
    const pythonPath = `Python_Path_${new Date().toString()}`;
    const pythonVersion = `Python_Version_${new Date().toString()}`;
    const pythonSettings = TypeMoq.Mock.ofType();
    pythonSettings.setup(p => p.pythonPath).returns(() => pythonPath);
    configService.setup(c => c.getSettings(TypeMoq.It.isValue(undefined))).returns(() => pythonSettings.object);
    procService.setup(p => p.exec(TypeMoq.It.isValue(pythonPath), TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve({
      stdout: pythonVersion
    }));
    const versionService = new interpreterVersion_1.InterpreterVersionService(procServiceFactory.object);
    const version = yield versionService.getVersion(pythonPath, '');
    chai_1.expect(version).to.be.equal(pythonVersion);
  }));
  test('Ensure resource is used when getting configuration service settings (defined resource)', () => __awaiter(void 0, void 0, void 0, function* () {
    const resource = vscode_1.Uri.file('abc');
    const pythonPath = `Python_Path_${new Date().toString()}`;
    const pythonVersion = `Python_Version_${new Date().toString()}`;
    const pythonSettings = TypeMoq.Mock.ofType();
    pythonSettings.setup(p => p.pythonPath).returns(() => pythonPath);
    configService.setup(c => c.getSettings(TypeMoq.It.isValue(resource))).returns(() => pythonSettings.object);
    procService.setup(p => p.exec(TypeMoq.It.isValue(pythonPath), TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve({
      stdout: pythonVersion
    }));
    const versionService = new interpreterVersion_1.InterpreterVersionService(procServiceFactory.object);
    const version = yield versionService.getVersion(pythonPath, '');
    chai_1.expect(version).to.be.equal(pythonVersion);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4ZWNGYWN0b3J5LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJUeXBlTW9xIiwidnNjb2RlXzEiLCJ0eXBlc18xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJ0eXBlc180IiwiaW50ZXJwcmV0ZXJWZXJzaW9uXzEiLCJzdWl0ZSIsInNlcnZpY2VDb250YWluZXIiLCJjb25maWdTZXJ2aWNlIiwicHJvY1NlcnZpY2UiLCJwcm9jU2VydmljZUZhY3RvcnkiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJlbnZWYXJzUHJvdmlkZXIiLCJmaWxlU3lzdGVtIiwiZiIsImZpbGVFeGlzdHMiLCJJdCIsImlzQW55IiwicmV0dXJucyIsImMiLCJnZXQiLCJpc1ZhbHVlIiwiSUZpbGVTeXN0ZW0iLCJvYmplY3QiLCJJRW52aXJvbm1lbnRWYXJpYWJsZXNQcm92aWRlciIsIklQcm9jZXNzU2VydmljZUZhY3RvcnkiLCJJQ29uZmlndXJhdGlvblNlcnZpY2UiLCJ4IiwidW5kZWZpbmVkIiwicCIsImNyZWF0ZSIsInYiLCJnZXRFbnZpcm9ubWVudFZhcmlhYmxlcyIsInRlc3QiLCJweXRob25QYXRoIiwiRGF0ZSIsInRvU3RyaW5nIiwicHl0aG9uVmVyc2lvbiIsInB5dGhvblNldHRpbmdzIiwiZ2V0U2V0dGluZ3MiLCJleGVjIiwic3Rkb3V0IiwidmVyc2lvblNlcnZpY2UiLCJJbnRlcnByZXRlclZlcnNpb25TZXJ2aWNlIiwidmVyc2lvbiIsImdldFZlcnNpb24iLCJleHBlY3QiLCJ0byIsImJlIiwi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QU8sR0FBRyxNQUFNRixjQUFjLENBQUNHLFVBQWYsQ0FBMEJYLFVBQTFCLEVBQXNDLEVBQXRDLENBQXRCO0FBQ0F2QyxJQUFBQSxNQUFNLENBQUNtRCxNQUFQLENBQWNGLE9BQWQsRUFBdUJHLEVBQXZCLENBQTBCQyxFQUExQixDQUE2QkMsS0FBN0IsQ0FBbUNaLGFBQW5DO0FBQ0gsR0FYNkcsQ0FBMUcsQ0FBSjtBQVlILENBNUNJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZnVuYy1ib2R5LWxlbmd0aCBuby1hbnlcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi92YXJpYWJsZXMvdHlwZXNcIik7XHJcbmNvbnN0IGludGVycHJldGVyVmVyc2lvbl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9pbnRlcnByZXRlci9pbnRlcnByZXRlclZlcnNpb25cIik7XHJcbnN1aXRlKCdQeXRob25FeGVjdXRhYmxlU2VydmljZScsICgpID0+IHtcclxuICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgbGV0IGNvbmZpZ1NlcnZpY2U7XHJcbiAgICBsZXQgcHJvY1NlcnZpY2U7XHJcbiAgICBsZXQgcHJvY1NlcnZpY2VGYWN0b3J5O1xyXG4gICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3QgZW52VmFyc1Byb3ZpZGVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHByb2NTZXJ2aWNlRmFjdG9yeSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBwcm9jU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25maWdTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IGZpbGVTeXN0ZW0gPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgZmlsZVN5c3RlbS5zZXR1cChmID0+IGYuZmlsZUV4aXN0cyhUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShmYWxzZSkpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JRmlsZVN5c3RlbSkpKS5yZXR1cm5zKCgpID0+IGZpbGVTeXN0ZW0ub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzQuSUVudmlyb25tZW50VmFyaWFibGVzUHJvdmlkZXIpKSkucmV0dXJucygoKSA9PiBlbnZWYXJzUHJvdmlkZXIub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzIuSVByb2Nlc3NTZXJ2aWNlRmFjdG9yeSkpKS5yZXR1cm5zKCgpID0+IHByb2NTZXJ2aWNlRmFjdG9yeS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMy5JQ29uZmlndXJhdGlvblNlcnZpY2UpKSkucmV0dXJucygoKSA9PiBjb25maWdTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgcHJvY1NlcnZpY2Uuc2V0dXAoKHgpID0+IHgudGhlbikucmV0dXJucygoKSA9PiB1bmRlZmluZWQpO1xyXG4gICAgICAgIHByb2NTZXJ2aWNlRmFjdG9yeS5zZXR1cChwID0+IHAuY3JlYXRlKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHByb2NTZXJ2aWNlLm9iamVjdCkpO1xyXG4gICAgICAgIGVudlZhcnNQcm92aWRlci5zZXR1cCh2ID0+IHYuZ2V0RW52aXJvbm1lbnRWYXJpYWJsZXMoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoe30pKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnRW5zdXJlIHJlc291cmNlIGlzIHVzZWQgd2hlbiBnZXR0aW5nIGNvbmZpZ3VyYXRpb24gc2VydmljZSBzZXR0aW5ncyAodW5kZWZpbmVkIHJlc291cmNlKScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBweXRob25QYXRoID0gYFB5dGhvbl9QYXRoXyR7bmV3IERhdGUoKS50b1N0cmluZygpfWA7XHJcbiAgICAgICAgY29uc3QgcHl0aG9uVmVyc2lvbiA9IGBQeXRob25fVmVyc2lvbl8ke25ldyBEYXRlKCkudG9TdHJpbmcoKX1gO1xyXG4gICAgICAgIGNvbnN0IHB5dGhvblNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHB5dGhvblNldHRpbmdzLnNldHVwKHAgPT4gcC5weXRob25QYXRoKS5yZXR1cm5zKCgpID0+IHB5dGhvblBhdGgpO1xyXG4gICAgICAgIGNvbmZpZ1NlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNWYWx1ZSh1bmRlZmluZWQpKSkucmV0dXJucygoKSA9PiBweXRob25TZXR0aW5ncy5vYmplY3QpO1xyXG4gICAgICAgIHByb2NTZXJ2aWNlLnNldHVwKHAgPT4gcC5leGVjKFR5cGVNb3EuSXQuaXNWYWx1ZShweXRob25QYXRoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IHN0ZG91dDogcHl0aG9uVmVyc2lvbiB9KSk7XHJcbiAgICAgICAgY29uc3QgdmVyc2lvblNlcnZpY2UgPSBuZXcgaW50ZXJwcmV0ZXJWZXJzaW9uXzEuSW50ZXJwcmV0ZXJWZXJzaW9uU2VydmljZShwcm9jU2VydmljZUZhY3Rvcnkub2JqZWN0KTtcclxuICAgICAgICBjb25zdCB2ZXJzaW9uID0geWllbGQgdmVyc2lvblNlcnZpY2UuZ2V0VmVyc2lvbihweXRob25QYXRoLCAnJyk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh2ZXJzaW9uKS50by5iZS5lcXVhbChweXRob25WZXJzaW9uKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSByZXNvdXJjZSBpcyB1c2VkIHdoZW4gZ2V0dGluZyBjb25maWd1cmF0aW9uIHNlcnZpY2Ugc2V0dGluZ3MgKGRlZmluZWQgcmVzb3VyY2UpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHJlc291cmNlID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2FiYycpO1xyXG4gICAgICAgIGNvbnN0IHB5dGhvblBhdGggPSBgUHl0aG9uX1BhdGhfJHtuZXcgRGF0ZSgpLnRvU3RyaW5nKCl9YDtcclxuICAgICAgICBjb25zdCBweXRob25WZXJzaW9uID0gYFB5dGhvbl9WZXJzaW9uXyR7bmV3IERhdGUoKS50b1N0cmluZygpfWA7XHJcbiAgICAgICAgY29uc3QgcHl0aG9uU2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgcHl0aG9uU2V0dGluZ3Muc2V0dXAocCA9PiBwLnB5dGhvblBhdGgpLnJldHVybnMoKCkgPT4gcHl0aG9uUGF0aCk7XHJcbiAgICAgICAgY29uZmlnU2VydmljZS5zZXR1cChjID0+IGMuZ2V0U2V0dGluZ3MoVHlwZU1vcS5JdC5pc1ZhbHVlKHJlc291cmNlKSkpLnJldHVybnMoKCkgPT4gcHl0aG9uU2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICBwcm9jU2VydmljZS5zZXR1cChwID0+IHAuZXhlYyhUeXBlTW9xLkl0LmlzVmFsdWUocHl0aG9uUGF0aCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBzdGRvdXQ6IHB5dGhvblZlcnNpb24gfSkpO1xyXG4gICAgICAgIGNvbnN0IHZlcnNpb25TZXJ2aWNlID0gbmV3IGludGVycHJldGVyVmVyc2lvbl8xLkludGVycHJldGVyVmVyc2lvblNlcnZpY2UocHJvY1NlcnZpY2VGYWN0b3J5Lm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IHlpZWxkIHZlcnNpb25TZXJ2aWNlLmdldFZlcnNpb24ocHl0aG9uUGF0aCwgJycpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QodmVyc2lvbikudG8uYmUuZXF1YWwocHl0aG9uVmVyc2lvbik7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1leGVjRmFjdG9yeS50ZXN0LmpzLm1hcCJdfQ==