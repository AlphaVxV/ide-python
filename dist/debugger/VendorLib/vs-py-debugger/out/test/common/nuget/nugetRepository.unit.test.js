// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const semver_1 = require("semver");

const typeMoq = require("typemoq");

const types_1 = require("../../../client/activation/types");

const nugetRepository_1 = require("../../../client/common/nuget/nugetRepository");

suite('Nuget on Nuget Repo', () => {
  let serviceContainer;
  let httpClient;
  let nugetRepo;
  setup(() => {
    serviceContainer = typeMoq.Mock.ofType();
    httpClient = typeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(typeMoq.It.isValue(types_1.IHttpClient))).returns(() => httpClient.object);
    nugetRepo = new nugetRepository_1.NugetRepository(serviceContainer.object);
  });
  test('Get all package versions', () => __awaiter(void 0, void 0, void 0, function* () {
    const packageBaseAddress = 'a';
    const packageName = 'b';
    const resp = {
      versions: ['1.1.1', '1.2.1']
    };
    const expectedUri = `${packageBaseAddress}/${packageName.toLowerCase().trim()}/index.json`;
    httpClient.setup(h => h.getJSON(typeMoq.It.isValue(expectedUri))).returns(() => Promise.resolve(resp)).verifiable(typeMoq.Times.once());
    const versions = yield nugetRepo.getVersions(packageBaseAddress, packageName);
    httpClient.verifyAll();
    chai_1.expect(versions).to.be.lengthOf(2);
    chai_1.expect(versions.map(item => item.raw)).to.deep.equal(resp.versions);
  }));
  test('Get package uri', () => __awaiter(void 0, void 0, void 0, function* () {
    const packageBaseAddress = 'a';
    const packageName = 'b';
    const version = '1.1.3';
    const expectedUri = `${packageBaseAddress}/${packageName}/${version}/${packageName}.${version}.nupkg`;
    const packageUri = nugetRepo.getNugetPackageUri(packageBaseAddress, packageName, new semver_1.SemVer(version));
    httpClient.verifyAll();
    chai_1.expect(packageUri).to.equal(expectedUri);
  }));
  test('Get packages', () => __awaiter(void 0, void 0, void 0, function* () {
    const versions = ['1.1.1', '1.2.1', '2.2.2', '2.5.4', '2.9.5-release', '2.7.4-beta', '2.0.2', '3.5.4'];

    nugetRepo.getVersions = () => Promise.resolve(versions.map(v => new semver_1.SemVer(v)));

    nugetRepo.getNugetPackageUri = () => 'uri';

    const packages = yield nugetRepo.getPackages('packageName');
    chai_1.expect(packages).to.be.lengthOf(versions.length);
    chai_1.expect(packages.map(item => item.version.raw)).to.be.deep.equal(versions);
    chai_1.expect(packages.map(item => item.uri)).to.be.deep.equal(versions.map(() => 'uri'));
    chai_1.expect(packages.map(item => item.package)).to.be.deep.equal(versions.map(() => 'packageName'));
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm51Z2V0UmVwb3NpdG9yeS51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJzZW12ZXJfMSIsInR5cGVNb3EiLCJ0eXBlc18xIiwibnVnZXRSZXBvc2l0b3J5XzEiLCJzdWl0ZSIsInNlcnZpY2VDb250YWluZXIiLCJodHRwQ2xpZW50IiwibnVnZXRSZXBvIiwic2V0dXAiLCJNb2NrIiwib2ZUeXBlIiwiYyIsImdldCIsIkl0IiwiaXNWYWx1ZSIsIklIdHRwQ2xpZW50IiwicmV0dXJucyIsIm9iamVjdCIsIk51Z2V0UmVwb3NpdG9yeSIsInRlc3QiLCJwYWNrYWdlQmFzZUFkZHJlc3MiLCJwYWNrYWdlTmFtZSIsInJlc3AiLCJ2ZXJzaW9ucyIsImV4cGVjdGVkVXJpIiwidG9Mb3dlckNhc2UiLCJ0cmltIiwiaCIsImdldEpTT04iLCJ2ZXJpZmlhYmxlIiwiVGltZXMiLCJvbmNlIiwiZ2V0VmVyc2lvbnMiLCJ2ZXJpZnlBbGwiLCJleHBlY3QiLCJ0byIsImJlIiwibGVuZ3RoT2YiLCJtYXAiLCJpdGVtIiwicmF3IiwiZGVlcCIsImVxdWFsIiwidmVyc2lvbiIsInBhY2thZ2VVcmkiLCJnZXROdWdldFBhY2thZ2VVcmkiLCJTZW1WZXIiLCJ2IiwicGFja2FnZXMiLCJnZXRQYWNrYWdlcyIsImxlbmd0aCIsInVyaSIsInBhY2thZ2UiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYs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QUF2QjtBQUNBbkQsSUFBQUEsTUFBTSxDQUFDb0MsTUFBUCxDQUFjYyxRQUFkLEVBQXdCYixFQUF4QixDQUEyQkMsRUFBM0IsQ0FBOEJDLFFBQTlCLENBQXVDZCxRQUFRLENBQUMyQixNQUFoRDtBQUNBcEQsSUFBQUEsTUFBTSxDQUFDb0MsTUFBUCxDQUFjYyxRQUFRLENBQUNWLEdBQVQsQ0FBYUMsSUFBSSxJQUFJQSxJQUFJLENBQUNJLE9BQUwsQ0FBYUgsR0FBbEMsQ0FBZCxFQUFzREwsRUFBdEQsQ0FBeURDLEVBQXpELENBQTRESyxJQUE1RCxDQUFpRUMsS0FBakUsQ0FBdUVuQixRQUF2RTtBQUNBekIsSUFBQUEsTUFBTSxDQUFDb0MsTUFBUCxDQUFjYyxRQUFRLENBQUNWLEdBQVQsQ0FBYUMsSUFBSSxJQUFJQSxJQUFJLENBQUNZLEdBQTFCLENBQWQsRUFBOENoQixFQUE5QyxDQUFpREMsRUFBakQsQ0FBb0RLLElBQXBELENBQXlEQyxLQUF6RCxDQUErRG5CLFFBQVEsQ0FBQ2UsR0FBVCxDQUFhLE1BQU0sS0FBbkIsQ0FBL0Q7QUFDQXhDLElBQUFBLE1BQU0sQ0FBQ29DLE1BQVAsQ0FBY2MsUUFBUSxDQUFDVixHQUFULENBQWFDLElBQUksSUFBSUEsSUFBSSxDQUFDYSxPQUExQixDQUFkLEVBQWtEakIsRUFBbEQsQ0FBcURDLEVBQXJELENBQXdESyxJQUF4RCxDQUE2REMsS0FBN0QsQ0FBbUVuQixRQUFRLENBQUNlLEdBQVQsQ0FBYSxNQUFNLGFBQW5CLENBQW5FO0FBQ0gsR0FUbUMsQ0FBaEMsQ0FBSjtBQVVILENBM0NJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IHNlbXZlcl8xID0gcmVxdWlyZShcInNlbXZlclwiKTtcclxuY29uc3QgdHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9hY3RpdmF0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCBudWdldFJlcG9zaXRvcnlfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL251Z2V0L251Z2V0UmVwb3NpdG9yeVwiKTtcclxuc3VpdGUoJ051Z2V0IG9uIE51Z2V0IFJlcG8nLCAoKSA9PiB7XHJcbiAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgIGxldCBodHRwQ2xpZW50O1xyXG4gICAgbGV0IG51Z2V0UmVwbztcclxuICAgIHNldHVwKCgpID0+IHtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGh0dHBDbGllbnQgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklIdHRwQ2xpZW50KSkpLnJldHVybnMoKCkgPT4gaHR0cENsaWVudC5vYmplY3QpO1xyXG4gICAgICAgIG51Z2V0UmVwbyA9IG5ldyBudWdldFJlcG9zaXRvcnlfMS5OdWdldFJlcG9zaXRvcnkoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdHZXQgYWxsIHBhY2thZ2UgdmVyc2lvbnMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcGFja2FnZUJhc2VBZGRyZXNzID0gJ2EnO1xyXG4gICAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gJ2InO1xyXG4gICAgICAgIGNvbnN0IHJlc3AgPSB7IHZlcnNpb25zOiBbJzEuMS4xJywgJzEuMi4xJ10gfTtcclxuICAgICAgICBjb25zdCBleHBlY3RlZFVyaSA9IGAke3BhY2thZ2VCYXNlQWRkcmVzc30vJHtwYWNrYWdlTmFtZS50b0xvd2VyQ2FzZSgpLnRyaW0oKX0vaW5kZXguanNvbmA7XHJcbiAgICAgICAgaHR0cENsaWVudFxyXG4gICAgICAgICAgICAuc2V0dXAoaCA9PiBoLmdldEpTT04odHlwZU1vcS5JdC5pc1ZhbHVlKGV4cGVjdGVkVXJpKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShyZXNwKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIGNvbnN0IHZlcnNpb25zID0geWllbGQgbnVnZXRSZXBvLmdldFZlcnNpb25zKHBhY2thZ2VCYXNlQWRkcmVzcywgcGFja2FnZU5hbWUpO1xyXG4gICAgICAgIGh0dHBDbGllbnQudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh2ZXJzaW9ucykudG8uYmUubGVuZ3RoT2YoMik7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh2ZXJzaW9ucy5tYXAoaXRlbSA9PiBpdGVtLnJhdykpLnRvLmRlZXAuZXF1YWwocmVzcC52ZXJzaW9ucyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdHZXQgcGFja2FnZSB1cmknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcGFja2FnZUJhc2VBZGRyZXNzID0gJ2EnO1xyXG4gICAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gJ2InO1xyXG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSAnMS4xLjMnO1xyXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkVXJpID0gYCR7cGFja2FnZUJhc2VBZGRyZXNzfS8ke3BhY2thZ2VOYW1lfS8ke3ZlcnNpb259LyR7cGFja2FnZU5hbWV9LiR7dmVyc2lvbn0ubnVwa2dgO1xyXG4gICAgICAgIGNvbnN0IHBhY2thZ2VVcmkgPSBudWdldFJlcG8uZ2V0TnVnZXRQYWNrYWdlVXJpKHBhY2thZ2VCYXNlQWRkcmVzcywgcGFja2FnZU5hbWUsIG5ldyBzZW12ZXJfMS5TZW1WZXIodmVyc2lvbikpO1xyXG4gICAgICAgIGh0dHBDbGllbnQudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChwYWNrYWdlVXJpKS50by5lcXVhbChleHBlY3RlZFVyaSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdHZXQgcGFja2FnZXMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgdmVyc2lvbnMgPSBbJzEuMS4xJywgJzEuMi4xJywgJzIuMi4yJywgJzIuNS40JywgJzIuOS41LXJlbGVhc2UnLCAnMi43LjQtYmV0YScsICcyLjAuMicsICczLjUuNCddO1xyXG4gICAgICAgIG51Z2V0UmVwby5nZXRWZXJzaW9ucyA9ICgpID0+IFByb21pc2UucmVzb2x2ZSh2ZXJzaW9ucy5tYXAodiA9PiBuZXcgc2VtdmVyXzEuU2VtVmVyKHYpKSk7XHJcbiAgICAgICAgbnVnZXRSZXBvLmdldE51Z2V0UGFja2FnZVVyaSA9ICgpID0+ICd1cmknO1xyXG4gICAgICAgIGNvbnN0IHBhY2thZ2VzID0geWllbGQgbnVnZXRSZXBvLmdldFBhY2thZ2VzKCdwYWNrYWdlTmFtZScpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocGFja2FnZXMpLnRvLmJlLmxlbmd0aE9mKHZlcnNpb25zLmxlbmd0aCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChwYWNrYWdlcy5tYXAoaXRlbSA9PiBpdGVtLnZlcnNpb24ucmF3KSkudG8uYmUuZGVlcC5lcXVhbCh2ZXJzaW9ucyk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChwYWNrYWdlcy5tYXAoaXRlbSA9PiBpdGVtLnVyaSkpLnRvLmJlLmRlZXAuZXF1YWwodmVyc2lvbnMubWFwKCgpID0+ICd1cmknKSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChwYWNrYWdlcy5tYXAoaXRlbSA9PiBpdGVtLnBhY2thZ2UpKS50by5iZS5kZWVwLmVxdWFsKHZlcnNpb25zLm1hcCgoKSA9PiAncGFja2FnZU5hbWUnKSk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1udWdldFJlcG9zaXRvcnkudW5pdC50ZXN0LmpzLm1hcCJdfQ==