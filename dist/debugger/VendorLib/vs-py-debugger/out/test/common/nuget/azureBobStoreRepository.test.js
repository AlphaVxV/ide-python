// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const semver_1 = require("semver");

const typeMoq = require("typemoq");

const languageServerPackageRepository_1 = require("../../../client/activation/languageServer/languageServerPackageRepository");

const languageServerPackageService_1 = require("../../../client/activation/languageServer/languageServerPackageService");

const types_1 = require("../../../client/activation/types");

const azureBlobStoreNugetRepository_1 = require("../../../client/common/nuget/azureBlobStoreNugetRepository");

const types_2 = require("../../../client/common/nuget/types");

const platformService_1 = require("../../../client/common/platform/platformService");

const types_3 = require("../../../client/common/platform/types");

const azureBlobStorageAccount = 'https://pvsc.blob.core.windows.net';
const azureCDNBlobStorageAccount = 'https://pvsc.azureedge.net';
suite('Nuget Azure Storage Repository', () => {
  let serviceContainer;
  let httpClient;
  let repo;
  setup(() => {
    serviceContainer = typeMoq.Mock.ofType();
    httpClient = typeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(typeMoq.It.isValue(types_1.IHttpClient))).returns(() => httpClient.object);
    const nugetService = typeMoq.Mock.ofType();
    nugetService.setup(n => n.getVersionFromPackageFileName(typeMoq.It.isAny())).returns(() => new semver_1.SemVer('1.1.1'));
    serviceContainer.setup(c => c.get(typeMoq.It.isValue(types_2.INugetService))).returns(() => nugetService.object);
    const defaultStorageChannel = languageServerPackageRepository_1.LanguageServerPackageStorageContainers.stable;
    repo = new azureBlobStoreNugetRepository_1.AzureBlobStoreNugetRepository(serviceContainer.object, azureBlobStorageAccount, defaultStorageChannel, azureCDNBlobStorageAccount);
  });
  test('Get all packages', function () {
    return __awaiter(this, void 0, void 0, function* () {
      // tslint:disable-next-line:no-invalid-this
      this.timeout(15000);
      const platformService = new platformService_1.PlatformService();
      serviceContainer.setup(c => c.get(typeMoq.It.isValue(types_3.IPlatformService))).returns(() => platformService);
      const packageJson = {
        languageServerVersion: '0.1.0'
      };
      const appEnv = typeMoq.Mock.ofType();
      appEnv.setup(e => e.packageJson).returns(() => packageJson);
      const lsPackageService = new languageServerPackageService_1.LanguageServerPackageService(serviceContainer.object, appEnv.object);
      const packageName = lsPackageService.getNugetPackageName();
      const packages = yield repo.getPackages(packageName);
      chai_1.expect(packages).to.be.length.greaterThan(0);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF6dXJlQm9iU3RvcmVSZXBvc2l0b3J5LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJzZW12ZXJfMSIsInR5cGVNb3EiLCJsYW5ndWFnZVNlcnZlclBhY2thZ2VSZXBvc2l0b3J5XzEiLCJsYW5ndWFnZVNlcnZlclBhY2thZ2VTZXJ2aWNlXzEiLCJ0eXBlc18xIiwiYXp1cmVCbG9iU3RvcmVOdWdldFJlcG9zaXRvcnlfMSIsInR5cGVzXzIiLCJwbGF0Zm9ybVNlcnZpY2VfMSIsInR5cGVzXzMiLCJhenVyZUJsb2JTdG9yYWdlQWNjb3VudCIsImF6dXJlQ0ROQmxvYlN0b3JhZ2VBY2NvdW50Iiwic3VpdGUiLCJzZXJ2aWNlQ29udGFpbmVyIiwiaHR0cENsaWVudCIsInJlcG8iLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJjIiwiZ2V0IiwiSXQiLCJpc1ZhbHVlIiwiSUh0dHBDbGllbnQiLCJyZXR1cm5zIiwib2JqZWN0IiwibnVnZXRTZXJ2aWNlIiwibiIsImdldFZlcnNpb25Gcm9tUGFja2FnZUZpbGVOYW1lIiwiaXNBbnkiLCJTZW1WZXIiLCJJTnVnZXRTZXJ2aWNlIiwiZGVmYXVsdFN0b3JhZ2VDaGFubmVsIiwiTGFuZ3VhZ2VTZXJ2ZXJQYWNrYWdlU3RvcmFnZUNvbnRhaW5lcnMiLCJzdGFibGUiLCJBenVyZUJsb2JTdG9yZU51Z2V0UmVwb3NpdG9yeSIsInRlc3QiLCJ0aW1lb3V0IiwicGxhdGZvcm1TZXJ2aWNlIiwiUGxhdGZvcm1TZXJ2aWNlIiwiSVBsYXRmb3JtU2VydmljZSIsInBhY2thZ2VKc29uIiwibGFuZ3VhZ2VTZXJ2ZXJWZXJzaW9uIiwiYXBwRW52IiwibHNQYWNrYWdlU2VydmljZSIsIkxhbmd1YWdlU2VydmVyUGFja2FnZVNlcnZpY2UiLCJwYWNrYWdlTmFtZSIsImdldE51Z2V0UGFja2FnZU5hbWUiLCJwYWNrYWdlcyIsImdldFBhY2thZ2VzIiwiZXhwZWN0IiwidG8iLCJiZSIsImxlbmd0aCIsImdyZWF0ZXJUaGFuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFB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QjtBQUNBL0MsTUFBQUEsTUFBTSxDQUFDbUQsTUFBUCxDQUFjRixRQUFkLEVBQXdCRyxFQUF4QixDQUEyQkMsRUFBM0IsQ0FBOEJDLE1BQTlCLENBQXFDQyxXQUFyQyxDQUFpRCxDQUFqRDtBQUNILEtBWmUsQ0FBaEI7QUFhSCxHQWRHLENBQUo7QUFlSCxDQTdCSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGNoYWlfMSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCBzZW12ZXJfMSA9IHJlcXVpcmUoXCJzZW12ZXJcIik7XHJcbmNvbnN0IHR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgbGFuZ3VhZ2VTZXJ2ZXJQYWNrYWdlUmVwb3NpdG9yeV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9hY3RpdmF0aW9uL2xhbmd1YWdlU2VydmVyL2xhbmd1YWdlU2VydmVyUGFja2FnZVJlcG9zaXRvcnlcIik7XHJcbmNvbnN0IGxhbmd1YWdlU2VydmVyUGFja2FnZVNlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvYWN0aXZhdGlvbi9sYW5ndWFnZVNlcnZlci9sYW5ndWFnZVNlcnZlclBhY2thZ2VTZXJ2aWNlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9hY3RpdmF0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCBhenVyZUJsb2JTdG9yZU51Z2V0UmVwb3NpdG9yeV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vbnVnZXQvYXp1cmVCbG9iU3RvcmVOdWdldFJlcG9zaXRvcnlcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9udWdldC90eXBlc1wiKTtcclxuY29uc3QgcGxhdGZvcm1TZXJ2aWNlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9wbGF0Zm9ybS9wbGF0Zm9ybVNlcnZpY2VcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9wbGF0Zm9ybS90eXBlc1wiKTtcclxuY29uc3QgYXp1cmVCbG9iU3RvcmFnZUFjY291bnQgPSAnaHR0cHM6Ly9wdnNjLmJsb2IuY29yZS53aW5kb3dzLm5ldCc7XHJcbmNvbnN0IGF6dXJlQ0ROQmxvYlN0b3JhZ2VBY2NvdW50ID0gJ2h0dHBzOi8vcHZzYy5henVyZWVkZ2UubmV0Jztcclxuc3VpdGUoJ051Z2V0IEF6dXJlIFN0b3JhZ2UgUmVwb3NpdG9yeScsICgpID0+IHtcclxuICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgbGV0IGh0dHBDbGllbnQ7XHJcbiAgICBsZXQgcmVwbztcclxuICAgIHNldHVwKCgpID0+IHtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGh0dHBDbGllbnQgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklIdHRwQ2xpZW50KSkpLnJldHVybnMoKCkgPT4gaHR0cENsaWVudC5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IG51Z2V0U2VydmljZSA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBudWdldFNlcnZpY2Uuc2V0dXAobiA9PiBuLmdldFZlcnNpb25Gcm9tUGFja2FnZUZpbGVOYW1lKHR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gbmV3IHNlbXZlcl8xLlNlbVZlcignMS4xLjEnKSk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklOdWdldFNlcnZpY2UpKSkucmV0dXJucygoKSA9PiBudWdldFNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBjb25zdCBkZWZhdWx0U3RvcmFnZUNoYW5uZWwgPSBsYW5ndWFnZVNlcnZlclBhY2thZ2VSZXBvc2l0b3J5XzEuTGFuZ3VhZ2VTZXJ2ZXJQYWNrYWdlU3RvcmFnZUNvbnRhaW5lcnMuc3RhYmxlO1xyXG4gICAgICAgIHJlcG8gPSBuZXcgYXp1cmVCbG9iU3RvcmVOdWdldFJlcG9zaXRvcnlfMS5BenVyZUJsb2JTdG9yZU51Z2V0UmVwb3NpdG9yeShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCwgYXp1cmVCbG9iU3RvcmFnZUFjY291bnQsIGRlZmF1bHRTdG9yYWdlQ2hhbm5lbCwgYXp1cmVDRE5CbG9iU3RvcmFnZUFjY291bnQpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdHZXQgYWxsIHBhY2thZ2VzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICAgICAgdGhpcy50aW1lb3V0KDE1MDAwKTtcclxuICAgICAgICAgICAgY29uc3QgcGxhdGZvcm1TZXJ2aWNlID0gbmV3IHBsYXRmb3JtU2VydmljZV8xLlBsYXRmb3JtU2VydmljZSgpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQodHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSVBsYXRmb3JtU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHBsYXRmb3JtU2VydmljZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VKc29uID0geyBsYW5ndWFnZVNlcnZlclZlcnNpb246ICcwLjEuMCcgfTtcclxuICAgICAgICAgICAgY29uc3QgYXBwRW52ID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICBhcHBFbnYuc2V0dXAoZSA9PiBlLnBhY2thZ2VKc29uKS5yZXR1cm5zKCgpID0+IHBhY2thZ2VKc29uKTtcclxuICAgICAgICAgICAgY29uc3QgbHNQYWNrYWdlU2VydmljZSA9IG5ldyBsYW5ndWFnZVNlcnZlclBhY2thZ2VTZXJ2aWNlXzEuTGFuZ3VhZ2VTZXJ2ZXJQYWNrYWdlU2VydmljZShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCwgYXBwRW52Lm9iamVjdCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gbHNQYWNrYWdlU2VydmljZS5nZXROdWdldFBhY2thZ2VOYW1lKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VzID0geWllbGQgcmVwby5nZXRQYWNrYWdlcyhwYWNrYWdlTmFtZSk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QocGFja2FnZXMpLnRvLmJlLmxlbmd0aC5ncmVhdGVyVGhhbigwKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXp1cmVCb2JTdG9yZVJlcG9zaXRvcnkudGVzdC5qcy5tYXAiXX0=