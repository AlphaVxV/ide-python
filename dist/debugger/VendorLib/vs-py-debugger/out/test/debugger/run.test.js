// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:no-invalid-this no-require-imports no-require-imports no-var-requires

const chai_1 = require("chai");

const path = require("path");

const constants_1 = require("../../client/common/constants");

const misc_1 = require("../../client/common/utils/misc");

const constants_2 = require("../../client/debugger/constants");

const types_1 = require("../../client/debugger/types");

const common_1 = require("../common");

const initialize_1 = require("../initialize");

const utils_1 = require("./utils");

const isProcessRunning = require('is-running');

const debugFilesPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'debugging');
const debuggerType = constants_2.DebuggerTypeName;
suite('Run without Debugging', () => {
  let debugClient;
  setup(function () {
    return __awaiter(this, void 0, void 0, function* () {
      if (!initialize_1.IS_MULTI_ROOT_TEST || !initialize_1.TEST_DEBUGGER) {
        this.skip();
      }

      yield new Promise(resolve => setTimeout(resolve, 1000));
      const coverageDirectory = path.join(constants_1.EXTENSION_ROOT_DIR, `debug_coverage_nodebug${this.currentTest.title}`);
      debugClient = yield utils_1.createDebugAdapter(coverageDirectory);
    });
  });
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    // Wait for a second before starting another test (sometimes, sockets take a while to get closed).
    yield common_1.sleep(1000);

    try {
      yield debugClient.stop().catch(misc_1.noop); // tslint:disable-next-line:no-empty
    } catch (ex) {}

    yield common_1.sleep(1000);
  }));

  function buildLaunchArgs(pythonFile, stopOnEntry = false, showReturnValue = false) {
    // tslint:disable-next-line:no-unnecessary-local-variable
    return {
      program: path.join(debugFilesPath, pythonFile),
      cwd: debugFilesPath,
      stopOnEntry,
      showReturnValue,
      noDebug: true,
      debugOptions: [types_1.DebugOptions.RedirectOutput],
      pythonPath: common_1.PYTHON_PATH,
      args: [],
      env: {
        PYTHONPATH: constants_2.PTVSD_PATH
      },
      envFile: '',
      logToFile: false,
      type: debuggerType,
      name: '',
      request: 'launch'
    };
  }

  test('Should run program to the end', () => __awaiter(void 0, void 0, void 0, function* () {
    yield Promise.all([debugClient.configurationSequence(), debugClient.launch(buildLaunchArgs('simplePrint.py', false)), debugClient.waitForEvent('initialized'), debugClient.waitForEvent('terminated')]);
  }));
  test('test stderr output for Python', () => __awaiter(void 0, void 0, void 0, function* () {
    yield Promise.all([debugClient.configurationSequence(), debugClient.launch(buildLaunchArgs('stdErrOutput.py', false)), debugClient.waitForEvent('initialized'), debugClient.assertOutput('stderr', 'error output'), debugClient.waitForEvent('terminated')]);
  }));
  test('Test stdout output', () => __awaiter(void 0, void 0, void 0, function* () {
    yield Promise.all([debugClient.configurationSequence(), debugClient.launch(buildLaunchArgs('stdOutOutput.py', false)), debugClient.waitForEvent('initialized'), debugClient.assertOutput('stdout', 'normal output'), debugClient.waitForEvent('terminated')]);
  }));
  test('Should kill python process when ending debug session', function () {
    return __awaiter(this, void 0, void 0, function* () {
      const skipped = true;

      if (skipped) {
        // tslint:disable-next-line:no-suspicious-comment
        // TODO: Why was this skipped?  See gh-2308.
        return this.skip();
      }

      const processIdOutput = new Promise(resolve => {
        debugClient.on('output', event => {
          if (event.event === 'output' && event.body.category === 'stdout') {
            resolve(parseInt(event.body.output.trim(), 10));
          }
        });
      });
      yield Promise.all([debugClient.configurationSequence(), debugClient.launch(buildLaunchArgs('sampleWithSleep.py', false)), debugClient.waitForEvent('initialized'), processIdOutput]);
      const processId = yield processIdOutput;
      chai_1.expect(processId).to.be.greaterThan(0, 'Invalid process id');
      yield debugClient.stop();
      yield common_1.sleep(1000); // Confirm the process is dead

      chai_1.expect(isProcessRunning(processId)).to.be.equal(false, 'Python program is still alive');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJ1bi50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwicGF0aCIsImNvbnN0YW50c18xIiwibWlzY18xIiwiY29uc3RhbnRzXzIiLCJ0eXBlc18xIiwiY29tbW9uXzEiLCJpbml0aWFsaXplXzEiLCJ1dGlsc18xIiwiaXNQcm9jZXNzUnVubmluZyIsImRlYnVnRmlsZXNQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsImRlYnVnZ2VyVHlwZSIsIkRlYnVnZ2VyVHlwZU5hbWUiLCJzdWl0ZSIsImRlYnVnQ2xpZW50Iiwic2V0dXAiLCJJU19NVUxUSV9ST09UX1RFU1QiLCJURVNUX0RFQlVHR0VSIiwic2tpcCIsInNldFRpbWVvdXQiLCJjb3ZlcmFnZURpcmVjdG9yeSIsIkVYVEVOU0lPTl9ST09UX0RJUiIsImN1cnJlbnRUZXN0IiwidGl0bGUiLCJjcmVhdGVEZWJ1Z0FkYXB0ZXIiLCJ0ZWFyZG93biIsInNsZWVwIiwic3RvcCIsImNhdGNoIiwibm9vcCIsImV4IiwiYnVpbGRMYXVuY2hBcmdzIiwicHl0aG9uRmlsZSIsInN0b3BPbkVudHJ5Iiwic2hvd1JldHVyblZhbHVlIiwicHJvZ3JhbSIsImN3ZCIsIm5vRGVidWciLCJkZWJ1Z09wdGlvbnMiLCJEZWJ1Z09wdGlvbnMiLCJSZWRpcmVjdE91dHB1dCIsInB5dGhvblBhdGgiLCJQWVRIT05fUEFUSCIsImFyZ3MiLCJlbnYiLCJQWVRIT05QQVRIIiwiUFRWU0RfUEFUSCIsImVudkZpbGUiLCJsb2dUb0ZpbGUiLCJ0eXBlIiwibmFtZSIsInJlcXVlc3QiLCJ0ZXN0IiwiYWxsIiwiY29uZmlndXJhdGlvblNlcXVlbmNlIiwibGF1bmNoIiwid2FpdEZvckV2ZW50IiwiYXNzZXJ0T3V0cHV0Iiwic2tpcHBlZCIsInByb2Nlc3NJZE91dHB1dCIsIm9uIiwiZXZlbnQiLCJib2R5IiwiY2F0ZWdvcnkiLCJwYXJzZUludCIsIm91dHB1dCIsInRyaW0iLCJwcm9jZXNzSWQiLCJleHBlY3QiLCJ0byIsImJlIiwiZ3JlYXRlclRoYW4iLCJlcXVhbCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzNGLGFBQVNDLFFBQVQsQ0FBa0JKLEtBQWxCLEVBQXlCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQyxPQUFELENBQVQsQ0FBbUJLLEtBQW5CLENBQUQsQ0FBSjtBQUFrQyxPQUF4QyxDQUF5QyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUM5RixhQUFTRixJQUFULENBQWNJLE1BQWQsRUFBc0I7QUFBRUEsTUFBQUEsTUFBTSxDQUFDQyxJQUFQLEdBQWNULE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxL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QVosRUFBTjtBQUNBLFlBQU12QixRQUFRLENBQUNzQixLQUFULENBQWUsSUFBZixDQUFOLENBdkJnRCxDQXdCaEQ7O0FBQ0E3QixNQUFBQSxNQUFNLENBQUN1RSxNQUFQLENBQWM3RCxnQkFBZ0IsQ0FBQzRELFNBQUQsQ0FBOUIsRUFBMkNFLEVBQTNDLENBQThDQyxFQUE5QyxDQUFpREUsS0FBakQsQ0FBdUQsS0FBdkQsRUFBOEQsK0JBQTlEO0FBQ0gsS0ExQmUsQ0FBaEI7QUEyQkgsR0E1QkcsQ0FBSjtBQTZCSCxDQWhHSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIHRzbGludDpkaXNhYmxlOm5vLWludmFsaWQtdGhpcyBuby1yZXF1aXJlLWltcG9ydHMgbm8tcmVxdWlyZS1pbXBvcnRzIG5vLXZhci1yZXF1aXJlc1xyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgbWlzY18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vdXRpbHMvbWlzY1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2RlYnVnZ2VyL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGVidWdnZXIvdHlwZXNcIik7XHJcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4uL2NvbW1vblwiKTtcclxuY29uc3QgaW5pdGlhbGl6ZV8xID0gcmVxdWlyZShcIi4uL2luaXRpYWxpemVcIik7XHJcbmNvbnN0IHV0aWxzXzEgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcclxuY29uc3QgaXNQcm9jZXNzUnVubmluZyA9IHJlcXVpcmUoJ2lzLXJ1bm5pbmcnKTtcclxuY29uc3QgZGVidWdGaWxlc1BhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAnZGVidWdnaW5nJyk7XHJcbmNvbnN0IGRlYnVnZ2VyVHlwZSA9IGNvbnN0YW50c18yLkRlYnVnZ2VyVHlwZU5hbWU7XHJcbnN1aXRlKCdSdW4gd2l0aG91dCBEZWJ1Z2dpbmcnLCAoKSA9PiB7XHJcbiAgICBsZXQgZGVidWdDbGllbnQ7XHJcbiAgICBzZXR1cChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgaWYgKCFpbml0aWFsaXplXzEuSVNfTVVMVElfUk9PVF9URVNUIHx8ICFpbml0aWFsaXplXzEuVEVTVF9ERUJVR0dFUikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5za2lwKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeWllbGQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcclxuICAgICAgICAgICAgY29uc3QgY292ZXJhZ2VEaXJlY3RvcnkgPSBwYXRoLmpvaW4oY29uc3RhbnRzXzEuRVhURU5TSU9OX1JPT1RfRElSLCBgZGVidWdfY292ZXJhZ2Vfbm9kZWJ1ZyR7dGhpcy5jdXJyZW50VGVzdC50aXRsZX1gKTtcclxuICAgICAgICAgICAgZGVidWdDbGllbnQgPSB5aWVsZCB1dGlsc18xLmNyZWF0ZURlYnVnQWRhcHRlcihjb3ZlcmFnZURpcmVjdG9yeSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRlYXJkb3duKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAvLyBXYWl0IGZvciBhIHNlY29uZCBiZWZvcmUgc3RhcnRpbmcgYW5vdGhlciB0ZXN0IChzb21ldGltZXMsIHNvY2tldHMgdGFrZSBhIHdoaWxlIHRvIGdldCBjbG9zZWQpLlxyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnNsZWVwKDEwMDApO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHlpZWxkIGRlYnVnQ2xpZW50LnN0b3AoKS5jYXRjaChtaXNjXzEubm9vcCk7XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1lbXB0eVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXgpIHsgfVxyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnNsZWVwKDEwMDApO1xyXG4gICAgfSkpO1xyXG4gICAgZnVuY3Rpb24gYnVpbGRMYXVuY2hBcmdzKHB5dGhvbkZpbGUsIHN0b3BPbkVudHJ5ID0gZmFsc2UsIHNob3dSZXR1cm5WYWx1ZSA9IGZhbHNlKSB7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVubmVjZXNzYXJ5LWxvY2FsLXZhcmlhYmxlXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvZ3JhbTogcGF0aC5qb2luKGRlYnVnRmlsZXNQYXRoLCBweXRob25GaWxlKSxcclxuICAgICAgICAgICAgY3dkOiBkZWJ1Z0ZpbGVzUGF0aCxcclxuICAgICAgICAgICAgc3RvcE9uRW50cnksXHJcbiAgICAgICAgICAgIHNob3dSZXR1cm5WYWx1ZSxcclxuICAgICAgICAgICAgbm9EZWJ1ZzogdHJ1ZSxcclxuICAgICAgICAgICAgZGVidWdPcHRpb25zOiBbdHlwZXNfMS5EZWJ1Z09wdGlvbnMuUmVkaXJlY3RPdXRwdXRdLFxyXG4gICAgICAgICAgICBweXRob25QYXRoOiBjb21tb25fMS5QWVRIT05fUEFUSCxcclxuICAgICAgICAgICAgYXJnczogW10sXHJcbiAgICAgICAgICAgIGVudjogeyBQWVRIT05QQVRIOiBjb25zdGFudHNfMi5QVFZTRF9QQVRIIH0sXHJcbiAgICAgICAgICAgIGVudkZpbGU6ICcnLFxyXG4gICAgICAgICAgICBsb2dUb0ZpbGU6IGZhbHNlLFxyXG4gICAgICAgICAgICB0eXBlOiBkZWJ1Z2dlclR5cGUsXHJcbiAgICAgICAgICAgIG5hbWU6ICcnLFxyXG4gICAgICAgICAgICByZXF1ZXN0OiAnbGF1bmNoJ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICB0ZXN0KCdTaG91bGQgcnVuIHByb2dyYW0gdG8gdGhlIGVuZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgICAgIGRlYnVnQ2xpZW50LmNvbmZpZ3VyYXRpb25TZXF1ZW5jZSgpLFxyXG4gICAgICAgICAgICBkZWJ1Z0NsaWVudC5sYXVuY2goYnVpbGRMYXVuY2hBcmdzKCdzaW1wbGVQcmludC5weScsIGZhbHNlKSksXHJcbiAgICAgICAgICAgIGRlYnVnQ2xpZW50LndhaXRGb3JFdmVudCgnaW5pdGlhbGl6ZWQnKSxcclxuICAgICAgICAgICAgZGVidWdDbGllbnQud2FpdEZvckV2ZW50KCd0ZXJtaW5hdGVkJylcclxuICAgICAgICBdKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ3Rlc3Qgc3RkZXJyIG91dHB1dCBmb3IgUHl0aG9uJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgZGVidWdDbGllbnQuY29uZmlndXJhdGlvblNlcXVlbmNlKCksXHJcbiAgICAgICAgICAgIGRlYnVnQ2xpZW50LmxhdW5jaChidWlsZExhdW5jaEFyZ3MoJ3N0ZEVyck91dHB1dC5weScsIGZhbHNlKSksXHJcbiAgICAgICAgICAgIGRlYnVnQ2xpZW50LndhaXRGb3JFdmVudCgnaW5pdGlhbGl6ZWQnKSxcclxuICAgICAgICAgICAgZGVidWdDbGllbnQuYXNzZXJ0T3V0cHV0KCdzdGRlcnInLCAnZXJyb3Igb3V0cHV0JyksXHJcbiAgICAgICAgICAgIGRlYnVnQ2xpZW50LndhaXRGb3JFdmVudCgndGVybWluYXRlZCcpXHJcbiAgICAgICAgXSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdUZXN0IHN0ZG91dCBvdXRwdXQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICBkZWJ1Z0NsaWVudC5jb25maWd1cmF0aW9uU2VxdWVuY2UoKSxcclxuICAgICAgICAgICAgZGVidWdDbGllbnQubGF1bmNoKGJ1aWxkTGF1bmNoQXJncygnc3RkT3V0T3V0cHV0LnB5JywgZmFsc2UpKSxcclxuICAgICAgICAgICAgZGVidWdDbGllbnQud2FpdEZvckV2ZW50KCdpbml0aWFsaXplZCcpLFxyXG4gICAgICAgICAgICBkZWJ1Z0NsaWVudC5hc3NlcnRPdXRwdXQoJ3N0ZG91dCcsICdub3JtYWwgb3V0cHV0JyksXHJcbiAgICAgICAgICAgIGRlYnVnQ2xpZW50LndhaXRGb3JFdmVudCgndGVybWluYXRlZCcpXHJcbiAgICAgICAgXSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdTaG91bGQga2lsbCBweXRob24gcHJvY2VzcyB3aGVuIGVuZGluZyBkZWJ1ZyBzZXNzaW9uJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNraXBwZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoc2tpcHBlZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXN1c3BpY2lvdXMtY29tbWVudFxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogV2h5IHdhcyB0aGlzIHNraXBwZWQ/ICBTZWUgZ2gtMjMwOC5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNraXAoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzSWRPdXRwdXQgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgICAgIGRlYnVnQ2xpZW50Lm9uKCdvdXRwdXQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZXZlbnQgPT09ICdvdXRwdXQnICYmIGV2ZW50LmJvZHkuY2F0ZWdvcnkgPT09ICdzdGRvdXQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocGFyc2VJbnQoZXZlbnQuYm9keS5vdXRwdXQudHJpbSgpLCAxMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgeWllbGQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICAgICAgZGVidWdDbGllbnQuY29uZmlndXJhdGlvblNlcXVlbmNlKCksXHJcbiAgICAgICAgICAgICAgICBkZWJ1Z0NsaWVudC5sYXVuY2goYnVpbGRMYXVuY2hBcmdzKCdzYW1wbGVXaXRoU2xlZXAucHknLCBmYWxzZSkpLFxyXG4gICAgICAgICAgICAgICAgZGVidWdDbGllbnQud2FpdEZvckV2ZW50KCdpbml0aWFsaXplZCcpLFxyXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0lkT3V0cHV0XHJcbiAgICAgICAgICAgIF0pO1xyXG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzSWQgPSB5aWVsZCBwcm9jZXNzSWRPdXRwdXQ7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QocHJvY2Vzc0lkKS50by5iZS5ncmVhdGVyVGhhbigwLCAnSW52YWxpZCBwcm9jZXNzIGlkJyk7XHJcbiAgICAgICAgICAgIHlpZWxkIGRlYnVnQ2xpZW50LnN0b3AoKTtcclxuICAgICAgICAgICAgeWllbGQgY29tbW9uXzEuc2xlZXAoMTAwMCk7XHJcbiAgICAgICAgICAgIC8vIENvbmZpcm0gdGhlIHByb2Nlc3MgaXMgZGVhZFxyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGlzUHJvY2Vzc1J1bm5pbmcocHJvY2Vzc0lkKSkudG8uYmUuZXF1YWwoZmFsc2UsICdQeXRob24gcHJvZ3JhbSBpcyBzdGlsbCBhbGl2ZScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ydW4udGVzdC5qcy5tYXAiXX0=