// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length

const chai_1 = require("chai");

const typemoq = require("typemoq");

const filter_1 = require("../../../client/application/diagnostics/filter");

const types_1 = require("../../../client/application/diagnostics/types");

const types_2 = require("../../../client/common/types");

suite('Application Diagnostics - Filter', () => {
  let globalState;
  let workspaceState;
  [{
    name: 'Global',
    scope: types_1.DiagnosticScope.Global,
    state: () => globalState,
    otherState: () => workspaceState
  }, {
    name: 'Workspace',
    scope: types_1.DiagnosticScope.WorkspaceFolder,
    state: () => workspaceState,
    otherState: () => globalState
  }].forEach(item => {
    let serviceContainer;
    let filterService;
    setup(() => {
      globalState = typemoq.Mock.ofType();
      workspaceState = typemoq.Mock.ofType();
      serviceContainer = typemoq.Mock.ofType();
      const stateFactory = typemoq.Mock.ofType();
      stateFactory.setup(f => f.createGlobalPersistentState(typemoq.It.isValue(filter_1.FilterKeys.GlobalDiagnosticFilter), typemoq.It.isValue([]))).returns(() => globalState.object);
      stateFactory.setup(f => f.createWorkspacePersistentState(typemoq.It.isValue(filter_1.FilterKeys.WorkspaceDiagnosticFilter), typemoq.It.isValue([]))).returns(() => workspaceState.object);
      serviceContainer.setup(s => s.get(typemoq.It.isValue(types_2.IPersistentStateFactory))).returns(() => stateFactory.object);
      filterService = new filter_1.DiagnosticFilterService(serviceContainer.object);
    });
    test(`ignoreDiagnostic must save codes in ${item.name} Persistent State`, () => __awaiter(void 0, void 0, void 0, function* () {
      const code = 'xyz';
      item.state().setup(g => g.value).returns(() => []).verifiable(typemoq.Times.once());
      item.state().setup(g => g.updateValue(typemoq.It.isValue([code]))).verifiable(typemoq.Times.once());
      item.otherState().setup(g => g.value).verifiable(typemoq.Times.never());
      item.otherState().setup(g => g.updateValue(typemoq.It.isAny())).verifiable(typemoq.Times.never());
      yield filterService.ignoreDiagnostic(code, item.scope);
      item.state().verifyAll();
    }));
    test('shouldIgnoreDiagnostic should return \'false\' when code does not exist in any State', () => __awaiter(void 0, void 0, void 0, function* () {
      const code = 'xyz';
      item.state().setup(g => g.value).returns(() => []).verifiable(typemoq.Times.once());
      item.otherState().setup(g => g.value).returns(() => []).verifiable(typemoq.Times.once());
      const ignore = yield filterService.shouldIgnoreDiagnostic(code);
      chai_1.expect(ignore).to.be.equal(false, 'Incorrect value');
      item.state().verifyAll();
    }));
    test(`shouldIgnoreDiagnostic should return \'true\' when code exist in ${item.name} State`, () => __awaiter(void 0, void 0, void 0, function* () {
      const code = 'xyz';
      item.state().setup(g => g.value).returns(() => ['a', 'b', 'c', code]).verifiable(typemoq.Times.once());
      item.otherState().setup(g => g.value).returns(() => []).verifiable(typemoq.Times.once());
      const ignore = yield filterService.shouldIgnoreDiagnostic(code);
      chai_1.expect(ignore).to.be.equal(true, 'Incorrect value');
      item.state().verifyAll();
    }));
    test('shouldIgnoreDiagnostic should return \'true\' when code exist in any State', () => __awaiter(void 0, void 0, void 0, function* () {
      const code = 'xyz';
      item.state().setup(g => g.value).returns(() => []).verifiable(typemoq.Times.atLeast(0));
      item.otherState().setup(g => g.value).returns(() => ['a', 'b', 'c', code]).verifiable(typemoq.Times.atLeast(0));
      const ignore = yield filterService.shouldIgnoreDiagnostic(code);
      chai_1.expect(ignore).to.be.equal(true, 'Incorrect value');
      item.state().verifyAll();
    }));
    test(`ignoreDiagnostic must append codes in ${item.name} Persistent State`, () => __awaiter(void 0, void 0, void 0, function* () {
      const code = 'xyz';
      const currentState = ['a', 'b', 'c'];
      item.state().setup(g => g.value).returns(() => currentState).verifiable(typemoq.Times.atLeastOnce());
      item.state().setup(g => g.updateValue(typemoq.It.isAny())).callback(value => {
        chai_1.expect(value).to.deep.equal(currentState.concat([code]));
      }).verifiable(typemoq.Times.atLeastOnce());
      item.otherState().setup(g => g.value).verifiable(typemoq.Times.never());
      item.otherState().setup(g => g.updateValue(typemoq.It.isAny())).verifiable(typemoq.Times.never());
      yield filterService.ignoreDiagnostic(code, item.scope);
      item.state().verifyAll();
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbHRlci51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImNoYWlfMSIsInJlcXVpcmUiLCJ0eXBlbW9xIiwiZmlsdGVyXzEiLCJ0eXBlc18xIiwidHlwZXNfMiIsInN1aXRlIiwiZ2xvYmFsU3RhdGUiLCJ3b3Jrc3BhY2VTdGF0ZSIsIm5hbWUiLCJzY29wZSIsIkRpYWdub3N0aWNTY29wZSIsIkdsb2JhbCIsInN0YXRlIiwib3RoZXJTdGF0ZSIsIldvcmtzcGFjZUZvbGRlciIsImZvckVhY2giLCJpdGVtIiwic2VydmljZUNvbnRhaW5lciIsImZpbHRlclNlcnZpY2UiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJzdGF0ZUZhY3RvcnkiLCJmIiwiY3JlYXRlR2xvYmFsUGVyc2lzdGVudFN0YXRlIiwiSXQiLCJpc1ZhbHVlIiwiRmlsdGVyS2V5cyIsIkdsb2JhbERpYWdub3N0aWNGaWx0ZXIiLCJyZXR1cm5zIiwib2JqZWN0IiwiY3JlYXRlV29ya3NwYWNlUGVyc2lzdGVudFN0YXRlIiwiV29ya3NwYWNlRGlhZ25vc3RpY0ZpbHRlciIsInMiLCJnZXQiLCJJUGVyc2lzdGVudFN0YXRlRmFjdG9yeSIsIkRpYWdub3N0aWNGaWx0ZXJTZXJ2aWNlIiwidGVzdCIsImNvZGUiLCJnIiwidmVyaWZpYWJsZSIsIlRpbWVzIiwib25jZSIsInVwZGF0ZVZhbHVlIiwibmV2ZXIiLCJpc0FueSIsImlnbm9yZURpYWdub3N0aWMiLCJ2ZXJpZnlBbGwiLCJpZ25vcmUiLCJzaG91bGRJZ25vcmVEaWFnbm9zdGljIiwiZXhwZWN0IiwidG8iLCJiZSIsImVxdWFsIiwiYXRMZWFzdCIsImN1cnJlbnRTdGF0ZSIsImF0TGVhc3RPbmNlIiwiY2FsbGJhY2siLCJkZWVwIiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8sSUFBckQsQ0FBMERSLFNBQTFELEVBQXFF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IEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIHRzbGludDpkaXNhYmxlOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbmNvbnN0IGNoYWlfMSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCB0eXBlbW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IGZpbHRlcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9hcHBsaWNhdGlvbi9kaWFnbm9zdGljcy9maWx0ZXJcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2FwcGxpY2F0aW9uL2RpYWdub3N0aWNzL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbnN1aXRlKCdBcHBsaWNhdGlvbiBEaWFnbm9zdGljcyAtIEZpbHRlcicsICgpID0+IHtcclxuICAgIGxldCBnbG9iYWxTdGF0ZTtcclxuICAgIGxldCB3b3Jrc3BhY2VTdGF0ZTtcclxuICAgIFtcclxuICAgICAgICB7IG5hbWU6ICdHbG9iYWwnLCBzY29wZTogdHlwZXNfMS5EaWFnbm9zdGljU2NvcGUuR2xvYmFsLCBzdGF0ZTogKCkgPT4gZ2xvYmFsU3RhdGUsIG90aGVyU3RhdGU6ICgpID0+IHdvcmtzcGFjZVN0YXRlIH0sXHJcbiAgICAgICAgeyBuYW1lOiAnV29ya3NwYWNlJywgc2NvcGU6IHR5cGVzXzEuRGlhZ25vc3RpY1Njb3BlLldvcmtzcGFjZUZvbGRlciwgc3RhdGU6ICgpID0+IHdvcmtzcGFjZVN0YXRlLCBvdGhlclN0YXRlOiAoKSA9PiBnbG9iYWxTdGF0ZSB9XHJcbiAgICBdXHJcbiAgICAgICAgLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICAgICAgbGV0IGZpbHRlclNlcnZpY2U7XHJcbiAgICAgICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgICAgICBnbG9iYWxTdGF0ZSA9IHR5cGVtb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlU3RhdGUgPSB0eXBlbW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIgPSB0eXBlbW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlRmFjdG9yeSA9IHR5cGVtb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgc3RhdGVGYWN0b3J5LnNldHVwKGYgPT4gZi5jcmVhdGVHbG9iYWxQZXJzaXN0ZW50U3RhdGUodHlwZW1vcS5JdC5pc1ZhbHVlKGZpbHRlcl8xLkZpbHRlcktleXMuR2xvYmFsRGlhZ25vc3RpY0ZpbHRlciksIHR5cGVtb3EuSXQuaXNWYWx1ZShbXSkpKVxyXG4gICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gZ2xvYmFsU3RhdGUub2JqZWN0KTtcclxuICAgICAgICAgICAgc3RhdGVGYWN0b3J5LnNldHVwKGYgPT4gZi5jcmVhdGVXb3Jrc3BhY2VQZXJzaXN0ZW50U3RhdGUodHlwZW1vcS5JdC5pc1ZhbHVlKGZpbHRlcl8xLkZpbHRlcktleXMuV29ya3NwYWNlRGlhZ25vc3RpY0ZpbHRlciksIHR5cGVtb3EuSXQuaXNWYWx1ZShbXSkpKVxyXG4gICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gd29ya3NwYWNlU3RhdGUub2JqZWN0KTtcclxuICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KHR5cGVtb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklQZXJzaXN0ZW50U3RhdGVGYWN0b3J5KSkpXHJcbiAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBzdGF0ZUZhY3Rvcnkub2JqZWN0KTtcclxuICAgICAgICAgICAgZmlsdGVyU2VydmljZSA9IG5ldyBmaWx0ZXJfMS5EaWFnbm9zdGljRmlsdGVyU2VydmljZShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGVzdChgaWdub3JlRGlhZ25vc3RpYyBtdXN0IHNhdmUgY29kZXMgaW4gJHtpdGVtLm5hbWV9IFBlcnNpc3RlbnQgU3RhdGVgLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSAneHl6JztcclxuICAgICAgICAgICAgaXRlbS5zdGF0ZSgpLnNldHVwKGcgPT4gZy52YWx1ZSkucmV0dXJucygoKSA9PiBbXSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgaXRlbS5zdGF0ZSgpLnNldHVwKGcgPT4gZy51cGRhdGVWYWx1ZSh0eXBlbW9xLkl0LmlzVmFsdWUoW2NvZGVdKSkpXHJcbiAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgIGl0ZW0ub3RoZXJTdGF0ZSgpLnNldHVwKGcgPT4gZy52YWx1ZSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICAgICAgICAgIGl0ZW0ub3RoZXJTdGF0ZSgpLnNldHVwKGcgPT4gZy51cGRhdGVWYWx1ZSh0eXBlbW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgICAgICAgICAgeWllbGQgZmlsdGVyU2VydmljZS5pZ25vcmVEaWFnbm9zdGljKGNvZGUsIGl0ZW0uc2NvcGUpO1xyXG4gICAgICAgICAgICBpdGVtLnN0YXRlKCkudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRlc3QoJ3Nob3VsZElnbm9yZURpYWdub3N0aWMgc2hvdWxkIHJldHVybiBcXCdmYWxzZVxcJyB3aGVuIGNvZGUgZG9lcyBub3QgZXhpc3QgaW4gYW55IFN0YXRlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb2RlID0gJ3h5eic7XHJcbiAgICAgICAgICAgIGl0ZW0uc3RhdGUoKS5zZXR1cChnID0+IGcudmFsdWUpLnJldHVybnMoKCkgPT4gW10pXHJcbiAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgIGl0ZW0ub3RoZXJTdGF0ZSgpLnNldHVwKGcgPT4gZy52YWx1ZSkucmV0dXJucygoKSA9PiBbXSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgY29uc3QgaWdub3JlID0geWllbGQgZmlsdGVyU2VydmljZS5zaG91bGRJZ25vcmVEaWFnbm9zdGljKGNvZGUpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGlnbm9yZSkudG8uYmUuZXF1YWwoZmFsc2UsICdJbmNvcnJlY3QgdmFsdWUnKTtcclxuICAgICAgICAgICAgaXRlbS5zdGF0ZSgpLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB0ZXN0KGBzaG91bGRJZ25vcmVEaWFnbm9zdGljIHNob3VsZCByZXR1cm4gXFwndHJ1ZVxcJyB3aGVuIGNvZGUgZXhpc3QgaW4gJHtpdGVtLm5hbWV9IFN0YXRlYCwgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb2RlID0gJ3h5eic7XHJcbiAgICAgICAgICAgIGl0ZW0uc3RhdGUoKS5zZXR1cChnID0+IGcudmFsdWUpLnJldHVybnMoKCkgPT4gWydhJywgJ2InLCAnYycsIGNvZGVdKVxyXG4gICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICBpdGVtLm90aGVyU3RhdGUoKS5zZXR1cChnID0+IGcudmFsdWUpLnJldHVybnMoKCkgPT4gW10pXHJcbiAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlnbm9yZSA9IHlpZWxkIGZpbHRlclNlcnZpY2Uuc2hvdWxkSWdub3JlRGlhZ25vc3RpYyhjb2RlKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChpZ25vcmUpLnRvLmJlLmVxdWFsKHRydWUsICdJbmNvcnJlY3QgdmFsdWUnKTtcclxuICAgICAgICAgICAgaXRlbS5zdGF0ZSgpLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB0ZXN0KCdzaG91bGRJZ25vcmVEaWFnbm9zdGljIHNob3VsZCByZXR1cm4gXFwndHJ1ZVxcJyB3aGVuIGNvZGUgZXhpc3QgaW4gYW55IFN0YXRlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBjb2RlID0gJ3h5eic7XHJcbiAgICAgICAgICAgIGl0ZW0uc3RhdGUoKS5zZXR1cChnID0+IGcudmFsdWUpLnJldHVybnMoKCkgPT4gW10pXHJcbiAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLmF0TGVhc3QoMCkpO1xyXG4gICAgICAgICAgICBpdGVtLm90aGVyU3RhdGUoKS5zZXR1cChnID0+IGcudmFsdWUpLnJldHVybnMoKCkgPT4gWydhJywgJ2InLCAnYycsIGNvZGVdKVxyXG4gICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5hdExlYXN0KDApKTtcclxuICAgICAgICAgICAgY29uc3QgaWdub3JlID0geWllbGQgZmlsdGVyU2VydmljZS5zaG91bGRJZ25vcmVEaWFnbm9zdGljKGNvZGUpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGlnbm9yZSkudG8uYmUuZXF1YWwodHJ1ZSwgJ0luY29ycmVjdCB2YWx1ZScpO1xyXG4gICAgICAgICAgICBpdGVtLnN0YXRlKCkudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRlc3QoYGlnbm9yZURpYWdub3N0aWMgbXVzdCBhcHBlbmQgY29kZXMgaW4gJHtpdGVtLm5hbWV9IFBlcnNpc3RlbnQgU3RhdGVgLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSAneHl6JztcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudFN0YXRlID0gWydhJywgJ2InLCAnYyddO1xyXG4gICAgICAgICAgICBpdGVtLnN0YXRlKCkuc2V0dXAoZyA9PiBnLnZhbHVlKS5yZXR1cm5zKCgpID0+IGN1cnJlbnRTdGF0ZSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgICAgIGl0ZW0uc3RhdGUoKS5zZXR1cChnID0+IGcudXBkYXRlVmFsdWUodHlwZW1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgICAgIC5jYWxsYmFjayh2YWx1ZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KHZhbHVlKS50by5kZWVwLmVxdWFsKGN1cnJlbnRTdGF0ZS5jb25jYXQoW2NvZGVdKSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgICAgICBpdGVtLm90aGVyU3RhdGUoKS5zZXR1cChnID0+IGcudmFsdWUpXHJcbiAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLm5ldmVyKCkpO1xyXG4gICAgICAgICAgICBpdGVtLm90aGVyU3RhdGUoKS5zZXR1cChnID0+IGcudXBkYXRlVmFsdWUodHlwZW1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICAgICAgICAgIHlpZWxkIGZpbHRlclNlcnZpY2UuaWdub3JlRGlhZ25vc3RpYyhjb2RlLCBpdGVtLnNjb3BlKTtcclxuICAgICAgICAgICAgaXRlbS5zdGF0ZSgpLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH0pO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmlsdGVyLnVuaXQudGVzdC5qcy5tYXAiXX0=