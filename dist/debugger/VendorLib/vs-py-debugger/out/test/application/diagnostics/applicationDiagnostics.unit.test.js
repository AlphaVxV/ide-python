// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:insecure-random

const typemoq = require("typemoq");

const vscode_1 = require("vscode");

const applicationDiagnostics_1 = require("../../../client/application/diagnostics/applicationDiagnostics");

const envPathVariable_1 = require("../../../client/application/diagnostics/checks/envPathVariable");

const invalidDebuggerType_1 = require("../../../client/application/diagnostics/checks/invalidDebuggerType");

const types_1 = require("../../../client/application/diagnostics/types");

const constants_1 = require("../../../client/common/constants");

const types_2 = require("../../../client/common/types"); // tslint:disable-next-line:max-func-body-length


suite('Application Diagnostics - ApplicationDiagnostics', () => {
  let serviceContainer;
  let envHealthCheck;
  let debuggerTypeCheck;
  let outputChannel;
  let logger;
  let appDiagnostics;
  setup(() => {
    serviceContainer = typemoq.Mock.ofType();
    envHealthCheck = typemoq.Mock.ofType();
    debuggerTypeCheck = typemoq.Mock.ofType();
    outputChannel = typemoq.Mock.ofType();
    logger = typemoq.Mock.ofType();
    serviceContainer.setup(d => d.get(typemoq.It.isValue(types_1.IDiagnosticsService), typemoq.It.isValue(envPathVariable_1.EnvironmentPathVariableDiagnosticsServiceId))).returns(() => envHealthCheck.object);
    serviceContainer.setup(d => d.get(typemoq.It.isValue(types_1.IDiagnosticsService), typemoq.It.isValue(invalidDebuggerType_1.InvalidDebuggerTypeDiagnosticsServiceId))).returns(() => debuggerTypeCheck.object);
    serviceContainer.setup(d => d.getAll(typemoq.It.isValue(types_1.IDiagnosticsService))).returns(() => [envHealthCheck.object, debuggerTypeCheck.object]);
    serviceContainer.setup(d => d.get(typemoq.It.isValue(types_2.IOutputChannel), typemoq.It.isValue(constants_1.STANDARD_OUTPUT_CHANNEL))).returns(() => outputChannel.object);
    serviceContainer.setup(d => d.get(typemoq.It.isValue(types_2.ILogger))).returns(() => logger.object);
    appDiagnostics = new applicationDiagnostics_1.ApplicationDiagnostics(serviceContainer.object);
  });
  test('Performing Pre Startup Health Check must check Path environment variable and Debugger Type', () => __awaiter(void 0, void 0, void 0, function* () {
    envHealthCheck.setup(e => e.diagnose()).returns(() => Promise.resolve([])).verifiable(typemoq.Times.once());
    debuggerTypeCheck.setup(e => e.diagnose()).returns(() => Promise.resolve([])).verifiable(typemoq.Times.once());
    yield appDiagnostics.performPreStartupHealthCheck();
    envHealthCheck.verifyAll();
    debuggerTypeCheck.verifyAll();
  }));
  test('Diagnostics Returned by Per Startup Health Checks must be logged', () => __awaiter(void 0, void 0, void 0, function* () {
    const diagnostics = [];

    for (let i = 0; i <= Math.random() * 10; i += 1) {
      const diagnostic = {
        code: `Error${i}`,
        message: `Error${i}`,
        scope: i % 2 === 0 ? types_1.DiagnosticScope.Global : types_1.DiagnosticScope.WorkspaceFolder,
        severity: vscode_1.DiagnosticSeverity.Error
      };
      diagnostics.push(diagnostic);
    }

    for (let i = 0; i <= Math.random() * 10; i += 1) {
      const diagnostic = {
        code: `Warning${i}`,
        message: `Warning${i}`,
        scope: i % 2 === 0 ? types_1.DiagnosticScope.Global : types_1.DiagnosticScope.WorkspaceFolder,
        severity: vscode_1.DiagnosticSeverity.Warning
      };
      diagnostics.push(diagnostic);
    }

    for (let i = 0; i <= Math.random() * 10; i += 1) {
      const diagnostic = {
        code: `Info${i}`,
        message: `Info${i}`,
        scope: i % 2 === 0 ? types_1.DiagnosticScope.Global : types_1.DiagnosticScope.WorkspaceFolder,
        severity: vscode_1.DiagnosticSeverity.Information
      };
      diagnostics.push(diagnostic);
    }

    for (const diagnostic of diagnostics) {
      const message = `Diagnostic Code: ${diagnostic.code}, Message: ${diagnostic.message}`;

      switch (diagnostic.severity) {
        case vscode_1.DiagnosticSeverity.Error:
          {
            logger.setup(l => l.logError(message)).verifiable(typemoq.Times.once());
            outputChannel.setup(o => o.appendLine(message)).verifiable(typemoq.Times.once());
            break;
          }

        case vscode_1.DiagnosticSeverity.Warning:
          {
            logger.setup(l => l.logWarning(message)).verifiable(typemoq.Times.once());
            outputChannel.setup(o => o.appendLine(message)).verifiable(typemoq.Times.once());
            break;
          }

        default:
          {
            logger.setup(l => l.logInformation(message)).verifiable(typemoq.Times.once());
            break;
          }
      }
    }

    envHealthCheck.setup(e => e.diagnose()).returns(() => Promise.resolve(diagnostics)).verifiable(typemoq.Times.once());
    debuggerTypeCheck.setup(e => e.diagnose()).returns(() => Promise.resolve([])).verifiable(typemoq.Times.once());
    yield appDiagnostics.performPreStartupHealthCheck();
    envHealthCheck.verifyAll();
    debuggerTypeCheck.verifyAll();
    outputChannel.verifyAll();
    logger.verifyAll();
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uRGlhZ25vc3RpY3MudW5pdC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ0eXBlbW9xIiwicmVxdWlyZSIsInZzY29kZV8xIiwiYXBwbGljYXRpb25EaWFnbm9zdGljc18xIiwiZW52UGF0aFZhcmlhYmxlXzEiLCJpbnZhbGlkRGVidWdnZXJUeXBlXzEiLCJ0eXBlc18xIiwiY29uc3RhbnRzXzEiLCJ0eXBlc18yIiwic3VpdGUiLCJzZXJ2aWNlQ29udGFpbmVyIiwiZW52SGVhbHRoQ2hlY2siLCJkZWJ1Z2dlclR5cGVDaGVjayIsIm91dHB1dENoYW5uZWwiLCJsb2dnZXIiLCJhcHBEaWFnbm9zdGljcyIsInNldHVwIiwiTW9jayIsIm9mVHlwZSIsImQiLCJnZXQiLCJJdCIsImlzVmFsdWUiLCJJRGlhZ25vc3RpY3NTZXJ2aWNlIiwiRW52aXJvbm1lbnRQYXRoVmFyaWFibGVEaWFnbm9zdGljc1NlcnZpY2VJZCIsInJldHVybnMiLCJvYmplY3QiLCJJbnZhbGlkRGVidWdnZXJUeXBlRGlhZ25vc3RpY3NTZXJ2aWNlSWQiLCJnZXRBbGwiLCJJT3V0cHV0Q2hhbm5lbCIsIlNUQU5EQVJEX09VVFBVVF9DSEFOTkVMIiwiSUxvZ2dlciIsIkFwcGxpY2F0aW9uRGlhZ25vc3RpY3MiLCJ0ZXN0IiwiZGlhZ25vc2UiLCJ2ZXJpZmlhYmxlIiwiVGltZXMiLCJvbmNlIiwicGVyZm9ybVByZVN0YXJ0dXBIZWFsdGhDaGVjayIsInZlcmlmeUFsbCIsImRpYWdub3N0aWNzIiwiaSIsIk1hdGgiLCJyYW5kb20iLCJkaWFnbm9zdGljIiwiY29kZSIsIm1lc3NhZ2UiLCJzY29wZSIsIkRpYWdub3N0aWNTY29wZSIsIkdsb2JhbCIsIldvcmtzcGFjZUZvbGRlciIsInNldmVyaXR5IiwiRGlhZ25vc3RpY1NldmVyaXR5IiwiRXJyb3IiLCJwdXNoIiwiV2FybmluZyIsIkluZm9ybWF0aW9uIiwibCIsImxvZ0Vycm9yIiwibyIsImFwcGVuZExpbmUiLCJsb2dXYXJuaW5nIiwibG9nSW5mb3JtYXRpb24iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFy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bkJMO0FBcUJIOztBQUNEMUIsSUFBQUEsY0FBYyxDQUFDSyxLQUFmLENBQXFCekIsQ0FBQyxJQUFJQSxDQUFDLENBQUMyQyxRQUFGLEVBQTFCLEVBQ0tULE9BREwsQ0FDYSxNQUFNekMsT0FBTyxDQUFDQyxPQUFSLENBQWdCdUQsV0FBaEIsQ0FEbkIsRUFFS0wsVUFGTCxDQUVnQm5DLE9BQU8sQ0FBQ29DLEtBQVIsQ0FBY0MsSUFBZCxFQUZoQjtBQUdBekIsSUFBQUEsaUJBQWlCLENBQUNJLEtBQWxCLENBQXdCekIsQ0FBQyxJQUFJQSxDQUFDLENBQUMyQyxRQUFGLEVBQTdCLEVBQ0tULE9BREwsQ0FDYSxNQUFNekMsT0FBTyxDQUFDQyxPQUFSLENBQWdCLEVBQWhCLENBRG5CLEVBRUtrRCxVQUZMLENBRWdCbkMsT0FBTyxDQUFDb0MsS0FBUixDQUFjQyxJQUFkLEVBRmhCO0FBR0EsVUFBTXRCLGNBQWMsQ0FBQ3VCLDRCQUFmLEVBQU47QUFDQTNCLElBQUFBLGNBQWMsQ0FBQzRCLFNBQWY7QUFDQTNCLElBQUFBLGlCQUFpQixDQUFDMkIsU0FBbEI7QUFDQTFCLElBQUFBLGFBQWEsQ0FBQzBCLFNBQWQ7QUFDQXpCLElBQUFBLE1BQU0sQ0FBQ3lCLFNBQVA7QUFDSCxHQWhFdUYsQ0FBcEYsQ0FBSjtBQWlFSCxDQXJHSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIHRzbGludDpkaXNhYmxlOmluc2VjdXJlLXJhbmRvbVxyXG5jb25zdCB0eXBlbW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgYXBwbGljYXRpb25EaWFnbm9zdGljc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9hcHBsaWNhdGlvbi9kaWFnbm9zdGljcy9hcHBsaWNhdGlvbkRpYWdub3N0aWNzXCIpO1xyXG5jb25zdCBlbnZQYXRoVmFyaWFibGVfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvYXBwbGljYXRpb24vZGlhZ25vc3RpY3MvY2hlY2tzL2VudlBhdGhWYXJpYWJsZVwiKTtcclxuY29uc3QgaW52YWxpZERlYnVnZ2VyVHlwZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9hcHBsaWNhdGlvbi9kaWFnbm9zdGljcy9jaGVja3MvaW52YWxpZERlYnVnZ2VyVHlwZVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvYXBwbGljYXRpb24vZGlhZ25vc3RpY3MvdHlwZXNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5zdWl0ZSgnQXBwbGljYXRpb24gRGlhZ25vc3RpY3MgLSBBcHBsaWNhdGlvbkRpYWdub3N0aWNzJywgKCkgPT4ge1xyXG4gICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICBsZXQgZW52SGVhbHRoQ2hlY2s7XHJcbiAgICBsZXQgZGVidWdnZXJUeXBlQ2hlY2s7XHJcbiAgICBsZXQgb3V0cHV0Q2hhbm5lbDtcclxuICAgIGxldCBsb2dnZXI7XHJcbiAgICBsZXQgYXBwRGlhZ25vc3RpY3M7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lciA9IHR5cGVtb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBlbnZIZWFsdGhDaGVjayA9IHR5cGVtb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBkZWJ1Z2dlclR5cGVDaGVjayA9IHR5cGVtb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBvdXRwdXRDaGFubmVsID0gdHlwZW1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGxvZ2dlciA9IHR5cGVtb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGQgPT4gZC5nZXQodHlwZW1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSURpYWdub3N0aWNzU2VydmljZSksIHR5cGVtb3EuSXQuaXNWYWx1ZShlbnZQYXRoVmFyaWFibGVfMS5FbnZpcm9ubWVudFBhdGhWYXJpYWJsZURpYWdub3N0aWNzU2VydmljZUlkKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IGVudkhlYWx0aENoZWNrLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChkID0+IGQuZ2V0KHR5cGVtb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklEaWFnbm9zdGljc1NlcnZpY2UpLCB0eXBlbW9xLkl0LmlzVmFsdWUoaW52YWxpZERlYnVnZ2VyVHlwZV8xLkludmFsaWREZWJ1Z2dlclR5cGVEaWFnbm9zdGljc1NlcnZpY2VJZCkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBkZWJ1Z2dlclR5cGVDaGVjay5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoZCA9PiBkLmdldEFsbCh0eXBlbW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JRGlhZ25vc3RpY3NTZXJ2aWNlKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFtlbnZIZWFsdGhDaGVjay5vYmplY3QsIGRlYnVnZ2VyVHlwZUNoZWNrLm9iamVjdF0pO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoZCA9PiBkLmdldCh0eXBlbW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JT3V0cHV0Q2hhbm5lbCksIHR5cGVtb3EuSXQuaXNWYWx1ZShjb25zdGFudHNfMS5TVEFOREFSRF9PVVRQVVRfQ0hBTk5FTCkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBvdXRwdXRDaGFubmVsLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChkID0+IGQuZ2V0KHR5cGVtb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklMb2dnZXIpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gbG9nZ2VyLm9iamVjdCk7XHJcbiAgICAgICAgYXBwRGlhZ25vc3RpY3MgPSBuZXcgYXBwbGljYXRpb25EaWFnbm9zdGljc18xLkFwcGxpY2F0aW9uRGlhZ25vc3RpY3Moc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdQZXJmb3JtaW5nIFByZSBTdGFydHVwIEhlYWx0aCBDaGVjayBtdXN0IGNoZWNrIFBhdGggZW52aXJvbm1lbnQgdmFyaWFibGUgYW5kIERlYnVnZ2VyIFR5cGUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgZW52SGVhbHRoQ2hlY2suc2V0dXAoZSA9PiBlLmRpYWdub3NlKCkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShbXSkpXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICBkZWJ1Z2dlclR5cGVDaGVjay5zZXR1cChlID0+IGUuZGlhZ25vc2UoKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKFtdKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIHlpZWxkIGFwcERpYWdub3N0aWNzLnBlcmZvcm1QcmVTdGFydHVwSGVhbHRoQ2hlY2soKTtcclxuICAgICAgICBlbnZIZWFsdGhDaGVjay52ZXJpZnlBbGwoKTtcclxuICAgICAgICBkZWJ1Z2dlclR5cGVDaGVjay52ZXJpZnlBbGwoKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0RpYWdub3N0aWNzIFJldHVybmVkIGJ5IFBlciBTdGFydHVwIEhlYWx0aCBDaGVja3MgbXVzdCBiZSBsb2dnZWQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZGlhZ25vc3RpY3MgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAoTWF0aC5yYW5kb20oKSAqIDEwKTsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpYWdub3N0aWMgPSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlOiBgRXJyb3Ike2l9YCxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBFcnJvciR7aX1gLFxyXG4gICAgICAgICAgICAgICAgc2NvcGU6IGkgJSAyID09PSAwID8gdHlwZXNfMS5EaWFnbm9zdGljU2NvcGUuR2xvYmFsIDogdHlwZXNfMS5EaWFnbm9zdGljU2NvcGUuV29ya3NwYWNlRm9sZGVyLFxyXG4gICAgICAgICAgICAgICAgc2V2ZXJpdHk6IHZzY29kZV8xLkRpYWdub3N0aWNTZXZlcml0eS5FcnJvclxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkaWFnbm9zdGljcy5wdXNoKGRpYWdub3N0aWMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAoTWF0aC5yYW5kb20oKSAqIDEwKTsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpYWdub3N0aWMgPSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlOiBgV2FybmluZyR7aX1gLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYFdhcm5pbmcke2l9YCxcclxuICAgICAgICAgICAgICAgIHNjb3BlOiBpICUgMiA9PT0gMCA/IHR5cGVzXzEuRGlhZ25vc3RpY1Njb3BlLkdsb2JhbCA6IHR5cGVzXzEuRGlhZ25vc3RpY1Njb3BlLldvcmtzcGFjZUZvbGRlcixcclxuICAgICAgICAgICAgICAgIHNldmVyaXR5OiB2c2NvZGVfMS5EaWFnbm9zdGljU2V2ZXJpdHkuV2FybmluZ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkaWFnbm9zdGljcy5wdXNoKGRpYWdub3N0aWMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAoTWF0aC5yYW5kb20oKSAqIDEwKTsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpYWdub3N0aWMgPSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlOiBgSW5mbyR7aX1gLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYEluZm8ke2l9YCxcclxuICAgICAgICAgICAgICAgIHNjb3BlOiBpICUgMiA9PT0gMCA/IHR5cGVzXzEuRGlhZ25vc3RpY1Njb3BlLkdsb2JhbCA6IHR5cGVzXzEuRGlhZ25vc3RpY1Njb3BlLldvcmtzcGFjZUZvbGRlcixcclxuICAgICAgICAgICAgICAgIHNldmVyaXR5OiB2c2NvZGVfMS5EaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb25cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZGlhZ25vc3RpY3MucHVzaChkaWFnbm9zdGljKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChjb25zdCBkaWFnbm9zdGljIG9mIGRpYWdub3N0aWNzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgRGlhZ25vc3RpYyBDb2RlOiAke2RpYWdub3N0aWMuY29kZX0sIE1lc3NhZ2U6ICR7ZGlhZ25vc3RpYy5tZXNzYWdlfWA7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZGlhZ25vc3RpYy5zZXZlcml0eSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSB2c2NvZGVfMS5EaWFnbm9zdGljU2V2ZXJpdHkuRXJyb3I6IHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc2V0dXAobCA9PiBsLmxvZ0Vycm9yKG1lc3NhZ2UpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0Q2hhbm5lbC5zZXR1cChvID0+IG8uYXBwZW5kTGluZShtZXNzYWdlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FzZSB2c2NvZGVfMS5EaWFnbm9zdGljU2V2ZXJpdHkuV2FybmluZzoge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zZXR1cChsID0+IGwubG9nV2FybmluZyhtZXNzYWdlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dENoYW5uZWwuc2V0dXAobyA9PiBvLmFwcGVuZExpbmUobWVzc2FnZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc2V0dXAobCA9PiBsLmxvZ0luZm9ybWF0aW9uKG1lc3NhZ2UpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlbW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZW52SGVhbHRoQ2hlY2suc2V0dXAoZSA9PiBlLmRpYWdub3NlKCkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShkaWFnbm9zdGljcykpXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVtb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICBkZWJ1Z2dlclR5cGVDaGVjay5zZXR1cChlID0+IGUuZGlhZ25vc2UoKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKFtdKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZW1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIHlpZWxkIGFwcERpYWdub3N0aWNzLnBlcmZvcm1QcmVTdGFydHVwSGVhbHRoQ2hlY2soKTtcclxuICAgICAgICBlbnZIZWFsdGhDaGVjay52ZXJpZnlBbGwoKTtcclxuICAgICAgICBkZWJ1Z2dlclR5cGVDaGVjay52ZXJpZnlBbGwoKTtcclxuICAgICAgICBvdXRwdXRDaGFubmVsLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIGxvZ2dlci52ZXJpZnlBbGwoKTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcGxpY2F0aW9uRGlhZ25vc3RpY3MudW5pdC50ZXN0LmpzLm1hcCJdfQ==