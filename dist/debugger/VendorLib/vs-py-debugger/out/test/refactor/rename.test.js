// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const os_1 = require("os");

const path = require("path");

const typeMoq = require("typemoq");

const vscode_1 = require("vscode");

const constants_1 = require("../../client/common/constants");

require("../../client/common/extensions");

const decoder_1 = require("../../client/common/process/decoder");

const proc_1 = require("../../client/common/process/proc");

const pythonExecutionFactory_1 = require("../../client/common/process/pythonExecutionFactory");

const types_1 = require("../../client/common/process/types");

const types_2 = require("../../client/common/types");

const proxy_1 = require("../../client/refactor/proxy");

const common_1 = require("../common");

const initialize_1 = require("./../initialize");

suite('Refactor Rename', () => {
  const options = {
    cursorStyle: vscode_1.TextEditorCursorStyle.Line,
    insertSpaces: true,
    lineNumbers: vscode_1.TextEditorLineNumbersStyle.Off,
    tabSize: 4
  };
  let pythonSettings;
  let serviceContainer;
  suiteSetup(initialize_1.initialize);
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    pythonSettings = typeMoq.Mock.ofType();
    pythonSettings.setup(p => p.pythonPath).returns(() => common_1.PYTHON_PATH);
    const configService = typeMoq.Mock.ofType();
    configService.setup(c => c.getSettings(typeMoq.It.isAny())).returns(() => pythonSettings.object);
    const processServiceFactory = typeMoq.Mock.ofType();
    processServiceFactory.setup(p => p.create(typeMoq.It.isAny())).returns(() => Promise.resolve(new proc_1.ProcessService(new decoder_1.BufferDecoder())));
    serviceContainer = typeMoq.Mock.ofType();
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_2.IConfigurationService), typeMoq.It.isAny())).returns(() => configService.object);
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_1.IProcessServiceFactory), typeMoq.It.isAny())).returns(() => processServiceFactory.object);
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_1.IPythonExecutionFactory), typeMoq.It.isAny())).returns(() => new pythonExecutionFactory_1.PythonExecutionFactory(serviceContainer.object));
    yield initialize_1.initializeTest();
  }));
  teardown(initialize_1.closeActiveWindows);
  suiteTeardown(initialize_1.closeActiveWindows);
  test('Rename function in source without a trailing empty line', () => __awaiter(void 0, void 0, void 0, function* () {
    const sourceFile = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'refactoring', 'source folder', 'without empty line.py');
    const expectedDiff = `--- a/${path.basename(sourceFile)}${os_1.EOL}+++ b/${path.basename(sourceFile)}${os_1.EOL}@@ -1,8 +1,8 @@${os_1.EOL} import os${os_1.EOL} ${os_1.EOL}-def one():${os_1.EOL}+def three():${os_1.EOL}     return True${os_1.EOL} ${os_1.EOL} def two():${os_1.EOL}-    if one():${os_1.EOL}-        print(\"A\" + one())${os_1.EOL}+    if three():${os_1.EOL}+        print(\"A\" + three())${os_1.EOL}`.splitLines({
      removeEmptyEntries: false,
      trim: false
    });
    const proxy = new proxy_1.RefactorProxy(constants_1.EXTENSION_ROOT_DIR, pythonSettings.object, path.dirname(sourceFile), serviceContainer.object);
    const textDocument = yield vscode_1.workspace.openTextDocument(sourceFile);
    yield vscode_1.window.showTextDocument(textDocument);
    const response = yield proxy.rename(textDocument, 'three', sourceFile, new vscode_1.Range(7, 20, 7, 23), options);
    chai_1.expect(response.results).to.be.lengthOf(1);
    chai_1.expect(response.results[0].diff.splitLines({
      removeEmptyEntries: false,
      trim: false
    })).to.be.deep.equal(expectedDiff);
  }));
  test('Rename function in source with a trailing empty line', () => __awaiter(void 0, void 0, void 0, function* () {
    const sourceFile = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'refactoring', 'source folder', 'with empty line.py');
    const expectedDiff = `--- a/${path.basename(sourceFile)}${os_1.EOL}+++ b/${path.basename(sourceFile)}${os_1.EOL}@@ -1,8 +1,8 @@${os_1.EOL} import os${os_1.EOL} ${os_1.EOL}-def one():${os_1.EOL}+def three():${os_1.EOL}     return True${os_1.EOL} ${os_1.EOL} def two():${os_1.EOL}-    if one():${os_1.EOL}-        print(\"A\" + one())${os_1.EOL}+    if three():${os_1.EOL}+        print(\"A\" + three())${os_1.EOL}`.splitLines({
      removeEmptyEntries: false,
      trim: false
    });
    const proxy = new proxy_1.RefactorProxy(constants_1.EXTENSION_ROOT_DIR, pythonSettings.object, path.dirname(sourceFile), serviceContainer.object);
    const textDocument = yield vscode_1.workspace.openTextDocument(sourceFile);
    yield vscode_1.window.showTextDocument(textDocument);
    const response = yield proxy.rename(textDocument, 'three', sourceFile, new vscode_1.Range(7, 20, 7, 23), options);
    chai_1.expect(response.results).to.be.lengthOf(1);
    chai_1.expect(response.results[0].diff.splitLines({
      removeEmptyEntries: false,
      trim: false
    })).to.be.deep.equal(expectedDiff);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbmFtZS50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwib3NfMSIsInBhdGgiLCJ0eXBlTW9xIiwidnNjb2RlXzEiLCJjb25zdGFudHNfMSIsImRlY29kZXJfMSIsInByb2NfMSIsInB5dGhvbkV4ZWN1dGlvbkZhY3RvcnlfMSIsInR5cGVzXzEiLCJ0eXBlc18yIiwicHJveHlfMSIsImNvbW1vbl8xIiwiaW5pdGlhbGl6ZV8xIiwic3VpdGUiLCJvcHRpb25zIiwiY3Vyc29yU3R5bGUiLCJUZXh0RWRpdG9yQ3Vyc29yU3R5bGUiLCJMaW5lIiwiaW5zZXJ0U3BhY2VzIiwibGluZU51bWJlcnMiLCJUZXh0RWRpdG9yTGluZU51bWJlcnNTdHlsZSIsIk9mZiIsInRhYlNpemUiLCJweXRob25TZXR0aW5ncyIsInNlcnZpY2VDb250YWluZXIiLCJzdWl0ZVNldHVwIiwiaW5pdGlhbGl6ZSIsInNldHVwIiwiTW9jayIsIm9mVHlwZSIsInAiLCJweXRob25QYXRoIiwicmV0dXJucyIsIlBZVEhPTl9QQVRIIiwiY29uZmlnU2VydmljZSIsImMiLCJnZXRTZXR0aW5ncyIsIkl0IiwiaXNBbnkiLCJvYmplY3QiLCJwcm9jZXNzU2VydmljZUZhY3RvcnkiLCJjcmVhdGUiLCJQcm9jZXNzU2VydmljZSIsIkJ1ZmZlckRlY29kZXIiLCJzIiwiZ2V0IiwiaXNWYWx1ZSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsIklQcm9jZXNzU2VydmljZUZhY3RvcnkiLCJJUHl0aG9uRXhlY3V0aW9uRmFjdG9yeSIsIlB5dGhvbkV4ZWN1dGlvbkZhY3RvcnkiLCJpbml0aWFsaXplVGVzdCIsInRlYXJkb3duIiwiY2xvc2VBY3RpdmVXaW5kb3dzIiwic3VpdGVUZWFyZG93biIsInRlc3QiLCJzb3VyY2VGaWxlIiwiam9pbiIsIkVYVEVOU0lPTl9ST09UX0RJUiIsImV4cGVjdGVkRGlmZiIsImJhc2VuYW1lIiwiRU9MIiwic3BsaXRMaW5lcyIsInJlbW92ZUVtcHR5RW50cmllcyIsInRyaW0iLCJwcm94eSIsIlJlZmFjdG9yUHJveHkiLCJkaXJuYW1lIiwidGV4dERvY3VtZW50Iiwid29ya3NwYWNlIiwib3BlblRleHREb2N1bWVudCIsIndpbmRvdyIsInNob3dUZXh0RG9jdW1lbnQiLCJyZXNwb25zZSIsInJlbmFtZSIsIlJhbmdlIiwiZXhwZWN0IiwicmVzdWx0cyIsInRvIiwiYmUiLCJsZW5ndGhPZiIsImRpZmYiLCJkZWVwIiwiZXF1YWwiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1C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bkIsVUFBekIsQ0FBb0M7QUFBRUMsTUFBQUEsa0JBQWtCLEVBQUUsS0FBdEI7QUFBNkJDLE1BQUFBLElBQUksRUFBRTtBQUFuQyxLQUFwQyxDQUFkLEVBQStGYyxFQUEvRixDQUFrR0MsRUFBbEcsQ0FBcUdHLElBQXJHLENBQTBHQyxLQUExRyxDQUFnSHhCLFlBQWhIO0FBQ0gsR0FWMkUsQ0FBeEUsQ0FBSjtBQVdILENBMUNJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IG9zXzEgPSByZXF1aXJlKFwib3NcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5yZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9leHRlbnNpb25zXCIpO1xyXG5jb25zdCBkZWNvZGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL2RlY29kZXJcIik7XHJcbmNvbnN0IHByb2NfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3Byb2Nlc3MvcHJvY1wiKTtcclxuY29uc3QgcHl0aG9uRXhlY3V0aW9uRmFjdG9yeV8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy9weXRob25FeGVjdXRpb25GYWN0b3J5XCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBwcm94eV8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9yZWZhY3Rvci9wcm94eVwiKTtcclxuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi8uLi9pbml0aWFsaXplXCIpO1xyXG5zdWl0ZSgnUmVmYWN0b3IgUmVuYW1lJywgKCkgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgY3Vyc29yU3R5bGU6IHZzY29kZV8xLlRleHRFZGl0b3JDdXJzb3JTdHlsZS5MaW5lLCBpbnNlcnRTcGFjZXM6IHRydWUsIGxpbmVOdW1iZXJzOiB2c2NvZGVfMS5UZXh0RWRpdG9yTGluZU51bWJlcnNTdHlsZS5PZmYsIHRhYlNpemU6IDQgfTtcclxuICAgIGxldCBweXRob25TZXR0aW5ncztcclxuICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgc3VpdGVTZXR1cChpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSk7XHJcbiAgICBzZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgcHl0aG9uU2V0dGluZ3MgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgcHl0aG9uU2V0dGluZ3Muc2V0dXAocCA9PiBwLnB5dGhvblBhdGgpLnJldHVybnMoKCkgPT4gY29tbW9uXzEuUFlUSE9OX1BBVEgpO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZ1NlcnZpY2UgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uZmlnU2VydmljZS5zZXR1cChjID0+IGMuZ2V0U2V0dGluZ3ModHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBweXRob25TZXR0aW5ncy5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IHByb2Nlc3NTZXJ2aWNlRmFjdG9yeSA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBwcm9jZXNzU2VydmljZUZhY3Rvcnkuc2V0dXAocCA9PiBwLmNyZWF0ZSh0eXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpKSkpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklDb25maWd1cmF0aW9uU2VydmljZSksIHR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAocyA9PiBzLmdldCh0eXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JUHJvY2Vzc1NlcnZpY2VGYWN0b3J5KSwgdHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBwcm9jZXNzU2VydmljZUZhY3Rvcnkub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKHMgPT4gcy5nZXQodHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSVB5dGhvbkV4ZWN1dGlvbkZhY3RvcnkpLCB0eXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IG5ldyBweXRob25FeGVjdXRpb25GYWN0b3J5XzEuUHl0aG9uRXhlY3V0aW9uRmFjdG9yeShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCkpO1xyXG4gICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5pbml0aWFsaXplVGVzdCgpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVhcmRvd24oaW5pdGlhbGl6ZV8xLmNsb3NlQWN0aXZlV2luZG93cyk7XHJcbiAgICBzdWl0ZVRlYXJkb3duKGluaXRpYWxpemVfMS5jbG9zZUFjdGl2ZVdpbmRvd3MpO1xyXG4gICAgdGVzdCgnUmVuYW1lIGZ1bmN0aW9uIGluIHNvdXJjZSB3aXRob3V0IGEgdHJhaWxpbmcgZW1wdHkgbGluZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBzb3VyY2VGaWxlID0gcGF0aC5qb2luKGNvbnN0YW50c18xLkVYVEVOU0lPTl9ST09UX0RJUiwgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ3JlZmFjdG9yaW5nJywgJ3NvdXJjZSBmb2xkZXInLCAnd2l0aG91dCBlbXB0eSBsaW5lLnB5Jyk7XHJcbiAgICAgICAgY29uc3QgZXhwZWN0ZWREaWZmID0gYC0tLSBhLyR7cGF0aC5iYXNlbmFtZShzb3VyY2VGaWxlKX0ke29zXzEuRU9MfSsrKyBiLyR7cGF0aC5iYXNlbmFtZShzb3VyY2VGaWxlKX0ke29zXzEuRU9MfUBAIC0xLDggKzEsOCBAQCR7b3NfMS5FT0x9IGltcG9ydCBvcyR7b3NfMS5FT0x9ICR7b3NfMS5FT0x9LWRlZiBvbmUoKToke29zXzEuRU9MfStkZWYgdGhyZWUoKToke29zXzEuRU9MfSAgICAgcmV0dXJuIFRydWUke29zXzEuRU9MfSAke29zXzEuRU9MfSBkZWYgdHdvKCk6JHtvc18xLkVPTH0tICAgIGlmIG9uZSgpOiR7b3NfMS5FT0x9LSAgICAgICAgcHJpbnQoXFxcIkFcXFwiICsgb25lKCkpJHtvc18xLkVPTH0rICAgIGlmIHRocmVlKCk6JHtvc18xLkVPTH0rICAgICAgICBwcmludChcXFwiQVxcXCIgKyB0aHJlZSgpKSR7b3NfMS5FT0x9YFxyXG4gICAgICAgICAgICAuc3BsaXRMaW5lcyh7IHJlbW92ZUVtcHR5RW50cmllczogZmFsc2UsIHRyaW06IGZhbHNlIH0pO1xyXG4gICAgICAgIGNvbnN0IHByb3h5ID0gbmV3IHByb3h5XzEuUmVmYWN0b3JQcm94eShjb25zdGFudHNfMS5FWFRFTlNJT05fUk9PVF9ESVIsIHB5dGhvblNldHRpbmdzLm9iamVjdCwgcGF0aC5kaXJuYW1lKHNvdXJjZUZpbGUpLCBzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgdGV4dERvY3VtZW50ID0geWllbGQgdnNjb2RlXzEud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQoc291cmNlRmlsZSk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlXzEud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIHByb3h5LnJlbmFtZSh0ZXh0RG9jdW1lbnQsICd0aHJlZScsIHNvdXJjZUZpbGUsIG5ldyB2c2NvZGVfMS5SYW5nZSg3LCAyMCwgNywgMjMpLCBvcHRpb25zKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3BvbnNlLnJlc3VsdHMpLnRvLmJlLmxlbmd0aE9mKDEpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzcG9uc2UucmVzdWx0c1swXS5kaWZmLnNwbGl0TGluZXMoeyByZW1vdmVFbXB0eUVudHJpZXM6IGZhbHNlLCB0cmltOiBmYWxzZSB9KSkudG8uYmUuZGVlcC5lcXVhbChleHBlY3RlZERpZmYpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnUmVuYW1lIGZ1bmN0aW9uIGluIHNvdXJjZSB3aXRoIGEgdHJhaWxpbmcgZW1wdHkgbGluZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBzb3VyY2VGaWxlID0gcGF0aC5qb2luKGNvbnN0YW50c18xLkVYVEVOU0lPTl9ST09UX0RJUiwgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ3JlZmFjdG9yaW5nJywgJ3NvdXJjZSBmb2xkZXInLCAnd2l0aCBlbXB0eSBsaW5lLnB5Jyk7XHJcbiAgICAgICAgY29uc3QgZXhwZWN0ZWREaWZmID0gYC0tLSBhLyR7cGF0aC5iYXNlbmFtZShzb3VyY2VGaWxlKX0ke29zXzEuRU9MfSsrKyBiLyR7cGF0aC5iYXNlbmFtZShzb3VyY2VGaWxlKX0ke29zXzEuRU9MfUBAIC0xLDggKzEsOCBAQCR7b3NfMS5FT0x9IGltcG9ydCBvcyR7b3NfMS5FT0x9ICR7b3NfMS5FT0x9LWRlZiBvbmUoKToke29zXzEuRU9MfStkZWYgdGhyZWUoKToke29zXzEuRU9MfSAgICAgcmV0dXJuIFRydWUke29zXzEuRU9MfSAke29zXzEuRU9MfSBkZWYgdHdvKCk6JHtvc18xLkVPTH0tICAgIGlmIG9uZSgpOiR7b3NfMS5FT0x9LSAgICAgICAgcHJpbnQoXFxcIkFcXFwiICsgb25lKCkpJHtvc18xLkVPTH0rICAgIGlmIHRocmVlKCk6JHtvc18xLkVPTH0rICAgICAgICBwcmludChcXFwiQVxcXCIgKyB0aHJlZSgpKSR7b3NfMS5FT0x9YFxyXG4gICAgICAgICAgICAuc3BsaXRMaW5lcyh7IHJlbW92ZUVtcHR5RW50cmllczogZmFsc2UsIHRyaW06IGZhbHNlIH0pO1xyXG4gICAgICAgIGNvbnN0IHByb3h5ID0gbmV3IHByb3h5XzEuUmVmYWN0b3JQcm94eShjb25zdGFudHNfMS5FWFRFTlNJT05fUk9PVF9ESVIsIHB5dGhvblNldHRpbmdzLm9iamVjdCwgcGF0aC5kaXJuYW1lKHNvdXJjZUZpbGUpLCBzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgdGV4dERvY3VtZW50ID0geWllbGQgdnNjb2RlXzEud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQoc291cmNlRmlsZSk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlXzEud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkIHByb3h5LnJlbmFtZSh0ZXh0RG9jdW1lbnQsICd0aHJlZScsIHNvdXJjZUZpbGUsIG5ldyB2c2NvZGVfMS5SYW5nZSg3LCAyMCwgNywgMjMpLCBvcHRpb25zKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3BvbnNlLnJlc3VsdHMpLnRvLmJlLmxlbmd0aE9mKDEpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QocmVzcG9uc2UucmVzdWx0c1swXS5kaWZmLnNwbGl0TGluZXMoeyByZW1vdmVFbXB0eUVudHJpZXM6IGZhbHNlLCB0cmltOiBmYWxzZSB9KSkudG8uYmUuZGVlcC5lcXVhbChleHBlY3RlZERpZmYpO1xyXG4gICAgfSkpO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVuYW1lLnRlc3QuanMubWFwIl19