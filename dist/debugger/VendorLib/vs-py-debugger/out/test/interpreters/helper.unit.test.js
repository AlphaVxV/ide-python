// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../client/common/application/types");

const helpers_1 = require("../../client/interpreter/helpers"); // tslint:disable-next-line:max-func-body-length


suite('Interpreters Display Helper', () => {
  let documentManager;
  let workspaceService;
  let serviceContainer;
  let helper;
  setup(() => {
    serviceContainer = TypeMoq.Mock.ofType();
    workspaceService = TypeMoq.Mock.ofType();
    documentManager = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IDocumentManager))).returns(() => documentManager.object);
    helper = new helpers_1.InterpreterHelper(serviceContainer.object);
  });
  test('getActiveWorkspaceUri should return undefined if there are no workspaces', () => {
    workspaceService.setup(w => w.workspaceFolders).returns(() => []);
    documentManager.setup(doc => doc.activeTextEditor).returns(() => undefined);
    const workspace = helper.getActiveWorkspaceUri();
    chai_1.expect(workspace).to.be.equal(undefined, 'incorrect value');
  });
  test('getActiveWorkspaceUri should return the workspace if there is only one', () => {
    const folderUri = vscode_1.Uri.file('abc'); // tslint:disable-next-line:no-any

    workspaceService.setup(w => w.workspaceFolders).returns(() => [{
      uri: folderUri
    }]);
    const workspace = helper.getActiveWorkspaceUri();
    chai_1.expect(workspace).to.be.not.equal(undefined, 'incorrect value');
    chai_1.expect(workspace.folderUri).to.be.equal(folderUri);
    chai_1.expect(workspace.configTarget).to.be.equal(vscode_1.ConfigurationTarget.Workspace);
  });
  test('getActiveWorkspaceUri should return undefined if we no active editor and have more than one workspace folder', () => {
    const folderUri = vscode_1.Uri.file('abc'); // tslint:disable-next-line:no-any

    workspaceService.setup(w => w.workspaceFolders).returns(() => [{
      uri: folderUri
    }, undefined]);
    documentManager.setup(d => d.activeTextEditor).returns(() => undefined);
    const workspace = helper.getActiveWorkspaceUri();
    chai_1.expect(workspace).to.be.equal(undefined, 'incorrect value');
  });
  test('getActiveWorkspaceUri should return undefined of the active editor does not belong to a workspace and if we have more than one workspace folder', () => {
    const folderUri = vscode_1.Uri.file('abc');
    const documentUri = vscode_1.Uri.file('file'); // tslint:disable-next-line:no-any

    workspaceService.setup(w => w.workspaceFolders).returns(() => [{
      uri: folderUri
    }, undefined]);
    const textEditor = TypeMoq.Mock.ofType();
    const document = TypeMoq.Mock.ofType();
    textEditor.setup(t => t.document).returns(() => document.object);
    document.setup(d => d.uri).returns(() => documentUri);
    documentManager.setup(d => d.activeTextEditor).returns(() => textEditor.object);
    workspaceService.setup(w => w.getWorkspaceFolder(TypeMoq.It.isValue(documentUri))).returns(() => undefined);
    const workspace = helper.getActiveWorkspaceUri();
    chai_1.expect(workspace).to.be.equal(undefined, 'incorrect value');
  });
  test('getActiveWorkspaceUri should return workspace folder of the active editor if belongs to a workspace and if we have more than one workspace folder', () => {
    const folderUri = vscode_1.Uri.file('abc');
    const documentWorkspaceFolderUri = vscode_1.Uri.file('file.abc');
    const documentUri = vscode_1.Uri.file('file'); // tslint:disable-next-line:no-any

    workspaceService.setup(w => w.workspaceFolders).returns(() => [{
      uri: folderUri
    }, undefined]);
    const textEditor = TypeMoq.Mock.ofType();
    const document = TypeMoq.Mock.ofType();
    textEditor.setup(t => t.document).returns(() => document.object);
    document.setup(d => d.uri).returns(() => documentUri);
    documentManager.setup(d => d.activeTextEditor).returns(() => textEditor.object); // tslint:disable-next-line:no-any

    workspaceService.setup(w => w.getWorkspaceFolder(TypeMoq.It.isValue(documentUri))).returns(() => {
      return {
        uri: documentWorkspaceFolderUri
      };
    });
    const workspace = helper.getActiveWorkspaceUri();
    chai_1.expect(workspace).to.be.not.equal(undefined, 'incorrect value');
    chai_1.expect(workspace.folderUri).to.be.equal(documentWorkspaceFolderUri);
    chai_1.expect(workspace.configTarget).to.be.equal(vscode_1.ConfigurationTarget.WorkspaceFolder);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlci51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjaGFpXzEiLCJyZXF1aXJlIiwiVHlwZU1vcSIsInZzY29kZV8xIiwidHlwZXNfMSIsImhlbHBlcnNfMSIsInN1aXRlIiwiZG9jdW1lbnRNYW5hZ2VyIiwid29ya3NwYWNlU2VydmljZSIsInNlcnZpY2VDb250YWluZXIiLCJoZWxwZXIiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJjIiwiZ2V0IiwiSXQiLCJpc1ZhbHVlIiwiSVdvcmtzcGFjZVNlcnZpY2UiLCJyZXR1cm5zIiwib2JqZWN0IiwiSURvY3VtZW50TWFuYWdlciIsIkludGVycHJldGVySGVscGVyIiwidGVzdCIsInciLCJ3b3Jrc3BhY2VGb2xkZXJzIiwiZG9jIiwiYWN0aXZlVGV4dEVkaXRvciIsInVuZGVmaW5lZCIsIndvcmtzcGFjZSIsImdldEFjdGl2ZVdvcmtzcGFjZVVyaSIsImV4cGVjdCIsInRvIiwiYmUiLCJlcXVhbCIsImZvbGRlclVyaSIsIlVyaSIsImZpbGUiLCJ1cmkiLCJub3QiLCJjb25maWdUYXJnZXQiLCJDb25maWd1cmF0aW9uVGFyZ2V0IiwiV29ya3NwYWNlIiwiZCIsImRvY3VtZW50VXJpIiwidGV4dEVkaXRvciIsImRvY3VtZW50IiwidCIsImdldFdvcmtzcGFjZUZvbGRlciIsImRvY3VtZW50V29ya3NwYWNlRm9sZGVyVXJpIiwiV29ya3NwYWNlRm9sZGVyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7O0FBQ0EsTUFBTUMsTUFBTSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUF0Qjs7QUFDQSxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxTQUFELENBQXZCOztBQUNB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QmEsQ0FBQyxJQUFJQSxDQUFDLENBQUN3QixrQkFBRixDQUFxQjlDLE9BQU8sQ0FBQ2MsRUFBUixDQUFXQyxPQUFYLENBQW1CMkIsV0FBbkIsQ0FBckIsQ0FBNUIsRUFBbUZ6QixPQUFuRixDQUEyRixNQUFNO0FBQUUsYUFBTztBQUFFbUIsUUFBQUEsR0FBRyxFQUFFVztBQUFQLE9BQVA7QUFBNkMsS0FBaEo7QUFDQSxVQUFNcEIsU0FBUyxHQUFHbkIsTUFBTSxDQUFDb0IscUJBQVAsRUFBbEI7QUFDQTlCLElBQUFBLE1BQU0sQ0FBQytCLE1BQVAsQ0FBY0YsU0FBZCxFQUF5QkcsRUFBekIsQ0FBNEJDLEVBQTVCLENBQStCTSxHQUEvQixDQUFtQ0wsS0FBbkMsQ0FBeUNOLFNBQXpDLEVBQW9ELGlCQUFwRDtBQUNBNUIsSUFBQUEsTUFBTSxDQUFDK0IsTUFBUCxDQUFjRixTQUFTLENBQUNNLFNBQXhCLEVBQW1DSCxFQUFuQyxDQUFzQ0MsRUFBdEMsQ0FBeUNDLEtBQXpDLENBQStDZSwwQkFBL0M7QUFDQWpELElBQUFBLE1BQU0sQ0FBQytCLE1BQVAsQ0FBY0YsU0FBUyxDQUFDVyxZQUF4QixFQUFzQ1IsRUFBdEMsQ0FBeUNDLEVBQXpDLENBQTRDQyxLQUE1QyxDQUFrRC9CLFFBQVEsQ0FBQ3NDLG1CQUFULENBQTZCUyxlQUEvRTtBQUNILEdBakJHLENBQUo7QUFrQkgsQ0FwRUksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcclxuY29uc3QgaGVscGVyc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9pbnRlcnByZXRlci9oZWxwZXJzXCIpO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ0ludGVycHJldGVycyBEaXNwbGF5IEhlbHBlcicsICgpID0+IHtcclxuICAgIGxldCBkb2N1bWVudE1hbmFnZXI7XHJcbiAgICBsZXQgd29ya3NwYWNlU2VydmljZTtcclxuICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgbGV0IGhlbHBlcjtcclxuICAgIHNldHVwKCgpID0+IHtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgZG9jdW1lbnRNYW5hZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSURvY3VtZW50TWFuYWdlcikpKS5yZXR1cm5zKCgpID0+IGRvY3VtZW50TWFuYWdlci5vYmplY3QpO1xyXG4gICAgICAgIGhlbHBlciA9IG5ldyBoZWxwZXJzXzEuSW50ZXJwcmV0ZXJIZWxwZXIoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdnZXRBY3RpdmVXb3Jrc3BhY2VVcmkgc2hvdWxkIHJldHVybiB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG5vIHdvcmtzcGFjZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcud29ya3NwYWNlRm9sZGVycykucmV0dXJucygoKSA9PiBbXSk7XHJcbiAgICAgICAgZG9jdW1lbnRNYW5hZ2VyLnNldHVwKGRvYyA9PiBkb2MuYWN0aXZlVGV4dEVkaXRvcikucmV0dXJucygoKSA9PiB1bmRlZmluZWQpO1xyXG4gICAgICAgIGNvbnN0IHdvcmtzcGFjZSA9IGhlbHBlci5nZXRBY3RpdmVXb3Jrc3BhY2VVcmkoKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHdvcmtzcGFjZSkudG8uYmUuZXF1YWwodW5kZWZpbmVkLCAnaW5jb3JyZWN0IHZhbHVlJyk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ2dldEFjdGl2ZVdvcmtzcGFjZVVyaSBzaG91bGQgcmV0dXJuIHRoZSB3b3Jrc3BhY2UgaWYgdGhlcmUgaXMgb25seSBvbmUnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZm9sZGVyVXJpID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2FiYycpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy53b3Jrc3BhY2VGb2xkZXJzKS5yZXR1cm5zKCgpID0+IFt7IHVyaTogZm9sZGVyVXJpIH1dKTtcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSBoZWxwZXIuZ2V0QWN0aXZlV29ya3NwYWNlVXJpKCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh3b3Jrc3BhY2UpLnRvLmJlLm5vdC5lcXVhbCh1bmRlZmluZWQsICdpbmNvcnJlY3QgdmFsdWUnKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHdvcmtzcGFjZS5mb2xkZXJVcmkpLnRvLmJlLmVxdWFsKGZvbGRlclVyaSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh3b3Jrc3BhY2UuY29uZmlnVGFyZ2V0KS50by5iZS5lcXVhbCh2c2NvZGVfMS5Db25maWd1cmF0aW9uVGFyZ2V0LldvcmtzcGFjZSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ2dldEFjdGl2ZVdvcmtzcGFjZVVyaSBzaG91bGQgcmV0dXJuIHVuZGVmaW5lZCBpZiB3ZSBubyBhY3RpdmUgZWRpdG9yIGFuZCBoYXZlIG1vcmUgdGhhbiBvbmUgd29ya3NwYWNlIGZvbGRlcicsICgpID0+IHtcclxuICAgICAgICBjb25zdCBmb2xkZXJVcmkgPSB2c2NvZGVfMS5VcmkuZmlsZSgnYWJjJyk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxyXG4gICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LndvcmtzcGFjZUZvbGRlcnMpLnJldHVybnMoKCkgPT4gW3sgdXJpOiBmb2xkZXJVcmkgfSwgdW5kZWZpbmVkXSk7XHJcbiAgICAgICAgZG9jdW1lbnRNYW5hZ2VyLnNldHVwKGQgPT4gZC5hY3RpdmVUZXh0RWRpdG9yKS5yZXR1cm5zKCgpID0+IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlID0gaGVscGVyLmdldEFjdGl2ZVdvcmtzcGFjZVVyaSgpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3Qod29ya3NwYWNlKS50by5iZS5lcXVhbCh1bmRlZmluZWQsICdpbmNvcnJlY3QgdmFsdWUnKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnZ2V0QWN0aXZlV29ya3NwYWNlVXJpIHNob3VsZCByZXR1cm4gdW5kZWZpbmVkIG9mIHRoZSBhY3RpdmUgZWRpdG9yIGRvZXMgbm90IGJlbG9uZyB0byBhIHdvcmtzcGFjZSBhbmQgaWYgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIHdvcmtzcGFjZSBmb2xkZXInLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZm9sZGVyVXJpID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2FiYycpO1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50VXJpID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2ZpbGUnKTtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcud29ya3NwYWNlRm9sZGVycykucmV0dXJucygoKSA9PiBbeyB1cmk6IGZvbGRlclVyaSB9LCB1bmRlZmluZWRdKTtcclxuICAgICAgICBjb25zdCB0ZXh0RWRpdG9yID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHRleHRFZGl0b3Iuc2V0dXAodCA9PiB0LmRvY3VtZW50KS5yZXR1cm5zKCgpID0+IGRvY3VtZW50Lm9iamVjdCk7XHJcbiAgICAgICAgZG9jdW1lbnQuc2V0dXAoZCA9PiBkLnVyaSkucmV0dXJucygoKSA9PiBkb2N1bWVudFVyaSk7XHJcbiAgICAgICAgZG9jdW1lbnRNYW5hZ2VyLnNldHVwKGQgPT4gZC5hY3RpdmVUZXh0RWRpdG9yKS5yZXR1cm5zKCgpID0+IHRleHRFZGl0b3Iub2JqZWN0KTtcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5nZXRXb3Jrc3BhY2VGb2xkZXIoVHlwZU1vcS5JdC5pc1ZhbHVlKGRvY3VtZW50VXJpKSkpLnJldHVybnMoKCkgPT4gdW5kZWZpbmVkKTtcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSBoZWxwZXIuZ2V0QWN0aXZlV29ya3NwYWNlVXJpKCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh3b3Jrc3BhY2UpLnRvLmJlLmVxdWFsKHVuZGVmaW5lZCwgJ2luY29ycmVjdCB2YWx1ZScpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdnZXRBY3RpdmVXb3Jrc3BhY2VVcmkgc2hvdWxkIHJldHVybiB3b3Jrc3BhY2UgZm9sZGVyIG9mIHRoZSBhY3RpdmUgZWRpdG9yIGlmIGJlbG9uZ3MgdG8gYSB3b3Jrc3BhY2UgYW5kIGlmIHdlIGhhdmUgbW9yZSB0aGFuIG9uZSB3b3Jrc3BhY2UgZm9sZGVyJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZvbGRlclVyaSA9IHZzY29kZV8xLlVyaS5maWxlKCdhYmMnKTtcclxuICAgICAgICBjb25zdCBkb2N1bWVudFdvcmtzcGFjZUZvbGRlclVyaSA9IHZzY29kZV8xLlVyaS5maWxlKCdmaWxlLmFiYycpO1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50VXJpID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2ZpbGUnKTtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcud29ya3NwYWNlRm9sZGVycykucmV0dXJucygoKSA9PiBbeyB1cmk6IGZvbGRlclVyaSB9LCB1bmRlZmluZWRdKTtcclxuICAgICAgICBjb25zdCB0ZXh0RWRpdG9yID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHRleHRFZGl0b3Iuc2V0dXAodCA9PiB0LmRvY3VtZW50KS5yZXR1cm5zKCgpID0+IGRvY3VtZW50Lm9iamVjdCk7XHJcbiAgICAgICAgZG9jdW1lbnQuc2V0dXAoZCA9PiBkLnVyaSkucmV0dXJucygoKSA9PiBkb2N1bWVudFVyaSk7XHJcbiAgICAgICAgZG9jdW1lbnRNYW5hZ2VyLnNldHVwKGQgPT4gZC5hY3RpdmVUZXh0RWRpdG9yKS5yZXR1cm5zKCgpID0+IHRleHRFZGl0b3Iub2JqZWN0KTtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuZ2V0V29ya3NwYWNlRm9sZGVyKFR5cGVNb3EuSXQuaXNWYWx1ZShkb2N1bWVudFVyaSkpKS5yZXR1cm5zKCgpID0+IHsgcmV0dXJuIHsgdXJpOiBkb2N1bWVudFdvcmtzcGFjZUZvbGRlclVyaSB9OyB9KTtcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSBoZWxwZXIuZ2V0QWN0aXZlV29ya3NwYWNlVXJpKCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh3b3Jrc3BhY2UpLnRvLmJlLm5vdC5lcXVhbCh1bmRlZmluZWQsICdpbmNvcnJlY3QgdmFsdWUnKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHdvcmtzcGFjZS5mb2xkZXJVcmkpLnRvLmJlLmVxdWFsKGRvY3VtZW50V29ya3NwYWNlRm9sZGVyVXJpKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHdvcmtzcGFjZS5jb25maWdUYXJnZXQpLnRvLmJlLmVxdWFsKHZzY29kZV8xLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlRm9sZGVyKTtcclxuICAgIH0pO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aGVscGVyLnVuaXQudGVzdC5qcy5tYXAiXX0=