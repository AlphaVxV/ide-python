"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:no-any

const chai_1 = require("chai");

const path = require("path");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../client/common/application/types");

const types_2 = require("../../client/common/platform/types");

const types_3 = require("../../client/common/process/types");

const contracts_1 = require("../../client/interpreter/contracts");

const virtualEnvs_1 = require("../../client/interpreter/virtualEnvs");

suite('Virtual environment manager', () => {
  const virtualEnvFolderName = 'virtual Env Folder Name';
  const pythonPath = path.join('a', 'b', virtualEnvFolderName, 'd', 'python');
  test('Plain Python environment suffix', () => __awaiter(void 0, void 0, void 0, function* () {
    return testSuffix(virtualEnvFolderName);
  }));
  test('Plain Python environment suffix with workspace Uri', () => __awaiter(void 0, void 0, void 0, function* () {
    return testSuffix(virtualEnvFolderName, false, vscode_1.Uri.file(path.join('1', '2', '3', '4')));
  }));
  test('Plain Python environment suffix with PipEnv', () => __awaiter(void 0, void 0, void 0, function* () {
    return testSuffix('workspaceName', true, vscode_1.Uri.file(path.join('1', '2', '3', 'workspaceName')));
  }));
  test('Use environment folder as env name', () => __awaiter(void 0, void 0, void 0, function* () {
    const serviceContainer = TypeMoq.Mock.ofType();
    serviceContainer.setup(s => s.get(TypeMoq.It.isValue(contracts_1.IPipEnvService))).returns(() => TypeMoq.Mock.ofType().object);
    const workspaceService = TypeMoq.Mock.ofType();
    workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => false);
    serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
    const venvManager = new virtualEnvs_1.VirtualEnvironmentManager(serviceContainer.object);
    const name = yield venvManager.getEnvironmentName(pythonPath);
    chai_1.expect(name).to.be.equal(virtualEnvFolderName);
  }));
  test('Use workspacec name as env name', () => __awaiter(void 0, void 0, void 0, function* () {
    const serviceContainer = TypeMoq.Mock.ofType();
    const pipEnvService = TypeMoq.Mock.ofType();
    pipEnvService.setup(p => p.isRelatedPipEnvironment(TypeMoq.It.isAny(), TypeMoq.It.isValue(pythonPath))).returns(() => Promise.resolve(true)).verifiable(TypeMoq.Times.once());
    serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_3.IProcessServiceFactory))).returns(() => TypeMoq.Mock.ofType().object);
    serviceContainer.setup(s => s.get(TypeMoq.It.isValue(contracts_1.IPipEnvService))).returns(() => pipEnvService.object);
    serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_2.IFileSystem))).returns(() => TypeMoq.Mock.ofType().object);
    const workspaceUri = vscode_1.Uri.file(path.join('root', 'sub', 'wkspace folder'));
    const workspaceFolder = {
      name: 'wkspace folder',
      index: 0,
      uri: workspaceUri
    };
    const workspaceService = TypeMoq.Mock.ofType();
    workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => true);
    workspaceService.setup(w => w.workspaceFolders).returns(() => [workspaceFolder]);
    serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
    const venvManager = new virtualEnvs_1.VirtualEnvironmentManager(serviceContainer.object);
    const name = yield venvManager.getEnvironmentName(pythonPath);
    chai_1.expect(name).to.be.equal(path.basename(workspaceUri.fsPath));
    pipEnvService.verifyAll();
  }));

  function testSuffix(expectedEnvName, isPipEnvironment = false, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      const serviceContainer = TypeMoq.Mock.ofType();
      serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_3.IProcessServiceFactory))).returns(() => TypeMoq.Mock.ofType().object);
      serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_2.IFileSystem))).returns(() => TypeMoq.Mock.ofType().object);
      const pipEnvService = TypeMoq.Mock.ofType();
      pipEnvService.setup(w => w.isRelatedPipEnvironment(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve(isPipEnvironment));
      serviceContainer.setup(s => s.get(TypeMoq.It.isValue(contracts_1.IPipEnvService))).returns(() => pipEnvService.object);
      const workspaceService = TypeMoq.Mock.ofType();
      workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => false);

      if (resource) {
        const workspaceFolder = TypeMoq.Mock.ofType();
        workspaceFolder.setup(w => w.uri).returns(() => resource);
        workspaceService.setup(w => w.getWorkspaceFolder(TypeMoq.It.isAny())).returns(() => workspaceFolder.object);
      }

      serviceContainer.setup(s => s.get(TypeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
      const venvManager = new virtualEnvs_1.VirtualEnvironmentManager(serviceContainer.object);
      const name = yield venvManager.getEnvironmentName(pythonPath, resource);
      chai_1.expect(name).to.be.equal(expectedEnvName, 'Virtual envrironment name suffix is incorrect.');
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpcnR1YWxFbnZNYW5hZ2VyLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiY2hhaV8xIiwicmVxdWlyZSIsInBhdGgiLCJUeXBlTW9xIiwidnNjb2RlXzEiLCJ0eXBlc18xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJjb250cmFjdHNfMSIsInZpcnR1YWxFbnZzXzEiLCJzdWl0ZSIsInZpcnR1YWxFbnZGb2xkZXJOYW1lIiwicHl0aG9uUGF0aCIsImpvaW4iLCJ0ZXN0IiwidGVzdFN1ZmZpeCIsIlVyaSIsImZpbGUiLCJzZXJ2aWNlQ29udGFpbmVyIiwiTW9jayIsIm9mVHlwZSIsInNldHVwIiwicyIsImdldCIsIkl0IiwiaXNWYWx1ZSIsIklQaXBFbnZTZXJ2aWNlIiwicmV0dXJucyIsIm9iamVjdCIsIndvcmtzcGFjZVNlcnZpY2UiLCJ3IiwiaGFzV29ya3NwYWNlRm9sZGVycyIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwidmVudk1hbmFnZXIiLCJWaXJ0dWFsRW52aXJvbm1lbnRNYW5hZ2VyIiwibmFtZSIsImdldEVudmlyb25tZW50TmFtZSIsImV4cGVjdCIsInRvIiwiYmUiLCJlcXVhbCIsInBpcEVudlNlcnZpY2UiLCJwIiwiaXNSZWxhdGVkUGlwRW52aXJvbm1lbnQiLCJpc0FueSIsInZlcmlmaWFibGUiLCJUaW1lcyIsIm9uY2UiLCJJUHJvY2Vzc1NlcnZpY2VGYWN0b3J5IiwiSUZpbGVTeXN0ZW0iLCJ3b3Jrc3BhY2VVcmkiLCJ3b3Jrc3BhY2VGb2xkZXIiLCJpbmRleCIsInVyaSIsIndvcmtzcGFjZUZvbGRlcnMiLCJiYXNlbmFtZSIsImZzUGF0aCIsInZlcmlmeUFsbCIsImV4cGVjdGVkRW52TmFtZSIsImlzUGlwRW52aXJvbm1lbnQiLCJyZXNvdXJjZSIsImdldFdvcmtzcGFjZUZvbGRlciJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8s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QixFQUFrRkwsT0FBbEYsQ0FBMEYsTUFBTUUsZ0JBQWdCLENBQUNELE1BQWpIO0FBQ0EsWUFBTUssV0FBVyxHQUFHLElBQUl4QixhQUFhLENBQUN5Qix5QkFBbEIsQ0FBNENoQixnQkFBZ0IsQ0FBQ1UsTUFBN0QsQ0FBcEI7QUFDQSxZQUFNTyxJQUFJLEdBQUcsTUFBTUYsV0FBVyxDQUFDRyxrQkFBWixDQUErQnhCLFVBQS9CLEVBQTJDZ0QsUUFBM0MsQ0FBbkI7QUFDQTVELE1BQUFBLE1BQU0sQ0FBQ3FDLE1BQVAsQ0FBY0YsSUFBZCxFQUFvQkcsRUFBcEIsQ0FBdUJDLEVBQXZCLENBQTBCQyxLQUExQixDQUFnQ2tCLGVBQWhDLEVBQWlELGdEQUFqRDtBQUNILEtBbEJlLENBQWhCO0FBbUJIO0FBQ0osQ0ExREksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIHRzbGludDpkaXNhYmxlOm5vLWFueVxyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL3R5cGVzXCIpO1xyXG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvaW50ZXJwcmV0ZXIvY29udHJhY3RzXCIpO1xyXG5jb25zdCB2aXJ0dWFsRW52c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9pbnRlcnByZXRlci92aXJ0dWFsRW52c1wiKTtcclxuc3VpdGUoJ1ZpcnR1YWwgZW52aXJvbm1lbnQgbWFuYWdlcicsICgpID0+IHtcclxuICAgIGNvbnN0IHZpcnR1YWxFbnZGb2xkZXJOYW1lID0gJ3ZpcnR1YWwgRW52IEZvbGRlciBOYW1lJztcclxuICAgIGNvbnN0IHB5dGhvblBhdGggPSBwYXRoLmpvaW4oJ2EnLCAnYicsIHZpcnR1YWxFbnZGb2xkZXJOYW1lLCAnZCcsICdweXRob24nKTtcclxuICAgIHRlc3QoJ1BsYWluIFB5dGhvbiBlbnZpcm9ubWVudCBzdWZmaXgnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7IHJldHVybiB0ZXN0U3VmZml4KHZpcnR1YWxFbnZGb2xkZXJOYW1lKTsgfSkpO1xyXG4gICAgdGVzdCgnUGxhaW4gUHl0aG9uIGVudmlyb25tZW50IHN1ZmZpeCB3aXRoIHdvcmtzcGFjZSBVcmknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7IHJldHVybiB0ZXN0U3VmZml4KHZpcnR1YWxFbnZGb2xkZXJOYW1lLCBmYWxzZSwgdnNjb2RlXzEuVXJpLmZpbGUocGF0aC5qb2luKCcxJywgJzInLCAnMycsICc0JykpKTsgfSkpO1xyXG4gICAgdGVzdCgnUGxhaW4gUHl0aG9uIGVudmlyb25tZW50IHN1ZmZpeCB3aXRoIFBpcEVudicsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsgcmV0dXJuIHRlc3RTdWZmaXgoJ3dvcmtzcGFjZU5hbWUnLCB0cnVlLCB2c2NvZGVfMS5VcmkuZmlsZShwYXRoLmpvaW4oJzEnLCAnMicsICczJywgJ3dvcmtzcGFjZU5hbWUnKSkpOyB9KSk7XHJcbiAgICB0ZXN0KCdVc2UgZW52aXJvbm1lbnQgZm9sZGVyIGFzIGVudiBuYW1lJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZShjb250cmFjdHNfMS5JUGlwRW52U2VydmljZSkpKS5yZXR1cm5zKCgpID0+IFR5cGVNb3EuTW9jay5vZlR5cGUoKS5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuaGFzV29ya3NwYWNlRm9sZGVycykucmV0dXJucygoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IHZlbnZNYW5hZ2VyID0gbmV3IHZpcnR1YWxFbnZzXzEuVmlydHVhbEVudmlyb25tZW50TWFuYWdlcihzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgbmFtZSA9IHlpZWxkIHZlbnZNYW5hZ2VyLmdldEVudmlyb25tZW50TmFtZShweXRob25QYXRoKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KG5hbWUpLnRvLmJlLmVxdWFsKHZpcnR1YWxFbnZGb2xkZXJOYW1lKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1VzZSB3b3Jrc3BhY2VjIG5hbWUgYXMgZW52IG5hbWUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3Qgc2VydmljZUNvbnRhaW5lciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBwaXBFbnZTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHBpcEVudlNlcnZpY2VcclxuICAgICAgICAgICAgLnNldHVwKHAgPT4gcC5pc1JlbGF0ZWRQaXBFbnZpcm9ubWVudChUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZShweXRob25QYXRoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAocyA9PiBzLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMy5JUHJvY2Vzc1NlcnZpY2VGYWN0b3J5KSkpLnJldHVybnMoKCkgPT4gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZShjb250cmFjdHNfMS5JUGlwRW52U2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHBpcEVudlNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKHMgPT4gcy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzIuSUZpbGVTeXN0ZW0pKSkucmV0dXJucygoKSA9PiBUeXBlTW9xLk1vY2sub2ZUeXBlKCkub2JqZWN0KTtcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2VVcmkgPSB2c2NvZGVfMS5VcmkuZmlsZShwYXRoLmpvaW4oJ3Jvb3QnLCAnc3ViJywgJ3drc3BhY2UgZm9sZGVyJykpO1xyXG4gICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHsgbmFtZTogJ3drc3BhY2UgZm9sZGVyJywgaW5kZXg6IDAsIHVyaTogd29ya3NwYWNlVXJpIH07XHJcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5oYXNXb3Jrc3BhY2VGb2xkZXJzKS5yZXR1cm5zKCgpID0+IHRydWUpO1xyXG4gICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LndvcmtzcGFjZUZvbGRlcnMpLnJldHVybnMoKCkgPT4gW3dvcmtzcGFjZUZvbGRlcl0pO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAocyA9PiBzLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBjb25zdCB2ZW52TWFuYWdlciA9IG5ldyB2aXJ0dWFsRW52c18xLlZpcnR1YWxFbnZpcm9ubWVudE1hbmFnZXIoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IG5hbWUgPSB5aWVsZCB2ZW52TWFuYWdlci5nZXRFbnZpcm9ubWVudE5hbWUocHl0aG9uUGF0aCk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChuYW1lKS50by5iZS5lcXVhbChwYXRoLmJhc2VuYW1lKHdvcmtzcGFjZVVyaS5mc1BhdGgpKTtcclxuICAgICAgICBwaXBFbnZTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgfSkpO1xyXG4gICAgZnVuY3Rpb24gdGVzdFN1ZmZpeChleHBlY3RlZEVudk5hbWUsIGlzUGlwRW52aXJvbm1lbnQgPSBmYWxzZSwgcmVzb3VyY2UpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZXJ2aWNlQ29udGFpbmVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKHMgPT4gcy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSVByb2Nlc3NTZXJ2aWNlRmFjdG9yeSkpKS5yZXR1cm5zKCgpID0+IFR5cGVNb3EuTW9jay5vZlR5cGUoKS5vYmplY3QpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKHMgPT4gcy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzIuSUZpbGVTeXN0ZW0pKSkucmV0dXJucygoKSA9PiBUeXBlTW9xLk1vY2sub2ZUeXBlKCkub2JqZWN0KTtcclxuICAgICAgICAgICAgY29uc3QgcGlwRW52U2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgcGlwRW52U2VydmljZS5zZXR1cCh3ID0+IHcuaXNSZWxhdGVkUGlwRW52aXJvbm1lbnQoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShpc1BpcEVudmlyb25tZW50KSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAocyA9PiBzLmdldChUeXBlTW9xLkl0LmlzVmFsdWUoY29udHJhY3RzXzEuSVBpcEVudlNlcnZpY2UpKSkucmV0dXJucygoKSA9PiBwaXBFbnZTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3Lmhhc1dvcmtzcGFjZUZvbGRlcnMpLnJldHVybnMoKCkgPT4gZmFsc2UpO1xyXG4gICAgICAgICAgICBpZiAocmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZUZvbGRlci5zZXR1cCh3ID0+IHcudXJpKS5yZXR1cm5zKCgpID0+IHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LmdldFdvcmtzcGFjZUZvbGRlcihUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZUZvbGRlci5vYmplY3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAocyA9PiBzLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICAgICAgY29uc3QgdmVudk1hbmFnZXIgPSBuZXcgdmlydHVhbEVudnNfMS5WaXJ0dWFsRW52aXJvbm1lbnRNYW5hZ2VyKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHlpZWxkIHZlbnZNYW5hZ2VyLmdldEVudmlyb25tZW50TmFtZShweXRob25QYXRoLCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QobmFtZSkudG8uYmUuZXF1YWwoZXhwZWN0ZWRFbnZOYW1lLCAnVmlydHVhbCBlbnZyaXJvbm1lbnQgbmFtZSBzdWZmaXggaXMgaW5jb3JyZWN0LicpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dmlydHVhbEVudk1hbmFnZXIudW5pdC50ZXN0LmpzLm1hcCJdfQ==