// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:no-any max-classes-per-file max-func-body-length

const chai_1 = require("chai");

const md5 = require("md5");

const ts_mockito_1 = require("ts-mockito");

const vscode_1 = require("vscode");

const types_1 = require("../../../client/common/application/types");

const workspace_1 = require("../../../client/common/application/workspace");

const misc_1 = require("../../../client/common/utils/misc");

const cacheableLocatorService_1 = require("../../../client/interpreter/locators/services/cacheableLocatorService");

const container_1 = require("../../../client/ioc/container");

suite('Interpreters - Cacheable Locator Service', () => {
  suite('Caching', () => {
    class Locator extends cacheableLocatorService_1.CacheableLocatorService {
      constructor(name, serviceCcontainer, mockLocator) {
        super(name, serviceCcontainer);
        this.mockLocator = mockLocator;
      }

      dispose() {
        misc_1.noop();
      }

      getInterpretersImplementation(resource) {
        return __awaiter(this, void 0, void 0, function* () {
          return this.mockLocator.getInterpretersImplementation();
        });
      }

      getCachedInterpreters(resource) {
        return this.mockLocator.getCachedInterpreters();
      }

      cacheInterpreters(interpreters, resource) {
        return __awaiter(this, void 0, void 0, function* () {
          return this.mockLocator.cacheInterpreters();
        });
      }

      getCacheKey(resource) {
        return this.mockLocator.getCacheKey();
      }

    }

    class MockLocator {
      getInterpretersImplementation() {
        return __awaiter(this, void 0, void 0, function* () {
          return [];
        });
      }

      getCachedInterpreters() {
        return;
      }

      cacheInterpreters() {
        return __awaiter(this, void 0, void 0, function* () {
          return;
        });
      }

      getCacheKey() {
        return '';
      }

    }

    let serviceContainer;
    setup(() => {
      serviceContainer = ts_mockito_1.mock(container_1.ServiceContainer);
    });
    test('Interpreters must be retrieved once, then cached', () => __awaiter(void 0, void 0, void 0, function* () {
      const expectedInterpreters = [1, 2];
      const mockedLocatorForVerification = ts_mockito_1.mock(MockLocator);
      const locator = new class extends Locator {
        addHandlersForInterpreterWatchers(cacheKey, resource) {
          return __awaiter(this, void 0, void 0, function* () {
            misc_1.noop();
          });
        }

      }('dummy', ts_mockito_1.instance(serviceContainer), ts_mockito_1.instance(mockedLocatorForVerification));
      ts_mockito_1.when(mockedLocatorForVerification.getInterpretersImplementation()).thenResolve(expectedInterpreters);
      ts_mockito_1.when(mockedLocatorForVerification.getCacheKey()).thenReturn('xyz');
      ts_mockito_1.when(mockedLocatorForVerification.getCachedInterpreters()).thenResolve();
      const [items1, items2, items3] = yield Promise.all([locator.getInterpreters(), locator.getInterpreters(), locator.getInterpreters()]);
      chai_1.expect(items1).to.be.deep.equal(expectedInterpreters);
      chai_1.expect(items2).to.be.deep.equal(expectedInterpreters);
      chai_1.expect(items3).to.be.deep.equal(expectedInterpreters);
      ts_mockito_1.verify(mockedLocatorForVerification.getInterpretersImplementation()).once();
      ts_mockito_1.verify(mockedLocatorForVerification.getCachedInterpreters()).atLeast(1);
      ts_mockito_1.verify(mockedLocatorForVerification.cacheInterpreters()).atLeast(1);
    }));
    test('Ensure onDidCreate event handler is attached', () => __awaiter(void 0, void 0, void 0, function* () {
      const mockedLocatorForVerification = ts_mockito_1.mock(MockLocator);

      class Watcher {
        onDidCreate(listener, thisArgs, disposables) {
          return {
            dispose: misc_1.noop
          };
        }

      }

      const watcher = ts_mockito_1.mock(Watcher);
      const locator = new class extends Locator {
        getInterpreterWatchers(_resource) {
          return __awaiter(this, void 0, void 0, function* () {
            return [ts_mockito_1.instance(watcher)];
          });
        }

      }('dummy', ts_mockito_1.instance(serviceContainer), ts_mockito_1.instance(mockedLocatorForVerification));
      yield locator.getInterpreters();
      ts_mockito_1.verify(watcher.onDidCreate(ts_mockito_1.anything(), ts_mockito_1.anything(), ts_mockito_1.anything())).once();
    }));
    test('Ensure cache is cleared when watcher event fires', () => __awaiter(void 0, void 0, void 0, function* () {
      const expectedInterpreters = [1, 2];
      const mockedLocatorForVerification = ts_mockito_1.mock(MockLocator);

      class Watcher {
        onDidCreate(listener, thisArgs, disposables) {
          this.listner = listener;
          return {
            dispose: misc_1.noop
          };
        }

        invokeListeners() {
          this.listner(undefined);
        }

      }

      const watcher = new Watcher();
      const locator = new class extends Locator {
        getInterpreterWatchers(_resource) {
          return __awaiter(this, void 0, void 0, function* () {
            return [watcher];
          });
        }

      }('dummy', ts_mockito_1.instance(serviceContainer), ts_mockito_1.instance(mockedLocatorForVerification));
      ts_mockito_1.when(mockedLocatorForVerification.getInterpretersImplementation()).thenResolve(expectedInterpreters);
      ts_mockito_1.when(mockedLocatorForVerification.getCacheKey()).thenReturn('xyz');
      ts_mockito_1.when(mockedLocatorForVerification.getCachedInterpreters()).thenResolve();
      const [items1, items2, items3] = yield Promise.all([locator.getInterpreters(), locator.getInterpreters(), locator.getInterpreters()]);
      chai_1.expect(items1).to.be.deep.equal(expectedInterpreters);
      chai_1.expect(items2).to.be.deep.equal(expectedInterpreters);
      chai_1.expect(items3).to.be.deep.equal(expectedInterpreters);
      ts_mockito_1.verify(mockedLocatorForVerification.getInterpretersImplementation()).once();
      ts_mockito_1.verify(mockedLocatorForVerification.getCachedInterpreters()).atLeast(1);
      ts_mockito_1.verify(mockedLocatorForVerification.cacheInterpreters()).once();
      watcher.invokeListeners();
      const [items4, items5, items6] = yield Promise.all([locator.getInterpreters(), locator.getInterpreters(), locator.getInterpreters()]);
      chai_1.expect(items4).to.be.deep.equal(expectedInterpreters);
      chai_1.expect(items5).to.be.deep.equal(expectedInterpreters);
      chai_1.expect(items6).to.be.deep.equal(expectedInterpreters); // We must get the list of interperters again and cache the new result again.

      ts_mockito_1.verify(mockedLocatorForVerification.getInterpretersImplementation()).twice();
      ts_mockito_1.verify(mockedLocatorForVerification.cacheInterpreters()).twice();
    }));
    test('Ensure locating event is raised', () => __awaiter(void 0, void 0, void 0, function* () {
      const mockedLocatorForVerification = ts_mockito_1.mock(MockLocator);
      const locator = new class extends Locator {
        getInterpreterWatchers(_resource) {
          return __awaiter(this, void 0, void 0, function* () {
            return [];
          });
        }

      }('dummy', ts_mockito_1.instance(serviceContainer), ts_mockito_1.instance(mockedLocatorForVerification));
      let locatingEventRaised = false;
      locator.onLocating(() => locatingEventRaised = true);
      ts_mockito_1.when(mockedLocatorForVerification.getInterpretersImplementation()).thenResolve([1, 2]);
      ts_mockito_1.when(mockedLocatorForVerification.getCacheKey()).thenReturn('xyz');
      ts_mockito_1.when(mockedLocatorForVerification.getCachedInterpreters()).thenResolve();
      yield locator.getInterpreters();
      chai_1.expect(locatingEventRaised).to.be.equal(true, 'Locating Event not raised');
    }));
  });
  suite('Cache Key', () => {
    class Locator extends cacheableLocatorService_1.CacheableLocatorService {
      dispose() {
        misc_1.noop();
      } // tslint:disable-next-line:no-unnecessary-override


      getCacheKey(resource) {
        return super.getCacheKey(resource);
      }

      getInterpretersImplementation(resource) {
        return __awaiter(this, void 0, void 0, function* () {
          return [];
        });
      }

      getCachedInterpreters(resource) {
        return [];
      }

      cacheInterpreters(interpreters, resource) {
        return __awaiter(this, void 0, void 0, function* () {
          misc_1.noop();
        });
      }

    }

    let serviceContainer;
    setup(() => {
      serviceContainer = ts_mockito_1.mock(container_1.ServiceContainer);
    });
    test('Cache Key must contain name of locator', () => __awaiter(void 0, void 0, void 0, function* () {
      const locator = new Locator('hello-World', ts_mockito_1.instance(serviceContainer));
      const key = locator.getCacheKey();
      chai_1.expect(key).contains('hello-World');
    }));
    test('Cache Key must not contain path to workspace', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspace = ts_mockito_1.mock(workspace_1.WorkspaceService);
      const workspaceFolder = {
        name: '1',
        index: 1,
        uri: vscode_1.Uri.file(__dirname)
      };
      ts_mockito_1.when(workspace.hasWorkspaceFolders).thenReturn(true);
      ts_mockito_1.when(workspace.workspaceFolders).thenReturn([workspaceFolder]);
      ts_mockito_1.when(workspace.getWorkspaceFolder(ts_mockito_1.anything())).thenReturn(workspaceFolder);
      ts_mockito_1.when(serviceContainer.get(types_1.IWorkspaceService)).thenReturn(ts_mockito_1.instance(workspace));
      ts_mockito_1.when(serviceContainer.get(types_1.IWorkspaceService, ts_mockito_1.anything())).thenReturn(ts_mockito_1.instance(workspace));
      const locator = new Locator('hello-World', ts_mockito_1.instance(serviceContainer), false);
      const key = locator.getCacheKey(vscode_1.Uri.file('something'));
      chai_1.expect(key).contains('hello-World');
      chai_1.expect(key).not.contains(md5(workspaceFolder.uri.fsPath));
    }));
    test('Cache Key must contain path to workspace', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspace = ts_mockito_1.mock(workspace_1.WorkspaceService);
      const workspaceFolder = {
        name: '1',
        index: 1,
        uri: vscode_1.Uri.file(__dirname)
      };
      const resource = vscode_1.Uri.file('a');
      ts_mockito_1.when(workspace.hasWorkspaceFolders).thenReturn(true);
      ts_mockito_1.when(workspace.workspaceFolders).thenReturn([workspaceFolder]);
      ts_mockito_1.when(workspace.getWorkspaceFolder(resource)).thenReturn(workspaceFolder);
      ts_mockito_1.when(serviceContainer.get(types_1.IWorkspaceService)).thenReturn(ts_mockito_1.instance(workspace));
      ts_mockito_1.when(serviceContainer.get(types_1.IWorkspaceService, ts_mockito_1.anything())).thenReturn(ts_mockito_1.instance(workspace));
      const locator = new Locator('hello-World', ts_mockito_1.instance(serviceContainer), true);
      const key = locator.getCacheKey(resource);
      chai_1.expect(key).contains('hello-World');
      chai_1.expect(key).contains(md5(workspaceFolder.uri.fsPath));
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhY2hlYWJsZUxvY2F0b3JTZXJ2aWNlLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiY2hhaV8xIiwicmVxdWlyZSIsIm1kNSIsInRzX21vY2tpdG9fMSIsInZzY29kZV8xIiwidHlwZXNfMSIsIndvcmtzcGFjZV8xIiwibWlzY18xIiwiY2FjaGVhYmxlTG9jYXRvclNlcnZpY2VfMSIsImNvbnRhaW5lcl8xIiwic3VpdGUiLCJMb2NhdG9yIiwiQ2FjaGVhYmxlTG9jYXRvclNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsIm5hbWUiLCJzZXJ2aWNlQ2NvbnRhaW5lciIsIm1vY2tMb2NhdG9yIiwiZGlzcG9zZSIsIm5vb3AiLCJnZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbiIsInJlc291cmNlIiwiZ2V0Q2FjaGVkSW50ZXJwcmV0ZXJzIiwiY2FjaGVJbnRlcnByZXRlcnMiLCJpbnRlcnByZXRlcnMiLCJnZXRDYWNoZUtleSIsIk1vY2tMb2NhdG9yIiwic2VydmljZUNvbnRhaW5lciIsInNldHVwIiwibW9jayIsIlNlcnZpY2VDb250YWluZXIiLCJ0ZXN0IiwiZXhwZWN0ZWRJbnRlcnByZXRlcnMiLCJtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uIiwibG9jYXRvciIsImFkZEhhbmRsZXJzRm9ySW50ZXJwcmV0ZXJXYXRjaGVycyIsImNhY2hlS2V5IiwiaW5zdGFuY2UiLCJ3aGVuIiwidGhlblJlc29sdmUiLCJ0aGVuUmV0dXJuIiwiaXRlbXMxIiwiaXRlbXMyIiwiaXRlbXMzIiwiYWxsIiwiZ2V0SW50ZXJwcmV0ZXJzIiwiZXhwZWN0IiwidG8iLCJiZSIsImRlZXAiLCJlcXVhbCIsInZlcmlmeSIsIm9uY2UiLCJhdExlYXN0IiwiV2F0Y2hlciIsIm9uRGlkQ3JlYXRlIiwibGlzdGVuZXIiLCJ0aGlzQXJncyIsImRpc3Bvc2FibGVzIiwid2F0Y2hlciIsImdldEludGVycHJldGVyV2F0Y2hlcnMiLCJfcmVzb3VyY2UiLCJhbnl0aGluZyIsImxpc3RuZXIiLCJpbnZva2VMaXN0ZW5lcnMiLCJ1bmRlZmluZWQiLCJpdGVtczQiLCJpdGVtczUiLCJpdGVtczYiLCJ0d2ljZSIsImxvY2F0aW5nRXZlbnRSYWlzZWQiLCJvbkxvY2F0aW5nIiwia2V5IiwiY29udGFpbnMiLCJ3b3Jrc3BhY2UiLCJXb3Jrc3BhY2VTZXJ2aWNlIiwid29ya3NwYWNlRm9sZGVyIiwiaW5kZXgiLCJ1cmkiLCJVcmkiLCJmaWxlIiwiX19kaXJuYW1lIiwiaGFzV29ya3NwYWNlRm9sZGVycyIsIndvcmtzcGFjZUZvbGRlcnMiLCJnZXRXb3Jrc3BhY2VGb2xkZXIiLCJnZXQiLCJJV29ya3NwYWNlU2VydmljZSIsIm5vdCIsImZzUGF0aCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7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QUEsWUFBWSxDQUFDa0MsSUFBYixDQUFrQlgsZ0JBQWdCLENBQUMwRCxHQUFqQixDQUFxQi9FLE9BQU8sQ0FBQ2dGLGlCQUE3QixFQUFnRGxGLFlBQVksQ0FBQzBELFFBQWIsRUFBaEQsQ0FBbEIsRUFBNEZ0QixVQUE1RixDQUF1R3BDLFlBQVksQ0FBQ2lDLFFBQWIsQ0FBc0JxQyxTQUF0QixDQUF2RztBQUNBLFlBQU14QyxPQUFPLEdBQUcsSUFBSXRCLE9BQUosQ0FBWSxhQUFaLEVBQTJCUixZQUFZLENBQUNpQyxRQUFiLENBQXNCVixnQkFBdEIsQ0FBM0IsRUFBb0UsSUFBcEUsQ0FBaEI7QUFDQSxZQUFNNkMsR0FBRyxHQUFHdEMsT0FBTyxDQUFDVCxXQUFSLENBQW9CSixRQUFwQixDQUFaO0FBQ0FwQixNQUFBQSxNQUFNLENBQUM2QyxNQUFQLENBQWMwQixHQUFkLEVBQW1CQyxRQUFuQixDQUE0QixhQUE1QjtBQUNBeEUsTUFBQUEsTUFBTSxDQUFDNkMsTUFBUCxDQUFjMEIsR0FBZCxFQUFtQkMsUUFBbkIsQ0FBNEJ0RSxHQUFHLENBQUN5RSxlQUFlLENBQUNFLEdBQWhCLENBQW9CVSxNQUFyQixDQUEvQjtBQUNILEtBYitELENBQTVELENBQUo7QUFjSCxHQTNESSxDQUFMO0FBNERILENBN01JLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gdHNsaW50OmRpc2FibGU6bm8tYW55IG1heC1jbGFzc2VzLXBlci1maWxlIG1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbmNvbnN0IGNoYWlfMSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCBtZDUgPSByZXF1aXJlKFwibWQ1XCIpO1xyXG5jb25zdCB0c19tb2NraXRvXzEgPSByZXF1aXJlKFwidHMtbW9ja2l0b1wiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IHdvcmtzcGFjZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vd29ya3NwYWNlXCIpO1xyXG5jb25zdCBtaXNjXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9taXNjXCIpO1xyXG5jb25zdCBjYWNoZWFibGVMb2NhdG9yU2VydmljZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9pbnRlcnByZXRlci9sb2NhdG9ycy9zZXJ2aWNlcy9jYWNoZWFibGVMb2NhdG9yU2VydmljZVwiKTtcclxuY29uc3QgY29udGFpbmVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2lvYy9jb250YWluZXJcIik7XHJcbnN1aXRlKCdJbnRlcnByZXRlcnMgLSBDYWNoZWFibGUgTG9jYXRvciBTZXJ2aWNlJywgKCkgPT4ge1xyXG4gICAgc3VpdGUoJ0NhY2hpbmcnLCAoKSA9PiB7XHJcbiAgICAgICAgY2xhc3MgTG9jYXRvciBleHRlbmRzIGNhY2hlYWJsZUxvY2F0b3JTZXJ2aWNlXzEuQ2FjaGVhYmxlTG9jYXRvclNlcnZpY2Uge1xyXG4gICAgICAgICAgICBjb25zdHJ1Y3RvcihuYW1lLCBzZXJ2aWNlQ2NvbnRhaW5lciwgbW9ja0xvY2F0b3IpIHtcclxuICAgICAgICAgICAgICAgIHN1cGVyKG5hbWUsIHNlcnZpY2VDY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubW9ja0xvY2F0b3IgPSBtb2NrTG9jYXRvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkaXNwb3NlKCkge1xyXG4gICAgICAgICAgICAgICAgbWlzY18xLm5vb3AoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbihyZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb2NrTG9jYXRvci5nZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ2V0Q2FjaGVkSW50ZXJwcmV0ZXJzKHJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb2NrTG9jYXRvci5nZXRDYWNoZWRJbnRlcnByZXRlcnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYWNoZUludGVycHJldGVycyhpbnRlcnByZXRlcnMsIHJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vY2tMb2NhdG9yLmNhY2hlSW50ZXJwcmV0ZXJzKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnZXRDYWNoZUtleShyZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9ja0xvY2F0b3IuZ2V0Q2FjaGVLZXkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjbGFzcyBNb2NrTG9jYXRvciB7XHJcbiAgICAgICAgICAgIGdldEludGVycHJldGVyc0ltcGxlbWVudGF0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnZXRDYWNoZWRJbnRlcnByZXRlcnMoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FjaGVJbnRlcnByZXRlcnMoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdldENhY2hlS2V5KCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgICAgIHNldHVwKCgpID0+IHtcclxuICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lciA9IHRzX21vY2tpdG9fMS5tb2NrKGNvbnRhaW5lcl8xLlNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRlc3QoJ0ludGVycHJldGVycyBtdXN0IGJlIHJldHJpZXZlZCBvbmNlLCB0aGVuIGNhY2hlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRJbnRlcnByZXRlcnMgPSBbMSwgMl07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24gPSB0c19tb2NraXRvXzEubW9jayhNb2NrTG9jYXRvcik7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvY2F0b3IgPSBuZXcgY2xhc3MgZXh0ZW5kcyBMb2NhdG9yIHtcclxuICAgICAgICAgICAgICAgIGFkZEhhbmRsZXJzRm9ySW50ZXJwcmV0ZXJXYXRjaGVycyhjYWNoZUtleSwgcmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaXNjXzEubm9vcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KCdkdW1teScsIHRzX21vY2tpdG9fMS5pbnN0YW5jZShzZXJ2aWNlQ29udGFpbmVyKSwgdHNfbW9ja2l0b18xLmluc3RhbmNlKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24pKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4obW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbigpKS50aGVuUmVzb2x2ZShleHBlY3RlZEludGVycHJldGVycyk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24uZ2V0Q2FjaGVLZXkoKSkudGhlblJldHVybigneHl6Jyk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24uZ2V0Q2FjaGVkSW50ZXJwcmV0ZXJzKCkpLnRoZW5SZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IFtpdGVtczEsIGl0ZW1zMiwgaXRlbXMzXSA9IHlpZWxkIFByb21pc2UuYWxsKFtsb2NhdG9yLmdldEludGVycHJldGVycygpLCBsb2NhdG9yLmdldEludGVycHJldGVycygpLCBsb2NhdG9yLmdldEludGVycHJldGVycygpXSk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoaXRlbXMxKS50by5iZS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJwcmV0ZXJzKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChpdGVtczIpLnRvLmJlLmRlZXAuZXF1YWwoZXhwZWN0ZWRJbnRlcnByZXRlcnMpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGl0ZW1zMykudG8uYmUuZGVlcC5lcXVhbChleHBlY3RlZEludGVycHJldGVycyk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS52ZXJpZnkobW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbigpKS5vbmNlKCk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS52ZXJpZnkobW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRDYWNoZWRJbnRlcnByZXRlcnMoKSkuYXRMZWFzdCgxKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLnZlcmlmeShtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uLmNhY2hlSW50ZXJwcmV0ZXJzKCkpLmF0TGVhc3QoMSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRlc3QoJ0Vuc3VyZSBvbkRpZENyZWF0ZSBldmVudCBoYW5kbGVyIGlzIGF0dGFjaGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uID0gdHNfbW9ja2l0b18xLm1vY2soTW9ja0xvY2F0b3IpO1xyXG4gICAgICAgICAgICBjbGFzcyBXYXRjaGVyIHtcclxuICAgICAgICAgICAgICAgIG9uRGlkQ3JlYXRlKGxpc3RlbmVyLCB0aGlzQXJncywgZGlzcG9zYWJsZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBkaXNwb3NlOiBtaXNjXzEubm9vcCB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHdhdGNoZXIgPSB0c19tb2NraXRvXzEubW9jayhXYXRjaGVyKTtcclxuICAgICAgICAgICAgY29uc3QgbG9jYXRvciA9IG5ldyBjbGFzcyBleHRlbmRzIExvY2F0b3Ige1xyXG4gICAgICAgICAgICAgICAgZ2V0SW50ZXJwcmV0ZXJXYXRjaGVycyhfcmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3RzX21vY2tpdG9fMS5pbnN0YW5jZSh3YXRjaGVyKV07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0oJ2R1bW15JywgdHNfbW9ja2l0b18xLmluc3RhbmNlKHNlcnZpY2VDb250YWluZXIpLCB0c19tb2NraXRvXzEuaW5zdGFuY2UobW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbikpO1xyXG4gICAgICAgICAgICB5aWVsZCBsb2NhdG9yLmdldEludGVycHJldGVycygpO1xyXG4gICAgICAgICAgICB0c19tb2NraXRvXzEudmVyaWZ5KHdhdGNoZXIub25EaWRDcmVhdGUodHNfbW9ja2l0b18xLmFueXRoaW5nKCksIHRzX21vY2tpdG9fMS5hbnl0aGluZygpLCB0c19tb2NraXRvXzEuYW55dGhpbmcoKSkpLm9uY2UoKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGVzdCgnRW5zdXJlIGNhY2hlIGlzIGNsZWFyZWQgd2hlbiB3YXRjaGVyIGV2ZW50IGZpcmVzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZEludGVycHJldGVycyA9IFsxLCAyXTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbiA9IHRzX21vY2tpdG9fMS5tb2NrKE1vY2tMb2NhdG9yKTtcclxuICAgICAgICAgICAgY2xhc3MgV2F0Y2hlciB7XHJcbiAgICAgICAgICAgICAgICBvbkRpZENyZWF0ZShsaXN0ZW5lciwgdGhpc0FyZ3MsIGRpc3Bvc2FibGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0bmVyID0gbGlzdGVuZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgZGlzcG9zZTogbWlzY18xLm5vb3AgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGludm9rZUxpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3RuZXIodW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB3YXRjaGVyID0gbmV3IFdhdGNoZXIoKTtcclxuICAgICAgICAgICAgY29uc3QgbG9jYXRvciA9IG5ldyBjbGFzcyBleHRlbmRzIExvY2F0b3Ige1xyXG4gICAgICAgICAgICAgICAgZ2V0SW50ZXJwcmV0ZXJXYXRjaGVycyhfcmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3dhdGNoZXJdO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KCdkdW1teScsIHRzX21vY2tpdG9fMS5pbnN0YW5jZShzZXJ2aWNlQ29udGFpbmVyKSwgdHNfbW9ja2l0b18xLmluc3RhbmNlKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24pKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4obW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbigpKS50aGVuUmVzb2x2ZShleHBlY3RlZEludGVycHJldGVycyk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24uZ2V0Q2FjaGVLZXkoKSkudGhlblJldHVybigneHl6Jyk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24uZ2V0Q2FjaGVkSW50ZXJwcmV0ZXJzKCkpLnRoZW5SZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IFtpdGVtczEsIGl0ZW1zMiwgaXRlbXMzXSA9IHlpZWxkIFByb21pc2UuYWxsKFtsb2NhdG9yLmdldEludGVycHJldGVycygpLCBsb2NhdG9yLmdldEludGVycHJldGVycygpLCBsb2NhdG9yLmdldEludGVycHJldGVycygpXSk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoaXRlbXMxKS50by5iZS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJwcmV0ZXJzKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChpdGVtczIpLnRvLmJlLmRlZXAuZXF1YWwoZXhwZWN0ZWRJbnRlcnByZXRlcnMpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGl0ZW1zMykudG8uYmUuZGVlcC5lcXVhbChleHBlY3RlZEludGVycHJldGVycyk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS52ZXJpZnkobW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbigpKS5vbmNlKCk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS52ZXJpZnkobW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRDYWNoZWRJbnRlcnByZXRlcnMoKSkuYXRMZWFzdCgxKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLnZlcmlmeShtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uLmNhY2hlSW50ZXJwcmV0ZXJzKCkpLm9uY2UoKTtcclxuICAgICAgICAgICAgd2F0Y2hlci5pbnZva2VMaXN0ZW5lcnMoKTtcclxuICAgICAgICAgICAgY29uc3QgW2l0ZW1zNCwgaXRlbXM1LCBpdGVtczZdID0geWllbGQgUHJvbWlzZS5hbGwoW2xvY2F0b3IuZ2V0SW50ZXJwcmV0ZXJzKCksIGxvY2F0b3IuZ2V0SW50ZXJwcmV0ZXJzKCksIGxvY2F0b3IuZ2V0SW50ZXJwcmV0ZXJzKCldKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChpdGVtczQpLnRvLmJlLmRlZXAuZXF1YWwoZXhwZWN0ZWRJbnRlcnByZXRlcnMpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KGl0ZW1zNSkudG8uYmUuZGVlcC5lcXVhbChleHBlY3RlZEludGVycHJldGVycyk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoaXRlbXM2KS50by5iZS5kZWVwLmVxdWFsKGV4cGVjdGVkSW50ZXJwcmV0ZXJzKTtcclxuICAgICAgICAgICAgLy8gV2UgbXVzdCBnZXQgdGhlIGxpc3Qgb2YgaW50ZXJwZXJ0ZXJzIGFnYWluIGFuZCBjYWNoZSB0aGUgbmV3IHJlc3VsdCBhZ2Fpbi5cclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLnZlcmlmeShtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uLmdldEludGVycHJldGVyc0ltcGxlbWVudGF0aW9uKCkpLnR3aWNlKCk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS52ZXJpZnkobW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5jYWNoZUludGVycHJldGVycygpKS50d2ljZSgpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB0ZXN0KCdFbnN1cmUgbG9jYXRpbmcgZXZlbnQgaXMgcmFpc2VkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uID0gdHNfbW9ja2l0b18xLm1vY2soTW9ja0xvY2F0b3IpO1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhdG9yID0gbmV3IGNsYXNzIGV4dGVuZHMgTG9jYXRvciB7XHJcbiAgICAgICAgICAgICAgICBnZXRJbnRlcnByZXRlcldhdGNoZXJzKF9yZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSgnZHVtbXknLCB0c19tb2NraXRvXzEuaW5zdGFuY2Uoc2VydmljZUNvbnRhaW5lciksIHRzX21vY2tpdG9fMS5pbnN0YW5jZShtb2NrZWRMb2NhdG9yRm9yVmVyaWZpY2F0aW9uKSk7XHJcbiAgICAgICAgICAgIGxldCBsb2NhdGluZ0V2ZW50UmFpc2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGxvY2F0b3Iub25Mb2NhdGluZygoKSA9PiBsb2NhdGluZ0V2ZW50UmFpc2VkID0gdHJ1ZSk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKG1vY2tlZExvY2F0b3JGb3JWZXJpZmljYXRpb24uZ2V0SW50ZXJwcmV0ZXJzSW1wbGVtZW50YXRpb24oKSkudGhlblJlc29sdmUoWzEsIDJdKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4obW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRDYWNoZUtleSgpKS50aGVuUmV0dXJuKCd4eXonKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4obW9ja2VkTG9jYXRvckZvclZlcmlmaWNhdGlvbi5nZXRDYWNoZWRJbnRlcnByZXRlcnMoKSkudGhlblJlc29sdmUoKTtcclxuICAgICAgICAgICAgeWllbGQgbG9jYXRvci5nZXRJbnRlcnByZXRlcnMoKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChsb2NhdGluZ0V2ZW50UmFpc2VkKS50by5iZS5lcXVhbCh0cnVlLCAnTG9jYXRpbmcgRXZlbnQgbm90IHJhaXNlZCcpO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH0pO1xyXG4gICAgc3VpdGUoJ0NhY2hlIEtleScsICgpID0+IHtcclxuICAgICAgICBjbGFzcyBMb2NhdG9yIGV4dGVuZHMgY2FjaGVhYmxlTG9jYXRvclNlcnZpY2VfMS5DYWNoZWFibGVMb2NhdG9yU2VydmljZSB7XHJcbiAgICAgICAgICAgIGRpc3Bvc2UoKSB7XHJcbiAgICAgICAgICAgICAgICBtaXNjXzEubm9vcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bm5lY2Vzc2FyeS1vdmVycmlkZVxyXG4gICAgICAgICAgICBnZXRDYWNoZUtleShyZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldENhY2hlS2V5KHJlc291cmNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnZXRJbnRlcnByZXRlcnNJbXBsZW1lbnRhdGlvbihyZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBnZXRDYWNoZWRJbnRlcnByZXRlcnMocmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYWNoZUludGVycHJldGVycyhpbnRlcnByZXRlcnMsIHJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pc2NfMS5ub29wKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgICAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIgPSB0c19tb2NraXRvXzEubW9jayhjb250YWluZXJfMS5TZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0ZXN0KCdDYWNoZSBLZXkgbXVzdCBjb250YWluIG5hbWUgb2YgbG9jYXRvcicsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYXRvciA9IG5ldyBMb2NhdG9yKCdoZWxsby1Xb3JsZCcsIHRzX21vY2tpdG9fMS5pbnN0YW5jZShzZXJ2aWNlQ29udGFpbmVyKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGxvY2F0b3IuZ2V0Q2FjaGVLZXkoKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChrZXkpLmNvbnRhaW5zKCdoZWxsby1Xb3JsZCcpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB0ZXN0KCdDYWNoZSBLZXkgbXVzdCBub3QgY29udGFpbiBwYXRoIHRvIHdvcmtzcGFjZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlID0gdHNfbW9ja2l0b18xLm1vY2sod29ya3NwYWNlXzEuV29ya3NwYWNlU2VydmljZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHsgbmFtZTogJzEnLCBpbmRleDogMSwgdXJpOiB2c2NvZGVfMS5VcmkuZmlsZShfX2Rpcm5hbWUpIH07XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKHdvcmtzcGFjZS5oYXNXb3Jrc3BhY2VGb2xkZXJzKS50aGVuUmV0dXJuKHRydWUpO1xyXG4gICAgICAgICAgICB0c19tb2NraXRvXzEud2hlbih3b3Jrc3BhY2Uud29ya3NwYWNlRm9sZGVycykudGhlblJldHVybihbd29ya3NwYWNlRm9sZGVyXSk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKHdvcmtzcGFjZS5nZXRXb3Jrc3BhY2VGb2xkZXIodHNfbW9ja2l0b18xLmFueXRoaW5nKCkpKS50aGVuUmV0dXJuKHdvcmtzcGFjZUZvbGRlcik7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKHNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSVdvcmtzcGFjZVNlcnZpY2UpKS50aGVuUmV0dXJuKHRzX21vY2tpdG9fMS5pbnN0YW5jZSh3b3Jrc3BhY2UpKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4oc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSwgdHNfbW9ja2l0b18xLmFueXRoaW5nKCkpKS50aGVuUmV0dXJuKHRzX21vY2tpdG9fMS5pbnN0YW5jZSh3b3Jrc3BhY2UpKTtcclxuICAgICAgICAgICAgY29uc3QgbG9jYXRvciA9IG5ldyBMb2NhdG9yKCdoZWxsby1Xb3JsZCcsIHRzX21vY2tpdG9fMS5pbnN0YW5jZShzZXJ2aWNlQ29udGFpbmVyKSwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBsb2NhdG9yLmdldENhY2hlS2V5KHZzY29kZV8xLlVyaS5maWxlKCdzb21ldGhpbmcnKSk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3Qoa2V5KS5jb250YWlucygnaGVsbG8tV29ybGQnKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChrZXkpLm5vdC5jb250YWlucyhtZDUod29ya3NwYWNlRm9sZGVyLnVyaS5mc1BhdGgpKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGVzdCgnQ2FjaGUgS2V5IG11c3QgY29udGFpbiBwYXRoIHRvIHdvcmtzcGFjZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlID0gdHNfbW9ja2l0b18xLm1vY2sod29ya3NwYWNlXzEuV29ya3NwYWNlU2VydmljZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHsgbmFtZTogJzEnLCBpbmRleDogMSwgdXJpOiB2c2NvZGVfMS5VcmkuZmlsZShfX2Rpcm5hbWUpIH07XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc291cmNlID0gdnNjb2RlXzEuVXJpLmZpbGUoJ2EnKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4od29ya3NwYWNlLmhhc1dvcmtzcGFjZUZvbGRlcnMpLnRoZW5SZXR1cm4odHJ1ZSk7XHJcbiAgICAgICAgICAgIHRzX21vY2tpdG9fMS53aGVuKHdvcmtzcGFjZS53b3Jrc3BhY2VGb2xkZXJzKS50aGVuUmV0dXJuKFt3b3Jrc3BhY2VGb2xkZXJdKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4od29ya3NwYWNlLmdldFdvcmtzcGFjZUZvbGRlcihyZXNvdXJjZSkpLnRoZW5SZXR1cm4od29ya3NwYWNlRm9sZGVyKTtcclxuICAgICAgICAgICAgdHNfbW9ja2l0b18xLndoZW4oc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpLnRoZW5SZXR1cm4odHNfbW9ja2l0b18xLmluc3RhbmNlKHdvcmtzcGFjZSkpO1xyXG4gICAgICAgICAgICB0c19tb2NraXRvXzEud2hlbihzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlLCB0c19tb2NraXRvXzEuYW55dGhpbmcoKSkpLnRoZW5SZXR1cm4odHNfbW9ja2l0b18xLmluc3RhbmNlKHdvcmtzcGFjZSkpO1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhdG9yID0gbmV3IExvY2F0b3IoJ2hlbGxvLVdvcmxkJywgdHNfbW9ja2l0b18xLmluc3RhbmNlKHNlcnZpY2VDb250YWluZXIpLCB0cnVlKTtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0gbG9jYXRvci5nZXRDYWNoZUtleShyZXNvdXJjZSk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3Qoa2V5KS5jb250YWlucygnaGVsbG8tV29ybGQnKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChrZXkpLmNvbnRhaW5zKG1kNSh3b3Jrc3BhY2VGb2xkZXIudXJpLmZzUGF0aCkpO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH0pO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2FjaGVhYmxlTG9jYXRvclNlcnZpY2UudW5pdC50ZXN0LmpzLm1hcCJdfQ==