// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:no-any max-classes-per-file max-func-body-length

const chai_1 = require("chai");

const ts_mockito_1 = require("ts-mockito");

const workspace_1 = require("../../../client/common/application/workspace");

const contracts_1 = require("../../../client/interpreter/contracts");

const interpreterWatcherBuilder_1 = require("../../../client/interpreter/locators/services/interpreterWatcherBuilder");

const container_1 = require("../../../client/ioc/container");

suite('Interpreters - Watcher Builder', () => {
  test('Build Workspace Virtual Env Watcher', () => __awaiter(void 0, void 0, void 0, function* () {
    const workspaceService = ts_mockito_1.mock(workspace_1.WorkspaceService);
    const serviceContainer = ts_mockito_1.mock(container_1.ServiceContainer);
    const builder = new interpreterWatcherBuilder_1.InterpreterWatcherBuilder(ts_mockito_1.instance(workspaceService), ts_mockito_1.instance(serviceContainer));
    const watcher = {
      register: () => Promise.resolve()
    };
    ts_mockito_1.when(workspaceService.getWorkspaceFolder(ts_mockito_1.anything())).thenReturn();
    ts_mockito_1.when(serviceContainer.get(contracts_1.IInterpreterWatcher, contracts_1.WORKSPACE_VIRTUAL_ENV_SERVICE)).thenReturn(watcher);
    const item = yield builder.getWorkspaceVirtualEnvInterpreterWatcher(undefined);
    chai_1.expect(item).to.be.equal(watcher, 'invalid');
  }));
  test('Ensure we cache Workspace Virtual Env Watcher', () => __awaiter(void 0, void 0, void 0, function* () {
    const workspaceService = ts_mockito_1.mock(workspace_1.WorkspaceService);
    const serviceContainer = ts_mockito_1.mock(container_1.ServiceContainer);
    const builder = new interpreterWatcherBuilder_1.InterpreterWatcherBuilder(ts_mockito_1.instance(workspaceService), ts_mockito_1.instance(serviceContainer));
    const watcher = {
      register: () => Promise.resolve()
    };
    ts_mockito_1.when(workspaceService.getWorkspaceFolder(ts_mockito_1.anything())).thenReturn();
    ts_mockito_1.when(serviceContainer.get(contracts_1.IInterpreterWatcher, contracts_1.WORKSPACE_VIRTUAL_ENV_SERVICE)).thenReturn(watcher);
    const [item1, item2, item3] = yield Promise.all([builder.getWorkspaceVirtualEnvInterpreterWatcher(undefined), builder.getWorkspaceVirtualEnvInterpreterWatcher(undefined), builder.getWorkspaceVirtualEnvInterpreterWatcher(undefined)]);
    chai_1.expect(item1).to.be.equal(watcher, 'invalid');
    chai_1.expect(item2).to.be.equal(watcher, 'invalid');
    chai_1.expect(item3).to.be.equal(watcher, 'invalid');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImludGVycHJldGVyV2F0Y2hlckJ1aWxkZXIudW5pdC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwidHNfbW9ja2l0b18xIiwid29ya3NwYWNlXzEiLCJjb250cmFjdHNfMSIsImludGVycHJldGVyV2F0Y2hlckJ1aWxkZXJfMSIsImNvbnRhaW5lcl8xIiwic3VpdGUiLCJ0ZXN0Iiwid29ya3NwYWNlU2VydmljZSIsIm1vY2siLCJXb3Jrc3BhY2VTZXJ2aWNlIiwic2VydmljZUNvbnRhaW5lciIsIlNlcnZpY2VDb250YWluZXIiLCJidWlsZGVyIiwiSW50ZXJwcmV0ZXJXYXRjaGVyQnVpbGRlciIsImluc3RhbmNlIiwid2F0Y2hlciIsInJlZ2lzdGVyIiwid2hlbiIsImdldFdvcmtzcGFjZUZvbGRlciIsImFueXRoaW5nIiwidGhlblJldHVybiIsImdldCIsIklJbnRlcnByZXRlcldhdGNoZXIiLCJXT1JLU1BBQ0VfVklSVFVBTF9FTlZfU0VSVklDRSIsIml0ZW0iLCJnZXRXb3Jrc3BhY2VWaXJ0dWFsRW52SW50ZXJwcmV0ZXJXYXRjaGVyIiwidW5kZWZpbmVkIiwiZXhwZWN0IiwidG8iLCJiZSIsImVxdWFsIiwiaXRlbTEiLCJpdGVtMiIsIml0ZW0zIiwiYWxsIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8sSUFBckQsQ0FBMERSLFNBQTFELEVBQXFFSyxRQUFyRSxDQUF0QztBQUF1SDs7QUFDL0lILElBQUFBLElBQUksQ0FBQyxDQUFDTixTQUFTLEdBQUdBLFNBQVMsQ0FBQ2EsS0FBVixDQUFnQmhCLE9BQWhCLEVBQXlCQyxVQUFVLElBQUksRUFBdkMsQ0FBYixFQUF5RFMsSUFBekQsRUFBRCxDQUFKO0FBQ0gsR0FMTSxDQUFQO0FBTUgsQ0FQRDs7QUFRQU8sTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUFFWCxFQUFBQSxLQUFLLEVBQUU7QUFBVCxDQUE3QyxFLENBQ0E7O0FBQ0EsTUFBTVksTUFBTSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUF0Qjs7QUFDQSxNQUFNQyxZQUFZLEdBQUdELE9BQU8sQ0FBQyxZQUFELENBQTVCOztBQUNBLE1BQU1FLFdBQVcsR0FBR0YsT0FBTyxDQUFDLDhDQUFELENBQTNCOztBQUNBLE1BQU1HLFdBQVcsR0FBR0gsT0FBTyxDQUFDLHVDQUFELENBQTNCOztBQUNBLE1BQU1JLDJCQUEyQixHQUFHSixPQUFPLENBQUMseUVBQUQsQ0FBM0M7O0FBQ0EsTUFBTUssV0FBVyxHQUFHTCxPQUFPLENBQUMsK0JBQUQsQ0FBM0I7O0FBQ0FNLEtBQUssQ0FBQyxnQ0FBRCxFQUFtQyxNQUFNO0FBQzFDQyxFQUFBQSxJQUFJLENBQUMscUNBQUQsRUFBd0MsTUFBTTdCLFNBQVMsU0FBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDM0YsVUFBTThCLGdCQUFnQixHQUFHUCxZQUFZLENBQUNRLElBQWIsQ0FBa0JQLFdBQVcsQ0FBQ1EsZ0JBQTlCLENBQXpCO0FBQ0EsVUFBTUMsZ0JBQWdCLEdBQUdWLFlBQVksQ0FBQ1EsSUFBYixDQUFrQkosV0FBVyxDQUFDTyxnQkFBOUIsQ0FBekI7QUFDQSxVQUFNQyxPQUFPLEdBQUcsSUFBSVQsMkJBQTJCLENBQUNVLHlCQUFoQyxDQUEwRGIsWUFBWSxDQUFDYyxRQUFiLENBQXNCUCxnQkFBdEIsQ0FBMUQsRUFBbUdQLFlBQVksQ0FBQ2MsUUFBYixDQUFzQkosZ0JBQXRCLENBQW5HLENBQWhCO0FBQ0EsVUFBTUssT0FBTyxHQUFHO0FBQUVDLE1BQUFBLFFBQVEsRUFBRSxNQUFNbEMsT0FBTyxDQUFDQyxPQUFSO0FBQWxCLEtBQWhCO0FBQ0FpQixJQUFBQSxZQUFZLENBQUNpQixJQUFiLENBQWtCVixnQkFBZ0IsQ0FBQ1csa0JBQWpCLENBQW9DbEIsWUFBWSxDQUFDbUIsUUFBYixFQUFwQyxDQUFsQixFQUFnRkMsVUFBaEY7QUFDQXBCLElBQUFBLFlBQVksQ0FBQ2lCLElBQWIsQ0FBa0JQLGdCQUFnQixDQUFDVyxHQUFqQixDQUFxQm5CLFdBQVcsQ0FBQ29CLG1CQUFqQyxFQUFzRHBCLFdBQVcsQ0FBQ3FCLDZCQUFsRSxDQUFsQixFQUFvSEgsVUFBcEgsQ0FBK0hMLE9BQS9IO0FBQ0EsVUFBTVMsSUFBSSxHQUFHLE1BQU1aLE9BQU8sQ0FBQ2Esd0NBQVIsQ0FBaURDLFNBQWpELENBQW5CO0FBQ0E1QixJQUFBQSxNQUFNLENBQUM2QixNQUFQLENBQWNILElBQWQsRUFBb0JJLEVBQXBCLENBQXVCQyxFQUF2QixDQUEwQkMsS0FBMUIsQ0FBZ0NmLE9BQWhDLEVBQXlDLFNBQXpDO0FBQ0gsR0FUMEQsQ0FBdkQsQ0FBSjtBQVVBVCxFQUFBQSxJQUFJLENBQUMsK0NBQUQsRUFBa0QsTUFBTTdCLFNBQVMsU0FBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDckcsVUFBTThCLGdCQUFnQixHQUFHUCxZQUFZLENBQUNRLElBQWIsQ0FBa0JQLFdBQVcsQ0FBQ1EsZ0JBQTlCLENBQXpCO0FBQ0EsVUFBTUMsZ0JBQWdCLEdBQUdWLFlBQVksQ0FBQ1EsSUFBYixDQUFrQkosV0FBVyxDQUFDTyxnQkFBOUIsQ0FBekI7QUFDQSxVQUFNQyxPQUFPLEdBQUcsSUFBSVQsMkJBQTJCLENBQUNVLHlCQUFoQyxDQUEwRGIsWUFBWSxDQUFDYyxRQUFiLENBQXNCUCxnQkFBdEIsQ0FBMUQsRUFBbUdQLFlBQVksQ0FBQ2MsUUFBYixDQUFzQkosZ0JBQXRCLENBQW5HLENBQWhCO0FBQ0EsVUFBTUssT0FBTyxHQUFHO0FBQUVDLE1BQUFBLFFBQVEsRUFBRSxNQUFNbEMsT0FBTyxDQUFDQyxPQUFSO0FBQWxCLEtBQWhCO0FBQ0FpQixJQUFBQSxZQUFZLENBQUNpQixJQUFiLENBQWtCVixnQkFBZ0IsQ0FBQ1csa0JBQWpCLENBQW9DbEIsWUFBWSxDQUFDbUIsUUFBYixFQUFwQyxDQUFsQixFQUFnRkMsVUFBaEY7QUFDQXBCLElBQUFBLFlBQVksQ0FBQ2lCLElBQWIsQ0FBa0JQLGdCQUFnQixDQUFDVyxHQUFqQixDQUFxQm5CLFdBQVcsQ0FBQ29CLG1CQUFqQyxFQUFzRHBCLFdBQVcsQ0FBQ3FCLDZCQUFsRSxDQUFsQixFQUFvSEgsVUFBcEgsQ0FBK0hMLE9BQS9IO0FBQ0EsVUFBTSxDQUFDZ0IsS0FBRCxFQUFRQyxLQUFSLEVBQWVDLEtBQWYsSUFBd0IsTUFBTW5ELE9BQU8sQ0FBQ29ELEdBQVIsQ0FBWSxDQUM1Q3RCLE9BQU8sQ0FBQ2Esd0NBQVIsQ0FBaURDLFNBQWpELENBRDRDLEVBRTVDZCxPQUFPLENBQUNhLHdDQUFSLENBQWlEQyxTQUFqRCxDQUY0QyxFQUc1Q2QsT0FBTyxDQUFDYSx3Q0FBUixDQUFpREMsU0FBakQsQ0FINEMsQ0FBWixDQUFwQztBQUtBNUIsSUFBQUEsTUFBTSxDQUFDNkIsTUFBUCxDQUFjSSxLQUFkLEVBQXFCSCxFQUFyQixDQUF3QkMsRUFBeEIsQ0FBMkJDLEtBQTNCLENBQWlDZixPQUFqQyxFQUEwQyxTQUExQztBQUNBakIsSUFBQUEsTUFBTSxDQUFDNkIsTUFBUCxDQUFjSyxLQUFkLEVBQXFCSixFQUFyQixDQUF3QkMsRUFBeEIsQ0FBMkJDLEtBQTNCLENBQWlDZixPQUFqQyxFQUEwQyxTQUExQztBQUNBakIsSUFBQUEsTUFBTSxDQUFDNkIsTUFBUCxDQUFjTSxLQUFkLEVBQXFCTCxFQUFyQixDQUF3QkMsRUFBeEIsQ0FBMkJDLEtBQTNCLENBQWlDZixPQUFqQyxFQUEwQyxTQUExQztBQUNILEdBZm9FLENBQWpFLENBQUo7QUFnQkgsQ0EzQkksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby1hbnkgbWF4LWNsYXNzZXMtcGVyLWZpbGUgbWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuY29uc3QgY2hhaV8xID0gcmVxdWlyZShcImNoYWlcIik7XHJcbmNvbnN0IHRzX21vY2tpdG9fMSA9IHJlcXVpcmUoXCJ0cy1tb2NraXRvXCIpO1xyXG5jb25zdCB3b3Jrc3BhY2VfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL2FwcGxpY2F0aW9uL3dvcmtzcGFjZVwiKTtcclxuY29uc3QgY29udHJhY3RzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2ludGVycHJldGVyL2NvbnRyYWN0c1wiKTtcclxuY29uc3QgaW50ZXJwcmV0ZXJXYXRjaGVyQnVpbGRlcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9pbnRlcnByZXRlci9sb2NhdG9ycy9zZXJ2aWNlcy9pbnRlcnByZXRlcldhdGNoZXJCdWlsZGVyXCIpO1xyXG5jb25zdCBjb250YWluZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvaW9jL2NvbnRhaW5lclwiKTtcclxuc3VpdGUoJ0ludGVycHJldGVycyAtIFdhdGNoZXIgQnVpbGRlcicsICgpID0+IHtcclxuICAgIHRlc3QoJ0J1aWxkIFdvcmtzcGFjZSBWaXJ0dWFsIEVudiBXYXRjaGVyJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHdvcmtzcGFjZVNlcnZpY2UgPSB0c19tb2NraXRvXzEubW9jayh3b3Jrc3BhY2VfMS5Xb3Jrc3BhY2VTZXJ2aWNlKTtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlQ29udGFpbmVyID0gdHNfbW9ja2l0b18xLm1vY2soY29udGFpbmVyXzEuU2VydmljZUNvbnRhaW5lcik7XHJcbiAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBpbnRlcnByZXRlcldhdGNoZXJCdWlsZGVyXzEuSW50ZXJwcmV0ZXJXYXRjaGVyQnVpbGRlcih0c19tb2NraXRvXzEuaW5zdGFuY2Uod29ya3NwYWNlU2VydmljZSksIHRzX21vY2tpdG9fMS5pbnN0YW5jZShzZXJ2aWNlQ29udGFpbmVyKSk7XHJcbiAgICAgICAgY29uc3Qgd2F0Y2hlciA9IHsgcmVnaXN0ZXI6ICgpID0+IFByb21pc2UucmVzb2x2ZSgpIH07XHJcbiAgICAgICAgdHNfbW9ja2l0b18xLndoZW4od29ya3NwYWNlU2VydmljZS5nZXRXb3Jrc3BhY2VGb2xkZXIodHNfbW9ja2l0b18xLmFueXRoaW5nKCkpKS50aGVuUmV0dXJuKCk7XHJcbiAgICAgICAgdHNfbW9ja2l0b18xLndoZW4oc2VydmljZUNvbnRhaW5lci5nZXQoY29udHJhY3RzXzEuSUludGVycHJldGVyV2F0Y2hlciwgY29udHJhY3RzXzEuV09SS1NQQUNFX1ZJUlRVQUxfRU5WX1NFUlZJQ0UpKS50aGVuUmV0dXJuKHdhdGNoZXIpO1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB5aWVsZCBidWlsZGVyLmdldFdvcmtzcGFjZVZpcnR1YWxFbnZJbnRlcnByZXRlcldhdGNoZXIodW5kZWZpbmVkKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KGl0ZW0pLnRvLmJlLmVxdWFsKHdhdGNoZXIsICdpbnZhbGlkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdFbnN1cmUgd2UgY2FjaGUgV29ya3NwYWNlIFZpcnR1YWwgRW52IFdhdGNoZXInLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlU2VydmljZSA9IHRzX21vY2tpdG9fMS5tb2NrKHdvcmtzcGFjZV8xLldvcmtzcGFjZVNlcnZpY2UpO1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2VDb250YWluZXIgPSB0c19tb2NraXRvXzEubW9jayhjb250YWluZXJfMS5TZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IGludGVycHJldGVyV2F0Y2hlckJ1aWxkZXJfMS5JbnRlcnByZXRlcldhdGNoZXJCdWlsZGVyKHRzX21vY2tpdG9fMS5pbnN0YW5jZSh3b3Jrc3BhY2VTZXJ2aWNlKSwgdHNfbW9ja2l0b18xLmluc3RhbmNlKHNlcnZpY2VDb250YWluZXIpKTtcclxuICAgICAgICBjb25zdCB3YXRjaGVyID0geyByZWdpc3RlcjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkgfTtcclxuICAgICAgICB0c19tb2NraXRvXzEud2hlbih3b3Jrc3BhY2VTZXJ2aWNlLmdldFdvcmtzcGFjZUZvbGRlcih0c19tb2NraXRvXzEuYW55dGhpbmcoKSkpLnRoZW5SZXR1cm4oKTtcclxuICAgICAgICB0c19tb2NraXRvXzEud2hlbihzZXJ2aWNlQ29udGFpbmVyLmdldChjb250cmFjdHNfMS5JSW50ZXJwcmV0ZXJXYXRjaGVyLCBjb250cmFjdHNfMS5XT1JLU1BBQ0VfVklSVFVBTF9FTlZfU0VSVklDRSkpLnRoZW5SZXR1cm4od2F0Y2hlcik7XHJcbiAgICAgICAgY29uc3QgW2l0ZW0xLCBpdGVtMiwgaXRlbTNdID0geWllbGQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgICAgICBidWlsZGVyLmdldFdvcmtzcGFjZVZpcnR1YWxFbnZJbnRlcnByZXRlcldhdGNoZXIodW5kZWZpbmVkKSxcclxuICAgICAgICAgICAgYnVpbGRlci5nZXRXb3Jrc3BhY2VWaXJ0dWFsRW52SW50ZXJwcmV0ZXJXYXRjaGVyKHVuZGVmaW5lZCksXHJcbiAgICAgICAgICAgIGJ1aWxkZXIuZ2V0V29ya3NwYWNlVmlydHVhbEVudkludGVycHJldGVyV2F0Y2hlcih1bmRlZmluZWQpXHJcbiAgICAgICAgXSk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdChpdGVtMSkudG8uYmUuZXF1YWwod2F0Y2hlciwgJ2ludmFsaWQnKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KGl0ZW0yKS50by5iZS5lcXVhbCh3YXRjaGVyLCAnaW52YWxpZCcpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoaXRlbTMpLnRvLmJlLmVxdWFsKHdhdGNoZXIsICdpbnZhbGlkJyk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbnRlcnByZXRlcldhdGNoZXJCdWlsZGVyLnVuaXQudGVzdC5qcy5tYXAiXX0=