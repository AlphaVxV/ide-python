"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../client/common/application/types");

const pythonPathUpdaterServiceFactory_1 = require("../../client/interpreter/configuration/pythonPathUpdaterServiceFactory"); // tslint:disable:no-invalid-template-strings max-func-body-length


suite('Python Path Settings Updater', () => {
  let serviceContainer;
  let workspaceService;
  let updaterServiceFactory;

  function setupMocks() {
    serviceContainer = TypeMoq.Mock.ofType();
    workspaceService = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
    updaterServiceFactory = new pythonPathUpdaterServiceFactory_1.PythonPathUpdaterServiceFactory(serviceContainer.object);
  }

  function setupConfigProvider(resource) {
    const workspaceConfig = TypeMoq.Mock.ofType();
    workspaceService.setup(w => w.getConfiguration(TypeMoq.It.isValue('python'), TypeMoq.It.isValue(resource))).returns(() => workspaceConfig.object);
    return workspaceConfig;
  }

  suite('Global', () => {
    setup(setupMocks);
    test('Python Path should not be updated when current pythonPath is the same', () => __awaiter(void 0, void 0, void 0, function* () {
      const updater = updaterServiceFactory.getGlobalPythonPathConfigurationService();
      const pythonPath = `xGlobalPythonPath${new Date().getMilliseconds()}`;
      const workspaceConfig = setupConfigProvider();
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => {
        // tslint:disable-next-line:no-any
        return {
          globalValue: pythonPath
        };
      });
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
    }));
    test('Python Path should be updated when current pythonPath is different', () => __awaiter(void 0, void 0, void 0, function* () {
      const updater = updaterServiceFactory.getGlobalPythonPathConfigurationService();
      const pythonPath = `xGlobalPythonPath${new Date().getMilliseconds()}`;
      const workspaceConfig = setupConfigProvider();
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => undefined);
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isValue('pythonPath'), TypeMoq.It.isValue(pythonPath), TypeMoq.It.isValue(true)), TypeMoq.Times.once());
    }));
  });
  suite('WorkspaceFolder', () => {
    setup(setupMocks);
    test('Python Path should not be updated when current pythonPath is the same', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspaceFolderPath = path.join('user', 'desktop', 'development');
      const workspaceFolder = vscode_1.Uri.file(workspaceFolderPath);
      const updater = updaterServiceFactory.getWorkspaceFolderPythonPathConfigurationService(workspaceFolder);
      const pythonPath = `xWorkspaceFolderPythonPath${new Date().getMilliseconds()}`;
      const workspaceConfig = setupConfigProvider(workspaceFolder);
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => {
        // tslint:disable-next-line:no-any
        return {
          workspaceFolderValue: pythonPath
        };
      });
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
    }));
    test('Python Path should be updated when current pythonPath is different', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspaceFolderPath = path.join('user', 'desktop', 'development');
      const workspaceFolder = vscode_1.Uri.file(workspaceFolderPath);
      const updater = updaterServiceFactory.getWorkspaceFolderPythonPathConfigurationService(workspaceFolder);
      const pythonPath = `xWorkspaceFolderPythonPath${new Date().getMilliseconds()}`;
      const workspaceConfig = setupConfigProvider(workspaceFolder);
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => undefined);
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isValue('pythonPath'), TypeMoq.It.isValue(pythonPath), TypeMoq.It.isValue(vscode_1.ConfigurationTarget.WorkspaceFolder)), TypeMoq.Times.once());
    }));
    test('Python Path should be truncated for worspace-relative paths', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspaceFolderPath = path.join('user', 'desktop', 'development');
      const workspaceFolder = vscode_1.Uri.file(workspaceFolderPath);
      const updater = updaterServiceFactory.getWorkspaceFolderPythonPathConfigurationService(workspaceFolder);
      const pythonPath = vscode_1.Uri.file(path.join(workspaceFolderPath, 'env', 'bin', 'python')).fsPath;
      const expectedPythonPath = path.join('env', 'bin', 'python');
      const workspaceConfig = setupConfigProvider(workspaceFolder);
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => undefined);
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isValue('pythonPath'), TypeMoq.It.isValue(expectedPythonPath), TypeMoq.It.isValue(vscode_1.ConfigurationTarget.WorkspaceFolder)), TypeMoq.Times.once());
    }));
  });
  suite('Workspace (multiroot scenario)', () => {
    setup(setupMocks);
    test('Python Path should not be updated when current pythonPath is the same', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspaceFolderPath = path.join('user', 'desktop', 'development');
      const workspaceFolder = vscode_1.Uri.file(workspaceFolderPath);
      const updater = updaterServiceFactory.getWorkspacePythonPathConfigurationService(workspaceFolder);
      const pythonPath = `xWorkspaceFolderPythonPath${new Date().getMilliseconds()}`;
      const workspaceConfig = setupConfigProvider(workspaceFolder);
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => {
        // tslint:disable-next-line:no-any
        return {
          workspaceValue: pythonPath
        };
      });
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
    }));
    test('Python Path should be updated when current pythonPath is different', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspaceFolderPath = path.join('user', 'desktop', 'development');
      const workspaceFolder = vscode_1.Uri.file(workspaceFolderPath);
      const updater = updaterServiceFactory.getWorkspacePythonPathConfigurationService(workspaceFolder);
      const pythonPath = `xWorkspaceFolderPythonPath${new Date().getMilliseconds()}`;
      const workspaceConfig = setupConfigProvider(workspaceFolder);
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => undefined);
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isValue('pythonPath'), TypeMoq.It.isValue(pythonPath), TypeMoq.It.isValue(false)), TypeMoq.Times.once());
    }));
    test('Python Path should be truncated for workspace-relative paths', () => __awaiter(void 0, void 0, void 0, function* () {
      const workspaceFolderPath = path.join('user', 'desktop', 'development');
      const workspaceFolder = vscode_1.Uri.file(workspaceFolderPath);
      const updater = updaterServiceFactory.getWorkspacePythonPathConfigurationService(workspaceFolder);
      const pythonPath = vscode_1.Uri.file(path.join(workspaceFolderPath, 'env', 'bin', 'python')).fsPath;
      const expectedPythonPath = path.join('env', 'bin', 'python');
      const workspaceConfig = setupConfigProvider(workspaceFolder);
      workspaceConfig.setup(w => w.inspect(TypeMoq.It.isValue('pythonPath'))).returns(() => undefined);
      yield updater.updatePythonPath(pythonPath);
      workspaceConfig.verify(w => w.update(TypeMoq.It.isValue('pythonPath'), TypeMoq.It.isValue(expectedPythonPath), TypeMoq.It.isValue(false)), TypeMoq.Times.once());
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5dGhvblBhdGhVcGRhdGVyLnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInBhdGgiLCJyZXF1aXJlIiwiVHlwZU1vcSIsInZzY29kZV8xIiwidHlwZXNfMSIsInB5dGhvblBhdGhVcGRhdGVyU2VydmljZUZhY3RvcnlfMSIsInN1aXRlIiwic2VydmljZUNvbnRhaW5lciIsIndvcmtzcGFjZVNlcnZpY2UiLCJ1cGRhdGVyU2VydmljZUZhY3RvcnkiLCJzZXR1cE1vY2tzIiwiTW9jayIsIm9mVHlwZSIsInNldHVwIiwiYyIsImdldCIsIkl0IiwiaXNWYWx1ZSIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwicmV0dXJucyIsIm9iamVjdCIsIlB5dGhvblBhdGhVcGRhdGVyU2VydmljZUZhY3RvcnkiLCJzZXR1cENvbmZpZ1Byb3ZpZGVyIiwicmVzb3VyY2UiLCJ3b3Jrc3BhY2VDb25maWciLCJ3IiwiZ2V0Q29uZmlndXJhdGlvbiIsInRlc3QiLCJ1cGRhdGVyIiwiZ2V0R2xvYmFsUHl0aG9uUGF0aENvbmZpZ3VyYXRpb25TZXJ2aWNlIiwicHl0aG9uUGF0aCIsIkRhdGUiLCJnZXRNaWxsaXNlY29uZHMiLCJpbnNwZWN0IiwiZ2xvYmFsVmFsdWUiLCJ1cGRhdGVQeXRob25QYXRoIiwidmVyaWZ5IiwidXBkYXRlIiwiaXNBbnkiLCJUaW1lcyIsIm5ldmVyIiwidW5kZWZpbmVkIiwib25jZSIsIndvcmtzcGFjZUZvbGRlclBhdGgiLCJqb2luIiwid29ya3NwYWNlRm9sZGVyIiwiVXJpIiwiZmlsZSIsImdldFdvcmtzcGFjZUZvbGRlclB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSIsIndvcmtzcGFjZUZvbGRlclZhbHVlIiwiQ29uZmlndXJhdGlvblRhcmdldCIsIldvcmtzcGFjZUZvbGRlciIsImZzUGF0aCIsImV4cGVjdGVkUHl0aG9uUGF0aCIsImdldFdvcmtzcGFjZVB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSIsIndvcmtzcGFjZVZhbHVlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFyQixHQUFzQyxJQUFJTixDQUFKLENBQU0sVUFBVUcsT0FBVixF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SCxDQS9HSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCBweXRob25QYXRoVXBkYXRlclNlcnZpY2VGYWN0b3J5XzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2ludGVycHJldGVyL2NvbmZpZ3VyYXRpb24vcHl0aG9uUGF0aFVwZGF0ZXJTZXJ2aWNlRmFjdG9yeVwiKTtcclxuLy8gdHNsaW50OmRpc2FibGU6bm8taW52YWxpZC10ZW1wbGF0ZS1zdHJpbmdzIG1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbnN1aXRlKCdQeXRob24gUGF0aCBTZXR0aW5ncyBVcGRhdGVyJywgKCkgPT4ge1xyXG4gICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICBsZXQgd29ya3NwYWNlU2VydmljZTtcclxuICAgIGxldCB1cGRhdGVyU2VydmljZUZhY3Rvcnk7XHJcbiAgICBmdW5jdGlvbiBzZXR1cE1vY2tzKCkge1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSVdvcmtzcGFjZVNlcnZpY2UpKSkucmV0dXJucygoKSA9PiB3b3Jrc3BhY2VTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgdXBkYXRlclNlcnZpY2VGYWN0b3J5ID0gbmV3IHB5dGhvblBhdGhVcGRhdGVyU2VydmljZUZhY3RvcnlfMS5QeXRob25QYXRoVXBkYXRlclNlcnZpY2VGYWN0b3J5KHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHNldHVwQ29uZmlnUHJvdmlkZXIocmVzb3VyY2UpIHtcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2VDb25maWcgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuZ2V0Q29uZmlndXJhdGlvbihUeXBlTW9xLkl0LmlzVmFsdWUoJ3B5dGhvbicpLCBUeXBlTW9xLkl0LmlzVmFsdWUocmVzb3VyY2UpKSkucmV0dXJucygoKSA9PiB3b3Jrc3BhY2VDb25maWcub2JqZWN0KTtcclxuICAgICAgICByZXR1cm4gd29ya3NwYWNlQ29uZmlnO1xyXG4gICAgfVxyXG4gICAgc3VpdGUoJ0dsb2JhbCcsICgpID0+IHtcclxuICAgICAgICBzZXR1cChzZXR1cE1vY2tzKTtcclxuICAgICAgICB0ZXN0KCdQeXRob24gUGF0aCBzaG91bGQgbm90IGJlIHVwZGF0ZWQgd2hlbiBjdXJyZW50IHB5dGhvblBhdGggaXMgdGhlIHNhbWUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXIgPSB1cGRhdGVyU2VydmljZUZhY3RvcnkuZ2V0R2xvYmFsUHl0aG9uUGF0aENvbmZpZ3VyYXRpb25TZXJ2aWNlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHB5dGhvblBhdGggPSBgeEdsb2JhbFB5dGhvblBhdGgke25ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCl9YDtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gc2V0dXBDb25maWdQcm92aWRlcigpO1xyXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb25maWcuc2V0dXAodyA9PiB3Lmluc3BlY3QoVHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob25QYXRoJykpKS5yZXR1cm5zKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IGdsb2JhbFZhbHVlOiBweXRob25QYXRoIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB5aWVsZCB1cGRhdGVyLnVwZGF0ZVB5dGhvblBhdGgocHl0aG9uUGF0aCk7XHJcbiAgICAgICAgICAgIHdvcmtzcGFjZUNvbmZpZy52ZXJpZnkodyA9PiB3LnVwZGF0ZShUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGVzdCgnUHl0aG9uIFBhdGggc2hvdWxkIGJlIHVwZGF0ZWQgd2hlbiBjdXJyZW50IHB5dGhvblBhdGggaXMgZGlmZmVyZW50JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVyID0gdXBkYXRlclNlcnZpY2VGYWN0b3J5LmdldEdsb2JhbFB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSgpO1xyXG4gICAgICAgICAgICBjb25zdCBweXRob25QYXRoID0gYHhHbG9iYWxQeXRob25QYXRoJHtuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUNvbmZpZyA9IHNldHVwQ29uZmlnUHJvdmlkZXIoKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnNldHVwKHcgPT4gdy5pbnNwZWN0KFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uUGF0aCcpKSkucmV0dXJucygoKSA9PiB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICB5aWVsZCB1cGRhdGVyLnVwZGF0ZVB5dGhvblBhdGgocHl0aG9uUGF0aCk7XHJcbiAgICAgICAgICAgIHdvcmtzcGFjZUNvbmZpZy52ZXJpZnkodyA9PiB3LnVwZGF0ZShUeXBlTW9xLkl0LmlzVmFsdWUoJ3B5dGhvblBhdGgnKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKHB5dGhvblBhdGgpLCBUeXBlTW9xLkl0LmlzVmFsdWUodHJ1ZSkpLCBUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfSk7XHJcbiAgICBzdWl0ZSgnV29ya3NwYWNlRm9sZGVyJywgKCkgPT4ge1xyXG4gICAgICAgIHNldHVwKHNldHVwTW9ja3MpO1xyXG4gICAgICAgIHRlc3QoJ1B5dGhvbiBQYXRoIHNob3VsZCBub3QgYmUgdXBkYXRlZCB3aGVuIGN1cnJlbnQgcHl0aG9uUGF0aCBpcyB0aGUgc2FtZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyUGF0aCA9IHBhdGguam9pbigndXNlcicsICdkZXNrdG9wJywgJ2RldmVsb3BtZW50Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHZzY29kZV8xLlVyaS5maWxlKHdvcmtzcGFjZUZvbGRlclBhdGgpO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVyID0gdXBkYXRlclNlcnZpY2VGYWN0b3J5LmdldFdvcmtzcGFjZUZvbGRlclB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSh3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBweXRob25QYXRoID0gYHhXb3Jrc3BhY2VGb2xkZXJQeXRob25QYXRoJHtuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUNvbmZpZyA9IHNldHVwQ29uZmlnUHJvdmlkZXIod29ya3NwYWNlRm9sZGVyKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnNldHVwKHcgPT4gdy5pbnNwZWN0KFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uUGF0aCcpKSkucmV0dXJucygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geyB3b3Jrc3BhY2VGb2xkZXJWYWx1ZTogcHl0aG9uUGF0aCB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgeWllbGQgdXBkYXRlci51cGRhdGVQeXRob25QYXRoKHB5dGhvblBhdGgpO1xyXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb25maWcudmVyaWZ5KHcgPT4gdy51cGRhdGUoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSksIFR5cGVNb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRlc3QoJ1B5dGhvbiBQYXRoIHNob3VsZCBiZSB1cGRhdGVkIHdoZW4gY3VycmVudCBweXRob25QYXRoIGlzIGRpZmZlcmVudCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyUGF0aCA9IHBhdGguam9pbigndXNlcicsICdkZXNrdG9wJywgJ2RldmVsb3BtZW50Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHZzY29kZV8xLlVyaS5maWxlKHdvcmtzcGFjZUZvbGRlclBhdGgpO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVyID0gdXBkYXRlclNlcnZpY2VGYWN0b3J5LmdldFdvcmtzcGFjZUZvbGRlclB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSh3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBweXRob25QYXRoID0gYHhXb3Jrc3BhY2VGb2xkZXJQeXRob25QYXRoJHtuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpfWA7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUNvbmZpZyA9IHNldHVwQ29uZmlnUHJvdmlkZXIod29ya3NwYWNlRm9sZGVyKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnNldHVwKHcgPT4gdy5pbnNwZWN0KFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uUGF0aCcpKSkucmV0dXJucygoKSA9PiB1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICB5aWVsZCB1cGRhdGVyLnVwZGF0ZVB5dGhvblBhdGgocHl0aG9uUGF0aCk7XHJcbiAgICAgICAgICAgIHdvcmtzcGFjZUNvbmZpZy52ZXJpZnkodyA9PiB3LnVwZGF0ZShUeXBlTW9xLkl0LmlzVmFsdWUoJ3B5dGhvblBhdGgnKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKHB5dGhvblBhdGgpLCBUeXBlTW9xLkl0LmlzVmFsdWUodnNjb2RlXzEuQ29uZmlndXJhdGlvblRhcmdldC5Xb3Jrc3BhY2VGb2xkZXIpKSwgVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIH0pKTtcclxuICAgICAgICB0ZXN0KCdQeXRob24gUGF0aCBzaG91bGQgYmUgdHJ1bmNhdGVkIGZvciB3b3JzcGFjZS1yZWxhdGl2ZSBwYXRocycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyUGF0aCA9IHBhdGguam9pbigndXNlcicsICdkZXNrdG9wJywgJ2RldmVsb3BtZW50Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHZzY29kZV8xLlVyaS5maWxlKHdvcmtzcGFjZUZvbGRlclBhdGgpO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVyID0gdXBkYXRlclNlcnZpY2VGYWN0b3J5LmdldFdvcmtzcGFjZUZvbGRlclB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSh3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBweXRob25QYXRoID0gdnNjb2RlXzEuVXJpLmZpbGUocGF0aC5qb2luKHdvcmtzcGFjZUZvbGRlclBhdGgsICdlbnYnLCAnYmluJywgJ3B5dGhvbicpKS5mc1BhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkUHl0aG9uUGF0aCA9IHBhdGguam9pbignZW52JywgJ2JpbicsICdweXRob24nKTtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gc2V0dXBDb25maWdQcm92aWRlcih3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb25maWcuc2V0dXAodyA9PiB3Lmluc3BlY3QoVHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob25QYXRoJykpKS5yZXR1cm5zKCgpID0+IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIHlpZWxkIHVwZGF0ZXIudXBkYXRlUHl0aG9uUGF0aChweXRob25QYXRoKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnZlcmlmeSh3ID0+IHcudXBkYXRlKFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uUGF0aCcpLCBUeXBlTW9xLkl0LmlzVmFsdWUoZXhwZWN0ZWRQeXRob25QYXRoKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKHZzY29kZV8xLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlRm9sZGVyKSksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9KTtcclxuICAgIHN1aXRlKCdXb3Jrc3BhY2UgKG11bHRpcm9vdCBzY2VuYXJpbyknLCAoKSA9PiB7XHJcbiAgICAgICAgc2V0dXAoc2V0dXBNb2Nrcyk7XHJcbiAgICAgICAgdGVzdCgnUHl0aG9uIFBhdGggc2hvdWxkIG5vdCBiZSB1cGRhdGVkIHdoZW4gY3VycmVudCBweXRob25QYXRoIGlzIHRoZSBzYW1lJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCB3b3Jrc3BhY2VGb2xkZXJQYXRoID0gcGF0aC5qb2luKCd1c2VyJywgJ2Rlc2t0b3AnLCAnZGV2ZWxvcG1lbnQnKTtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyID0gdnNjb2RlXzEuVXJpLmZpbGUod29ya3NwYWNlRm9sZGVyUGF0aCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXIgPSB1cGRhdGVyU2VydmljZUZhY3RvcnkuZ2V0V29ya3NwYWNlUHl0aG9uUGF0aENvbmZpZ3VyYXRpb25TZXJ2aWNlKHdvcmtzcGFjZUZvbGRlcik7XHJcbiAgICAgICAgICAgIGNvbnN0IHB5dGhvblBhdGggPSBgeFdvcmtzcGFjZUZvbGRlclB5dGhvblBhdGgke25ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCl9YDtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gc2V0dXBDb25maWdQcm92aWRlcih3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb25maWcuc2V0dXAodyA9PiB3Lmluc3BlY3QoVHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob25QYXRoJykpKS5yZXR1cm5zKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IHdvcmtzcGFjZVZhbHVlOiBweXRob25QYXRoIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB5aWVsZCB1cGRhdGVyLnVwZGF0ZVB5dGhvblBhdGgocHl0aG9uUGF0aCk7XHJcbiAgICAgICAgICAgIHdvcmtzcGFjZUNvbmZpZy52ZXJpZnkodyA9PiB3LnVwZGF0ZShUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgICAgdGVzdCgnUHl0aG9uIFBhdGggc2hvdWxkIGJlIHVwZGF0ZWQgd2hlbiBjdXJyZW50IHB5dGhvblBhdGggaXMgZGlmZmVyZW50JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCB3b3Jrc3BhY2VGb2xkZXJQYXRoID0gcGF0aC5qb2luKCd1c2VyJywgJ2Rlc2t0b3AnLCAnZGV2ZWxvcG1lbnQnKTtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyID0gdnNjb2RlXzEuVXJpLmZpbGUod29ya3NwYWNlRm9sZGVyUGF0aCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXIgPSB1cGRhdGVyU2VydmljZUZhY3RvcnkuZ2V0V29ya3NwYWNlUHl0aG9uUGF0aENvbmZpZ3VyYXRpb25TZXJ2aWNlKHdvcmtzcGFjZUZvbGRlcik7XHJcbiAgICAgICAgICAgIGNvbnN0IHB5dGhvblBhdGggPSBgeFdvcmtzcGFjZUZvbGRlclB5dGhvblBhdGgke25ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCl9YDtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gc2V0dXBDb25maWdQcm92aWRlcih3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb25maWcuc2V0dXAodyA9PiB3Lmluc3BlY3QoVHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob25QYXRoJykpKS5yZXR1cm5zKCgpID0+IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIHlpZWxkIHVwZGF0ZXIudXBkYXRlUHl0aG9uUGF0aChweXRob25QYXRoKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnZlcmlmeSh3ID0+IHcudXBkYXRlKFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uUGF0aCcpLCBUeXBlTW9xLkl0LmlzVmFsdWUocHl0aG9uUGF0aCksIFR5cGVNb3EuSXQuaXNWYWx1ZShmYWxzZSkpLCBUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHRlc3QoJ1B5dGhvbiBQYXRoIHNob3VsZCBiZSB0cnVuY2F0ZWQgZm9yIHdvcmtzcGFjZS1yZWxhdGl2ZSBwYXRocycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyUGF0aCA9IHBhdGguam9pbigndXNlcicsICdkZXNrdG9wJywgJ2RldmVsb3BtZW50Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHZzY29kZV8xLlVyaS5maWxlKHdvcmtzcGFjZUZvbGRlclBhdGgpO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVyID0gdXBkYXRlclNlcnZpY2VGYWN0b3J5LmdldFdvcmtzcGFjZVB5dGhvblBhdGhDb25maWd1cmF0aW9uU2VydmljZSh3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBweXRob25QYXRoID0gdnNjb2RlXzEuVXJpLmZpbGUocGF0aC5qb2luKHdvcmtzcGFjZUZvbGRlclBhdGgsICdlbnYnLCAnYmluJywgJ3B5dGhvbicpKS5mc1BhdGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkUHl0aG9uUGF0aCA9IHBhdGguam9pbignZW52JywgJ2JpbicsICdweXRob24nKTtcclxuICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gc2V0dXBDb25maWdQcm92aWRlcih3b3Jrc3BhY2VGb2xkZXIpO1xyXG4gICAgICAgICAgICB3b3Jrc3BhY2VDb25maWcuc2V0dXAodyA9PiB3Lmluc3BlY3QoVHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob25QYXRoJykpKS5yZXR1cm5zKCgpID0+IHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIHlpZWxkIHVwZGF0ZXIudXBkYXRlUHl0aG9uUGF0aChweXRob25QYXRoKTtcclxuICAgICAgICAgICAgd29ya3NwYWNlQ29uZmlnLnZlcmlmeSh3ID0+IHcudXBkYXRlKFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uUGF0aCcpLCBUeXBlTW9xLkl0LmlzVmFsdWUoZXhwZWN0ZWRQeXRob25QYXRoKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKGZhbHNlKSksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9KTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXB5dGhvblBhdGhVcGRhdGVyLnRlc3QuanMubWFwIl19