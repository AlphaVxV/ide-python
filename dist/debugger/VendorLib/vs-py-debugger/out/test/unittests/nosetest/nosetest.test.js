"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const fs = require("fs");

const path = require("path");

const vscode = require("vscode");

const constants_1 = require("../../../client/common/constants");

const constants_2 = require("../../../client/unittests/common/constants");

const types_1 = require("../../../client/unittests/common/types");

const common_1 = require("../../common");

const helper_1 = require("../helper");

const serviceRegistry_1 = require("../serviceRegistry");

const initialize_1 = require("./../../initialize");

const UNITTEST_TEST_FILES_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'noseFiles');
const UNITTEST_SINGLE_TEST_FILE_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'single');
const filesToDelete = [path.join(UNITTEST_TEST_FILES_PATH, '.noseids'), path.join(UNITTEST_SINGLE_TEST_FILE_PATH, '.noseids')]; // tslint:disable-next-line:max-func-body-length

suite('Unit Tests - nose - discovery against actual python process', () => {
  let ioc;
  const configTarget = initialize_1.IS_MULTI_ROOT_TEST ? vscode.ConfigurationTarget.WorkspaceFolder : vscode.ConfigurationTarget.Workspace;
  suiteSetup(() => __awaiter(void 0, void 0, void 0, function* () {
    filesToDelete.forEach(file => {
      if (fs.existsSync(file)) {
        fs.unlinkSync(file);
      }
    });
    yield common_1.updateSetting('unitTest.nosetestArgs', [], common_1.rootWorkspaceUri, configTarget);
    yield initialize_1.initialize();
  }));
  suiteTeardown(() => __awaiter(void 0, void 0, void 0, function* () {
    yield common_1.updateSetting('unitTest.nosetestArgs', [], common_1.rootWorkspaceUri, configTarget);
    filesToDelete.forEach(file => {
      if (fs.existsSync(file)) {
        fs.unlinkSync(file);
      }
    });
  }));
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initializeTest();
    initializeDI();
  }));
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    ioc.dispose();
    yield common_1.updateSetting('unitTest.nosetestArgs', [], common_1.rootWorkspaceUri, configTarget);
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerProcessTypes();
    ioc.registerUnitTestTypes();
    ioc.registerVariableTypes();
  }

  test('Discover Tests (single test file)', () => __awaiter(void 0, void 0, void 0, function* () {
    const factory = ioc.serviceContainer.get(types_1.ITestManagerFactory);
    const testManager = factory('nosetest', common_1.rootWorkspaceUri, UNITTEST_SINGLE_TEST_FILE_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    assert.equal(tests.testFiles.length, 2, 'Incorrect number of test files');
    assert.equal(tests.testFunctions.length, 6, 'Incorrect number of test functions');
    assert.equal(tests.testSuites.length, 2, 'Incorrect number of test suites');
    helper_1.lookForTestFile(tests, path.join('tests', 'test_one.py'));
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vc2V0ZXN0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImFzc2VydCIsInJlcXVpcmUiLCJmcyIsInBhdGgiLCJ2c2NvZGUiLCJjb25zdGFudHNfMSIsImNvbnN0YW50c18yIiwidHlwZXNfMSIsImNvbW1vbl8xIiwiaGVscGVyXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsImluaXRpYWxpemVfMSIsIlVOSVRURVNUX1RFU1RfRklMRVNfUEFUSCIsImpvaW4iLCJFWFRFTlNJT05fUk9PVF9ESVIiLCJVTklUVEVTVF9TSU5HTEVfVEVTVF9GSUxFX1BBVEgiLCJmaWxlc1RvRGVsZXRlIiwic3VpdGUiLCJpb2MiLCJjb25maWdUYXJnZXQiLCJJU19NVUxUSV9ST09UX1RFU1QiLCJDb25maWd1cmF0aW9uVGFyZ2V0IiwiV29ya3NwYWNlRm9sZGVyIiwiV29ya3NwYWNlIiwic3VpdGVTZXR1cCIsImZvckVhY2giLCJmaWxlIiwiZXhpc3RzU3luYyIsInVubGlua1N5bmMiLCJ1cGRhdGVTZXR0aW5nIiwicm9vdFdvcmtzcGFjZVVyaSIsImluaXRpYWxpemUiLCJzdWl0ZVRlYXJkb3duIiwic2V0dXAiLCJpbml0aWFsaXplVGVzdCIsImluaXRpYWxpemVESSIsInRlYXJkb3duIiwiZGlzcG9zZSIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwicmVnaXN0ZXJDb21tb25UeXBlcyIsInJlZ2lzdGVyUHJvY2Vzc1R5cGVzIiwicmVnaXN0ZXJVbml0VGVzdFR5cGVzIiwicmVnaXN0ZXJWYXJpYWJsZVR5cGVzIiwidGVzdCIsImZhY3RvcnkiLCJzZXJ2aWNlQ29udGFpbmVyIiwiZ2V0IiwiSVRlc3RNYW5hZ2VyRmFjdG9yeSIsInRlc3RNYW5hZ2VyIiwidGVzdHMiLCJkaXNjb3ZlclRlc3RzIiwiQ29tbWFuZFNvdXJjZSIsInVpIiwiZXF1YWwiLCJ0ZXN0RmlsZXMiLCJsZW5ndGgiLCJ0ZXN0RnVuY3Rpb25zIiwidGVzdFN1aXRlcyIsImxvb2tGb3JUZXN0RmlsZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFB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SUFBQUEsR0FBRyxDQUFDd0IscUJBQUo7QUFDSDs7QUFDREMsRUFBQUEsSUFBSSxDQUFDLG1DQUFELEVBQXNDLE1BQU1oRSxTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ3pGLFVBQU1pRSxPQUFPLEdBQUcxQixHQUFHLENBQUMyQixnQkFBSixDQUFxQkMsR0FBckIsQ0FBeUJ2QyxPQUFPLENBQUN3QyxtQkFBakMsQ0FBaEI7QUFDQSxVQUFNQyxXQUFXLEdBQUdKLE9BQU8sQ0FBQyxVQUFELEVBQWFwQyxRQUFRLENBQUNzQixnQkFBdEIsRUFBd0NmLDhCQUF4QyxDQUEzQjtBQUNBLFVBQU1rQyxLQUFLLEdBQUcsTUFBTUQsV0FBVyxDQUFDRSxhQUFaLENBQTBCNUMsV0FBVyxDQUFDNkMsYUFBWixDQUEwQkMsRUFBcEQsRUFBd0QsSUFBeEQsRUFBOEQsSUFBOUQsQ0FBcEI7QUFDQXBELElBQUFBLE1BQU0sQ0FBQ3FELEtBQVAsQ0FBYUosS0FBSyxDQUFDSyxTQUFOLENBQWdCQyxNQUE3QixFQUFxQyxDQUFyQyxFQUF3QyxnQ0FBeEM7QUFDQXZELElBQUFBLE1BQU0sQ0FBQ3FELEtBQVAsQ0FBYUosS0FBSyxDQUFDTyxhQUFOLENBQW9CRCxNQUFqQyxFQUF5QyxDQUF6QyxFQUE0QyxvQ0FBNUM7QUFDQXZELElBQUFBLE1BQU0sQ0FBQ3FELEtBQVAsQ0FBYUosS0FBSyxDQUFDUSxVQUFOLENBQWlCRixNQUE5QixFQUFzQyxDQUF0QyxFQUF5QyxpQ0FBekM7QUFDQTlDLElBQUFBLFFBQVEsQ0FBQ2lELGVBQVQsQ0FBeUJULEtBQXpCLEVBQWdDOUMsSUFBSSxDQUFDVSxJQUFMLENBQVUsT0FBVixFQUFtQixhQUFuQixDQUFoQztBQUNILEdBUndELENBQXJELENBQUo7QUFTSCxDQTVDSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKFwiZnNcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdnNjb2RlID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvdW5pdHRlc3RzL2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uXCIpO1xyXG5jb25zdCBoZWxwZXJfMSA9IHJlcXVpcmUoXCIuLi9oZWxwZXJcIik7XHJcbmNvbnN0IHNlcnZpY2VSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4uL3NlcnZpY2VSZWdpc3RyeVwiKTtcclxuY29uc3QgaW5pdGlhbGl6ZV8xID0gcmVxdWlyZShcIi4vLi4vLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3QgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIID0gcGF0aC5qb2luKGNvbnN0YW50c18xLkVYVEVOU0lPTl9ST09UX0RJUiwgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ3Rlc3RGaWxlcycsICdub3NlRmlsZXMnKTtcclxuY29uc3QgVU5JVFRFU1RfU0lOR0xFX1RFU1RfRklMRV9QQVRIID0gcGF0aC5qb2luKGNvbnN0YW50c18xLkVYVEVOU0lPTl9ST09UX0RJUiwgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ3Rlc3RGaWxlcycsICdzaW5nbGUnKTtcclxuY29uc3QgZmlsZXNUb0RlbGV0ZSA9IFtcclxuICAgIHBhdGguam9pbihVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgsICcubm9zZWlkcycpLFxyXG4gICAgcGF0aC5qb2luKFVOSVRURVNUX1NJTkdMRV9URVNUX0ZJTEVfUEFUSCwgJy5ub3NlaWRzJylcclxuXTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbnN1aXRlKCdVbml0IFRlc3RzIC0gbm9zZSAtIGRpc2NvdmVyeSBhZ2FpbnN0IGFjdHVhbCBweXRob24gcHJvY2VzcycsICgpID0+IHtcclxuICAgIGxldCBpb2M7XHJcbiAgICBjb25zdCBjb25maWdUYXJnZXQgPSBpbml0aWFsaXplXzEuSVNfTVVMVElfUk9PVF9URVNUID8gdnNjb2RlLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlRm9sZGVyIDogdnNjb2RlLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlO1xyXG4gICAgc3VpdGVTZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgZmlsZXNUb0RlbGV0ZS5mb3JFYWNoKGZpbGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlKSkge1xyXG4gICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhmaWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0Lm5vc2V0ZXN0QXJncycsIFtdLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5pbml0aWFsaXplKCk7XHJcbiAgICB9KSk7XHJcbiAgICBzdWl0ZVRlYXJkb3duKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5ub3NldGVzdEFyZ3MnLCBbXSwgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgY29uZmlnVGFyZ2V0KTtcclxuICAgICAgICBmaWxlc1RvRGVsZXRlLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKGZpbGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KSk7XHJcbiAgICBzZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemVUZXN0KCk7XHJcbiAgICAgICAgaW5pdGlhbGl6ZURJKCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZWFyZG93bigoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgaW9jLmRpc3Bvc2UoKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5ub3NldGVzdEFyZ3MnLCBbXSwgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgY29uZmlnVGFyZ2V0KTtcclxuICAgIH0pKTtcclxuICAgIGZ1bmN0aW9uIGluaXRpYWxpemVESSgpIHtcclxuICAgICAgICBpb2MgPSBuZXcgc2VydmljZVJlZ2lzdHJ5XzEuVW5pdFRlc3RJb2NDb250YWluZXIoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJDb21tb25UeXBlcygpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlclByb2Nlc3NUeXBlcygpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlclVuaXRUZXN0VHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJWYXJpYWJsZVR5cGVzKCk7XHJcbiAgICB9XHJcbiAgICB0ZXN0KCdEaXNjb3ZlciBUZXN0cyAoc2luZ2xlIHRlc3QgZmlsZSknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklUZXN0TWFuYWdlckZhY3RvcnkpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RNYW5hZ2VyID0gZmFjdG9yeSgnbm9zZXRlc3QnLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBVTklUVEVTVF9TSU5HTEVfVEVTVF9GSUxFX1BBVEgpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RzID0geWllbGQgdGVzdE1hbmFnZXIuZGlzY292ZXJUZXN0cyhjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGVzdHMudGVzdEZpbGVzLmxlbmd0aCwgMiwgJ0luY29ycmVjdCBudW1iZXIgb2YgdGVzdCBmaWxlcycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXN0cy50ZXN0RnVuY3Rpb25zLmxlbmd0aCwgNiwgJ0luY29ycmVjdCBudW1iZXIgb2YgdGVzdCBmdW5jdGlvbnMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGVzdHMudGVzdFN1aXRlcy5sZW5ndGgsIDIsICdJbmNvcnJlY3QgbnVtYmVyIG9mIHRlc3Qgc3VpdGVzJyk7XHJcbiAgICAgICAgaGVscGVyXzEubG9va0ZvclRlc3RGaWxlKHRlc3RzLCBwYXRoLmpvaW4oJ3Rlc3RzJywgJ3Rlc3Rfb25lLnB5JykpO1xyXG4gICAgfSkpO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bm9zZXRlc3QudGVzdC5qcy5tYXAiXX0=