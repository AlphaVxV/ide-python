"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const fs = require("fs");

const path = require("path");

const vscode = require("vscode");

const constants_1 = require("../../../client/common/constants");

const types_1 = require("../../../client/common/process/types");

const constants_2 = require("../../../client/unittests/common/constants");

const types_2 = require("../../../client/unittests/common/types");

const common_1 = require("../../common");

const serviceRegistry_1 = require("../serviceRegistry");

const initialize_1 = require("./../../initialize");

const UNITTEST_TEST_FILES_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'noseFiles');
const UNITTEST_SINGLE_TEST_FILE_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'single');
const filesToDelete = [path.join(UNITTEST_TEST_FILES_PATH, '.noseids'), path.join(UNITTEST_SINGLE_TEST_FILE_PATH, '.noseids')]; // tslint:disable-next-line:max-func-body-length

suite('Unit Tests - nose - run against actual python process', () => {
  let ioc;
  const configTarget = initialize_1.IS_MULTI_ROOT_TEST ? vscode.ConfigurationTarget.WorkspaceFolder : vscode.ConfigurationTarget.Workspace;
  suiteSetup(() => __awaiter(void 0, void 0, void 0, function* () {
    filesToDelete.forEach(file => {
      if (fs.existsSync(file)) {
        fs.unlinkSync(file);
      }
    });
    yield common_1.updateSetting('unitTest.nosetestArgs', [], common_1.rootWorkspaceUri, configTarget);
    yield initialize_1.initialize();
  }));
  suiteTeardown(() => __awaiter(void 0, void 0, void 0, function* () {
    yield common_1.updateSetting('unitTest.nosetestArgs', [], common_1.rootWorkspaceUri, configTarget);
    filesToDelete.forEach(file => {
      if (fs.existsSync(file)) {
        fs.unlinkSync(file);
      }
    });
  }));
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initializeTest();
    initializeDI();
  }));
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    ioc.dispose();
    yield common_1.updateSetting('unitTest.nosetestArgs', [], common_1.rootWorkspaceUri, configTarget);
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerUnitTestTypes();
    ioc.registerVariableTypes();
    ioc.registerMockProcessTypes();
  }

  function injectTestDiscoveryOutput(outputFileName) {
    return __awaiter(this, void 0, void 0, function* () {
      const procService = yield ioc.serviceContainer.get(types_1.IProcessServiceFactory).create();
      procService.onExecObservable((file, args, options, callback) => {
        if (args.indexOf('--collect-only') >= 0) {
          callback({
            out: fs.readFileSync(path.join(UNITTEST_TEST_FILES_PATH, outputFileName), 'utf8').replace(/\/Users\/donjayamanne\/.vscode\/extensions\/pythonVSCode\/src\/test\/pythonFiles\/testFiles\/noseFiles/g, UNITTEST_TEST_FILES_PATH),
            source: 'stdout'
          });
        }
      });
    });
  }

  function injectTestRunOutput(outputFileName, failedOutput = false) {
    return __awaiter(this, void 0, void 0, function* () {
      const procService = yield ioc.serviceContainer.get(types_1.IProcessServiceFactory).create();
      procService.onExecObservable((file, args, options, callback) => {
        if (failedOutput && args.indexOf('--failed') === -1) {
          return;
        }

        const index = args.findIndex(arg => arg.startsWith('--xunit-file='));

        if (index >= 0) {
          const fileName = args[index].substr('--xunit-file='.length);
          const contents = fs.readFileSync(path.join(UNITTEST_TEST_FILES_PATH, outputFileName), 'utf8');
          fs.writeFileSync(fileName, contents, 'utf8');
          callback({
            out: '',
            source: 'stdout'
          });
        }
      });
    });
  }

  test('Run Tests', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('run.one.output');
    yield injectTestRunOutput('run.one.result');
    yield common_1.updateSetting('unitTest.nosetestArgs', ['-m', 'test'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('nosetest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const results = yield testManager.runTest(constants_2.CommandSource.ui);
    assert.equal(results.summary.errors, 1, 'Errors');
    assert.equal(results.summary.failures, 7, 'Failures');
    assert.equal(results.summary.passed, 6, 'Passed');
    assert.equal(results.summary.skipped, 2, 'skipped');
  }));
  test('Run Failed Tests', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('run.two.output');
    yield injectTestRunOutput('run.two.result');
    yield injectTestRunOutput('run.two.again.result', true);
    yield common_1.updateSetting('unitTest.nosetestArgs', ['-m', 'test'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('nosetest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    let results = yield testManager.runTest(constants_2.CommandSource.ui);
    assert.equal(results.summary.errors, 1, 'Errors');
    assert.equal(results.summary.failures, 7, 'Failures');
    assert.equal(results.summary.passed, 6, 'Passed');
    assert.equal(results.summary.skipped, 2, 'skipped');
    results = yield testManager.runTest(constants_2.CommandSource.ui, undefined, true);
    assert.equal(results.summary.errors, 1, 'Errors again');
    assert.equal(results.summary.failures, 7, 'Failures again');
    assert.equal(results.summary.passed, 0, 'Passed again');
    assert.equal(results.summary.skipped, 0, 'skipped again');
  }));
  test('Run Specific Test File', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('run.three.output');
    yield injectTestRunOutput('run.three.result');
    yield common_1.updateSetting('unitTest.nosetestArgs', ['-m', 'test'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('nosetest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    const testFileToRun = tests.testFiles.find(t => t.fullPath.endsWith('test_root.py'));
    assert.ok(testFileToRun, 'Test file not found'); // tslint:disable-next-line:no-non-null-assertion

    const testFile = {
      testFile: [testFileToRun],
      testFolder: [],
      testFunction: [],
      testSuite: []
    };
    const results = yield testManager.runTest(constants_2.CommandSource.ui, testFile);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 1, 'Failures');
    assert.equal(results.summary.passed, 1, 'Passed');
    assert.equal(results.summary.skipped, 1, 'skipped');
  }));
  test('Run Specific Test Suite', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('run.four.output');
    yield injectTestRunOutput('run.four.result');
    yield common_1.updateSetting('unitTest.nosetestArgs', ['-m', 'test'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('nosetest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    const testSuiteToRun = tests.testSuites.find(s => s.xmlClassName === 'test_root.Test_Root_test1');
    assert.ok(testSuiteToRun, 'Test suite not found'); // tslint:disable-next-line:no-non-null-assertion

    const testSuite = {
      testFile: [],
      testFolder: [],
      testFunction: [],
      testSuite: [testSuiteToRun.testSuite]
    };
    const results = yield testManager.runTest(constants_2.CommandSource.ui, testSuite);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 1, 'Failures');
    assert.equal(results.summary.passed, 1, 'Passed');
    assert.equal(results.summary.skipped, 1, 'skipped');
  }));
  test('Run Specific Test Function', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('run.five.output');
    yield injectTestRunOutput('run.five.result');
    yield common_1.updateSetting('unitTest.nosetestArgs', ['-m', 'test'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('nosetest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    const testFnToRun = tests.testFunctions.find(f => f.xmlClassName === 'test_root.Test_Root_test1');
    assert.ok(testFnToRun, 'Test function not found'); // tslint:disable-next-line:no-non-null-assertion

    const testFn = {
      testFile: [],
      testFolder: [],
      testFunction: [testFnToRun.testFunction],
      testSuite: []
    };
    const results = yield testManager.runTest(constants_2.CommandSource.ui, testFn);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 1, 'Failures');
    assert.equal(results.summary.passed, 0, 'Passed');
    assert.equal(results.summary.skipped, 0, 'skipped');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vc2V0ZXN0LnJ1bi50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJhc3NlcnQiLCJyZXF1aXJlIiwiZnMiLCJwYXRoIiwidnNjb2RlIiwiY29uc3RhbnRzXzEiLCJ0eXBlc18xIiwiY29uc3RhbnRzXzIiLCJ0eXBlc18yIiwiY29tbW9uXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsImluaXRpYWxpemVfMSIsIlVOSVRURVNUX1RFU1RfRklMRVNfUEFUSCIsImpvaW4iLCJFWFRFTlNJT05fUk9PVF9ESVIiLCJVTklUVEVTVF9TSU5HTEVfVEVTVF9GSUxFX1BBVEgiLCJmaWxlc1RvRGVsZXRlIiwic3VpdGUiLCJpb2MiLCJjb25maWdUYXJnZXQiLCJJU19NVUxUSV9ST09UX1RFU1QiLCJDb25maWd1cmF0aW9uVGFyZ2V0IiwiV29ya3NwYWNlRm9sZGVyIiwiV29ya3NwYWNlIiwic3VpdGVTZXR1cCIsImZvckVhY2giLCJmaWxlIiwiZXhpc3RzU3luYyIsInVubGlua1N5bmMiLCJ1cGRhdGVTZXR0aW5nIiwicm9vdFdvcmtzcGFjZVVyaSIsImluaXRpYWxpemUiLCJzdWl0ZVRlYXJkb3duIiwic2V0dXAiLCJpbml0aWFsaXplVGVzdCIsImluaXRpYWxpemVESSIsInRlYXJkb3duIiwiZGlzcG9zZSIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwicmVnaXN0ZXJDb21tb25UeXBlcyIsInJlZ2lzdGVyVW5pdFRlc3RUeXBlcyIsInJlZ2lzdGVyVmFyaWFibGVUeXBlcyIsInJlZ2lzdGVyTW9ja1Byb2Nlc3NUeXBlcyIsImluamVjdFRlc3REaXNjb3ZlcnlPdXRwdXQiLCJvdXRwdXRGaWxlTmFtZSIsInByb2NTZXJ2aWNlIiwic2VydmljZUNvbnRhaW5lciIsImdldCIsIklQcm9jZXNzU2VydmljZUZhY3RvcnkiLCJjcmVhdGUiLCJvbkV4ZWNPYnNlcnZhYmxlIiwiYXJncyIsIm9wdGlvbnMiLCJjYWxsYmFjayIsImluZGV4T2YiLCJvdXQiLCJyZWFkRmlsZVN5bmMiLCJyZXBsYWNlIiwic291cmNlIiwiaW5qZWN0VGVzdFJ1bk91dHB1dCIsImZhaWxlZE91dHB1dCIsImluZGV4IiwiZmluZEluZGV4IiwiYXJnIiwic3RhcnRzV2l0aCIsImZpbGVOYW1lIiwic3Vic3RyIiwibGVuZ3RoIiwiY29udGVudHMiLCJ3cml0ZUZpbGVTeW5jIiwidGVzdCIsImZhY3RvcnkiLCJJVGVzdE1hbmFnZXJGYWN0b3J5IiwidGVzdE1hbmFnZXIiLCJyZXN1bHRzIiwicnVuVGVzdCIsIkNvbW1hbmRTb3VyY2UiLCJ1aSIsImVxdWFsIiwic3VtbWFyeSIsImVycm9ycyIsImZhaWx1cmVzIiwicGFzc2VkIiwic2tpcHBlZCIsInVuZGVmaW5lZCIsInRlc3RzIiwiZGlzY292ZXJUZXN0cyIsInRlc3RGaWxlVG9SdW4iLCJ0ZXN0RmlsZXMiLCJmaW5kIiwidCIsImZ1bGxQYXRoIiwiZW5kc1dpdGgiLCJvayIsInRlc3RGaWxlIiwidGVzdEZvbGRlciIsInRlc3RGdW5jdGlvbiIsInRlc3RTdWl0ZSIsInRlc3RTdWl0ZVRvUnVuIiwidGVzdFN1aXRlcyIsInMiLCJ4bWxDbGFzc05hbWUiLCJ0ZXN0Rm5Ub1J1biIsInRlc3RGdW5jdGlvbnMiLCJmIiwidGVzdEZuIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMs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QUNOLFlBQWIsQ0FBOUM7QUFBMEVDLE1BQUFBLFNBQVMsRUFBRTtBQUFyRixLQUFmO0FBQ0EsVUFBTXZCLE9BQU8sR0FBRyxNQUFNRCxXQUFXLENBQUNFLE9BQVosQ0FBb0JwRSxXQUFXLENBQUNxRSxhQUFaLENBQTBCQyxFQUE5QyxFQUFrRDRCLE1BQWxELENBQXRCO0FBQ0F6RyxJQUFBQSxNQUFNLENBQUM4RSxLQUFQLENBQWFKLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQkMsTUFBN0IsRUFBcUMsQ0FBckMsRUFBd0MsUUFBeEM7QUFDQWhGLElBQUFBLE1BQU0sQ0FBQzhFLEtBQVAsQ0FBYUosT0FBTyxDQUFDSyxPQUFSLENBQWdCRSxRQUE3QixFQUF1QyxDQUF2QyxFQUEwQyxVQUExQztBQUNBakYsSUFBQUEsTUFBTSxDQUFDOEUsS0FBUCxDQUFhSixPQUFPLENBQUNLLE9BQVIsQ0FBZ0JHLE1BQTdCLEVBQXFDLENBQXJDLEVBQXdDLFFBQXhDO0FBQ0FsRixJQUFBQSxNQUFNLENBQUM4RSxLQUFQLENBQWFKLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQkksT0FBN0IsRUFBc0MsQ0FBdEMsRUFBeUMsU0FBekM7QUFDSCxHQWhCaUQsQ0FBOUMsQ0FBSjtBQWlCSCxDQWxKSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKFwiZnNcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdnNjb2RlID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL3R5cGVzXCIpO1xyXG5jb25zdCBjb25zdGFudHNfMiA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvdW5pdHRlc3RzL2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L3VuaXR0ZXN0cy9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vblwiKTtcclxuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi4vc2VydmljZVJlZ2lzdHJ5XCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi8uLi8uLi9pbml0aWFsaXplXCIpO1xyXG5jb25zdCBVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEggPSBwYXRoLmpvaW4oY29uc3RhbnRzXzEuRVhURU5TSU9OX1JPT1RfRElSLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAndGVzdEZpbGVzJywgJ25vc2VGaWxlcycpO1xyXG5jb25zdCBVTklUVEVTVF9TSU5HTEVfVEVTVF9GSUxFX1BBVEggPSBwYXRoLmpvaW4oY29uc3RhbnRzXzEuRVhURU5TSU9OX1JPT1RfRElSLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAndGVzdEZpbGVzJywgJ3NpbmdsZScpO1xyXG5jb25zdCBmaWxlc1RvRGVsZXRlID0gW1xyXG4gICAgcGF0aC5qb2luKFVOSVRURVNUX1RFU1RfRklMRVNfUEFUSCwgJy5ub3NlaWRzJyksXHJcbiAgICBwYXRoLmpvaW4oVU5JVFRFU1RfU0lOR0xFX1RFU1RfRklMRV9QQVRILCAnLm5vc2VpZHMnKVxyXG5dO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ1VuaXQgVGVzdHMgLSBub3NlIC0gcnVuIGFnYWluc3QgYWN0dWFsIHB5dGhvbiBwcm9jZXNzJywgKCkgPT4ge1xyXG4gICAgbGV0IGlvYztcclxuICAgIGNvbnN0IGNvbmZpZ1RhcmdldCA9IGluaXRpYWxpemVfMS5JU19NVUxUSV9ST09UX1RFU1QgPyB2c2NvZGUuQ29uZmlndXJhdGlvblRhcmdldC5Xb3Jrc3BhY2VGb2xkZXIgOiB2c2NvZGUuQ29uZmlndXJhdGlvblRhcmdldC5Xb3Jrc3BhY2U7XHJcbiAgICBzdWl0ZVNldHVwKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBmaWxlc1RvRGVsZXRlLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKGZpbGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgeWllbGQgY29tbW9uXzEudXBkYXRlU2V0dGluZygndW5pdFRlc3Qubm9zZXRlc3RBcmdzJywgW10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUoKTtcclxuICAgIH0pKTtcclxuICAgIHN1aXRlVGVhcmRvd24oKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0Lm5vc2V0ZXN0QXJncycsIFtdLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIGZpbGVzVG9EZWxldGUuZm9yRWFjaChmaWxlID0+IHtcclxuICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZSkpIHtcclxuICAgICAgICAgICAgICAgIGZzLnVubGlua1N5bmMoZmlsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pKTtcclxuICAgIHNldHVwKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBpbml0aWFsaXplXzEuaW5pdGlhbGl6ZVRlc3QoKTtcclxuICAgICAgICBpbml0aWFsaXplREkoKTtcclxuICAgIH0pKTtcclxuICAgIHRlYXJkb3duKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBpb2MuZGlzcG9zZSgpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0Lm5vc2V0ZXN0QXJncycsIFtdLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgfSkpO1xyXG4gICAgZnVuY3Rpb24gaW5pdGlhbGl6ZURJKCkge1xyXG4gICAgICAgIGlvYyA9IG5ldyBzZXJ2aWNlUmVnaXN0cnlfMS5Vbml0VGVzdElvY0NvbnRhaW5lcigpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlckNvbW1vblR5cGVzKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyVW5pdFRlc3RUeXBlcygpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlclZhcmlhYmxlVHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJNb2NrUHJvY2Vzc1R5cGVzKCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBpbmplY3RUZXN0RGlzY292ZXJ5T3V0cHV0KG91dHB1dEZpbGVOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSB5aWVsZCBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JUHJvY2Vzc1NlcnZpY2VGYWN0b3J5KS5jcmVhdGUoKTtcclxuICAgICAgICAgICAgcHJvY1NlcnZpY2Uub25FeGVjT2JzZXJ2YWJsZSgoZmlsZSwgYXJncywgb3B0aW9ucywgY2FsbGJhY2spID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmluZGV4T2YoJy0tY29sbGVjdC1vbmx5JykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0OiBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKFVOSVRURVNUX1RFU1RfRklMRVNfUEFUSCwgb3V0cHV0RmlsZU5hbWUpLCAndXRmOCcpLnJlcGxhY2UoL1xcL1VzZXJzXFwvZG9uamF5YW1hbm5lXFwvLnZzY29kZVxcL2V4dGVuc2lvbnNcXC9weXRob25WU0NvZGVcXC9zcmNcXC90ZXN0XFwvcHl0aG9uRmlsZXNcXC90ZXN0RmlsZXNcXC9ub3NlRmlsZXMvZywgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc3Rkb3V0J1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGluamVjdFRlc3RSdW5PdXRwdXQob3V0cHV0RmlsZU5hbWUsIGZhaWxlZE91dHB1dCA9IGZhbHNlKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgY29uc3QgcHJvY1NlcnZpY2UgPSB5aWVsZCBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JUHJvY2Vzc1NlcnZpY2VGYWN0b3J5KS5jcmVhdGUoKTtcclxuICAgICAgICAgICAgcHJvY1NlcnZpY2Uub25FeGVjT2JzZXJ2YWJsZSgoZmlsZSwgYXJncywgb3B0aW9ucywgY2FsbGJhY2spID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChmYWlsZWRPdXRwdXQgJiYgYXJncy5pbmRleE9mKCctLWZhaWxlZCcpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gYXJncy5maW5kSW5kZXgoYXJnID0+IGFyZy5zdGFydHNXaXRoKCctLXh1bml0LWZpbGU9JykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGFyZ3NbaW5kZXhdLnN1YnN0cignLS14dW5pdC1maWxlPScubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50cyA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRILCBvdXRwdXRGaWxlTmFtZSksICd1dGY4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlTmFtZSwgY29udGVudHMsICd1dGY4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeyBvdXQ6ICcnLCBzb3VyY2U6ICdzdGRvdXQnIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHRlc3QoJ1J1biBUZXN0cycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0RGlzY292ZXJ5T3V0cHV0KCdydW4ub25lLm91dHB1dCcpO1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3RSdW5PdXRwdXQoJ3J1bi5vbmUucmVzdWx0Jyk7XHJcbiAgICAgICAgeWllbGQgY29tbW9uXzEudXBkYXRlU2V0dGluZygndW5pdFRlc3Qubm9zZXRlc3RBcmdzJywgWyctbScsICd0ZXN0J10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklUZXN0TWFuYWdlckZhY3RvcnkpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RNYW5hZ2VyID0gZmFjdG9yeSgnbm9zZXRlc3QnLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSB5aWVsZCB0ZXN0TWFuYWdlci5ydW5UZXN0KGNvbnN0YW50c18yLkNvbW1hbmRTb3VyY2UudWkpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZXJyb3JzLCAxLCAnRXJyb3JzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5mYWlsdXJlcywgNywgJ0ZhaWx1cmVzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5wYXNzZWQsIDYsICdQYXNzZWQnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnNraXBwZWQsIDIsICdza2lwcGVkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdSdW4gRmFpbGVkIFRlc3RzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3REaXNjb3ZlcnlPdXRwdXQoJ3J1bi50d28ub3V0cHV0Jyk7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdFJ1bk91dHB1dCgncnVuLnR3by5yZXN1bHQnKTtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0UnVuT3V0cHV0KCdydW4udHdvLmFnYWluLnJlc3VsdCcsIHRydWUpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0Lm5vc2V0ZXN0QXJncycsIFsnLW0nLCAndGVzdCddLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JVGVzdE1hbmFnZXJGYWN0b3J5KTtcclxuICAgICAgICBjb25zdCB0ZXN0TWFuYWdlciA9IGZhY3RvcnkoJ25vc2V0ZXN0JywgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIKTtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHlpZWxkIHRlc3RNYW5hZ2VyLnJ1blRlc3QoY29uc3RhbnRzXzIuQ29tbWFuZFNvdXJjZS51aSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5lcnJvcnMsIDEsICdFcnJvcnMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmZhaWx1cmVzLCA3LCAnRmFpbHVyZXMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnBhc3NlZCwgNiwgJ1Bhc3NlZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuc2tpcHBlZCwgMiwgJ3NraXBwZWQnKTtcclxuICAgICAgICByZXN1bHRzID0geWllbGQgdGVzdE1hbmFnZXIucnVuVGVzdChjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB1bmRlZmluZWQsIHRydWUpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZXJyb3JzLCAxLCAnRXJyb3JzIGFnYWluJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5mYWlsdXJlcywgNywgJ0ZhaWx1cmVzIGFnYWluJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5wYXNzZWQsIDAsICdQYXNzZWQgYWdhaW4nKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnNraXBwZWQsIDAsICdza2lwcGVkIGFnYWluJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdSdW4gU3BlY2lmaWMgVGVzdCBGaWxlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3REaXNjb3ZlcnlPdXRwdXQoJ3J1bi50aHJlZS5vdXRwdXQnKTtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0UnVuT3V0cHV0KCdydW4udGhyZWUucmVzdWx0Jyk7XHJcbiAgICAgICAgeWllbGQgY29tbW9uXzEudXBkYXRlU2V0dGluZygndW5pdFRlc3Qubm9zZXRlc3RBcmdzJywgWyctbScsICd0ZXN0J10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklUZXN0TWFuYWdlckZhY3RvcnkpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RNYW5hZ2VyID0gZmFjdG9yeSgnbm9zZXRlc3QnLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RzID0geWllbGQgdGVzdE1hbmFnZXIuZGlzY292ZXJUZXN0cyhjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICBjb25zdCB0ZXN0RmlsZVRvUnVuID0gdGVzdHMudGVzdEZpbGVzLmZpbmQodCA9PiB0LmZ1bGxQYXRoLmVuZHNXaXRoKCd0ZXN0X3Jvb3QucHknKSk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKHRlc3RGaWxlVG9SdW4sICdUZXN0IGZpbGUgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgIGNvbnN0IHRlc3RGaWxlID0geyB0ZXN0RmlsZTogW3Rlc3RGaWxlVG9SdW5dLCB0ZXN0Rm9sZGVyOiBbXSwgdGVzdEZ1bmN0aW9uOiBbXSwgdGVzdFN1aXRlOiBbXSB9O1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSB5aWVsZCB0ZXN0TWFuYWdlci5ydW5UZXN0KGNvbnN0YW50c18yLkNvbW1hbmRTb3VyY2UudWksIHRlc3RGaWxlKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmVycm9ycywgMCwgJ0Vycm9ycycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZmFpbHVyZXMsIDEsICdGYWlsdXJlcycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkucGFzc2VkLCAxLCAnUGFzc2VkJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5za2lwcGVkLCAxLCAnc2tpcHBlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnUnVuIFNwZWNpZmljIFRlc3QgU3VpdGUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdERpc2NvdmVyeU91dHB1dCgncnVuLmZvdXIub3V0cHV0Jyk7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdFJ1bk91dHB1dCgncnVuLmZvdXIucmVzdWx0Jyk7XHJcbiAgICAgICAgeWllbGQgY29tbW9uXzEudXBkYXRlU2V0dGluZygndW5pdFRlc3Qubm9zZXRlc3RBcmdzJywgWyctbScsICd0ZXN0J10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklUZXN0TWFuYWdlckZhY3RvcnkpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RNYW5hZ2VyID0gZmFjdG9yeSgnbm9zZXRlc3QnLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RzID0geWllbGQgdGVzdE1hbmFnZXIuZGlzY292ZXJUZXN0cyhjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICBjb25zdCB0ZXN0U3VpdGVUb1J1biA9IHRlc3RzLnRlc3RTdWl0ZXMuZmluZChzID0+IHMueG1sQ2xhc3NOYW1lID09PSAndGVzdF9yb290LlRlc3RfUm9vdF90ZXN0MScpO1xyXG4gICAgICAgIGFzc2VydC5vayh0ZXN0U3VpdGVUb1J1biwgJ1Rlc3Qgc3VpdGUgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgIGNvbnN0IHRlc3RTdWl0ZSA9IHsgdGVzdEZpbGU6IFtdLCB0ZXN0Rm9sZGVyOiBbXSwgdGVzdEZ1bmN0aW9uOiBbXSwgdGVzdFN1aXRlOiBbdGVzdFN1aXRlVG9SdW4udGVzdFN1aXRlXSB9O1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSB5aWVsZCB0ZXN0TWFuYWdlci5ydW5UZXN0KGNvbnN0YW50c18yLkNvbW1hbmRTb3VyY2UudWksIHRlc3RTdWl0ZSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5lcnJvcnMsIDAsICdFcnJvcnMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmZhaWx1cmVzLCAxLCAnRmFpbHVyZXMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnBhc3NlZCwgMSwgJ1Bhc3NlZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuc2tpcHBlZCwgMSwgJ3NraXBwZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1J1biBTcGVjaWZpYyBUZXN0IEZ1bmN0aW9uJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3REaXNjb3ZlcnlPdXRwdXQoJ3J1bi5maXZlLm91dHB1dCcpO1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3RSdW5PdXRwdXQoJ3J1bi5maXZlLnJlc3VsdCcpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0Lm5vc2V0ZXN0QXJncycsIFsnLW0nLCAndGVzdCddLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JVGVzdE1hbmFnZXJGYWN0b3J5KTtcclxuICAgICAgICBjb25zdCB0ZXN0TWFuYWdlciA9IGZhY3RvcnkoJ25vc2V0ZXN0JywgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIKTtcclxuICAgICAgICBjb25zdCB0ZXN0cyA9IHlpZWxkIHRlc3RNYW5hZ2VyLmRpc2NvdmVyVGVzdHMoY29uc3RhbnRzXzIuQ29tbWFuZFNvdXJjZS51aSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3QgdGVzdEZuVG9SdW4gPSB0ZXN0cy50ZXN0RnVuY3Rpb25zLmZpbmQoZiA9PiBmLnhtbENsYXNzTmFtZSA9PT0gJ3Rlc3Rfcm9vdC5UZXN0X1Jvb3RfdGVzdDEnKTtcclxuICAgICAgICBhc3NlcnQub2sodGVzdEZuVG9SdW4sICdUZXN0IGZ1bmN0aW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICBjb25zdCB0ZXN0Rm4gPSB7IHRlc3RGaWxlOiBbXSwgdGVzdEZvbGRlcjogW10sIHRlc3RGdW5jdGlvbjogW3Rlc3RGblRvUnVuLnRlc3RGdW5jdGlvbl0sIHRlc3RTdWl0ZTogW10gfTtcclxuICAgICAgICBjb25zdCByZXN1bHRzID0geWllbGQgdGVzdE1hbmFnZXIucnVuVGVzdChjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB0ZXN0Rm4pO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZXJyb3JzLCAwLCAnRXJyb3JzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5mYWlsdXJlcywgMSwgJ0ZhaWx1cmVzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5wYXNzZWQsIDAsICdQYXNzZWQnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnNraXBwZWQsIDAsICdza2lwcGVkJyk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1ub3NldGVzdC5ydW4udGVzdC5qcy5tYXAiXX0=