// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const chai_1 = require("chai");

const path = require("path");

const typeMoq = require("typemoq");

const types_1 = require("../../../client/common/types");

const argumentsHelper_1 = require("../../../client/unittests/common/argumentsHelper");

const argsService_1 = require("../../../client/unittests/pytest/services/argsService");

const types_2 = require("../../../client/unittests/types");

suite('ArgsService: pytest', () => {
  let argumentsService;
  suiteSetup(() => {
    const serviceContainer = typeMoq.Mock.ofType();
    const logger = typeMoq.Mock.ofType();
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_1.ILogger), typeMoq.It.isAny())).returns(() => logger.object);
    const argsHelper = new argumentsHelper_1.ArgumentsHelper(serviceContainer.object);
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_2.IArgumentsHelper), typeMoq.It.isAny())).returns(() => argsHelper);
    argumentsService = new argsService_1.ArgumentsService(serviceContainer.object);
  });
  test('Test getting the test folder in pytest', () => {
    const dir = path.join('a', 'b', 'c');
    const args = ['anzy', '--one', '--rootdir', dir];
    const testDirs = argumentsService.getTestFolders(args);
    chai_1.expect(testDirs).to.be.lengthOf(1);
    chai_1.expect(testDirs[0]).to.equal(dir);
  });
  test('Test getting the test folder in pytest (with multiple dirs)', () => {
    const dir = path.join('a', 'b', 'c');
    const dir2 = path.join('a', 'b', '2');
    const args = ['anzy', '--one', '--rootdir', dir, '--rootdir', dir2];
    const testDirs = argumentsService.getTestFolders(args);
    chai_1.expect(testDirs).to.be.lengthOf(2);
    chai_1.expect(testDirs[0]).to.equal(dir);
    chai_1.expect(testDirs[1]).to.equal(dir2);
  });
  test('Test getting the test folder in pytest (with multiple dirs in the middle)', () => {
    const dir = path.join('a', 'b', 'c');
    const dir2 = path.join('a', 'b', '2');
    const args = ['anzy', '--one', '--rootdir', dir, '--rootdir', dir2, '-xyz'];
    const testDirs = argumentsService.getTestFolders(args);
    chai_1.expect(testDirs).to.be.lengthOf(2);
    chai_1.expect(testDirs[0]).to.equal(dir);
    chai_1.expect(testDirs[1]).to.equal(dir2);
  });
  test('Test getting the test folder in pytest (with single positional dir)', () => {
    const dir = path.join('a', 'b', 'c');
    const args = ['anzy', '--one', dir];
    const testDirs = argumentsService.getTestFolders(args);
    chai_1.expect(testDirs).to.be.lengthOf(1);
    chai_1.expect(testDirs[0]).to.equal(dir);
  });
  test('Test getting the test folder in pytest (with multiple positional dirs)', () => {
    const dir = path.join('a', 'b', 'c');
    const dir2 = path.join('a', 'b', '2');
    const args = ['anzy', '--one', dir, dir2];
    const testDirs = argumentsService.getTestFolders(args);
    chai_1.expect(testDirs).to.be.lengthOf(2);
    chai_1.expect(testDirs[0]).to.equal(dir);
    chai_1.expect(testDirs[1]).to.equal(dir2);
  });
  test('Test getting the test folder in pytest (with multiple dirs excluding python files)', () => {
    const dir = path.join('a', 'b', 'c');
    const dir2 = path.join('a', 'b', '2');
    const args = ['anzy', '--one', dir, dir2, path.join(dir, 'one.py')];
    const testDirs = argumentsService.getTestFolders(args);
    chai_1.expect(testDirs).to.be.lengthOf(2);
    chai_1.expect(testDirs[0]).to.equal(dir);
    chai_1.expect(testDirs[1]).to.equal(dir2);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5dGVzdC5hcmdzU2VydmljZS51bml0LnRlc3QuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjaGFpXzEiLCJyZXF1aXJlIiwicGF0aCIsInR5cGVNb3EiLCJ0eXBlc18xIiwiYXJndW1lbnRzSGVscGVyXzEiLCJhcmdzU2VydmljZV8xIiwidHlwZXNfMiIsInN1aXRlIiwiYXJndW1lbnRzU2VydmljZSIsInN1aXRlU2V0dXAiLCJzZXJ2aWNlQ29udGFpbmVyIiwiTW9jayIsIm9mVHlwZSIsImxvZ2dlciIsInNldHVwIiwicyIsImdldCIsIkl0IiwiaXNWYWx1ZSIsIklMb2dnZXIiLCJpc0FueSIsInJldHVybnMiLCJvYmplY3QiLCJhcmdzSGVscGVyIiwiQXJndW1lbnRzSGVscGVyIiwiSUFyZ3VtZW50c0hlbHBlciIsIkFyZ3VtZW50c1NlcnZpY2UiLCJ0ZXN0IiwiZGlyIiwiam9pbiIsImFyZ3MiLCJ0ZXN0RGlycyIsImdldFRlc3RGb2xkZXJzIiwiZXhwZWN0IiwidG8iLCJiZSIsImxlbmd0aE9mIiwiZXF1YWwiLCJkaXIyIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7O0FBQ0EsTUFBTUMsTUFBTSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUF0Qjs7QUFDQSxNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1FLE9BQU8sR0FBR0YsT0FBTyxDQUFDLFNBQUQsQ0FBdkI7O0FBQ0EsTUFBTUcsT0FBTyxHQUFHSCxPQUFPLENBQUMsOEJBQUQsQ0FBdkI7O0FBQ0EsTUFBTUksaUJBQWlCLEdBQUdKLE9BQU8sQ0FBQyxrREFBRCxDQUFqQzs7QUFDQSxNQUFNSyxhQUFhLEdBQUdMLE9BQU8sQ0FBQyx1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USxDQUFDLENBQUQsQ0FBdEIsRUFBMkJHLEVBQTNCLENBQThCRyxLQUE5QixDQUFvQ0MsSUFBcEM7QUFDSCxHQVJHLENBQUo7QUFTQVgsRUFBQUEsSUFBSSxDQUFDLG9GQUFELEVBQXVGLE1BQU07QUFDN0YsVUFBTUMsR0FBRyxHQUFHM0IsSUFBSSxDQUFDNEIsSUFBTCxDQUFVLEdBQVYsRUFBZSxHQUFmLEVBQW9CLEdBQXBCLENBQVo7QUFDQSxVQUFNUyxJQUFJLEdBQUdyQyxJQUFJLENBQUM0QixJQUFMLENBQVUsR0FBVixFQUFlLEdBQWYsRUFBb0IsR0FBcEIsQ0FBYjtBQUNBLFVBQU1DLElBQUksR0FBRyxDQUFDLE1BQUQsRUFBUyxPQUFULEVBQWtCRixHQUFsQixFQUF1QlUsSUFBdkIsRUFBNkJyQyxJQUFJLENBQUM0QixJQUFMLENBQVVELEdBQVYsRUFBZSxRQUFmLENBQTdCLENBQWI7QUFDQSxVQUFNRyxRQUFRLEdBQUd2QixnQkFBZ0IsQ0FBQ3dCLGNBQWpCLENBQWdDRixJQUFoQyxDQUFqQjtBQUNBL0IsSUFBQUEsTUFBTSxDQUFDa0MsTUFBUCxDQUFjRixRQUFkLEVBQXdCRyxFQUF4QixDQUEyQkMsRUFBM0IsQ0FBOEJDLFFBQTlCLENBQXVDLENBQXZDO0FBQ0FyQyxJQUFBQSxNQUFNLENBQUNrQyxNQUFQLENBQWNGLFFBQVEsQ0FBQyxDQUFELENBQXRCLEVBQTJCRyxFQUEzQixDQUE4QkcsS0FBOUIsQ0FBb0NULEdBQXBDO0FBQ0E3QixJQUFBQSxNQUFNLENBQUNrQyxNQUFQLENBQWNGLFFBQVEsQ0FBQyxDQUFELENBQXRCLEVBQTJCRyxFQUEzQixDQUE4QkcsS0FBOUIsQ0FBb0NDLElBQXBDO0FBQ0gsR0FSRyxDQUFKO0FBU0gsQ0FoRUksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB0eXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgYXJndW1lbnRzSGVscGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L3VuaXR0ZXN0cy9jb21tb24vYXJndW1lbnRzSGVscGVyXCIpO1xyXG5jb25zdCBhcmdzU2VydmljZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvcHl0ZXN0L3NlcnZpY2VzL2FyZ3NTZXJ2aWNlXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvdHlwZXNcIik7XHJcbnN1aXRlKCdBcmdzU2VydmljZTogcHl0ZXN0JywgKCkgPT4ge1xyXG4gICAgbGV0IGFyZ3VtZW50c1NlcnZpY2U7XHJcbiAgICBzdWl0ZVNldHVwKCgpID0+IHtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlQ29udGFpbmVyID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IGxvZ2dlciA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyXHJcbiAgICAgICAgICAgIC5zZXR1cChzID0+IHMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklMb2dnZXIpLCB0eXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBsb2dnZXIub2JqZWN0KTtcclxuICAgICAgICBjb25zdCBhcmdzSGVscGVyID0gbmV3IGFyZ3VtZW50c0hlbHBlcl8xLkFyZ3VtZW50c0hlbHBlcihzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lclxyXG4gICAgICAgICAgICAuc2V0dXAocyA9PiBzLmdldCh0eXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JQXJndW1lbnRzSGVscGVyKSwgdHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gYXJnc0hlbHBlcik7XHJcbiAgICAgICAgYXJndW1lbnRzU2VydmljZSA9IG5ldyBhcmdzU2VydmljZV8xLkFyZ3VtZW50c1NlcnZpY2Uoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdUZXN0IGdldHRpbmcgdGhlIHRlc3QgZm9sZGVyIGluIHB5dGVzdCcsICgpID0+IHtcclxuICAgICAgICBjb25zdCBkaXIgPSBwYXRoLmpvaW4oJ2EnLCAnYicsICdjJyk7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IFsnYW56eScsICctLW9uZScsICctLXJvb3RkaXInLCBkaXJdO1xyXG4gICAgICAgIGNvbnN0IHRlc3REaXJzID0gYXJndW1lbnRzU2VydmljZS5nZXRUZXN0Rm9sZGVycyhhcmdzKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHRlc3REaXJzKS50by5iZS5sZW5ndGhPZigxKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHRlc3REaXJzWzBdKS50by5lcXVhbChkaXIpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdUZXN0IGdldHRpbmcgdGhlIHRlc3QgZm9sZGVyIGluIHB5dGVzdCAod2l0aCBtdWx0aXBsZSBkaXJzKScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBkaXIgPSBwYXRoLmpvaW4oJ2EnLCAnYicsICdjJyk7XHJcbiAgICAgICAgY29uc3QgZGlyMiA9IHBhdGguam9pbignYScsICdiJywgJzInKTtcclxuICAgICAgICBjb25zdCBhcmdzID0gWydhbnp5JywgJy0tb25lJywgJy0tcm9vdGRpcicsIGRpciwgJy0tcm9vdGRpcicsIGRpcjJdO1xyXG4gICAgICAgIGNvbnN0IHRlc3REaXJzID0gYXJndW1lbnRzU2VydmljZS5nZXRUZXN0Rm9sZGVycyhhcmdzKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHRlc3REaXJzKS50by5iZS5sZW5ndGhPZigyKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHRlc3REaXJzWzBdKS50by5lcXVhbChkaXIpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QodGVzdERpcnNbMV0pLnRvLmVxdWFsKGRpcjIpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdUZXN0IGdldHRpbmcgdGhlIHRlc3QgZm9sZGVyIGluIHB5dGVzdCAod2l0aCBtdWx0aXBsZSBkaXJzIGluIHRoZSBtaWRkbGUpJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRpciA9IHBhdGguam9pbignYScsICdiJywgJ2MnKTtcclxuICAgICAgICBjb25zdCBkaXIyID0gcGF0aC5qb2luKCdhJywgJ2InLCAnMicpO1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBbJ2FuenknLCAnLS1vbmUnLCAnLS1yb290ZGlyJywgZGlyLCAnLS1yb290ZGlyJywgZGlyMiwgJy14eXonXTtcclxuICAgICAgICBjb25zdCB0ZXN0RGlycyA9IGFyZ3VtZW50c1NlcnZpY2UuZ2V0VGVzdEZvbGRlcnMoYXJncyk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh0ZXN0RGlycykudG8uYmUubGVuZ3RoT2YoMik7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh0ZXN0RGlyc1swXSkudG8uZXF1YWwoZGlyKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHRlc3REaXJzWzFdKS50by5lcXVhbChkaXIyKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnVGVzdCBnZXR0aW5nIHRoZSB0ZXN0IGZvbGRlciBpbiBweXRlc3QgKHdpdGggc2luZ2xlIHBvc2l0aW9uYWwgZGlyKScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBkaXIgPSBwYXRoLmpvaW4oJ2EnLCAnYicsICdjJyk7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IFsnYW56eScsICctLW9uZScsIGRpcl07XHJcbiAgICAgICAgY29uc3QgdGVzdERpcnMgPSBhcmd1bWVudHNTZXJ2aWNlLmdldFRlc3RGb2xkZXJzKGFyZ3MpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QodGVzdERpcnMpLnRvLmJlLmxlbmd0aE9mKDEpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QodGVzdERpcnNbMF0pLnRvLmVxdWFsKGRpcik7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ1Rlc3QgZ2V0dGluZyB0aGUgdGVzdCBmb2xkZXIgaW4gcHl0ZXN0ICh3aXRoIG11bHRpcGxlIHBvc2l0aW9uYWwgZGlycyknLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGlyID0gcGF0aC5qb2luKCdhJywgJ2InLCAnYycpO1xyXG4gICAgICAgIGNvbnN0IGRpcjIgPSBwYXRoLmpvaW4oJ2EnLCAnYicsICcyJyk7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IFsnYW56eScsICctLW9uZScsIGRpciwgZGlyMl07XHJcbiAgICAgICAgY29uc3QgdGVzdERpcnMgPSBhcmd1bWVudHNTZXJ2aWNlLmdldFRlc3RGb2xkZXJzKGFyZ3MpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QodGVzdERpcnMpLnRvLmJlLmxlbmd0aE9mKDIpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QodGVzdERpcnNbMF0pLnRvLmVxdWFsKGRpcik7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh0ZXN0RGlyc1sxXSkudG8uZXF1YWwoZGlyMik7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ1Rlc3QgZ2V0dGluZyB0aGUgdGVzdCBmb2xkZXIgaW4gcHl0ZXN0ICh3aXRoIG11bHRpcGxlIGRpcnMgZXhjbHVkaW5nIHB5dGhvbiBmaWxlcyknLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGlyID0gcGF0aC5qb2luKCdhJywgJ2InLCAnYycpO1xyXG4gICAgICAgIGNvbnN0IGRpcjIgPSBwYXRoLmpvaW4oJ2EnLCAnYicsICcyJyk7XHJcbiAgICAgICAgY29uc3QgYXJncyA9IFsnYW56eScsICctLW9uZScsIGRpciwgZGlyMiwgcGF0aC5qb2luKGRpciwgJ29uZS5weScpXTtcclxuICAgICAgICBjb25zdCB0ZXN0RGlycyA9IGFyZ3VtZW50c1NlcnZpY2UuZ2V0VGVzdEZvbGRlcnMoYXJncyk7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh0ZXN0RGlycykudG8uYmUubGVuZ3RoT2YoMik7XHJcbiAgICAgICAgY2hhaV8xLmV4cGVjdCh0ZXN0RGlyc1swXSkudG8uZXF1YWwoZGlyKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHRlc3REaXJzWzFdKS50by5lcXVhbChkaXIyKTtcclxuICAgIH0pO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHl0ZXN0LmFyZ3NTZXJ2aWNlLnVuaXQudGVzdC5qcy5tYXAiXX0=