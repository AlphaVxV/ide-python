"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const fs = require("fs");

const path = require("path");

const vscode = require("vscode");

const constants_1 = require("../../../client/common/constants");

const types_1 = require("../../../client/common/process/types");

const constants_2 = require("../../../client/unittests/common/constants");

const types_2 = require("../../../client/unittests/common/types");

const common_1 = require("../../common");

const serviceRegistry_1 = require("../serviceRegistry");

const initialize_1 = require("./../../initialize");

const UNITTEST_TEST_FILES_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'standard');
const PYTEST_RESULTS_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'pytestFiles', 'results'); // tslint:disable-next-line:max-func-body-length

suite('Unit Tests - pytest - run with mocked process output', () => {
  let ioc;
  const configTarget = initialize_1.IS_MULTI_ROOT_TEST ? vscode.ConfigurationTarget.WorkspaceFolder : vscode.ConfigurationTarget.Workspace;
  suiteSetup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initialize();
    yield common_1.updateSetting('unitTest.pyTestArgs', [], common_1.rootWorkspaceUri, configTarget);
  }));
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initializeTest();
    initializeDI();
  }));
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    ioc.dispose();
    yield common_1.updateSetting('unitTest.pyTestArgs', [], common_1.rootWorkspaceUri, configTarget);
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerUnitTestTypes();
    ioc.registerVariableTypes(); // Mocks.

    ioc.registerMockProcessTypes();
  }

  function injectTestDiscoveryOutput(outputFileName) {
    return __awaiter(this, void 0, void 0, function* () {
      const procService = yield ioc.serviceContainer.get(types_1.IProcessServiceFactory).create();
      procService.onExecObservable((file, args, options, callback) => {
        if (args.indexOf('--collect-only') >= 0) {
          callback({
            out: fs.readFileSync(path.join(PYTEST_RESULTS_PATH, outputFileName), 'utf8').replace(/\/Users\/donjayamanne\/.vscode\/extensions\/pythonVSCode\/src\/test\/pythonFiles\/testFiles\/noseFiles/g, PYTEST_RESULTS_PATH),
            source: 'stdout'
          });
        }
      });
    });
  }

  function injectTestRunOutput(outputFileName, failedOutput = false) {
    return __awaiter(this, void 0, void 0, function* () {
      const procService = yield ioc.serviceContainer.get(types_1.IProcessServiceFactory).create();
      procService.onExecObservable((file, args, options, callback) => {
        if (failedOutput && args.indexOf('--last-failed') === -1) {
          return;
        }

        const index = args.findIndex(arg => arg.startsWith('--junitxml='));

        if (index >= 0) {
          const fileName = args[index].substr('--junitxml='.length);
          const contents = fs.readFileSync(path.join(PYTEST_RESULTS_PATH, outputFileName), 'utf8');
          fs.writeFileSync(fileName, contents, 'utf8');
          callback({
            out: '',
            source: 'stdout'
          });
        }
      });
    });
  }

  test('Run Tests', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('one.output');
    yield injectTestRunOutput('one.xml');
    yield common_1.updateSetting('unitTest.pyTestArgs', ['-k=test_'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('pytest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const results = yield testManager.runTest(constants_2.CommandSource.ui);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 9, 'Failures');
    assert.equal(results.summary.passed, 17, 'Passed');
    assert.equal(results.summary.skipped, 3, 'skipped');
  }));
  test('Run Failed Tests', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('two.output');
    yield injectTestRunOutput('two.xml');
    yield injectTestRunOutput('two.again.xml', true);
    yield common_1.updateSetting('unitTest.pyTestArgs', ['-k=test_'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('pytest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    let results = yield testManager.runTest(constants_2.CommandSource.ui);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 9, 'Failures');
    assert.equal(results.summary.passed, 17, 'Passed');
    assert.equal(results.summary.skipped, 3, 'skipped');
    results = yield testManager.runTest(constants_2.CommandSource.ui, undefined, true);
    assert.equal(results.summary.errors, 0, 'Failed Errors');
    assert.equal(results.summary.failures, 9, 'Failed Failures');
    assert.equal(results.summary.passed, 0, 'Failed Passed');
    assert.equal(results.summary.skipped, 0, 'Failed skipped');
  }));
  test('Run Specific Test File', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('three.output');
    yield injectTestRunOutput('three.xml');
    yield common_1.updateSetting('unitTest.pyTestArgs', ['-k=test_'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('pytest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    const testFile = {
      fullPath: path.join(UNITTEST_TEST_FILES_PATH, 'tests', 'test_another_pytest.py'),
      name: 'tests/test_another_pytest.py',
      nameToRun: 'tests/test_another_pytest.py',
      xmlName: 'tests/test_another_pytest.py',
      functions: [],
      suites: [],
      time: 0
    };
    const testFileToRun = {
      testFile: [testFile],
      testFolder: [],
      testFunction: [],
      testSuite: []
    };
    const results = yield testManager.runTest(constants_2.CommandSource.ui, testFileToRun);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 1, 'Failures');
    assert.equal(results.summary.passed, 3, 'Passed');
    assert.equal(results.summary.skipped, 0, 'skipped');
  }));
  test('Run Specific Test Suite', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('four.output');
    yield injectTestRunOutput('four.xml');
    yield common_1.updateSetting('unitTest.pyTestArgs', ['-k=test_'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('pytest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    const testSuite = {
      testFile: [],
      testFolder: [],
      testFunction: [],
      testSuite: [tests.testSuites[0].testSuite]
    };
    const results = yield testManager.runTest(constants_2.CommandSource.ui, testSuite);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 1, 'Failures');
    assert.equal(results.summary.passed, 1, 'Passed');
    assert.equal(results.summary.skipped, 1, 'skipped');
  }));
  test('Run Specific Test Function', () => __awaiter(void 0, void 0, void 0, function* () {
    yield injectTestDiscoveryOutput('five.output');
    yield injectTestRunOutput('five.xml');
    yield common_1.updateSetting('unitTest.pyTestArgs', ['-k=test_'], common_1.rootWorkspaceUri, configTarget);
    const factory = ioc.serviceContainer.get(types_2.ITestManagerFactory);
    const testManager = factory('pytest', common_1.rootWorkspaceUri, UNITTEST_TEST_FILES_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    const testFn = {
      testFile: [],
      testFolder: [],
      testFunction: [tests.testFunctions[0].testFunction],
      testSuite: []
    };
    const results = yield testManager.runTest(constants_2.CommandSource.ui, testFn);
    assert.equal(results.summary.errors, 0, 'Errors');
    assert.equal(results.summary.failures, 1, 'Failures');
    assert.equal(results.summary.passed, 0, 'Passed');
    assert.equal(results.summary.skipped, 0, 'skipped');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5dGVzdC5ydW4udGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiYXNzZXJ0IiwicmVxdWlyZSIsImZzIiwicGF0aCIsInZzY29kZSIsImNvbnN0YW50c18xIiwidHlwZXNfMSIsImNvbnN0YW50c18yIiwidHlwZXNfMiIsImNvbW1vbl8xIiwic2VydmljZVJlZ2lzdHJ5XzEiLCJpbml0aWFsaXplXzEiLCJVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgiLCJqb2luIiwiRVhURU5TSU9OX1JPT1RfRElSIiwiUFlURVNUX1JFU1VMVFNfUEFUSCIsInN1aXRlIiwiaW9jIiwiY29uZmlnVGFyZ2V0IiwiSVNfTVVMVElfUk9PVF9URVNUIiwiQ29uZmlndXJhdGlvblRhcmdldCIsIldvcmtzcGFjZUZvbGRlciIsIldvcmtzcGFjZSIsInN1aXRlU2V0dXAiLCJpbml0aWFsaXplIiwidXBkYXRlU2V0dGluZyIsInJvb3RXb3Jrc3BhY2VVcmkiLCJzZXR1cCIsImluaXRpYWxpemVUZXN0IiwiaW5pdGlhbGl6ZURJIiwidGVhcmRvd24iLCJkaXNwb3NlIiwiVW5pdFRlc3RJb2NDb250YWluZXIiLCJyZWdpc3RlckNvbW1vblR5cGVzIiwicmVnaXN0ZXJVbml0VGVzdFR5cGVzIiwicmVnaXN0ZXJWYXJpYWJsZVR5cGVzIiwicmVnaXN0ZXJNb2NrUHJvY2Vzc1R5cGVzIiwiaW5qZWN0VGVzdERpc2NvdmVyeU91dHB1dCIsIm91dHB1dEZpbGVOYW1lIiwicHJvY1NlcnZpY2UiLCJzZXJ2aWNlQ29udGFpbmVyIiwiZ2V0IiwiSVByb2Nlc3NTZXJ2aWNlRmFjdG9yeSIsImNyZWF0ZSIsIm9uRXhlY09ic2VydmFibGUiLCJmaWxlIiwiYXJncyIsIm9wdGlvbnMiLCJjYWxsYmFjayIsImluZGV4T2YiLCJvdXQiLCJyZWFkRmlsZVN5bmMiLCJyZXBsYWNlIiwic291cmNlIiwiaW5qZWN0VGVzdFJ1bk91dHB1dCIsImZhaWxlZE91dHB1dCIsImluZGV4IiwiZmluZEluZGV4IiwiYXJnIiwic3RhcnRzV2l0aCIsImZpbGVOYW1lIiwic3Vic3RyIiwibGVuZ3RoIiwiY29udGVudHMiLCJ3cml0ZUZpbGVTeW5jIiwidGVzdCIsImZhY3RvcnkiLCJJVGVzdE1hbmFnZXJGYWN0b3J5IiwidGVzdE1hbmFnZXIiLCJyZXN1bHRzIiwicnVuVGVzdCIsIkNvbW1hbmRTb3VyY2UiLCJ1aSIsImVxdWFsIiwic3VtbWFyeSIsImVycm9ycyIsImZhaWx1cmVzIiwicGFzc2VkIiwic2tpcHBlZCIsInVuZGVmaW5lZCIsImRpc2NvdmVyVGVzdHMiLCJ0ZXN0RmlsZSIsImZ1bGxQYXRoIiwibmFtZSIsIm5hbWVUb1J1biIsInhtbE5hbWUiLCJmdW5jdGlvbnMiLCJzdWl0ZXMiLCJ0aW1lIiwidGVzdEZpbGVUb1J1biIsInRlc3RGb2xkZXIiLCJ0ZXN0RnVuY3Rpb24iLCJ0ZXN0U3VpdGUiLCJ0ZXN0cyIsInRlc3RTdWl0ZXMiLCJ0ZXN0Rm4iLCJ0ZXN0RnVuY3Rpb25zIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENB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QUFrRHVCLE1BQWxELENBQXRCO0FBQ0EvRixJQUFBQSxNQUFNLENBQUN5RSxLQUFQLENBQWFKLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQkMsTUFBN0IsRUFBcUMsQ0FBckMsRUFBd0MsUUFBeEM7QUFDQTNFLElBQUFBLE1BQU0sQ0FBQ3lFLEtBQVAsQ0FBYUosT0FBTyxDQUFDSyxPQUFSLENBQWdCRSxRQUE3QixFQUF1QyxDQUF2QyxFQUEwQyxVQUExQztBQUNBNUUsSUFBQUEsTUFBTSxDQUFDeUUsS0FBUCxDQUFhSixPQUFPLENBQUNLLE9BQVIsQ0FBZ0JHLE1BQTdCLEVBQXFDLENBQXJDLEVBQXdDLFFBQXhDO0FBQ0E3RSxJQUFBQSxNQUFNLENBQUN5RSxLQUFQLENBQWFKLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQkksT0FBN0IsRUFBc0MsQ0FBdEMsRUFBeUMsU0FBekM7QUFDSCxHQWJpRCxDQUE5QyxDQUFKO0FBY0gsQ0F0SUksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcbmNvbnN0IGZzID0gcmVxdWlyZShcImZzXCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy90eXBlc1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L3VuaXR0ZXN0cy9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBjb21tb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb25cIik7XHJcbmNvbnN0IHNlcnZpY2VSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4uL3NlcnZpY2VSZWdpc3RyeVwiKTtcclxuY29uc3QgaW5pdGlhbGl6ZV8xID0gcmVxdWlyZShcIi4vLi4vLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3QgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIID0gcGF0aC5qb2luKGNvbnN0YW50c18xLkVYVEVOU0lPTl9ST09UX0RJUiwgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ3Rlc3RGaWxlcycsICdzdGFuZGFyZCcpO1xyXG5jb25zdCBQWVRFU1RfUkVTVUxUU19QQVRIID0gcGF0aC5qb2luKGNvbnN0YW50c18xLkVYVEVOU0lPTl9ST09UX0RJUiwgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ3Rlc3RGaWxlcycsICdweXRlc3RGaWxlcycsICdyZXN1bHRzJyk7XHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5zdWl0ZSgnVW5pdCBUZXN0cyAtIHB5dGVzdCAtIHJ1biB3aXRoIG1vY2tlZCBwcm9jZXNzIG91dHB1dCcsICgpID0+IHtcclxuICAgIGxldCBpb2M7XHJcbiAgICBjb25zdCBjb25maWdUYXJnZXQgPSBpbml0aWFsaXplXzEuSVNfTVVMVElfUk9PVF9URVNUID8gdnNjb2RlLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlRm9sZGVyIDogdnNjb2RlLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlO1xyXG4gICAgc3VpdGVTZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUoKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5weVRlc3RBcmdzJywgW10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICB9KSk7XHJcbiAgICBzZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemVUZXN0KCk7XHJcbiAgICAgICAgaW5pdGlhbGl6ZURJKCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZWFyZG93bigoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgaW9jLmRpc3Bvc2UoKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5weVRlc3RBcmdzJywgW10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICB9KSk7XHJcbiAgICBmdW5jdGlvbiBpbml0aWFsaXplREkoKSB7XHJcbiAgICAgICAgaW9jID0gbmV3IHNlcnZpY2VSZWdpc3RyeV8xLlVuaXRUZXN0SW9jQ29udGFpbmVyKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyQ29tbW9uVHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJVbml0VGVzdFR5cGVzKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyVmFyaWFibGVUeXBlcygpO1xyXG4gICAgICAgIC8vIE1vY2tzLlxyXG4gICAgICAgIGlvYy5yZWdpc3Rlck1vY2tQcm9jZXNzVHlwZXMoKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGluamVjdFRlc3REaXNjb3ZlcnlPdXRwdXQob3V0cHV0RmlsZU5hbWUpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9jU2VydmljZSA9IHlpZWxkIGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18xLklQcm9jZXNzU2VydmljZUZhY3RvcnkpLmNyZWF0ZSgpO1xyXG4gICAgICAgICAgICBwcm9jU2VydmljZS5vbkV4ZWNPYnNlcnZhYmxlKChmaWxlLCBhcmdzLCBvcHRpb25zLCBjYWxsYmFjaykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuaW5kZXhPZignLS1jb2xsZWN0LW9ubHknKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQ6IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oUFlURVNUX1JFU1VMVFNfUEFUSCwgb3V0cHV0RmlsZU5hbWUpLCAndXRmOCcpLnJlcGxhY2UoL1xcL1VzZXJzXFwvZG9uamF5YW1hbm5lXFwvLnZzY29kZVxcL2V4dGVuc2lvbnNcXC9weXRob25WU0NvZGVcXC9zcmNcXC90ZXN0XFwvcHl0aG9uRmlsZXNcXC90ZXN0RmlsZXNcXC9ub3NlRmlsZXMvZywgUFlURVNUX1JFU1VMVFNfUEFUSCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3N0ZG91dCdcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBpbmplY3RUZXN0UnVuT3V0cHV0KG91dHB1dEZpbGVOYW1lLCBmYWlsZWRPdXRwdXQgPSBmYWxzZSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2NTZXJ2aWNlID0geWllbGQgaW9jLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSVByb2Nlc3NTZXJ2aWNlRmFjdG9yeSkuY3JlYXRlKCk7XHJcbiAgICAgICAgICAgIHByb2NTZXJ2aWNlLm9uRXhlY09ic2VydmFibGUoKGZpbGUsIGFyZ3MsIG9wdGlvbnMsIGNhbGxiYWNrKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmFpbGVkT3V0cHV0ICYmIGFyZ3MuaW5kZXhPZignLS1sYXN0LWZhaWxlZCcpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gYXJncy5maW5kSW5kZXgoYXJnID0+IGFyZy5zdGFydHNXaXRoKCctLWp1bml0eG1sPScpKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBhcmdzW2luZGV4XS5zdWJzdHIoJy0tanVuaXR4bWw9Jy5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRzID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbihQWVRFU1RfUkVTVUxUU19QQVRILCBvdXRwdXRGaWxlTmFtZSksICd1dGY4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlTmFtZSwgY29udGVudHMsICd1dGY4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeyBvdXQ6ICcnLCBzb3VyY2U6ICdzdGRvdXQnIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHRlc3QoJ1J1biBUZXN0cycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0RGlzY292ZXJ5T3V0cHV0KCdvbmUub3V0cHV0Jyk7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdFJ1bk91dHB1dCgnb25lLnhtbCcpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0LnB5VGVzdEFyZ3MnLCBbJy1rPXRlc3RfJ10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklUZXN0TWFuYWdlckZhY3RvcnkpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RNYW5hZ2VyID0gZmFjdG9yeSgncHl0ZXN0JywgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIKTtcclxuICAgICAgICBjb25zdCByZXN1bHRzID0geWllbGQgdGVzdE1hbmFnZXIucnVuVGVzdChjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmVycm9ycywgMCwgJ0Vycm9ycycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZmFpbHVyZXMsIDksICdGYWlsdXJlcycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkucGFzc2VkLCAxNywgJ1Bhc3NlZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuc2tpcHBlZCwgMywgJ3NraXBwZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1J1biBGYWlsZWQgVGVzdHMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdERpc2NvdmVyeU91dHB1dCgndHdvLm91dHB1dCcpO1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3RSdW5PdXRwdXQoJ3R3by54bWwnKTtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0UnVuT3V0cHV0KCd0d28uYWdhaW4ueG1sJywgdHJ1ZSk7XHJcbiAgICAgICAgeWllbGQgY29tbW9uXzEudXBkYXRlU2V0dGluZygndW5pdFRlc3QucHlUZXN0QXJncycsIFsnLWs9dGVzdF8nXSwgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgY29uZmlnVGFyZ2V0KTtcclxuICAgICAgICBjb25zdCBmYWN0b3J5ID0gaW9jLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzIuSVRlc3RNYW5hZ2VyRmFjdG9yeSk7XHJcbiAgICAgICAgY29uc3QgdGVzdE1hbmFnZXIgPSBmYWN0b3J5KCdweXRlc3QnLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgpO1xyXG4gICAgICAgIGxldCByZXN1bHRzID0geWllbGQgdGVzdE1hbmFnZXIucnVuVGVzdChjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmVycm9ycywgMCwgJ0Vycm9ycycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZmFpbHVyZXMsIDksICdGYWlsdXJlcycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkucGFzc2VkLCAxNywgJ1Bhc3NlZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuc2tpcHBlZCwgMywgJ3NraXBwZWQnKTtcclxuICAgICAgICByZXN1bHRzID0geWllbGQgdGVzdE1hbmFnZXIucnVuVGVzdChjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB1bmRlZmluZWQsIHRydWUpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZXJyb3JzLCAwLCAnRmFpbGVkIEVycm9ycycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZmFpbHVyZXMsIDksICdGYWlsZWQgRmFpbHVyZXMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnBhc3NlZCwgMCwgJ0ZhaWxlZCBQYXNzZWQnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnNraXBwZWQsIDAsICdGYWlsZWQgc2tpcHBlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnUnVuIFNwZWNpZmljIFRlc3QgRmlsZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0RGlzY292ZXJ5T3V0cHV0KCd0aHJlZS5vdXRwdXQnKTtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0UnVuT3V0cHV0KCd0aHJlZS54bWwnKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5weVRlc3RBcmdzJywgWyctaz10ZXN0XyddLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JVGVzdE1hbmFnZXJGYWN0b3J5KTtcclxuICAgICAgICBjb25zdCB0ZXN0TWFuYWdlciA9IGZhY3RvcnkoJ3B5dGVzdCcsIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIFVOSVRURVNUX1RFU1RfRklMRVNfUEFUSCk7XHJcbiAgICAgICAgeWllbGQgdGVzdE1hbmFnZXIuZGlzY292ZXJUZXN0cyhjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB0cnVlLCB0cnVlKTtcclxuICAgICAgICBjb25zdCB0ZXN0RmlsZSA9IHtcclxuICAgICAgICAgICAgZnVsbFBhdGg6IHBhdGguam9pbihVTklUVEVTVF9URVNUX0ZJTEVTX1BBVEgsICd0ZXN0cycsICd0ZXN0X2Fub3RoZXJfcHl0ZXN0LnB5JyksXHJcbiAgICAgICAgICAgIG5hbWU6ICd0ZXN0cy90ZXN0X2Fub3RoZXJfcHl0ZXN0LnB5JyxcclxuICAgICAgICAgICAgbmFtZVRvUnVuOiAndGVzdHMvdGVzdF9hbm90aGVyX3B5dGVzdC5weScsXHJcbiAgICAgICAgICAgIHhtbE5hbWU6ICd0ZXN0cy90ZXN0X2Fub3RoZXJfcHl0ZXN0LnB5JyxcclxuICAgICAgICAgICAgZnVuY3Rpb25zOiBbXSxcclxuICAgICAgICAgICAgc3VpdGVzOiBbXSxcclxuICAgICAgICAgICAgdGltZTogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgdGVzdEZpbGVUb1J1biA9IHsgdGVzdEZpbGU6IFt0ZXN0RmlsZV0sIHRlc3RGb2xkZXI6IFtdLCB0ZXN0RnVuY3Rpb246IFtdLCB0ZXN0U3VpdGU6IFtdIH07XHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHlpZWxkIHRlc3RNYW5hZ2VyLnJ1blRlc3QoY29uc3RhbnRzXzIuQ29tbWFuZFNvdXJjZS51aSwgdGVzdEZpbGVUb1J1bik7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5lcnJvcnMsIDAsICdFcnJvcnMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmZhaWx1cmVzLCAxLCAnRmFpbHVyZXMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnBhc3NlZCwgMywgJ1Bhc3NlZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuc2tpcHBlZCwgMCwgJ3NraXBwZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ1J1biBTcGVjaWZpYyBUZXN0IFN1aXRlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGluamVjdFRlc3REaXNjb3ZlcnlPdXRwdXQoJ2ZvdXIub3V0cHV0Jyk7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdFJ1bk91dHB1dCgnZm91ci54bWwnKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5weVRlc3RBcmdzJywgWyctaz10ZXN0XyddLCBjb21tb25fMS5yb290V29ya3NwYWNlVXJpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JVGVzdE1hbmFnZXJGYWN0b3J5KTtcclxuICAgICAgICBjb25zdCB0ZXN0TWFuYWdlciA9IGZhY3RvcnkoJ3B5dGVzdCcsIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIFVOSVRURVNUX1RFU1RfRklMRVNfUEFUSCk7XHJcbiAgICAgICAgY29uc3QgdGVzdHMgPSB5aWVsZCB0ZXN0TWFuYWdlci5kaXNjb3ZlclRlc3RzKGNvbnN0YW50c18yLkNvbW1hbmRTb3VyY2UudWksIHRydWUsIHRydWUpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RTdWl0ZSA9IHsgdGVzdEZpbGU6IFtdLCB0ZXN0Rm9sZGVyOiBbXSwgdGVzdEZ1bmN0aW9uOiBbXSwgdGVzdFN1aXRlOiBbdGVzdHMudGVzdFN1aXRlc1swXS50ZXN0U3VpdGVdIH07XHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHlpZWxkIHRlc3RNYW5hZ2VyLnJ1blRlc3QoY29uc3RhbnRzXzIuQ29tbWFuZFNvdXJjZS51aSwgdGVzdFN1aXRlKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LmVycm9ycywgMCwgJ0Vycm9ycycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZmFpbHVyZXMsIDEsICdGYWlsdXJlcycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkucGFzc2VkLCAxLCAnUGFzc2VkJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5za2lwcGVkLCAxLCAnc2tpcHBlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnUnVuIFNwZWNpZmljIFRlc3QgRnVuY3Rpb24nLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5qZWN0VGVzdERpc2NvdmVyeU91dHB1dCgnZml2ZS5vdXRwdXQnKTtcclxuICAgICAgICB5aWVsZCBpbmplY3RUZXN0UnVuT3V0cHV0KCdmaXZlLnhtbCcpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3VuaXRUZXN0LnB5VGVzdEFyZ3MnLCBbJy1rPXRlc3RfJ10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IGlvYy5zZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc18yLklUZXN0TWFuYWdlckZhY3RvcnkpO1xyXG4gICAgICAgIGNvbnN0IHRlc3RNYW5hZ2VyID0gZmFjdG9yeSgncHl0ZXN0JywgY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSwgVU5JVFRFU1RfVEVTVF9GSUxFU19QQVRIKTtcclxuICAgICAgICBjb25zdCB0ZXN0cyA9IHlpZWxkIHRlc3RNYW5hZ2VyLmRpc2NvdmVyVGVzdHMoY29uc3RhbnRzXzIuQ29tbWFuZFNvdXJjZS51aSwgdHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3QgdGVzdEZuID0geyB0ZXN0RmlsZTogW10sIHRlc3RGb2xkZXI6IFtdLCB0ZXN0RnVuY3Rpb246IFt0ZXN0cy50ZXN0RnVuY3Rpb25zWzBdLnRlc3RGdW5jdGlvbl0sIHRlc3RTdWl0ZTogW10gfTtcclxuICAgICAgICBjb25zdCByZXN1bHRzID0geWllbGQgdGVzdE1hbmFnZXIucnVuVGVzdChjb25zdGFudHNfMi5Db21tYW5kU291cmNlLnVpLCB0ZXN0Rm4pO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChyZXN1bHRzLnN1bW1hcnkuZXJyb3JzLCAwLCAnRXJyb3JzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5mYWlsdXJlcywgMSwgJ0ZhaWx1cmVzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHJlc3VsdHMuc3VtbWFyeS5wYXNzZWQsIDAsICdQYXNzZWQnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0cy5zdW1tYXJ5LnNraXBwZWQsIDAsICdza2lwcGVkJyk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1weXRlc3QucnVuLnRlc3QuanMubWFwIl19