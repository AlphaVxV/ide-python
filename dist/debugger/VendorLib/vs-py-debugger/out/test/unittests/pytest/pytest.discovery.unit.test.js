// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length

const chai_1 = require("chai");

const chaipromise = require("chai-as-promised");

const path = require("path");

const typeMoq = require("typemoq");

const constants_1 = require("../../../client/unittests/common/constants");

const types_1 = require("../../../client/unittests/common/types");

const discoveryService_1 = require("../../../client/unittests/pytest/services/discoveryService");

const types_2 = require("../../../client/unittests/types");

chai_1.use(chaipromise);
suite('Unit Tests - PyTest - Discovery', () => {
  let discoveryService;
  let argsService;
  let testParser;
  let runner;
  let helper;
  setup(() => {
    const serviceContainer = typeMoq.Mock.ofType();
    argsService = typeMoq.Mock.ofType();
    testParser = typeMoq.Mock.ofType();
    runner = typeMoq.Mock.ofType();
    helper = typeMoq.Mock.ofType();
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_2.IArgumentsService), typeMoq.It.isAny())).returns(() => argsService.object);
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_1.ITestRunner), typeMoq.It.isAny())).returns(() => runner.object);
    serviceContainer.setup(s => s.get(typeMoq.It.isValue(types_1.ITestsHelper), typeMoq.It.isAny())).returns(() => helper.object);
    discoveryService = new discoveryService_1.TestDiscoveryService(serviceContainer.object, testParser.object);
  });
  test('Ensure discovery is invoked with the right args and single dir', () => __awaiter(void 0, void 0, void 0, function* () {
    const args = [];
    const runOutput = 'xyz';
    const dir = path.join('a', 'b', 'c');
    const tests = {
      summary: {
        errors: 1,
        failures: 0,
        passed: 0,
        skipped: 0
      },
      testFiles: [],
      testFunctions: [],
      testSuites: [],
      rootTestFolders: [],
      testFolders: []
    };
    argsService.setup(a => a.filterArguments(typeMoq.It.isValue(args), typeMoq.It.isValue(types_2.TestFilter.discovery))).returns(() => []).verifiable(typeMoq.Times.once());
    argsService.setup(a => a.getTestFolders(typeMoq.It.isValue(args))).returns(() => [dir]).verifiable(typeMoq.Times.once());
    helper.setup(a => a.mergeTests(typeMoq.It.isAny())).returns(() => tests).verifiable(typeMoq.Times.once());
    runner.setup(r => r.run(typeMoq.It.isValue(constants_1.PYTEST_PROVIDER), typeMoq.It.isAny())).callback((_, opts) => {
      chai_1.expect(opts.args).to.include('--cache-clear');
      chai_1.expect(opts.args).to.include('-s');
      chai_1.expect(opts.args).to.include('--collect-only');
      chai_1.expect(opts.args[opts.args.length - 1]).to.equal(dir);
    }).returns(() => Promise.resolve(runOutput)).verifiable(typeMoq.Times.once());
    testParser.setup(t => t.parse(typeMoq.It.isValue(runOutput), typeMoq.It.isAny())).returns(() => tests).verifiable(typeMoq.Times.once());
    const options = typeMoq.Mock.ofType();
    const token = typeMoq.Mock.ofType();
    options.setup(o => o.args).returns(() => args);
    options.setup(o => o.token).returns(() => token.object);
    token.setup(t => t.isCancellationRequested).returns(() => false);
    const result = yield discoveryService.discoverTests(options.object);
    chai_1.expect(result).to.be.equal(tests);
    argsService.verifyAll();
    runner.verifyAll();
    testParser.verifyAll();
    helper.verifyAll();
  }));
  test('Ensure discovery is invoked with the right args and multiple dirs', () => __awaiter(void 0, void 0, void 0, function* () {
    const args = [];
    const runOutput = 'xyz';
    const dirs = [path.join('a', 'b', '1'), path.join('a', 'b', '2')];
    const tests = {
      summary: {
        errors: 1,
        failures: 0,
        passed: 0,
        skipped: 0
      },
      testFiles: [],
      testFunctions: [],
      testSuites: [],
      rootTestFolders: [],
      testFolders: []
    };
    argsService.setup(a => a.filterArguments(typeMoq.It.isValue(args), typeMoq.It.isValue(types_2.TestFilter.discovery))).returns(() => []).verifiable(typeMoq.Times.once());
    argsService.setup(a => a.getTestFolders(typeMoq.It.isValue(args))).returns(() => dirs).verifiable(typeMoq.Times.once());
    helper.setup(a => a.mergeTests(typeMoq.It.isAny())).returns(() => tests).verifiable(typeMoq.Times.once());
    runner.setup(r => r.run(typeMoq.It.isValue(constants_1.PYTEST_PROVIDER), typeMoq.It.isAny())).callback((_, opts) => {
      chai_1.expect(opts.args).to.include('--cache-clear');
      chai_1.expect(opts.args).to.include('-s');
      chai_1.expect(opts.args).to.include('--collect-only');
      const dir = opts.args[opts.args.length - 1];
      chai_1.expect(dirs).to.include(dir);
      dirs.splice(dirs.indexOf(dir) - 1, 1);
    }).returns(() => Promise.resolve(runOutput)).verifiable(typeMoq.Times.once());
    testParser.setup(t => t.parse(typeMoq.It.isValue(runOutput), typeMoq.It.isAny())).returns(() => tests).verifiable(typeMoq.Times.once());
    const options = typeMoq.Mock.ofType();
    const token = typeMoq.Mock.ofType();
    options.setup(o => o.args).returns(() => args);
    options.setup(o => o.token).returns(() => token.object);
    token.setup(t => t.isCancellationRequested).returns(() => false);
    const result = yield discoveryService.discoverTests(options.object);
    chai_1.expect(result).to.be.equal(tests);
    argsService.verifyAll();
    runner.verifyAll();
    testParser.verifyAll();
    helper.verifyAll();
  }));
  test('Ensure discovery is cancelled', () => __awaiter(void 0, void 0, void 0, function* () {
    const args = [];
    const runOutput = 'xyz';
    const tests = {
      summary: {
        errors: 1,
        failures: 0,
        passed: 0,
        skipped: 0
      },
      testFiles: [],
      testFunctions: [],
      testSuites: [],
      rootTestFolders: [],
      testFolders: []
    };
    argsService.setup(a => a.filterArguments(typeMoq.It.isValue(args), typeMoq.It.isValue(types_2.TestFilter.discovery))).returns(() => []).verifiable(typeMoq.Times.once());
    argsService.setup(a => a.getTestFolders(typeMoq.It.isValue(args))).returns(() => ['']).verifiable(typeMoq.Times.once());
    runner.setup(r => r.run(typeMoq.It.isValue(constants_1.PYTEST_PROVIDER), typeMoq.It.isAny())).callback((_, opts) => {
      chai_1.expect(opts.args).to.include('--cache-clear');
      chai_1.expect(opts.args).to.include('-s');
      chai_1.expect(opts.args).to.include('--collect-only');
    }).returns(() => Promise.resolve(runOutput)).verifiable(typeMoq.Times.once());
    testParser.setup(t => t.parse(typeMoq.It.isAny(), typeMoq.It.isAny())).returns(() => tests).verifiable(typeMoq.Times.never());
    helper.setup(a => a.mergeTests(typeMoq.It.isAny())).returns(() => tests);
    const options = typeMoq.Mock.ofType();
    const token = typeMoq.Mock.ofType();
    token.setup(t => t.isCancellationRequested).returns(() => true).verifiable(typeMoq.Times.once());
    options.setup(o => o.args).returns(() => args);
    options.setup(o => o.token).returns(() => token.object);
    const promise = discoveryService.discoverTests(options.object);
    yield chai_1.expect(promise).to.eventually.be.rejectedWith('cancelled');
    argsService.verifyAll();
    runner.verifyAll();
    testParser.verifyAll();
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5dGVzdC5kaXNjb3ZlcnkudW5pdC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwiY2hhaXByb21pc2UiLCJwYXRoIiwidHlwZU1vcSIsImNvbnN0YW50c18xIiwidHlwZXNfMSIsImRpc2NvdmVyeVNlcnZpY2VfMSIsInR5cGVzXzIiLCJ1c2UiLCJzdWl0ZSIsImRpc2NvdmVyeVNlcnZpY2UiLCJhcmdzU2VydmljZSIsInRlc3RQYXJzZXIiLCJydW5uZXIiLCJoZWxwZXIiLCJzZXR1cCIsInNlcnZpY2VDb250YWluZXIiLCJNb2NrIiwib2ZUeXBlIiwicyIsImdldCIsIkl0IiwiaXNWYWx1ZSIsIklBcmd1bWVudHNTZXJ2aWNlIiwiaXNBbnkiLCJyZXR1cm5zIiwib2JqZWN0IiwiSVRlc3RSdW5uZXIiLCJJVGVzdHNIZWxwZXIiLCJUZXN0RGlzY292ZXJ5U2VydmljZSIsInRlc3QiLCJhcmdzIiwicnVuT3V0cHV0IiwiZGlyIiwiam9pbiIsInRlc3RzIiwic3VtbWFyeSIsImVycm9ycyIsImZhaWx1cmVzIiwicGFzc2VkIiwic2tpcHBlZCIsInRlc3RGaWxlcyIsInRlc3RGdW5jdGlvbnMiLCJ0ZXN0U3VpdGVzIiwicm9vdFRlc3RGb2xkZXJzIiwidGVzdEZvbGRlcnMiLCJhIiwiZmlsdGVyQXJndW1lbnRzIiwiVGVzdEZpbHRlciIsImRpc2NvdmVyeSIsInZlcmlmaWFibGUiLCJUaW1lcyIsIm9uY2UiLCJnZXRUZXN0Rm9sZGVycyIsIm1lcmdlVGVzdHMiLCJyIiwicnVuIiwiUFlURVNUX1BST1ZJREVSIiwiY2FsbGJhY2siLCJfIiwib3B0cyIsImV4cGVjdCIsInRvIiwiaW5jbHVkZSIsImxlbmd0aCIsImVxdWFsIiwidCIsInBhcnNlIiwib3B0aW9ucyIsInRva2VuIiwibyIsImlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkIiwiZGlzY292ZXJUZXN0cyIsImJlIiwidmVyaWZ5QWxsIiwiZGlycyIsInNwbGljZSIsImluZGV4T2YiLCJuZXZlciIsInByb21pc2UiLCJldmVudHVhbGx5IiwicmVqZWN0ZWRXaXRoIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FB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QSxVQUFVLENBQUM4RCxTQUFYO0FBQ0gsR0F2Q29ELENBQWpELENBQUo7QUF3Q0gsQ0FwSkksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgY2hhaXByb21pc2UgPSByZXF1aXJlKFwiY2hhaS1hcy1wcm9taXNlZFwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB0eXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvdW5pdHRlc3RzL2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgZGlzY292ZXJ5U2VydmljZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvcHl0ZXN0L3NlcnZpY2VzL2Rpc2NvdmVyeVNlcnZpY2VcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L3VuaXR0ZXN0cy90eXBlc1wiKTtcclxuY2hhaV8xLnVzZShjaGFpcHJvbWlzZSk7XHJcbnN1aXRlKCdVbml0IFRlc3RzIC0gUHlUZXN0IC0gRGlzY292ZXJ5JywgKCkgPT4ge1xyXG4gICAgbGV0IGRpc2NvdmVyeVNlcnZpY2U7XHJcbiAgICBsZXQgYXJnc1NlcnZpY2U7XHJcbiAgICBsZXQgdGVzdFBhcnNlcjtcclxuICAgIGxldCBydW5uZXI7XHJcbiAgICBsZXQgaGVscGVyO1xyXG4gICAgc2V0dXAoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2VDb250YWluZXIgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgYXJnc1NlcnZpY2UgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgdGVzdFBhcnNlciA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBydW5uZXIgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgaGVscGVyID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAocyA9PiBzLmdldCh0eXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JQXJndW1lbnRzU2VydmljZSksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IGFyZ3NTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklUZXN0UnVubmVyKSwgdHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gcnVubmVyLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChzID0+IHMuZ2V0KHR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklUZXN0c0hlbHBlciksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IGhlbHBlci5vYmplY3QpO1xyXG4gICAgICAgIGRpc2NvdmVyeVNlcnZpY2UgPSBuZXcgZGlzY292ZXJ5U2VydmljZV8xLlRlc3REaXNjb3ZlcnlTZXJ2aWNlKHNlcnZpY2VDb250YWluZXIub2JqZWN0LCB0ZXN0UGFyc2VyLm9iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBkaXNjb3ZlcnkgaXMgaW52b2tlZCB3aXRoIHRoZSByaWdodCBhcmdzIGFuZCBzaW5nbGUgZGlyJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBbXTtcclxuICAgICAgICBjb25zdCBydW5PdXRwdXQgPSAneHl6JztcclxuICAgICAgICBjb25zdCBkaXIgPSBwYXRoLmpvaW4oJ2EnLCAnYicsICdjJyk7XHJcbiAgICAgICAgY29uc3QgdGVzdHMgPSB7XHJcbiAgICAgICAgICAgIHN1bW1hcnk6IHsgZXJyb3JzOiAxLCBmYWlsdXJlczogMCwgcGFzc2VkOiAwLCBza2lwcGVkOiAwIH0sXHJcbiAgICAgICAgICAgIHRlc3RGaWxlczogW10sIHRlc3RGdW5jdGlvbnM6IFtdLCB0ZXN0U3VpdGVzOiBbXSxcclxuICAgICAgICAgICAgcm9vdFRlc3RGb2xkZXJzOiBbXSwgdGVzdEZvbGRlcnM6IFtdXHJcbiAgICAgICAgfTtcclxuICAgICAgICBhcmdzU2VydmljZS5zZXR1cChhID0+IGEuZmlsdGVyQXJndW1lbnRzKHR5cGVNb3EuSXQuaXNWYWx1ZShhcmdzKSwgdHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzIuVGVzdEZpbHRlci5kaXNjb3ZlcnkpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gW10pXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICBhcmdzU2VydmljZS5zZXR1cChhID0+IGEuZ2V0VGVzdEZvbGRlcnModHlwZU1vcS5JdC5pc1ZhbHVlKGFyZ3MpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gW2Rpcl0pXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICBoZWxwZXIuc2V0dXAoYSA9PiBhLm1lcmdlVGVzdHModHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gdGVzdHMpXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICBydW5uZXIuc2V0dXAociA9PiByLnJ1bih0eXBlTW9xLkl0LmlzVmFsdWUoY29uc3RhbnRzXzEuUFlURVNUX1BST1ZJREVSKSwgdHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgLmNhbGxiYWNrKChfLCBvcHRzKSA9PiB7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3Qob3B0cy5hcmdzKS50by5pbmNsdWRlKCctLWNhY2hlLWNsZWFyJyk7XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3Qob3B0cy5hcmdzKS50by5pbmNsdWRlKCctcycpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KG9wdHMuYXJncykudG8uaW5jbHVkZSgnLS1jb2xsZWN0LW9ubHknKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChvcHRzLmFyZ3Nbb3B0cy5hcmdzLmxlbmd0aCAtIDFdKS50by5lcXVhbChkaXIpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShydW5PdXRwdXQpKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgdGVzdFBhcnNlci5zZXR1cCh0ID0+IHQucGFyc2UodHlwZU1vcS5JdC5pc1ZhbHVlKHJ1bk91dHB1dCksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHRlc3RzKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCB0b2tlbiA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBvcHRpb25zLnNldHVwKG8gPT4gby5hcmdzKS5yZXR1cm5zKCgpID0+IGFyZ3MpO1xyXG4gICAgICAgIG9wdGlvbnMuc2V0dXAobyA9PiBvLnRva2VuKS5yZXR1cm5zKCgpID0+IHRva2VuLm9iamVjdCk7XHJcbiAgICAgICAgdG9rZW4uc2V0dXAodCA9PiB0LmlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0geWllbGQgZGlzY292ZXJ5U2VydmljZS5kaXNjb3ZlclRlc3RzKG9wdGlvbnMub2JqZWN0KTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkudG8uYmUuZXF1YWwodGVzdHMpO1xyXG4gICAgICAgIGFyZ3NTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIHJ1bm5lci52ZXJpZnlBbGwoKTtcclxuICAgICAgICB0ZXN0UGFyc2VyLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIGhlbHBlci52ZXJpZnlBbGwoKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBkaXNjb3ZlcnkgaXMgaW52b2tlZCB3aXRoIHRoZSByaWdodCBhcmdzIGFuZCBtdWx0aXBsZSBkaXJzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBbXTtcclxuICAgICAgICBjb25zdCBydW5PdXRwdXQgPSAneHl6JztcclxuICAgICAgICBjb25zdCBkaXJzID0gW3BhdGguam9pbignYScsICdiJywgJzEnKSwgcGF0aC5qb2luKCdhJywgJ2InLCAnMicpXTtcclxuICAgICAgICBjb25zdCB0ZXN0cyA9IHtcclxuICAgICAgICAgICAgc3VtbWFyeTogeyBlcnJvcnM6IDEsIGZhaWx1cmVzOiAwLCBwYXNzZWQ6IDAsIHNraXBwZWQ6IDAgfSxcclxuICAgICAgICAgICAgdGVzdEZpbGVzOiBbXSwgdGVzdEZ1bmN0aW9uczogW10sIHRlc3RTdWl0ZXM6IFtdLFxyXG4gICAgICAgICAgICByb290VGVzdEZvbGRlcnM6IFtdLCB0ZXN0Rm9sZGVyczogW11cclxuICAgICAgICB9O1xyXG4gICAgICAgIGFyZ3NTZXJ2aWNlLnNldHVwKGEgPT4gYS5maWx0ZXJBcmd1bWVudHModHlwZU1vcS5JdC5pc1ZhbHVlKGFyZ3MpLCB0eXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5UZXN0RmlsdGVyLmRpc2NvdmVyeSkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBbXSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIGFyZ3NTZXJ2aWNlLnNldHVwKGEgPT4gYS5nZXRUZXN0Rm9sZGVycyh0eXBlTW9xLkl0LmlzVmFsdWUoYXJncykpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBkaXJzKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgaGVscGVyLnNldHVwKGEgPT4gYS5tZXJnZVRlc3RzKHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHRlc3RzKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgcnVubmVyLnNldHVwKHIgPT4gci5ydW4odHlwZU1vcS5JdC5pc1ZhbHVlKGNvbnN0YW50c18xLlBZVEVTVF9QUk9WSURFUiksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5jYWxsYmFjaygoXywgb3B0cykgPT4ge1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KG9wdHMuYXJncykudG8uaW5jbHVkZSgnLS1jYWNoZS1jbGVhcicpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KG9wdHMuYXJncykudG8uaW5jbHVkZSgnLXMnKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChvcHRzLmFyZ3MpLnRvLmluY2x1ZGUoJy0tY29sbGVjdC1vbmx5Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpciA9IG9wdHMuYXJnc1tvcHRzLmFyZ3MubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgIGNoYWlfMS5leHBlY3QoZGlycykudG8uaW5jbHVkZShkaXIpO1xyXG4gICAgICAgICAgICBkaXJzLnNwbGljZShkaXJzLmluZGV4T2YoZGlyKSAtIDEsIDEpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShydW5PdXRwdXQpKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgdGVzdFBhcnNlci5zZXR1cCh0ID0+IHQucGFyc2UodHlwZU1vcS5JdC5pc1ZhbHVlKHJ1bk91dHB1dCksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHRlc3RzKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCB0b2tlbiA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBvcHRpb25zLnNldHVwKG8gPT4gby5hcmdzKS5yZXR1cm5zKCgpID0+IGFyZ3MpO1xyXG4gICAgICAgIG9wdGlvbnMuc2V0dXAobyA9PiBvLnRva2VuKS5yZXR1cm5zKCgpID0+IHRva2VuLm9iamVjdCk7XHJcbiAgICAgICAgdG9rZW4uc2V0dXAodCA9PiB0LmlzQ2FuY2VsbGF0aW9uUmVxdWVzdGVkKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0geWllbGQgZGlzY292ZXJ5U2VydmljZS5kaXNjb3ZlclRlc3RzKG9wdGlvbnMub2JqZWN0KTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KHJlc3VsdCkudG8uYmUuZXF1YWwodGVzdHMpO1xyXG4gICAgICAgIGFyZ3NTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIHJ1bm5lci52ZXJpZnlBbGwoKTtcclxuICAgICAgICB0ZXN0UGFyc2VyLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIGhlbHBlci52ZXJpZnlBbGwoKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBkaXNjb3ZlcnkgaXMgY2FuY2VsbGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGFyZ3MgPSBbXTtcclxuICAgICAgICBjb25zdCBydW5PdXRwdXQgPSAneHl6JztcclxuICAgICAgICBjb25zdCB0ZXN0cyA9IHtcclxuICAgICAgICAgICAgc3VtbWFyeTogeyBlcnJvcnM6IDEsIGZhaWx1cmVzOiAwLCBwYXNzZWQ6IDAsIHNraXBwZWQ6IDAgfSxcclxuICAgICAgICAgICAgdGVzdEZpbGVzOiBbXSwgdGVzdEZ1bmN0aW9uczogW10sIHRlc3RTdWl0ZXM6IFtdLFxyXG4gICAgICAgICAgICByb290VGVzdEZvbGRlcnM6IFtdLCB0ZXN0Rm9sZGVyczogW11cclxuICAgICAgICB9O1xyXG4gICAgICAgIGFyZ3NTZXJ2aWNlLnNldHVwKGEgPT4gYS5maWx0ZXJBcmd1bWVudHModHlwZU1vcS5JdC5pc1ZhbHVlKGFyZ3MpLCB0eXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5UZXN0RmlsdGVyLmRpc2NvdmVyeSkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBbXSlcclxuICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgIGFyZ3NTZXJ2aWNlLnNldHVwKGEgPT4gYS5nZXRUZXN0Rm9sZGVycyh0eXBlTW9xLkl0LmlzVmFsdWUoYXJncykpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiBbJyddKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgcnVubmVyLnNldHVwKHIgPT4gci5ydW4odHlwZU1vcS5JdC5pc1ZhbHVlKGNvbnN0YW50c18xLlBZVEVTVF9QUk9WSURFUiksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5jYWxsYmFjaygoXywgb3B0cykgPT4ge1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KG9wdHMuYXJncykudG8uaW5jbHVkZSgnLS1jYWNoZS1jbGVhcicpO1xyXG4gICAgICAgICAgICBjaGFpXzEuZXhwZWN0KG9wdHMuYXJncykudG8uaW5jbHVkZSgnLXMnKTtcclxuICAgICAgICAgICAgY2hhaV8xLmV4cGVjdChvcHRzLmFyZ3MpLnRvLmluY2x1ZGUoJy0tY29sbGVjdC1vbmx5Jyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHJ1bk91dHB1dCkpXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICB0ZXN0UGFyc2VyLnNldHVwKHQgPT4gdC5wYXJzZSh0eXBlTW9xLkl0LmlzQW55KCksIHR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHRlc3RzKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm5ldmVyKCkpO1xyXG4gICAgICAgIGhlbHBlci5zZXR1cChhID0+IGEubWVyZ2VUZXN0cyh0eXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAucmV0dXJucygoKSA9PiB0ZXN0cyk7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCB0b2tlbiA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICB0b2tlbi5zZXR1cCh0ID0+IHQuaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHRydWUpXHJcbiAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICBvcHRpb25zLnNldHVwKG8gPT4gby5hcmdzKS5yZXR1cm5zKCgpID0+IGFyZ3MpO1xyXG4gICAgICAgIG9wdGlvbnMuc2V0dXAobyA9PiBvLnRva2VuKS5yZXR1cm5zKCgpID0+IHRva2VuLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IGRpc2NvdmVyeVNlcnZpY2UuZGlzY292ZXJUZXN0cyhvcHRpb25zLm9iamVjdCk7XHJcbiAgICAgICAgeWllbGQgY2hhaV8xLmV4cGVjdChwcm9taXNlKS50by5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgnY2FuY2VsbGVkJyk7XHJcbiAgICAgICAgYXJnc1NlcnZpY2UudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgcnVubmVyLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIHRlc3RQYXJzZXIudmVyaWZ5QWxsKCk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1weXRlc3QuZGlzY292ZXJ5LnVuaXQudGVzdC5qcy5tYXAiXX0=