"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const path = require("path");

const vscode = require("vscode");

const constants_1 = require("../../../client/common/constants");

const constants_2 = require("../../../client/unittests/common/constants");

const types_1 = require("../../../client/unittests/common/types");

const common_1 = require("../../common");

const serviceRegistry_1 = require("../serviceRegistry");

const initialize_1 = require("./../../initialize");

const UNITTEST_SINGLE_TEST_FILE_PATH = path.join(constants_1.EXTENSION_ROOT_DIR, 'src', 'test', 'pythonFiles', 'testFiles', 'single'); // tslint:disable-next-line:max-func-body-length

suite('Unit Tests - pytest - discovery against actual python process', () => {
  let ioc;
  const configTarget = initialize_1.IS_MULTI_ROOT_TEST ? vscode.ConfigurationTarget.WorkspaceFolder : vscode.ConfigurationTarget.Workspace;
  suiteSetup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initialize();
    yield common_1.updateSetting('unitTest.pyTestArgs', [], common_1.rootWorkspaceUri, configTarget);
  }));
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initializeTest();
    initializeDI();
  }));
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    ioc.dispose();
    yield common_1.updateSetting('unitTest.pyTestArgs', [], common_1.rootWorkspaceUri, configTarget);
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerProcessTypes();
    ioc.registerUnitTestTypes();
    ioc.registerVariableTypes();
  }

  test('Discover Tests (single test file)', () => __awaiter(void 0, void 0, void 0, function* () {
    const factory = ioc.serviceContainer.get(types_1.ITestManagerFactory);
    const testManager = factory('pytest', common_1.rootWorkspaceUri, UNITTEST_SINGLE_TEST_FILE_PATH);
    const tests = yield testManager.discoverTests(constants_2.CommandSource.ui, true, true);
    assert.equal(tests.testFiles.length, 2, 'Incorrect number of test files');
    assert.equal(tests.testFunctions.length, 6, 'Incorrect number of test functions');
    assert.equal(tests.testSuites.length, 2, 'Incorrect number of test suites');
    assert.equal(tests.testFiles.some(t => t.name === 'tests/test_one.py' && t.nameToRun === t.name), true, 'Test File not found');
    assert.equal(tests.testFiles.some(t => t.name === 'test_root.py' && t.nameToRun === t.name), true, 'Test File not found');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInB5dGVzdC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJhc3NlcnQiLCJyZXF1aXJlIiwicGF0aCIsInZzY29kZSIsImNvbnN0YW50c18xIiwiY29uc3RhbnRzXzIiLCJ0eXBlc18xIiwiY29tbW9uXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsImluaXRpYWxpemVfMSIsIlVOSVRURVNUX1NJTkdMRV9URVNUX0ZJTEVfUEFUSCIsImpvaW4iLCJFWFRFTlNJT05fUk9PVF9ESVIiLCJzdWl0ZSIsImlvYyIsImNvbmZpZ1RhcmdldCIsIklTX01VTFRJX1JPT1RfVEVTVCIsIkNvbmZpZ3VyYXRpb25UYXJnZXQiLCJXb3Jrc3BhY2VGb2xkZXIiLCJXb3Jrc3BhY2UiLCJzdWl0ZVNldHVwIiwiaW5pdGlhbGl6ZSIsInVwZGF0ZVNldHRpbmciLCJyb290V29ya3NwYWNlVXJpIiwic2V0dXAiLCJpbml0aWFsaXplVGVzdCIsImluaXRpYWxpemVESSIsInRlYXJkb3duIiwiZGlzcG9zZSIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwicmVnaXN0ZXJDb21tb25UeXBlcyIsInJlZ2lzdGVyUHJvY2Vzc1R5cGVzIiwicmVnaXN0ZXJVbml0VGVzdFR5cGVzIiwicmVnaXN0ZXJWYXJpYWJsZVR5cGVzIiwidGVzdCIsImZhY3RvcnkiLCJzZXJ2aWNlQ29udGFpbmVyIiwiZ2V0IiwiSVRlc3RNYW5hZ2VyRmFjdG9yeSIsInRlc3RNYW5hZ2VyIiwidGVzdHMiLCJkaXNjb3ZlclRlc3RzIiwiQ29tbWFuZFNvdXJjZSIsInVpIiwiZXF1YWwiLCJ0ZXN0RmlsZXMiLCJsZW5ndGgiLCJ0ZXN0RnVuY3Rpb25zIiwidGVzdFN1aXRlcyIsInNvbWUiLCJ0IiwibmFtZSIsIm5hbWVUb1J1biJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFuRCxFQUFxRE8sSUFBckQsQ0FBMERSLFNBQTFELEVBQXFFSyxRQUFyRSxDQUF0QztBQUF1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LENBQUNFLFNBQUYsS0FBZ0JGLENBQUMsQ0FBQ0MsSUFBekUsQ0FBYixFQUE2RixJQUE3RixFQUFtRyxxQkFBbkc7QUFDSCxHQVR3RCxDQUFyRCxDQUFKO0FBVUgsQ0FoQ0ksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdnNjb2RlID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9jb25zdGFudHNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18yID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC91bml0dGVzdHMvY29tbW9uL2NvbnN0YW50c1wiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvdW5pdHRlc3RzL2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uXCIpO1xyXG5jb25zdCBzZXJ2aWNlUmVnaXN0cnlfMSA9IHJlcXVpcmUoXCIuLi9zZXJ2aWNlUmVnaXN0cnlcIik7XHJcbmNvbnN0IGluaXRpYWxpemVfMSA9IHJlcXVpcmUoXCIuLy4uLy4uL2luaXRpYWxpemVcIik7XHJcbmNvbnN0IFVOSVRURVNUX1NJTkdMRV9URVNUX0ZJTEVfUEFUSCA9IHBhdGguam9pbihjb25zdGFudHNfMS5FWFRFTlNJT05fUk9PVF9ESVIsICdzcmMnLCAndGVzdCcsICdweXRob25GaWxlcycsICd0ZXN0RmlsZXMnLCAnc2luZ2xlJyk7XHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5zdWl0ZSgnVW5pdCBUZXN0cyAtIHB5dGVzdCAtIGRpc2NvdmVyeSBhZ2FpbnN0IGFjdHVhbCBweXRob24gcHJvY2VzcycsICgpID0+IHtcclxuICAgIGxldCBpb2M7XHJcbiAgICBjb25zdCBjb25maWdUYXJnZXQgPSBpbml0aWFsaXplXzEuSVNfTVVMVElfUk9PVF9URVNUID8gdnNjb2RlLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlRm9sZGVyIDogdnNjb2RlLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlO1xyXG4gICAgc3VpdGVTZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUoKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5weVRlc3RBcmdzJywgW10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICB9KSk7XHJcbiAgICBzZXR1cCgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemVUZXN0KCk7XHJcbiAgICAgICAgaW5pdGlhbGl6ZURJKCk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZWFyZG93bigoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgaW9jLmRpc3Bvc2UoKTtcclxuICAgICAgICB5aWVsZCBjb21tb25fMS51cGRhdGVTZXR0aW5nKCd1bml0VGVzdC5weVRlc3RBcmdzJywgW10sIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIGNvbmZpZ1RhcmdldCk7XHJcbiAgICB9KSk7XHJcbiAgICBmdW5jdGlvbiBpbml0aWFsaXplREkoKSB7XHJcbiAgICAgICAgaW9jID0gbmV3IHNlcnZpY2VSZWdpc3RyeV8xLlVuaXRUZXN0SW9jQ29udGFpbmVyKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyQ29tbW9uVHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJQcm9jZXNzVHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJVbml0VGVzdFR5cGVzKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyVmFyaWFibGVUeXBlcygpO1xyXG4gICAgfVxyXG4gICAgdGVzdCgnRGlzY292ZXIgVGVzdHMgKHNpbmdsZSB0ZXN0IGZpbGUpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBpb2Muc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JVGVzdE1hbmFnZXJGYWN0b3J5KTtcclxuICAgICAgICBjb25zdCB0ZXN0TWFuYWdlciA9IGZhY3RvcnkoJ3B5dGVzdCcsIGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmksIFVOSVRURVNUX1NJTkdMRV9URVNUX0ZJTEVfUEFUSCk7XHJcbiAgICAgICAgY29uc3QgdGVzdHMgPSB5aWVsZCB0ZXN0TWFuYWdlci5kaXNjb3ZlclRlc3RzKGNvbnN0YW50c18yLkNvbW1hbmRTb3VyY2UudWksIHRydWUsIHRydWUpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXN0cy50ZXN0RmlsZXMubGVuZ3RoLCAyLCAnSW5jb3JyZWN0IG51bWJlciBvZiB0ZXN0IGZpbGVzJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHRlc3RzLnRlc3RGdW5jdGlvbnMubGVuZ3RoLCA2LCAnSW5jb3JyZWN0IG51bWJlciBvZiB0ZXN0IGZ1bmN0aW9ucycpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXN0cy50ZXN0U3VpdGVzLmxlbmd0aCwgMiwgJ0luY29ycmVjdCBudW1iZXIgb2YgdGVzdCBzdWl0ZXMnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGVzdHMudGVzdEZpbGVzLnNvbWUodCA9PiB0Lm5hbWUgPT09ICd0ZXN0cy90ZXN0X29uZS5weScgJiYgdC5uYW1lVG9SdW4gPT09IHQubmFtZSksIHRydWUsICdUZXN0IEZpbGUgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHRlc3RzLnRlc3RGaWxlcy5zb21lKHQgPT4gdC5uYW1lID09PSAndGVzdF9yb290LnB5JyAmJiB0Lm5hbWVUb1J1biA9PT0gdC5uYW1lKSwgdHJ1ZSwgJ1Rlc3QgRmlsZSBub3QgZm91bmQnKTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXB5dGVzdC50ZXN0LmpzLm1hcCJdfQ==