// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length no-any

const chai_1 = require("chai");

const chaiPromise = require("chai-as-promised");

const typeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../../../client/common/application/types");

const types_2 = require("../../../../client/common/types");

const enum_1 = require("../../../../client/common/utils/enum");

const configSettingService_1 = require("../../../../client/unittests/common/services/configSettingService");

chai_1.use(chaiPromise);
const updateMethods = ['updateTestArgs', 'disable', 'enable'];
suite('Unit Tests - ConfigSettingsService', () => {
  [types_2.Product.pytest, types_2.Product.unittest, types_2.Product.nosetest].forEach(prodItem => {
    const product = prodItem;
    const prods = enum_1.getNamesAndValues(types_2.Product);
    const productName = prods.filter(item => item.value === product)[0];
    const workspaceUri = vscode_1.Uri.file(__filename);
    updateMethods.forEach(updateMethod => {
      suite(`Test '${updateMethod}' method with ${productName.name}`, () => {
        let testConfigSettingsService;
        let workspaceService;
        setup(() => {
          const serviceContainer = typeMoq.Mock.ofType();
          workspaceService = typeMoq.Mock.ofType();
          serviceContainer.setup(c => c.get(typeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
          testConfigSettingsService = new configSettingService_1.TestConfigSettingsService(serviceContainer.object);
        });

        function getTestArgSetting(prod) {
          switch (prod) {
            case types_2.Product.unittest:
              return 'unitTest.unittestArgs';

            case types_2.Product.pytest:
              return 'unitTest.pyTestArgs';

            case types_2.Product.nosetest:
              return 'unitTest.nosetestArgs';

            default:
              throw new Error('Invalid Test Product');
          }
        }

        function getTestEnablingSetting(prod) {
          switch (prod) {
            case types_2.Product.unittest:
              return 'unitTest.unittestEnabled';

            case types_2.Product.pytest:
              return 'unitTest.pyTestEnabled';

            case types_2.Product.nosetest:
              return 'unitTest.nosetestsEnabled';

            default:
              throw new Error('Invalid Test Product');
          }
        }

        function getExpectedValueAndSettings() {
          switch (updateMethod) {
            case 'disable':
              {
                return {
                  configValue: false,
                  configName: getTestEnablingSetting(product)
                };
              }

            case 'enable':
              {
                return {
                  configValue: true,
                  configName: getTestEnablingSetting(product)
                };
              }

            case 'updateTestArgs':
              {
                return {
                  configValue: ['one', 'two', 'three'],
                  configName: getTestArgSetting(product)
                };
              }

            default:
              {
                throw new Error('Invalid Method');
              }
          }
        }

        test('Update Test Arguments with workspace Uri without workspaces', () => __awaiter(void 0, void 0, void 0, function* () {
          workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => false).verifiable(typeMoq.Times.atLeastOnce());
          const pythonConfig = typeMoq.Mock.ofType();
          workspaceService.setup(w => w.getConfiguration(typeMoq.It.isValue('python'))).returns(() => pythonConfig.object).verifiable(typeMoq.Times.once());
          const {
            configValue,
            configName
          } = getExpectedValueAndSettings();
          pythonConfig.setup(p => p.update(typeMoq.It.isValue(configName), typeMoq.It.isValue(configValue))).returns(() => Promise.resolve()).verifiable(typeMoq.Times.once());

          if (updateMethod === 'updateTestArgs') {
            yield testConfigSettingsService.updateTestArgs(workspaceUri, product, configValue);
          } else {
            yield testConfigSettingsService[updateMethod](workspaceUri, product);
          }

          workspaceService.verifyAll();
          pythonConfig.verifyAll();
        }));
        test('Update Test Arguments with workspace Uri with one workspace', () => __awaiter(void 0, void 0, void 0, function* () {
          workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => true).verifiable(typeMoq.Times.atLeastOnce());
          const workspaceFolder = typeMoq.Mock.ofType();
          workspaceFolder.setup(w => w.uri).returns(() => workspaceUri).verifiable(typeMoq.Times.atLeastOnce());
          workspaceService.setup(w => w.workspaceFolders).returns(() => [workspaceFolder.object]).verifiable(typeMoq.Times.atLeastOnce());
          const pythonConfig = typeMoq.Mock.ofType();
          workspaceService.setup(w => w.getConfiguration(typeMoq.It.isValue('python'), typeMoq.It.isValue(workspaceUri))).returns(() => pythonConfig.object).verifiable(typeMoq.Times.once());
          const {
            configValue,
            configName
          } = getExpectedValueAndSettings();
          pythonConfig.setup(p => p.update(typeMoq.It.isValue(configName), typeMoq.It.isValue(configValue))).returns(() => Promise.resolve()).verifiable(typeMoq.Times.once());

          if (updateMethod === 'updateTestArgs') {
            yield testConfigSettingsService.updateTestArgs(workspaceUri, product, configValue);
          } else {
            yield testConfigSettingsService[updateMethod](workspaceUri, product);
          }

          workspaceService.verifyAll();
          pythonConfig.verifyAll();
        }));
        test('Update Test Arguments with workspace Uri with more than one workspace and uri belongs to a workspace', () => __awaiter(void 0, void 0, void 0, function* () {
          workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => true).verifiable(typeMoq.Times.atLeastOnce());
          const workspaceFolder = typeMoq.Mock.ofType();
          workspaceFolder.setup(w => w.uri).returns(() => workspaceUri).verifiable(typeMoq.Times.atLeastOnce());
          workspaceService.setup(w => w.workspaceFolders).returns(() => [workspaceFolder.object, workspaceFolder.object]).verifiable(typeMoq.Times.atLeastOnce());
          workspaceService.setup(w => w.getWorkspaceFolder(typeMoq.It.isValue(workspaceUri))).returns(() => workspaceFolder.object).verifiable(typeMoq.Times.once());
          const pythonConfig = typeMoq.Mock.ofType();
          workspaceService.setup(w => w.getConfiguration(typeMoq.It.isValue('python'), typeMoq.It.isValue(workspaceUri))).returns(() => pythonConfig.object).verifiable(typeMoq.Times.once());
          const {
            configValue,
            configName
          } = getExpectedValueAndSettings();
          pythonConfig.setup(p => p.update(typeMoq.It.isValue(configName), typeMoq.It.isValue(configValue))).returns(() => Promise.resolve()).verifiable(typeMoq.Times.once());

          if (updateMethod === 'updateTestArgs') {
            yield testConfigSettingsService.updateTestArgs(workspaceUri, product, configValue);
          } else {
            yield testConfigSettingsService[updateMethod](workspaceUri, product);
          }

          workspaceService.verifyAll();
          pythonConfig.verifyAll();
        }));
        test('Expect an exception when updating Test Arguments with workspace Uri with more than one workspace and uri does not belong to a workspace', () => __awaiter(void 0, void 0, void 0, function* () {
          workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => true).verifiable(typeMoq.Times.atLeastOnce());
          const workspaceFolder = typeMoq.Mock.ofType();
          workspaceFolder.setup(w => w.uri).returns(() => workspaceUri).verifiable(typeMoq.Times.atLeastOnce());
          workspaceService.setup(w => w.workspaceFolders).returns(() => [workspaceFolder.object, workspaceFolder.object]).verifiable(typeMoq.Times.atLeastOnce());
          workspaceService.setup(w => w.getWorkspaceFolder(typeMoq.It.isValue(workspaceUri))).returns(() => undefined).verifiable(typeMoq.Times.once());
          const {
            configValue
          } = getExpectedValueAndSettings();
          const promise = testConfigSettingsService.updateTestArgs(workspaceUri, product, configValue);
          chai_1.expect(promise).to.eventually.rejectedWith();
          workspaceService.verifyAll();
        }));
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZ1NldHRpbmdTZXJ2aWNlLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiY2hhaV8xIiwicmVxdWlyZSIsImNoYWlQcm9taXNlIiwidHlwZU1vcSIsInZzY29kZV8xIiwidHlwZXNfMSIsInR5cGVzXzIiLCJlbnVtXzEiLCJjb25maWdTZXR0aW5nU2VydmljZV8xIiwidXNlIiwidXBkYXRlTWV0aG9kcyIsInN1aXRlIiwiUHJvZHVjdCIsInB5dGVzdCIsInVuaXR0ZXN0Iiwibm9zZXRlc3QiLCJmb3JFYWNoIiwicHJvZEl0ZW0iLCJwcm9kdWN0IiwicHJvZHMiLCJnZXROYW1lc0FuZFZhbHVlcyIsInByb2R1Y3ROYW1lIiwiZmlsdGVyIiwiaXRlbSIsIndvcmtzcGFjZVVyaSIsIlVyaSIsImZpbGUiLCJfX2ZpbGVuYW1lIiwidXBkYXRlTWV0aG9kIiwibmFtZSIsInRlc3RDb25maWdTZXR0aW5nc1NlcnZpY2UiLCJ3b3Jrc3BhY2VTZXJ2aWNlIiwic2V0dXAiLCJzZXJ2aWNlQ29udGFpbmVyIiwiTW9jayIsIm9mVHlwZSIsImMiLCJnZXQiLCJJdCIsImlzVmFsdWUiLCJJV29ya3NwYWNlU2VydmljZSIsInJldHVybnMiLCJvYmplY3QiLCJUZXN0Q29uZmlnU2V0dGluZ3NTZXJ2aWNlIiwiZ2V0VGVzdEFyZ1NldHRpbmciLCJwcm9kIiwiRXJyb3IiLCJnZXRUZXN0RW5hYmxpbmdTZXR0aW5nIiwiZ2V0RXhwZWN0ZWRWYWx1ZUFuZFNldHRpbmdzIiwiY29uZmlnVmFsdWUiLCJjb25maWdOYW1lIiwidGVzdCIsInciLCJoYXNXb3Jrc3BhY2VGb2xkZXJzIiwidmVyaWZpYWJsZSIsIlRpbWVzIiwiYXRMZWFzdE9uY2UiLCJweXRob25Db25maWciLCJnZXRDb25maWd1cmF0aW9uIiwib25jZSIsInAiLCJ1cGRhdGUiLCJ1cGRhdGVUZXN0QXJncyIsInZlcmlmeUFsbCIsIndvcmtzcGFjZUZvbGRlciIsInVyaSIsIndvcmtzcGFjZUZvbGRlcnMiLCJnZXRXb3Jrc3BhY2VGb2xkZXIiLCJ1bmRlZmluZWQiLCJwcm9taXNlIiwiZXhwZWN0IiwidG8iLCJldmVudHVhbGx5IiwicmVqZWN0ZWRXaXRoIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFF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YyxnQkFBOUIsRUFDS3pCLE9BREwsQ0FDYSxNQUFNLENBQUN1QixlQUFlLENBQUN0QixNQUFqQixFQUF5QnNCLGVBQWUsQ0FBQ3RCLE1BQXpDLENBRG5CLEVBRUtZLFVBRkwsQ0FFZ0JuRCxPQUFPLENBQUNvRCxLQUFSLENBQWNDLFdBQWQsRUFGaEI7QUFHQXpCLFVBQUFBLGdCQUFnQixDQUFDQyxLQUFqQixDQUF1Qm9CLENBQUMsSUFBSUEsQ0FBQyxDQUFDZSxrQkFBRixDQUFxQmhFLE9BQU8sQ0FBQ21DLEVBQVIsQ0FBV0MsT0FBWCxDQUFtQmYsWUFBbkIsQ0FBckIsQ0FBNUIsRUFDS2lCLE9BREwsQ0FDYSxNQUFNMkIsU0FEbkIsRUFFS2QsVUFGTCxDQUVnQm5ELE9BQU8sQ0FBQ29ELEtBQVIsQ0FBY0ksSUFBZCxFQUZoQjtBQUdBLGdCQUFNO0FBQUVWLFlBQUFBO0FBQUYsY0FBa0JELDJCQUEyQixFQUFuRDtBQUNBLGdCQUFNcUIsT0FBTyxHQUFHdkMseUJBQXlCLENBQUNnQyxjQUExQixDQUF5Q3RDLFlBQXpDLEVBQXVETixPQUF2RCxFQUFnRStCLFdBQWhFLENBQWhCO0FBQ0FqRCxVQUFBQSxNQUFNLENBQUNzRSxNQUFQLENBQWNELE9BQWQsRUFBdUJFLEVBQXZCLENBQTBCQyxVQUExQixDQUFxQ0MsWUFBckM7QUFDQTFDLFVBQUFBLGdCQUFnQixDQUFDZ0MsU0FBakI7QUFDSCxTQWxCOEosQ0FBM0osQ0FBSjtBQW1CSCxPQXBKSSxDQUFMO0FBcUpILEtBdEpEO0FBdUpILEdBNUpEO0FBNkpILENBOUpJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gdHNsaW50OmRpc2FibGU6bWF4LWZ1bmMtYm9keS1sZW5ndGggbm8tYW55XHJcbmNvbnN0IGNoYWlfMSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCBjaGFpUHJvbWlzZSA9IHJlcXVpcmUoXCJjaGFpLWFzLXByb21pc2VkXCIpO1xyXG5jb25zdCB0eXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHZzY29kZV8xID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgdHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9jbGllbnQvY29tbW9uL2FwcGxpY2F0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGVudW1fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL2VudW1cIik7XHJcbmNvbnN0IGNvbmZpZ1NldHRpbmdTZXJ2aWNlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vY2xpZW50L3VuaXR0ZXN0cy9jb21tb24vc2VydmljZXMvY29uZmlnU2V0dGluZ1NlcnZpY2VcIik7XHJcbmNoYWlfMS51c2UoY2hhaVByb21pc2UpO1xyXG5jb25zdCB1cGRhdGVNZXRob2RzID0gWyd1cGRhdGVUZXN0QXJncycsICdkaXNhYmxlJywgJ2VuYWJsZSddO1xyXG5zdWl0ZSgnVW5pdCBUZXN0cyAtIENvbmZpZ1NldHRpbmdzU2VydmljZScsICgpID0+IHtcclxuICAgIFt0eXBlc18yLlByb2R1Y3QucHl0ZXN0LCB0eXBlc18yLlByb2R1Y3QudW5pdHRlc3QsIHR5cGVzXzIuUHJvZHVjdC5ub3NldGVzdF0uZm9yRWFjaChwcm9kSXRlbSA9PiB7XHJcbiAgICAgICAgY29uc3QgcHJvZHVjdCA9IHByb2RJdGVtO1xyXG4gICAgICAgIGNvbnN0IHByb2RzID0gZW51bV8xLmdldE5hbWVzQW5kVmFsdWVzKHR5cGVzXzIuUHJvZHVjdCk7XHJcbiAgICAgICAgY29uc3QgcHJvZHVjdE5hbWUgPSBwcm9kcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnZhbHVlID09PSBwcm9kdWN0KVswXTtcclxuICAgICAgICBjb25zdCB3b3Jrc3BhY2VVcmkgPSB2c2NvZGVfMS5VcmkuZmlsZShfX2ZpbGVuYW1lKTtcclxuICAgICAgICB1cGRhdGVNZXRob2RzLmZvckVhY2godXBkYXRlTWV0aG9kID0+IHtcclxuICAgICAgICAgICAgc3VpdGUoYFRlc3QgJyR7dXBkYXRlTWV0aG9kfScgbWV0aG9kIHdpdGggJHtwcm9kdWN0TmFtZS5uYW1lfWAsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCB0ZXN0Q29uZmlnU2V0dGluZ3NTZXJ2aWNlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdvcmtzcGFjZVNlcnZpY2U7XHJcbiAgICAgICAgICAgICAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VydmljZUNvbnRhaW5lciA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldCh0eXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXN0Q29uZmlnU2V0dGluZ3NTZXJ2aWNlID0gbmV3IGNvbmZpZ1NldHRpbmdTZXJ2aWNlXzEuVGVzdENvbmZpZ1NldHRpbmdzU2VydmljZShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRlc3RBcmdTZXR0aW5nKHByb2QpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHByb2QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlByb2R1Y3QudW5pdHRlc3Q6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3VuaXRUZXN0LnVuaXR0ZXN0QXJncyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5Qcm9kdWN0LnB5dGVzdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAndW5pdFRlc3QucHlUZXN0QXJncyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgdHlwZXNfMi5Qcm9kdWN0Lm5vc2V0ZXN0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd1bml0VGVzdC5ub3NldGVzdEFyZ3MnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFRlc3QgUHJvZHVjdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRlc3RFbmFibGluZ1NldHRpbmcocHJvZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIHR5cGVzXzIuUHJvZHVjdC51bml0dGVzdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAndW5pdFRlc3QudW5pdHRlc3RFbmFibGVkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlByb2R1Y3QucHl0ZXN0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd1bml0VGVzdC5weVRlc3RFbmFibGVkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSB0eXBlc18yLlByb2R1Y3Qubm9zZXRlc3Q6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3VuaXRUZXN0Lm5vc2V0ZXN0c0VuYWJsZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFRlc3QgUHJvZHVjdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEV4cGVjdGVkVmFsdWVBbmRTZXR0aW5ncygpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHVwZGF0ZU1ldGhvZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkaXNhYmxlJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgY29uZmlnVmFsdWU6IGZhbHNlLCBjb25maWdOYW1lOiBnZXRUZXN0RW5hYmxpbmdTZXR0aW5nKHByb2R1Y3QpIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW5hYmxlJzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgY29uZmlnVmFsdWU6IHRydWUsIGNvbmZpZ05hbWU6IGdldFRlc3RFbmFibGluZ1NldHRpbmcocHJvZHVjdCkgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1cGRhdGVUZXN0QXJncyc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGNvbmZpZ1ZhbHVlOiBbJ29uZScsICd0d28nLCAndGhyZWUnXSwgY29uZmlnTmFtZTogZ2V0VGVzdEFyZ1NldHRpbmcocHJvZHVjdCkgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgTWV0aG9kJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0ZXN0KCdVcGRhdGUgVGVzdCBBcmd1bWVudHMgd2l0aCB3b3Jrc3BhY2UgVXJpIHdpdGhvdXQgd29ya3NwYWNlcycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5oYXNXb3Jrc3BhY2VGb2xkZXJzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5hdExlYXN0T25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBweXRob25Db25maWcgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuZ2V0Q29uZmlndXJhdGlvbih0eXBlTW9xLkl0LmlzVmFsdWUoJ3B5dGhvbicpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gcHl0aG9uQ29uZmlnLm9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY29uZmlnVmFsdWUsIGNvbmZpZ05hbWUgfSA9IGdldEV4cGVjdGVkVmFsdWVBbmRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHB5dGhvbkNvbmZpZy5zZXR1cChwID0+IHAudXBkYXRlKHR5cGVNb3EuSXQuaXNWYWx1ZShjb25maWdOYW1lKSwgdHlwZU1vcS5JdC5pc1ZhbHVlKGNvbmZpZ1ZhbHVlKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZU1ldGhvZCA9PT0gJ3VwZGF0ZVRlc3RBcmdzJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXN0Q29uZmlnU2V0dGluZ3NTZXJ2aWNlLnVwZGF0ZVRlc3RBcmdzKHdvcmtzcGFjZVVyaSwgcHJvZHVjdCwgY29uZmlnVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgdGVzdENvbmZpZ1NldHRpbmdzU2VydmljZVt1cGRhdGVNZXRob2RdKHdvcmtzcGFjZVVyaSwgcHJvZHVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2UudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHl0aG9uQ29uZmlnLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgdGVzdCgnVXBkYXRlIFRlc3QgQXJndW1lbnRzIHdpdGggd29ya3NwYWNlIFVyaSB3aXRoIG9uZSB3b3Jrc3BhY2UnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuaGFzV29ya3NwYWNlRm9sZGVycylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5hdExlYXN0T25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3Jrc3BhY2VGb2xkZXIgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlRm9sZGVyLnNldHVwKHcgPT4gdy51cmkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZVVyaSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5hdExlYXN0T25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy53b3Jrc3BhY2VGb2xkZXJzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBbd29ya3NwYWNlRm9sZGVyLm9iamVjdF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHl0aG9uQ29uZmlnID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LmdldENvbmZpZ3VyYXRpb24odHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob24nKSwgdHlwZU1vcS5JdC5pc1ZhbHVlKHdvcmtzcGFjZVVyaSkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBweXRob25Db25maWcub2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBjb25maWdWYWx1ZSwgY29uZmlnTmFtZSB9ID0gZ2V0RXhwZWN0ZWRWYWx1ZUFuZFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHl0aG9uQ29uZmlnLnNldHVwKHAgPT4gcC51cGRhdGUodHlwZU1vcS5JdC5pc1ZhbHVlKGNvbmZpZ05hbWUpLCB0eXBlTW9xLkl0LmlzVmFsdWUoY29uZmlnVmFsdWUpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXBkYXRlTWV0aG9kID09PSAndXBkYXRlVGVzdEFyZ3MnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHRlc3RDb25maWdTZXR0aW5nc1NlcnZpY2UudXBkYXRlVGVzdEFyZ3Mod29ya3NwYWNlVXJpLCBwcm9kdWN0LCBjb25maWdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXN0Q29uZmlnU2V0dGluZ3NTZXJ2aWNlW3VwZGF0ZU1ldGhvZF0od29ya3NwYWNlVXJpLCBwcm9kdWN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICBweXRob25Db25maWcudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICB0ZXN0KCdVcGRhdGUgVGVzdCBBcmd1bWVudHMgd2l0aCB3b3Jrc3BhY2UgVXJpIHdpdGggbW9yZSB0aGFuIG9uZSB3b3Jrc3BhY2UgYW5kIHVyaSBiZWxvbmdzIHRvIGEgd29ya3NwYWNlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3Lmhhc1dvcmtzcGFjZUZvbGRlcnMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlRm9sZGVyID0gdHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUZvbGRlci5zZXR1cCh3ID0+IHcudXJpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiB3b3Jrc3BhY2VVcmkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcud29ya3NwYWNlRm9sZGVycylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gW3dvcmtzcGFjZUZvbGRlci5vYmplY3QsIHdvcmtzcGFjZUZvbGRlci5vYmplY3RdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LmdldFdvcmtzcGFjZUZvbGRlcih0eXBlTW9xLkl0LmlzVmFsdWUod29ya3NwYWNlVXJpKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZUZvbGRlci5vYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBweXRob25Db25maWcgPSB0eXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cCh3ID0+IHcuZ2V0Q29uZmlndXJhdGlvbih0eXBlTW9xLkl0LmlzVmFsdWUoJ3B5dGhvbicpLCB0eXBlTW9xLkl0LmlzVmFsdWUod29ya3NwYWNlVXJpKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IHB5dGhvbkNvbmZpZy5vYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGNvbmZpZ1ZhbHVlLCBjb25maWdOYW1lIH0gPSBnZXRFeHBlY3RlZFZhbHVlQW5kU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICBweXRob25Db25maWcuc2V0dXAocCA9PiBwLnVwZGF0ZSh0eXBlTW9xLkl0LmlzVmFsdWUoY29uZmlnTmFtZSksIHR5cGVNb3EuSXQuaXNWYWx1ZShjb25maWdWYWx1ZSkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1cGRhdGVNZXRob2QgPT09ICd1cGRhdGVUZXN0QXJncycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgdGVzdENvbmZpZ1NldHRpbmdzU2VydmljZS51cGRhdGVUZXN0QXJncyh3b3Jrc3BhY2VVcmksIHByb2R1Y3QsIGNvbmZpZ1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHRlc3RDb25maWdTZXR0aW5nc1NlcnZpY2VbdXBkYXRlTWV0aG9kXSh3b3Jrc3BhY2VVcmksIHByb2R1Y3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHB5dGhvbkNvbmZpZy52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIHRlc3QoJ0V4cGVjdCBhbiBleGNlcHRpb24gd2hlbiB1cGRhdGluZyBUZXN0IEFyZ3VtZW50cyB3aXRoIHdvcmtzcGFjZSBVcmkgd2l0aCBtb3JlIHRoYW4gb25lIHdvcmtzcGFjZSBhbmQgdXJpIGRvZXMgbm90IGJlbG9uZyB0byBhIHdvcmtzcGFjZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5oYXNXb3Jrc3BhY2VGb2xkZXJzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtzcGFjZUZvbGRlciA9IHR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VGb2xkZXIuc2V0dXAodyA9PiB3LnVyaSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gd29ya3NwYWNlVXJpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZSh0eXBlTW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LndvcmtzcGFjZUZvbGRlcnMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFt3b3Jrc3BhY2VGb2xkZXIub2JqZWN0LCB3b3Jrc3BhY2VGb2xkZXIub2JqZWN0XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUodHlwZU1vcS5UaW1lcy5hdExlYXN0T25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5nZXRXb3Jrc3BhY2VGb2xkZXIodHlwZU1vcS5JdC5pc1ZhbHVlKHdvcmtzcGFjZVVyaSkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKHR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGNvbmZpZ1ZhbHVlIH0gPSBnZXRFeHBlY3RlZFZhbHVlQW5kU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlID0gdGVzdENvbmZpZ1NldHRpbmdzU2VydmljZS51cGRhdGVUZXN0QXJncyh3b3Jrc3BhY2VVcmksIHByb2R1Y3QsIGNvbmZpZ1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGFpXzEuZXhwZWN0KHByb21pc2UpLnRvLmV2ZW50dWFsbHkucmVqZWN0ZWRXaXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbmZpZ1NldHRpbmdTZXJ2aWNlLnVuaXQudGVzdC5qcy5tYXAiXX0=