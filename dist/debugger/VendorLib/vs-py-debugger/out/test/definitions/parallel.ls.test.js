"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const os_1 = require("os");

const path = require("path");

const vscode = require("vscode");

const constants_1 = require("../../client/common/platform/constants");

const constants_2 = require("../constants");

const initialize_1 = require("../initialize");

const textUtils_1 = require("../textUtils");

const autoCompPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'autocomp');
const fileOne = path.join(autoCompPath, 'one.py');
suite('Code, Hover Definition and Intellisense (Language Server)', () => {
  suiteSetup(function () {
    return __awaiter(this, void 0, void 0, function* () {
      // https://github.com/Microsoft/vscode-python/issues/1061
      // tslint:disable-next-line:no-invalid-this
      this.skip();

      if (!constants_2.IsLanguageServerTest()) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
      }

      yield initialize_1.initialize();
    });
  });
  suiteTeardown(initialize_1.closeActiveWindows);
  teardown(initialize_1.closeActiveWindows);
  test('All three together', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode.workspace.openTextDocument(fileOne);
    let position = new vscode.Position(30, 5);
    const hoverDef = yield vscode.commands.executeCommand('vscode.executeHoverProvider', textDocument.uri, position);
    const codeDef = yield vscode.commands.executeCommand('vscode.executeDefinitionProvider', textDocument.uri, position);
    position = new vscode.Position(3, 10);
    const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
    assert.equal(list.items.filter(item => item.label === 'api_version').length, 1, 'api_version not found');
    assert.equal(codeDef.length, 1, 'Definition length is incorrect');
    const expectedPath = constants_1.IS_WINDOWS ? fileOne.toUpperCase() : fileOne;
    const actualPath = constants_1.IS_WINDOWS ? codeDef[0].uri.fsPath.toUpperCase() : codeDef[0].uri.fsPath;
    assert.equal(actualPath, expectedPath, 'Incorrect file');
    assert.equal(`${codeDef[0].range.start.line},${codeDef[0].range.start.character}`, '17,4', 'Start position is incorrect');
    assert.equal(`${codeDef[0].range.end.line},${codeDef[0].range.end.character}`, '21,11', 'End position is incorrect');
    assert.equal(hoverDef.length, 1, 'Definition length is incorrect');
    assert.equal(`${hoverDef[0].range.start.line},${hoverDef[0].range.start.character}`, '30,4', 'Start position is incorrect');
    assert.equal(`${hoverDef[0].range.end.line},${hoverDef[0].range.end.character}`, '30,11', 'End position is incorrect');
    assert.equal(hoverDef[0].contents.length, 1, 'Invalid content items'); // tslint:disable-next-line:prefer-template

    const expectedContent = '```python' + os_1.EOL + 'def method1()' + os_1.EOL + '```' + os_1.EOL + 'This is method1';
    assert.equal(textUtils_1.normalizeMarkedString(hoverDef[0].contents[0]), expectedContent, 'function signature incorrect');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmFsbGVsLmxzLnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImFzc2VydCIsInJlcXVpcmUiLCJvc18xIiwicGF0aCIsInZzY29kZSIsImNvbnN0YW50c18xIiwiY29uc3RhbnRzXzIiLCJpbml0aWFsaXplXzEiLCJ0ZXh0VXRpbHNfMSIsImF1dG9Db21wUGF0aCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJmaWxlT25lIiwic3VpdGUiLCJzdWl0ZVNldHVwIiwic2tpcCIsIklzTGFuZ3VhZ2VTZXJ2ZXJUZXN0IiwiaW5pdGlhbGl6ZSIsInN1aXRlVGVhcmRvd24iLCJjbG9zZUFjdGl2ZVdpbmRvd3MiLCJ0ZWFyZG93biIsInRlc3QiLCJ0ZXh0RG9jdW1lbnQiLCJ3b3Jrc3BhY2UiLCJvcGVuVGV4dERvY3VtZW50IiwicG9zaXRpb24iLCJQb3NpdGlvbiIsImhvdmVyRGVmIiwiY29tbWFuZHMiLCJleGVjdXRlQ29tbWFuZCIsInVyaSIsImNvZGVEZWYiLCJsaXN0IiwiZXF1YWwiLCJpdGVtcyIsImZpbHRlciIsIml0ZW0iLCJsYWJlbCIsImxlbmd0aCIsImV4cGVjdGVkUGF0aCIsIklTX1dJTkRPV1MiLCJ0b1VwcGVyQ2FzZSIsImFjdHVhbFBhdGgiLCJmc1BhdGgiLCJyYW5nZSIsInN0YXJ0IiwibGluZSIsImNoYXJhY3RlciIsImVuZCIsImNvbnRlbnRzIiwiZXhwZWN0ZWRDb250ZW50IiwiRU9MIiwibm9ybWFsaXplTWFya2VkU3RyaW5nIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxT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dCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcclxuY29uc3Qgb3NfMSA9IHJlcXVpcmUoXCJvc1wiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB2c2NvZGUgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL2NvbnN0YW50c1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3QgdGV4dFV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdGV4dFV0aWxzXCIpO1xyXG5jb25zdCBhdXRvQ29tcFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAnYXV0b2NvbXAnKTtcclxuY29uc3QgZmlsZU9uZSA9IHBhdGguam9pbihhdXRvQ29tcFBhdGgsICdvbmUucHknKTtcclxuc3VpdGUoJ0NvZGUsIEhvdmVyIERlZmluaXRpb24gYW5kIEludGVsbGlzZW5zZSAoTGFuZ3VhZ2UgU2VydmVyKScsICgpID0+IHtcclxuICAgIHN1aXRlU2V0dXAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvdnNjb2RlLXB5dGhvbi9pc3N1ZXMvMTA2MVxyXG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzXHJcbiAgICAgICAgICAgIHRoaXMuc2tpcCgpO1xyXG4gICAgICAgICAgICBpZiAoIWNvbnN0YW50c18yLklzTGFuZ3VhZ2VTZXJ2ZXJUZXN0KCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICAgICAgICAgIHRoaXMuc2tpcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5pbml0aWFsaXplKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHN1aXRlVGVhcmRvd24oaW5pdGlhbGl6ZV8xLmNsb3NlQWN0aXZlV2luZG93cyk7XHJcbiAgICB0ZWFyZG93bihpbml0aWFsaXplXzEuY2xvc2VBY3RpdmVXaW5kb3dzKTtcclxuICAgIHRlc3QoJ0FsbCB0aHJlZSB0b2dldGhlcicsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCB0ZXh0RG9jdW1lbnQgPSB5aWVsZCB2c2NvZGUud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQoZmlsZU9uZSk7XHJcbiAgICAgICAgbGV0IHBvc2l0aW9uID0gbmV3IHZzY29kZS5Qb3NpdGlvbigzMCwgNSk7XHJcbiAgICAgICAgY29uc3QgaG92ZXJEZWYgPSB5aWVsZCB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3ZzY29kZS5leGVjdXRlSG92ZXJQcm92aWRlcicsIHRleHREb2N1bWVudC51cmksIHBvc2l0aW9uKTtcclxuICAgICAgICBjb25zdCBjb2RlRGVmID0geWllbGQgdnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKCd2c2NvZGUuZXhlY3V0ZURlZmluaXRpb25Qcm92aWRlcicsIHRleHREb2N1bWVudC51cmksIHBvc2l0aW9uKTtcclxuICAgICAgICBwb3NpdGlvbiA9IG5ldyB2c2NvZGUuUG9zaXRpb24oMywgMTApO1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3ZzY29kZS5leGVjdXRlQ29tcGxldGlvbkl0ZW1Qcm92aWRlcicsIHRleHREb2N1bWVudC51cmksIHBvc2l0aW9uKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnYXBpX3ZlcnNpb24nKS5sZW5ndGgsIDEsICdhcGlfdmVyc2lvbiBub3QgZm91bmQnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoY29kZURlZi5sZW5ndGgsIDEsICdEZWZpbml0aW9uIGxlbmd0aCBpcyBpbmNvcnJlY3QnKTtcclxuICAgICAgICBjb25zdCBleHBlY3RlZFBhdGggPSBjb25zdGFudHNfMS5JU19XSU5ET1dTID8gZmlsZU9uZS50b1VwcGVyQ2FzZSgpIDogZmlsZU9uZTtcclxuICAgICAgICBjb25zdCBhY3R1YWxQYXRoID0gY29uc3RhbnRzXzEuSVNfV0lORE9XUyA/IGNvZGVEZWZbMF0udXJpLmZzUGF0aC50b1VwcGVyQ2FzZSgpIDogY29kZURlZlswXS51cmkuZnNQYXRoO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChhY3R1YWxQYXRoLCBleHBlY3RlZFBhdGgsICdJbmNvcnJlY3QgZmlsZScpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChgJHtjb2RlRGVmWzBdLnJhbmdlLnN0YXJ0LmxpbmV9LCR7Y29kZURlZlswXS5yYW5nZS5zdGFydC5jaGFyYWN0ZXJ9YCwgJzE3LDQnLCAnU3RhcnQgcG9zaXRpb24gaXMgaW5jb3JyZWN0Jyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGAke2NvZGVEZWZbMF0ucmFuZ2UuZW5kLmxpbmV9LCR7Y29kZURlZlswXS5yYW5nZS5lbmQuY2hhcmFjdGVyfWAsICcyMSwxMScsICdFbmQgcG9zaXRpb24gaXMgaW5jb3JyZWN0Jyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGhvdmVyRGVmLmxlbmd0aCwgMSwgJ0RlZmluaXRpb24gbGVuZ3RoIGlzIGluY29ycmVjdCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChgJHtob3ZlckRlZlswXS5yYW5nZS5zdGFydC5saW5lfSwke2hvdmVyRGVmWzBdLnJhbmdlLnN0YXJ0LmNoYXJhY3Rlcn1gLCAnMzAsNCcsICdTdGFydCBwb3NpdGlvbiBpcyBpbmNvcnJlY3QnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYCR7aG92ZXJEZWZbMF0ucmFuZ2UuZW5kLmxpbmV9LCR7aG92ZXJEZWZbMF0ucmFuZ2UuZW5kLmNoYXJhY3Rlcn1gLCAnMzAsMTEnLCAnRW5kIHBvc2l0aW9uIGlzIGluY29ycmVjdCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChob3ZlckRlZlswXS5jb250ZW50cy5sZW5ndGgsIDEsICdJbnZhbGlkIGNvbnRlbnQgaXRlbXMnKTtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLXRlbXBsYXRlXHJcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRDb250ZW50ID0gJ2BgYHB5dGhvbicgKyBvc18xLkVPTCArICdkZWYgbWV0aG9kMSgpJyArIG9zXzEuRU9MICsgJ2BgYCcgKyBvc18xLkVPTCArICdUaGlzIGlzIG1ldGhvZDEnO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXh0VXRpbHNfMS5ub3JtYWxpemVNYXJrZWRTdHJpbmcoaG92ZXJEZWZbMF0uY29udGVudHNbMF0pLCBleHBlY3RlZENvbnRlbnQsICdmdW5jdGlvbiBzaWduYXR1cmUgaW5jb3JyZWN0Jyk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYXJhbGxlbC5scy50ZXN0LmpzLm1hcCJdfQ==