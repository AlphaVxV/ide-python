"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const os_1 = require("os");

const path = require("path");

const vscode = require("vscode");

const constants_1 = require("../../client/common/platform/constants");

const constants_2 = require("../constants");

const initialize_1 = require("../initialize");

const textUtils_1 = require("../textUtils");

const autoCompPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'autocomp');
const fileOne = path.join(autoCompPath, 'one.py');
suite('Code, Hover Definition and Intellisense (Jedi)', () => {
  suiteSetup(function () {
    return __awaiter(this, void 0, void 0, function* () {
      if (constants_2.IsLanguageServerTest()) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
      }

      yield initialize_1.initialize();
    });
  });
  suiteTeardown(initialize_1.closeActiveWindows);
  teardown(initialize_1.closeActiveWindows);
  test('All three together', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode.workspace.openTextDocument(fileOne);
    let position = new vscode.Position(30, 5);
    const hoverDef = yield vscode.commands.executeCommand('vscode.executeHoverProvider', textDocument.uri, position);
    const codeDef = yield vscode.commands.executeCommand('vscode.executeDefinitionProvider', textDocument.uri, position);
    position = new vscode.Position(3, 10);
    const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
    assert.equal(list.items.filter(item => item.label === 'api_version').length, 1, 'api_version not found');
    assert.equal(codeDef.length, 1, 'Definition length is incorrect');
    const expectedPath = constants_1.IS_WINDOWS ? fileOne.toUpperCase() : fileOne;
    const actualPath = constants_1.IS_WINDOWS ? codeDef[0].uri.fsPath.toUpperCase() : codeDef[0].uri.fsPath;
    assert.equal(actualPath, expectedPath, 'Incorrect file');
    assert.equal(`${codeDef[0].range.start.line},${codeDef[0].range.start.character}`, '17,4', 'Start position is incorrect');
    assert.equal(`${codeDef[0].range.end.line},${codeDef[0].range.end.character}`, '21,11', 'End position is incorrect');
    assert.equal(hoverDef.length, 1, 'Definition length is incorrect');
    assert.equal(`${hoverDef[0].range.start.line},${hoverDef[0].range.start.character}`, '30,4', 'Start position is incorrect');
    assert.equal(`${hoverDef[0].range.end.line},${hoverDef[0].range.end.character}`, '30,11', 'End position is incorrect');
    assert.equal(hoverDef[0].contents.length, 1, 'Invalid content items'); // tslint:disable-next-line:prefer-template

    const expectedContent = '```python' + os_1.EOL + 'def method1()' + os_1.EOL + '```' + os_1.EOL + 'This is method1';
    assert.equal(textUtils_1.normalizeMarkedString(hoverDef[0].contents[0]), expectedContent, 'function signature incorrect');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcmFsbGVsLmplZGkudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiYXNzZXJ0IiwicmVxdWlyZSIsIm9zXzEiLCJwYXRoIiwidnNjb2RlIiwiY29uc3RhbnRzXzEiLCJjb25zdGFudHNfMiIsImluaXRpYWxpemVfMSIsInRleHRVdGlsc18xIiwiYXV0b0NvbXBQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsImZpbGVPbmUiLCJzdWl0ZSIsInN1aXRlU2V0dXAiLCJJc0xhbmd1YWdlU2VydmVyVGVzdCIsInNraXAiLCJpbml0aWFsaXplIiwic3VpdGVUZWFyZG93biIsImNsb3NlQWN0aXZlV2luZG93cyIsInRlYXJkb3duIiwidGVzdCIsInRleHREb2N1bWVudCIsIndvcmtzcGFjZSIsIm9wZW5UZXh0RG9jdW1lbnQiLCJwb3NpdGlvbiIsIlBvc2l0aW9uIiwiaG92ZXJEZWYiLCJjb21tYW5kcyIsImV4ZWN1dGVDb21tYW5kIiwidXJpIiwiY29kZURlZiIsImxpc3QiLCJlcXVhbCIsIml0ZW1zIiwiZmlsdGVyIiwiaXRlbSIsImxhYmVsIiwibGVuZ3RoIiwiZXhwZWN0ZWRQYXRoIiwiSVNfV0lORE9XUyIsInRvVXBwZXJDYXNlIiwiYWN0dWFsUGF0aCIsImZzUGF0aCIsInJhbmdlIiwic3RhcnQiLCJsaW5lIiwiY2hhcmFjdGVyIiwiZW5kIiwiY29udGVudHMiLCJleHBlY3RlZENvbnRlbnQiLCJFT0wiLCJub3JtYWxpemVNYXJrZWRTdHJpbmciXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxV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Q0FBQ2lDLEtBQVAsQ0FBYyxHQUFFTixRQUFRLENBQUMsQ0FBRCxDQUFSLENBQVlpQixLQUFaLENBQWtCQyxLQUFsQixDQUF3QkMsSUFBSyxJQUFHbkIsUUFBUSxDQUFDLENBQUQsQ0FBUixDQUFZaUIsS0FBWixDQUFrQkMsS0FBbEIsQ0FBd0JFLFNBQVUsRUFBbEYsRUFBcUYsTUFBckYsRUFBNkYsNkJBQTdGO0FBQ0EvQyxJQUFBQSxNQUFNLENBQUNpQyxLQUFQLENBQWMsR0FBRU4sUUFBUSxDQUFDLENBQUQsQ0FBUixDQUFZaUIsS0FBWixDQUFrQkksR0FBbEIsQ0FBc0JGLElBQUssSUFBR25CLFFBQVEsQ0FBQyxDQUFELENBQVIsQ0FBWWlCLEtBQVosQ0FBa0JJLEdBQWxCLENBQXNCRCxTQUFVLEVBQTlFLEVBQWlGLE9BQWpGLEVBQTBGLDJCQUExRjtBQUNBL0MsSUFBQUEsTUFBTSxDQUFDaUMsS0FBUCxDQUFhTixRQUFRLENBQUMsQ0FBRCxDQUFSLENBQVlzQixRQUFaLENBQXFCWCxNQUFsQyxFQUEwQyxDQUExQyxFQUE2Qyx1QkFBN0MsRUFqQjBFLENBa0IxRTs7QUFDQSxVQUFNWSxlQUFlLEdBQUcsY0FBY2hELElBQUksQ0FBQ2lELEdBQW5CLEdBQXlCLGVBQXpCLEdBQTJDakQsSUFBSSxDQUFDaUQsR0FBaEQsR0FBc0QsS0FBdEQsR0FBOERqRCxJQUFJLENBQUNpRCxHQUFuRSxHQUF5RSxpQkFBakc7QUFDQW5ELElBQUFBLE1BQU0sQ0FBQ2lDLEtBQVAsQ0FBYXpCLFdBQVcsQ0FBQzRDLHFCQUFaLENBQWtDekIsUUFBUSxDQUFDLENBQUQsQ0FBUixDQUFZc0IsUUFBWixDQUFxQixDQUFyQixDQUFsQyxDQUFiLEVBQXlFQyxlQUF6RSxFQUEwRiw4QkFBMUY7QUFDSCxHQXJCeUMsQ0FBdEMsQ0FBSjtBQXNCSCxDQWxDSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcclxuY29uc3Qgb3NfMSA9IHJlcXVpcmUoXCJvc1wiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB2c2NvZGUgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL2NvbnN0YW50c1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzIgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3QgdGV4dFV0aWxzXzEgPSByZXF1aXJlKFwiLi4vdGV4dFV0aWxzXCIpO1xyXG5jb25zdCBhdXRvQ29tcFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAnYXV0b2NvbXAnKTtcclxuY29uc3QgZmlsZU9uZSA9IHBhdGguam9pbihhdXRvQ29tcFBhdGgsICdvbmUucHknKTtcclxuc3VpdGUoJ0NvZGUsIEhvdmVyIERlZmluaXRpb24gYW5kIEludGVsbGlzZW5zZSAoSmVkaSknLCAoKSA9PiB7XHJcbiAgICBzdWl0ZVNldHVwKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBpZiAoY29uc3RhbnRzXzIuSXNMYW5ndWFnZVNlcnZlclRlc3QoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5za2lwKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgc3VpdGVUZWFyZG93bihpbml0aWFsaXplXzEuY2xvc2VBY3RpdmVXaW5kb3dzKTtcclxuICAgIHRlYXJkb3duKGluaXRpYWxpemVfMS5jbG9zZUFjdGl2ZVdpbmRvd3MpO1xyXG4gICAgdGVzdCgnQWxsIHRocmVlIHRvZ2V0aGVyJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudChmaWxlT25lKTtcclxuICAgICAgICBsZXQgcG9zaXRpb24gPSBuZXcgdnNjb2RlLlBvc2l0aW9uKDMwLCA1KTtcclxuICAgICAgICBjb25zdCBob3ZlckRlZiA9IHlpZWxkIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgndnNjb2RlLmV4ZWN1dGVIb3ZlclByb3ZpZGVyJywgdGV4dERvY3VtZW50LnVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgIGNvbnN0IGNvZGVEZWYgPSB5aWVsZCB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3ZzY29kZS5leGVjdXRlRGVmaW5pdGlvblByb3ZpZGVyJywgdGV4dERvY3VtZW50LnVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgIHBvc2l0aW9uID0gbmV3IHZzY29kZS5Qb3NpdGlvbigzLCAxMCk7XHJcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgndnNjb2RlLmV4ZWN1dGVDb21wbGV0aW9uSXRlbVByb3ZpZGVyJywgdGV4dERvY3VtZW50LnVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChsaXN0Lml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdhcGlfdmVyc2lvbicpLmxlbmd0aCwgMSwgJ2FwaV92ZXJzaW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChjb2RlRGVmLmxlbmd0aCwgMSwgJ0RlZmluaXRpb24gbGVuZ3RoIGlzIGluY29ycmVjdCcpO1xyXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkUGF0aCA9IGNvbnN0YW50c18xLklTX1dJTkRPV1MgPyBmaWxlT25lLnRvVXBwZXJDYXNlKCkgOiBmaWxlT25lO1xyXG4gICAgICAgIGNvbnN0IGFjdHVhbFBhdGggPSBjb25zdGFudHNfMS5JU19XSU5ET1dTID8gY29kZURlZlswXS51cmkuZnNQYXRoLnRvVXBwZXJDYXNlKCkgOiBjb2RlRGVmWzBdLnVyaS5mc1BhdGg7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGFjdHVhbFBhdGgsIGV4cGVjdGVkUGF0aCwgJ0luY29ycmVjdCBmaWxlJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGAke2NvZGVEZWZbMF0ucmFuZ2Uuc3RhcnQubGluZX0sJHtjb2RlRGVmWzBdLnJhbmdlLnN0YXJ0LmNoYXJhY3Rlcn1gLCAnMTcsNCcsICdTdGFydCBwb3NpdGlvbiBpcyBpbmNvcnJlY3QnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYCR7Y29kZURlZlswXS5yYW5nZS5lbmQubGluZX0sJHtjb2RlRGVmWzBdLnJhbmdlLmVuZC5jaGFyYWN0ZXJ9YCwgJzIxLDExJywgJ0VuZCBwb3NpdGlvbiBpcyBpbmNvcnJlY3QnKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoaG92ZXJEZWYubGVuZ3RoLCAxLCAnRGVmaW5pdGlvbiBsZW5ndGggaXMgaW5jb3JyZWN0Jyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGAke2hvdmVyRGVmWzBdLnJhbmdlLnN0YXJ0LmxpbmV9LCR7aG92ZXJEZWZbMF0ucmFuZ2Uuc3RhcnQuY2hhcmFjdGVyfWAsICczMCw0JywgJ1N0YXJ0IHBvc2l0aW9uIGlzIGluY29ycmVjdCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChgJHtob3ZlckRlZlswXS5yYW5nZS5lbmQubGluZX0sJHtob3ZlckRlZlswXS5yYW5nZS5lbmQuY2hhcmFjdGVyfWAsICczMCwxMScsICdFbmQgcG9zaXRpb24gaXMgaW5jb3JyZWN0Jyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGhvdmVyRGVmWzBdLmNvbnRlbnRzLmxlbmd0aCwgMSwgJ0ludmFsaWQgY29udGVudCBpdGVtcycpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItdGVtcGxhdGVcclxuICAgICAgICBjb25zdCBleHBlY3RlZENvbnRlbnQgPSAnYGBgcHl0aG9uJyArIG9zXzEuRU9MICsgJ2RlZiBtZXRob2QxKCknICsgb3NfMS5FT0wgKyAnYGBgJyArIG9zXzEuRU9MICsgJ1RoaXMgaXMgbWV0aG9kMSc7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHRleHRVdGlsc18xLm5vcm1hbGl6ZU1hcmtlZFN0cmluZyhob3ZlckRlZlswXS5jb250ZW50c1swXSksIGV4cGVjdGVkQ29udGVudCwgJ2Z1bmN0aW9uIHNpZ25hdHVyZSBpbmNvcnJlY3QnKTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhcmFsbGVsLmplZGkudGVzdC5qcy5tYXAiXX0=