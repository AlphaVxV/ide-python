// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length

const chai_1 = require("chai");

const path = require("path");

const TypeMoq = require("typemoq");

const languageServer_1 = require("../../../client/activation/languageServer/languageServer");

const types_1 = require("../../../client/common/application/types");

const types_2 = require("../../../client/common/platform/types");

const types_3 = require("../../../client/common/types");

const types_4 = require("../../../client/common/variables/types");

suite('Language Server', () => {
  let serviceContainer;
  let pythonSettings;
  let appShell;
  let cmdManager;
  let workspaceService;
  let platformService;
  let languageServer;
  let extensionContext;
  setup(() => {
    serviceContainer = TypeMoq.Mock.ofType();
    extensionContext = TypeMoq.Mock.ofType();
    appShell = TypeMoq.Mock.ofType();
    workspaceService = TypeMoq.Mock.ofType();
    cmdManager = TypeMoq.Mock.ofType();
    platformService = TypeMoq.Mock.ofType();
    const configService = TypeMoq.Mock.ofType();
    pythonSettings = TypeMoq.Mock.ofType();
    workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => false);
    workspaceService.setup(w => w.workspaceFolders).returns(() => []);
    configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => pythonSettings.object);
    const output = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IOutputChannel), TypeMoq.It.isAny())).returns(() => output.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IWorkspaceService))).returns(() => workspaceService.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IApplicationShell))).returns(() => appShell.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IDisposableRegistry))).returns(() => []);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService))).returns(() => configService.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.ICommandManager))).returns(() => cmdManager.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IPlatformService))).returns(() => platformService.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IExtensionContext))).returns(() => extensionContext.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IFeatureDeprecationManager))).returns(() => TypeMoq.Mock.ofType().object);
    languageServer = new languageServer_1.LanguageServerExtensionActivator(serviceContainer.object);
  });
  test('Must get PYTHONPATH from env vars provider', () => __awaiter(void 0, void 0, void 0, function* () {
    const pathDelimiter = 'x';
    const pythonPathVar = ['A', 'B', '1'];
    const envVarsProvider = TypeMoq.Mock.ofType();
    const pathUtils = TypeMoq.Mock.ofType();
    extensionContext.setup(e => e.extensionPath).returns(() => path.join('a', 'b', 'c'));
    pathUtils.setup(p => p.delimiter).returns(() => pathDelimiter);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.IEnvironmentVariablesProvider))).returns(() => envVarsProvider.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IPathUtils))).returns(() => pathUtils.object);
    envVarsProvider.setup(p => p.getEnvironmentVariables()).returns(() => {
      return Promise.resolve({
        PYTHONPATH: pythonPathVar.join(pathDelimiter)
      });
    }).verifiable(TypeMoq.Times.once()); // tslint:disable-next-line:no-any

    languageServer.languageServerFolder = '';
    const options = yield languageServer.getAnalysisOptions();
    chai_1.expect(options).not.to.equal(undefined, 'options cannot be undefined');
    chai_1.expect(options.initializationOptions).not.to.equal(undefined, 'initializationOptions cannot be undefined');
    chai_1.expect(options.initializationOptions.searchPaths).to.include.members(pythonPathVar);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxhbmd1YWdlU2VydmVyLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiY2hhaV8xIiwicmVxdWlyZSIsInBhdGgiLCJUeXBlTW9xIiwibGFuZ3VhZ2VTZXJ2ZXJfMSIsInR5cGVzXzEiLCJ0eXBlc18yIiwidHlwZXNfMyIsInR5cGVzXzQiLCJzdWl0ZSIsInNlcnZpY2VDb250YWluZXIiLCJweXRob25TZXR0aW5ncyIsImFwcFNoZWxsIiwiY21kTWFuYWdlciIsIndvcmtzcGFjZVNlcnZpY2UiLCJwbGF0Zm9ybVNlcnZpY2UiLCJsYW5ndWFnZVNlcnZlciIsImV4dGVuc2lvbkNvbnRleHQiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJjb25maWdTZXJ2aWNlIiwidyIsImhhc1dvcmtzcGFjZUZvbGRlcnMiLCJyZXR1cm5zIiwid29ya3NwYWNlRm9sZGVycyIsImMiLCJnZXRTZXR0aW5ncyIsIkl0IiwiaXNBbnkiLCJvYmplY3QiLCJvdXRwdXQiLCJnZXQiLCJpc1ZhbHVlIiwiSU91dHB1dENoYW5uZWwiLCJJV29ya3NwYWNlU2VydmljZSIsIklBcHBsaWNhdGlvblNoZWxsIiwiSURpc3Bvc2FibGVSZWdpc3RyeSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsIklDb21tYW5kTWFuYWdlciIsIklQbGF0Zm9ybVNlcnZpY2UiLCJJRXh0ZW5zaW9uQ29udGV4dCIsIklGZWF0dXJlRGVwcmVjYXRpb25NYW5hZ2VyIiwiTGFuZ3VhZ2VTZXJ2ZXJFeHRlbnNpb25BY3RpdmF0b3IiLCJ0ZXN0IiwicGF0aERlbGltaXRlciIsInB5dGhvblBhdGhWYXIiLCJlbnZWYXJzUHJvdmlkZXIiLCJwYXRoVXRpbHMiLCJleHRlbnNpb25QYXRoIiwiam9pbiIsInAiLCJkZWxpbWl0ZXIiLCJJRW52aXJvbm1lbnRWYXJpYWJsZXNQcm92aWRlciIsIklQYXRoVXRpbHMiLCJnZXRFbnZpcm9ubWVudFZhcmlhYmxlcyIsIlBZVEhPTlBBVEgiLCJ2ZXJpZmlhYmxlIiwiVGltZXMiLCJvbmNlIiwibGFuZ3VhZ2VTZXJ2ZXJGb2xkZXIiLCJvcHRpb25zIiwiZ2V0QW5hbHlzaXNPcHRpb25zIiwiZXhwZWN0Iiwibm90IiwidG8iLCJlcXVhbCIsInVuZGVmaW5lZCIsImluaXRpYWxpemF0aW9uT3B0aW9ucyIsInNlYXJjaFBhdGhzIiwiaW5jbHVkZSIsIm1lbWJlcnMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVM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ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5jb25zdCBjaGFpXzEgPSByZXF1aXJlKFwiY2hhaVwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IGxhbmd1YWdlU2VydmVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2FjdGl2YXRpb24vbGFuZ3VhZ2VTZXJ2ZXIvbGFuZ3VhZ2VTZXJ2ZXJcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vLi4vLi4vY2xpZW50L2NvbW1vbi92YXJpYWJsZXMvdHlwZXNcIik7XHJcbnN1aXRlKCdMYW5ndWFnZSBTZXJ2ZXInLCAoKSA9PiB7XHJcbiAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgIGxldCBweXRob25TZXR0aW5ncztcclxuICAgIGxldCBhcHBTaGVsbDtcclxuICAgIGxldCBjbWRNYW5hZ2VyO1xyXG4gICAgbGV0IHdvcmtzcGFjZVNlcnZpY2U7XHJcbiAgICBsZXQgcGxhdGZvcm1TZXJ2aWNlO1xyXG4gICAgbGV0IGxhbmd1YWdlU2VydmVyO1xyXG4gICAgbGV0IGV4dGVuc2lvbkNvbnRleHQ7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBleHRlbnNpb25Db250ZXh0ID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGFwcFNoZWxsID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY21kTWFuYWdlciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBwbGF0Zm9ybVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBweXRob25TZXR0aW5ncyA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5oYXNXb3Jrc3BhY2VGb2xkZXJzKS5yZXR1cm5zKCgpID0+IGZhbHNlKTtcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy53b3Jrc3BhY2VGb2xkZXJzKS5yZXR1cm5zKCgpID0+IFtdKTtcclxuICAgICAgICBjb25maWdTZXJ2aWNlLnNldHVwKGMgPT4gYy5nZXRTZXR0aW5ncyhUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHB5dGhvblNldHRpbmdzLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMy5JT3V0cHV0Q2hhbm5lbCksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gb3V0cHV0Lm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMS5JQXBwbGljYXRpb25TaGVsbCkpKS5yZXR1cm5zKCgpID0+IGFwcFNoZWxsLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18zLklEaXNwb3NhYmxlUmVnaXN0cnkpKSkucmV0dXJucygoKSA9PiBbXSk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18zLklDb25maWd1cmF0aW9uU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IGNvbmZpZ1NlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSUNvbW1hbmRNYW5hZ2VyKSkpLnJldHVybnMoKCkgPT4gY21kTWFuYWdlci5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JUGxhdGZvcm1TZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gcGxhdGZvcm1TZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18zLklFeHRlbnNpb25Db250ZXh0KSkpLnJldHVybnMoKCkgPT4gZXh0ZW5zaW9uQ29udGV4dC5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMy5JRmVhdHVyZURlcHJlY2F0aW9uTWFuYWdlcikpKS5yZXR1cm5zKCgpID0+IFR5cGVNb3EuTW9jay5vZlR5cGUoKS5vYmplY3QpO1xyXG4gICAgICAgIGxhbmd1YWdlU2VydmVyID0gbmV3IGxhbmd1YWdlU2VydmVyXzEuTGFuZ3VhZ2VTZXJ2ZXJFeHRlbnNpb25BY3RpdmF0b3Ioc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdNdXN0IGdldCBQWVRIT05QQVRIIGZyb20gZW52IHZhcnMgcHJvdmlkZXInLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgcGF0aERlbGltaXRlciA9ICd4JztcclxuICAgICAgICBjb25zdCBweXRob25QYXRoVmFyID0gWydBJywgJ0InLCAnMSddO1xyXG4gICAgICAgIGNvbnN0IGVudlZhcnNQcm92aWRlciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBwYXRoVXRpbHMgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgZXh0ZW5zaW9uQ29udGV4dC5zZXR1cChlID0+IGUuZXh0ZW5zaW9uUGF0aCkucmV0dXJucygoKSA9PiBwYXRoLmpvaW4oJ2EnLCAnYicsICdjJykpO1xyXG4gICAgICAgIHBhdGhVdGlscy5zZXR1cChwID0+IHAuZGVsaW1pdGVyKS5yZXR1cm5zKCgpID0+IHBhdGhEZWxpbWl0ZXIpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfNC5JRW52aXJvbm1lbnRWYXJpYWJsZXNQcm92aWRlcikpKS5yZXR1cm5zKCgpID0+IGVudlZhcnNQcm92aWRlci5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMy5JUGF0aFV0aWxzKSkpLnJldHVybnMoKCkgPT4gcGF0aFV0aWxzLm9iamVjdCk7XHJcbiAgICAgICAgZW52VmFyc1Byb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zZXR1cChwID0+IHAuZ2V0RW52aXJvbm1lbnRWYXJpYWJsZXMoKSlcclxuICAgICAgICAgICAgLnJldHVybnMoKCkgPT4geyByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgUFlUSE9OUEFUSDogcHl0aG9uUGF0aFZhci5qb2luKHBhdGhEZWxpbWl0ZXIpIH0pOyB9KVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxyXG4gICAgICAgIGxhbmd1YWdlU2VydmVyLmxhbmd1YWdlU2VydmVyRm9sZGVyID0gJyc7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHlpZWxkIGxhbmd1YWdlU2VydmVyLmdldEFuYWx5c2lzT3B0aW9ucygpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3Qob3B0aW9ucykubm90LnRvLmVxdWFsKHVuZGVmaW5lZCwgJ29wdGlvbnMgY2Fubm90IGJlIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3Qob3B0aW9ucy5pbml0aWFsaXphdGlvbk9wdGlvbnMpLm5vdC50by5lcXVhbCh1bmRlZmluZWQsICdpbml0aWFsaXphdGlvbk9wdGlvbnMgY2Fubm90IGJlIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3Qob3B0aW9ucy5pbml0aWFsaXphdGlvbk9wdGlvbnMuc2VhcmNoUGF0aHMpLnRvLmluY2x1ZGUubWVtYmVycyhweXRob25QYXRoVmFyKTtcclxuICAgIH0pKTtcclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxhbmd1YWdlU2VydmVyLnVuaXQudGVzdC5qcy5tYXAiXX0=