// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:no-any

const chai_1 = require("chai");

const TypeMoq = require("typemoq");

const downloader_1 = require("../../client/activation/downloader");

const platformData_1 = require("../../client/activation/platformData");

const types_1 = require("../../client/activation/types");

const constants_1 = require("../../client/common/constants");

const types_2 = require("../../client/common/platform/types");

const types_3 = require("../../client/common/types");

suite('Activation - Downloader', () => {
  let languageServerDownloader;
  let platformService;
  let container;
  let folderService;
  setup(() => {
    container = TypeMoq.Mock.ofType();
    platformService = TypeMoq.Mock.ofType();
    folderService = TypeMoq.Mock.ofType();
    const fs = TypeMoq.Mock.ofType();
    const output = TypeMoq.Mock.ofType();
    const platformData = new platformData_1.PlatformData(platformService.object, fs.object);
    container.setup(a => a.get(TypeMoq.It.isValue(types_3.IOutputChannel), TypeMoq.It.isValue(constants_1.STANDARD_OUTPUT_CHANNEL))).returns(() => output.object);
    container.setup(a => a.get(TypeMoq.It.isValue(types_2.IFileSystem))).returns(() => fs.object);
    container.setup(a => a.get(TypeMoq.It.isValue(types_1.ILanguageServerFolderService))).returns(() => folderService.object);
    languageServerDownloader = new downloader_1.LanguageServerDownloader(platformData, '', container.object);
  });
  test('Get download uri', () => __awaiter(void 0, void 0, void 0, function* () {
    const pkg = {
      uri: 'xyz'
    };
    folderService.setup(f => f.getLatestLanguageServerVersion()).returns(() => Promise.resolve(pkg)).verifiable(TypeMoq.Times.once());
    const info = yield languageServerDownloader.getDownloadInfo();
    folderService.verifyAll();
    chai_1.expect(info).to.deep.equal(pkg);
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRvd25sb2FkZXIudW5pdC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJjaGFpXzEiLCJyZXF1aXJlIiwiVHlwZU1vcSIsImRvd25sb2FkZXJfMSIsInBsYXRmb3JtRGF0YV8xIiwidHlwZXNfMSIsImNvbnN0YW50c18xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJzdWl0ZSIsImxhbmd1YWdlU2VydmVyRG93bmxvYWRlciIsInBsYXRmb3JtU2VydmljZSIsImNvbnRhaW5lciIsImZvbGRlclNlcnZpY2UiLCJzZXR1cCIsIk1vY2siLCJvZlR5cGUiLCJmcyIsIm91dHB1dCIsInBsYXRmb3JtRGF0YSIsIlBsYXRmb3JtRGF0YSIsIm9iamVjdCIsImEiLCJnZXQiLCJJdCIsImlzVmFsdWUiLCJJT3V0cHV0Q2hhbm5lbCIsIlNUQU5EQVJEX09VVFBVVF9DSEFOTkVMIiwicmV0dXJucyIsIklGaWxlU3lzdGVtIiwiSUxhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSIsIkxhbmd1YWdlU2VydmVyRG93bmxvYWRlciIsInRlc3QiLCJwa2ciLCJ1cmkiLCJmIiwiZ2V0TGF0ZXN0TGFuZ3VhZ2VTZXJ2ZXJWZXJzaW9uIiwidmVyaWZpYWJsZSIsIlRpbWVzIiwib25jZSIsImluZm8iLCJnZXREb3dubG9hZEluZm8iLCJ2ZXJpZnlBbGwiLCJleHBlY3QiLCJ0byIsImRlZXAiLCJlcXVhbCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FB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QUFFO0FBQVAsS0FBWjtBQUNBckIsSUFBQUEsYUFBYSxDQUNSQyxLQURMLENBQ1dxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0MsOEJBQUYsRUFEaEIsRUFFS1IsT0FGTCxDQUVhLE1BQU01QyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0JnRCxHQUFoQixDQUZuQixFQUdLSSxVQUhMLENBR2dCbkMsT0FBTyxDQUFDb0MsS0FBUixDQUFjQyxJQUFkLEVBSGhCO0FBSUEsVUFBTUMsSUFBSSxHQUFHLE1BQU05Qix3QkFBd0IsQ0FBQytCLGVBQXpCLEVBQW5CO0FBQ0E1QixJQUFBQSxhQUFhLENBQUM2QixTQUFkO0FBQ0ExQyxJQUFBQSxNQUFNLENBQUMyQyxNQUFQLENBQWNILElBQWQsRUFBb0JJLEVBQXBCLENBQXVCQyxJQUF2QixDQUE0QkMsS0FBNUIsQ0FBa0NiLEdBQWxDO0FBQ0gsR0FUdUMsQ0FBcEMsQ0FBSjtBQVVILENBM0JJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gdHNsaW50OmRpc2FibGU6bm8tYW55XHJcbmNvbnN0IGNoYWlfMSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IGRvd25sb2FkZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvYWN0aXZhdGlvbi9kb3dubG9hZGVyXCIpO1xyXG5jb25zdCBwbGF0Zm9ybURhdGFfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvYWN0aXZhdGlvbi9wbGF0Zm9ybURhdGFcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2FjdGl2YXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi90eXBlc1wiKTtcclxuc3VpdGUoJ0FjdGl2YXRpb24gLSBEb3dubG9hZGVyJywgKCkgPT4ge1xyXG4gICAgbGV0IGxhbmd1YWdlU2VydmVyRG93bmxvYWRlcjtcclxuICAgIGxldCBwbGF0Zm9ybVNlcnZpY2U7XHJcbiAgICBsZXQgY29udGFpbmVyO1xyXG4gICAgbGV0IGZvbGRlclNlcnZpY2U7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgY29udGFpbmVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHBsYXRmb3JtU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBmb2xkZXJTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IGZzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IG91dHB1dCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBwbGF0Zm9ybURhdGEgPSBuZXcgcGxhdGZvcm1EYXRhXzEuUGxhdGZvcm1EYXRhKHBsYXRmb3JtU2VydmljZS5vYmplY3QsIGZzLm9iamVjdCk7XHJcbiAgICAgICAgY29udGFpbmVyLnNldHVwKGEgPT4gYS5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSU91dHB1dENoYW5uZWwpLCBUeXBlTW9xLkl0LmlzVmFsdWUoY29uc3RhbnRzXzEuU1RBTkRBUkRfT1VUUFVUX0NIQU5ORUwpKSkucmV0dXJucygoKSA9PiBvdXRwdXQub2JqZWN0KTtcclxuICAgICAgICBjb250YWluZXIuc2V0dXAoYSA9PiBhLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JRmlsZVN5c3RlbSkpKS5yZXR1cm5zKCgpID0+IGZzLm9iamVjdCk7XHJcbiAgICAgICAgY29udGFpbmVyLnNldHVwKGEgPT4gYS5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSUxhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IGZvbGRlclNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBsYW5ndWFnZVNlcnZlckRvd25sb2FkZXIgPSBuZXcgZG93bmxvYWRlcl8xLkxhbmd1YWdlU2VydmVyRG93bmxvYWRlcihwbGF0Zm9ybURhdGEsICcnLCBjb250YWluZXIub2JqZWN0KTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnR2V0IGRvd25sb2FkIHVyaScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBwa2cgPSB7IHVyaTogJ3h5eicgfTtcclxuICAgICAgICBmb2xkZXJTZXJ2aWNlXHJcbiAgICAgICAgICAgIC5zZXR1cChmID0+IGYuZ2V0TGF0ZXN0TGFuZ3VhZ2VTZXJ2ZXJWZXJzaW9uKCkpXHJcbiAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShwa2cpKVxyXG4gICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgY29uc3QgaW5mbyA9IHlpZWxkIGxhbmd1YWdlU2VydmVyRG93bmxvYWRlci5nZXREb3dubG9hZEluZm8oKTtcclxuICAgICAgICBmb2xkZXJTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoaW5mbykudG8uZGVlcC5lcXVhbChwa2cpO1xyXG4gICAgfSkpO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZG93bmxvYWRlci51bml0LnRlc3QuanMubWFwIl19