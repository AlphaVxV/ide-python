// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-func-body-length

const semver_1 = require("semver");

const TypeMoq = require("typemoq");

const activationService_1 = require("../../client/activation/activationService");

const types_1 = require("../../client/activation/types");

const types_2 = require("../../client/common/application/types");

const constants_1 = require("../../client/common/constants");

const types_3 = require("../../client/common/platform/types");

const types_4 = require("../../client/common/types");

const testOSInfos = require("../common/utils/platform.unit.test");

suite('Activation - ActivationService', () => {
  [true, false].forEach(jediIsEnabled => {
    suite(`Jedi is ${jediIsEnabled ? 'enabled' : 'disabled'}`, () => {
      let serviceContainer;
      let pythonSettings;
      let appShell;
      let cmdManager;
      let workspaceService;
      let platformService;
      setup(function () {
        if (constants_1.isLanguageServerTest()) {
          // tslint:disable-next-line:no-invalid-this
          return this.skip();
        }

        serviceContainer = TypeMoq.Mock.ofType();
        appShell = TypeMoq.Mock.ofType();
        workspaceService = TypeMoq.Mock.ofType();
        cmdManager = TypeMoq.Mock.ofType();
        platformService = TypeMoq.Mock.ofType();
        const configService = TypeMoq.Mock.ofType();
        pythonSettings = TypeMoq.Mock.ofType();
        const langFolderServiceMock = TypeMoq.Mock.ofType();
        const folderVer = {
          path: '',
          version: new semver_1.SemVer('1.2.3')
        };
        workspaceService.setup(w => w.hasWorkspaceFolders).returns(() => false);
        workspaceService.setup(w => w.workspaceFolders).returns(() => []);
        configService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => pythonSettings.object);
        langFolderServiceMock.setup(l => l.getCurrentLanguageServerDirectory()).returns(() => Promise.resolve(folderVer));
        const output = TypeMoq.Mock.ofType();
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.IOutputChannel), TypeMoq.It.isAny())).returns(() => output.object);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IWorkspaceService))).returns(() => workspaceService.object);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IApplicationShell))).returns(() => appShell.object);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.IDisposableRegistry))).returns(() => []);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.IConfigurationService))).returns(() => configService.object);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.ICommandManager))).returns(() => cmdManager.object);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IPlatformService))).returns(() => platformService.object);
        serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.ILanguageServerFolderService))).returns(() => langFolderServiceMock.object);
      });

      function testActivation(activationService, activator, lsSupported = true) {
        return __awaiter(this, void 0, void 0, function* () {
          activator.setup(a => a.activate()).returns(() => Promise.resolve(true)).verifiable(TypeMoq.Times.once());
          let activatorName = types_1.ExtensionActivators.Jedi;

          if (lsSupported && !jediIsEnabled) {
            activatorName = types_1.ExtensionActivators.DotNet;
          }

          serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IExtensionActivator), TypeMoq.It.isValue(activatorName))).returns(() => activator.object).verifiable(TypeMoq.Times.once());
          yield activationService.activate();
          activator.verifyAll();
          serviceContainer.verifyAll();
        });
      }

      const supportedTests = [['win10', testOSInfos.WIN_10], ['win7', testOSInfos.WIN_7], ['high sierra', testOSInfos.MAC_HIGH_SIERRA], ['sierra', testOSInfos.MAC_SIERRA], ['ubuntu 18.04', testOSInfos.UBUNTU_BIONIC], ['ubuntu 14.04', testOSInfos.UBUNTU_PRECISE], ['fedora 24', testOSInfos.FEDORA], ['arch', testOSInfos.ARCH]];

      for (const [osID, info] of supportedTests) {
        test(`LS is supported (${osID})`, () => __awaiter(void 0, void 0, void 0, function* () {
          pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabled);
          platformService.setup(p => p.info).returns(() => info);
          const activator = TypeMoq.Mock.ofType();
          const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
          yield testActivation(activationService, activator, true);
        }));
      }

      const unsupportedTests = [['winXP', testOSInfos.WIN_XP], ['el capitan', testOSInfos.MAC_EL_CAPITAN]];

      for (const [osID, info] of unsupportedTests) {
        test(`LS is not supported (${osID})`, () => __awaiter(void 0, void 0, void 0, function* () {
          pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabled);
          platformService.setup(p => p.info).returns(() => info);
          const activator = TypeMoq.Mock.ofType();
          const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
          yield testActivation(activationService, activator, false);
        }));
      }

      test('Activatory must be activated', () => __awaiter(void 0, void 0, void 0, function* () {
        pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabled);
        const activator = TypeMoq.Mock.ofType();
        const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
        yield testActivation(activationService, activator);
      }));
      test('Activatory must be deactivated', () => __awaiter(void 0, void 0, void 0, function* () {
        pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabled);
        const activator = TypeMoq.Mock.ofType();
        const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
        yield testActivation(activationService, activator);
        activator.setup(a => a.deactivate()).returns(() => Promise.resolve()).verifiable(TypeMoq.Times.once());
        activationService.dispose();
        activator.verifyAll();
      }));
      test('Prompt user to reload VS Code and reload, when setting is toggled', () => __awaiter(void 0, void 0, void 0, function* () {
        let callbackHandler;
        let jediIsEnabledValueInSetting = jediIsEnabled;
        workspaceService.setup(w => w.onDidChangeConfiguration(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).callback(cb => callbackHandler = cb).returns(() => TypeMoq.Mock.ofType().object).verifiable(TypeMoq.Times.once());
        pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabledValueInSetting);
        const activator = TypeMoq.Mock.ofType();
        const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
        workspaceService.verifyAll();
        yield testActivation(activationService, activator);
        const event = TypeMoq.Mock.ofType();
        event.setup(e => e.affectsConfiguration(TypeMoq.It.isValue('python.jediEnabled'), TypeMoq.It.isAny())).returns(() => true).verifiable(TypeMoq.Times.atLeastOnce());
        appShell.setup(a => a.showInformationMessage(TypeMoq.It.isAny(), TypeMoq.It.isValue('Reload'))).returns(() => Promise.resolve('Reload')).verifiable(TypeMoq.Times.once());
        cmdManager.setup(c => c.executeCommand(TypeMoq.It.isValue('workbench.action.reloadWindow'))).verifiable(TypeMoq.Times.once()); // Toggle the value in the setting and invoke the callback.

        jediIsEnabledValueInSetting = !jediIsEnabledValueInSetting;
        yield callbackHandler(event.object);
        event.verifyAll();
        appShell.verifyAll();
        cmdManager.verifyAll();
      }));
      test('Prompt user to reload VS Code and do not reload, when setting is toggled', () => __awaiter(void 0, void 0, void 0, function* () {
        let callbackHandler;
        let jediIsEnabledValueInSetting = jediIsEnabled;
        workspaceService.setup(w => w.onDidChangeConfiguration(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).callback(cb => callbackHandler = cb).returns(() => TypeMoq.Mock.ofType().object).verifiable(TypeMoq.Times.once());
        pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabledValueInSetting);
        const activator = TypeMoq.Mock.ofType();
        const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
        workspaceService.verifyAll();
        yield testActivation(activationService, activator);
        const event = TypeMoq.Mock.ofType();
        event.setup(e => e.affectsConfiguration(TypeMoq.It.isValue('python.jediEnabled'), TypeMoq.It.isAny())).returns(() => true).verifiable(TypeMoq.Times.atLeastOnce());
        appShell.setup(a => a.showInformationMessage(TypeMoq.It.isAny(), TypeMoq.It.isValue('Reload'))).returns(() => Promise.resolve(undefined)).verifiable(TypeMoq.Times.once());
        cmdManager.setup(c => c.executeCommand(TypeMoq.It.isValue('workbench.action.reloadWindow'))).verifiable(TypeMoq.Times.never()); // Toggle the value in the setting and invoke the callback.

        jediIsEnabledValueInSetting = !jediIsEnabledValueInSetting;
        yield callbackHandler(event.object);
        event.verifyAll();
        appShell.verifyAll();
        cmdManager.verifyAll();
      }));
      test('Do not prompt user to reload VS Code when setting is not toggled', () => __awaiter(void 0, void 0, void 0, function* () {
        let callbackHandler;
        workspaceService.setup(w => w.onDidChangeConfiguration(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).callback(cb => callbackHandler = cb).returns(() => TypeMoq.Mock.ofType().object).verifiable(TypeMoq.Times.once());
        pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabled);
        const activator = TypeMoq.Mock.ofType();
        const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
        workspaceService.verifyAll();
        yield testActivation(activationService, activator);
        const event = TypeMoq.Mock.ofType();
        event.setup(e => e.affectsConfiguration(TypeMoq.It.isValue('python.jediEnabled'), TypeMoq.It.isAny())).returns(() => true).verifiable(TypeMoq.Times.atLeastOnce());
        appShell.setup(a => a.showInformationMessage(TypeMoq.It.isAny(), TypeMoq.It.isValue('Reload'))).returns(() => Promise.resolve(undefined)).verifiable(TypeMoq.Times.never());
        cmdManager.setup(c => c.executeCommand(TypeMoq.It.isValue('workbench.action.reloadWindow'))).verifiable(TypeMoq.Times.never()); // Invoke the config changed callback.

        yield callbackHandler(event.object);
        event.verifyAll();
        appShell.verifyAll();
        cmdManager.verifyAll();
      }));
      test('Do not prompt user to reload VS Code when setting is not changed', () => __awaiter(void 0, void 0, void 0, function* () {
        let callbackHandler;
        workspaceService.setup(w => w.onDidChangeConfiguration(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny())).callback(cb => callbackHandler = cb).returns(() => TypeMoq.Mock.ofType().object).verifiable(TypeMoq.Times.once());
        pythonSettings.setup(p => p.jediEnabled).returns(() => jediIsEnabled);
        const activator = TypeMoq.Mock.ofType();
        const activationService = new activationService_1.ExtensionActivationService(serviceContainer.object);
        workspaceService.verifyAll();
        yield testActivation(activationService, activator);
        const event = TypeMoq.Mock.ofType();
        event.setup(e => e.affectsConfiguration(TypeMoq.It.isValue('python.jediEnabled'), TypeMoq.It.isAny())).returns(() => false).verifiable(TypeMoq.Times.atLeastOnce());
        appShell.setup(a => a.showInformationMessage(TypeMoq.It.isAny(), TypeMoq.It.isValue('Reload'))).returns(() => Promise.resolve(undefined)).verifiable(TypeMoq.Times.never());
        cmdManager.setup(c => c.executeCommand(TypeMoq.It.isValue('workbench.action.reloadWindow'))).verifiable(TypeMoq.Times.never()); // Invoke the config changed callback.

        yield callbackHandler(event.object);
        event.verifyAll();
        appShell.verifyAll();
        cmdManager.verifyAll();
      }));
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2YXRpb25TZXJ2aWNlLnVuaXQudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwic2VtdmVyXzEiLCJyZXF1aXJlIiwiVHlwZU1vcSIsImFjdGl2YXRpb25TZXJ2aWNlXzEiLCJ0eXBlc18xIiwidHlwZXNfMiIsImNvbnN0YW50c18xIiwidHlwZXNfMyIsInR5cGVzXzQiLCJ0ZXN0T1NJbmZvcyIsInN1aXRlIiwiZm9yRWFjaCIsImplZGlJc0VuYWJsZWQiLCJzZXJ2aWNlQ29udGFpbmVyIiwicHl0aG9uU2V0dGluZ3MiLCJhcHBTaGVsbCIsImNtZE1hbmFnZXIiLCJ3b3Jrc3BhY2VTZXJ2aWNlIiwicGxhdGZvcm1TZXJ2aWNlIiwic2V0dXAiLCJpc0xhbmd1YWdlU2VydmVyVGVzdCIsInNraXAiLCJNb2NrIiwib2ZUeXBlIiwiY29uZmlnU2VydmljZSIsImxhbmdGb2xkZXJTZXJ2aWNlTW9jayIsImZvbGRlclZlciIsInBhdGgiLCJ2ZXJzaW9uIiwiU2VtVmVyIiwidyIsImhhc1dvcmtzcGFjZUZvbGRlcnMiLCJyZXR1cm5zIiwid29ya3NwYWNlRm9sZGVycyIsImMiLCJnZXRTZXR0aW5ncyIsIkl0IiwiaXNBbnkiLCJvYmplY3QiLCJsIiwiZ2V0Q3VycmVudExhbmd1YWdlU2VydmVyRGlyZWN0b3J5Iiwib3V0cHV0IiwiZ2V0IiwiaXNWYWx1ZSIsIklPdXRwdXRDaGFubmVsIiwiSVdvcmtzcGFjZVNlcnZpY2UiLCJJQXBwbGljYXRpb25TaGVsbCIsIklEaXNwb3NhYmxlUmVnaXN0cnkiLCJJQ29uZmlndXJhdGlvblNlcnZpY2UiLCJJQ29tbWFuZE1hbmFnZXIiLCJJUGxhdGZvcm1TZXJ2aWNlIiwiSUxhbmd1YWdlU2VydmVyRm9sZGVyU2VydmljZSIsInRlc3RBY3RpdmF0aW9uIiwiYWN0aXZhdGlvblNlcnZpY2UiLCJhY3RpdmF0b3IiLCJsc1N1cHBvcnRlZCIsImEiLCJhY3RpdmF0ZSIsInZlcmlmaWFibGUiLCJUaW1lcyIsIm9uY2UiLCJhY3RpdmF0b3JOYW1lIiwiRXh0ZW5zaW9uQWN0aXZhdG9ycyIsIkplZGkiLCJEb3ROZXQiLCJJRXh0ZW5zaW9uQWN0aXZhdG9yIiwidmVyaWZ5QWxsIiwic3VwcG9ydGVkVGVzdHMiLCJXSU5fMTAiLCJXSU5fNyIsIk1BQ19ISUdIX1NJRVJSQSIsIk1BQ19TSUVSUkEiLCJVQlVOVFVfQklPTklDIiwiVUJVTlRVX1BSRUNJU0UiLCJGRURPUkEiLCJBUkNIIiwib3NJRCIsImluZm8iLCJ0ZXN0IiwicCIsImplZGlFbmFibGVkIiwiRXh0ZW5zaW9uQWN0aXZhdGlvblNlcnZpY2UiLCJ1bnN1cHBvcnRlZFRlc3RzIiwiV0lOX1hQIiwiTUFDX0VMX0NBUElUQU4iLCJkZWFjdGl2YXRlIiwiZGlzcG9zZSIsImNhbGxiYWNrSGFuZGxlciIsImplZGlJc0VuYWJsZWRWYWx1ZUluU2V0dGluZyIsIm9uRGlkQ2hhbmdlQ29uZmlndXJhdGlvbiIsImNhbGxiYWNrIiwiY2IiLCJldmVudCIsImFmZmVjdHNDb25maWd1cmF0aW9uIiwiYXRMZWFzdE9uY2UiLCJzaG93SW5mb3JtYXRpb25NZXNzYWdlIiwiZXhlY3V0ZUNvbW1hbmQiLCJ1bmRlZmluZWQiLCJuZXZlciJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFB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cUMsQ0FBQyxJQUFJQSxDQUFDLENBQUN1QyxzQkFBRixDQUF5QjdGLE9BQU8sQ0FBQ2tDLEVBQVIsQ0FBV0MsS0FBWCxFQUF6QixFQUE2Q25DLE9BQU8sQ0FBQ2tDLEVBQVIsQ0FBV08sT0FBWCxDQUFtQixRQUFuQixDQUE3QyxDQUFwQixFQUNLWCxPQURMLENBQ2EsTUFBTWhELE9BQU8sQ0FBQ0MsT0FBUixDQUFnQmdILFNBQWhCLENBRG5CLEVBRUt2QyxVQUZMLENBRWdCeEQsT0FBTyxDQUFDeUQsS0FBUixDQUFjdUMsS0FBZCxFQUZoQjtBQUdBbEYsUUFBQUEsVUFBVSxDQUFDRyxLQUFYLENBQWlCZSxDQUFDLElBQUlBLENBQUMsQ0FBQzhELGNBQUYsQ0FBaUI5RixPQUFPLENBQUNrQyxFQUFSLENBQVdPLE9BQVgsQ0FBbUIsK0JBQW5CLENBQWpCLENBQXRCLEVBQ0tlLFVBREwsQ0FDZ0J4RCxPQUFPLENBQUN5RCxLQUFSLENBQWN1QyxLQUFkLEVBRGhCLEVBbkJ3SCxDQXFCeEg7O0FBQ0EsY0FBTVgsZUFBZSxDQUFDSyxLQUFLLENBQUN0RCxNQUFQLENBQXJCO0FBQ0FzRCxRQUFBQSxLQUFLLENBQUMxQixTQUFOO0FBQ0FuRCxRQUFBQSxRQUFRLENBQUNtRCxTQUFUO0FBQ0FsRCxRQUFBQSxVQUFVLENBQUNrRCxTQUFYO0FBQ0gsT0ExQnVGLENBQXBGLENBQUo7QUEyQkgsS0F6TkksQ0FBTDtBQTBOSCxHQTNORDtBQTROSCxDQTdOSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIHRzbGludDpkaXNhYmxlOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbmNvbnN0IHNlbXZlcl8xID0gcmVxdWlyZShcInNlbXZlclwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCBhY3RpdmF0aW9uU2VydmljZV8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9hY3RpdmF0aW9uL2FjdGl2YXRpb25TZXJ2aWNlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9hY3RpdmF0aW9uL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgdGVzdE9TSW5mb3MgPSByZXF1aXJlKFwiLi4vY29tbW9uL3V0aWxzL3BsYXRmb3JtLnVuaXQudGVzdFwiKTtcclxuc3VpdGUoJ0FjdGl2YXRpb24gLSBBY3RpdmF0aW9uU2VydmljZScsICgpID0+IHtcclxuICAgIFt0cnVlLCBmYWxzZV0uZm9yRWFjaChqZWRpSXNFbmFibGVkID0+IHtcclxuICAgICAgICBzdWl0ZShgSmVkaSBpcyAke2plZGlJc0VuYWJsZWQgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWAsICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICAgICAgICAgIGxldCBweXRob25TZXR0aW5ncztcclxuICAgICAgICAgICAgbGV0IGFwcFNoZWxsO1xyXG4gICAgICAgICAgICBsZXQgY21kTWFuYWdlcjtcclxuICAgICAgICAgICAgbGV0IHdvcmtzcGFjZVNlcnZpY2U7XHJcbiAgICAgICAgICAgIGxldCBwbGF0Zm9ybVNlcnZpY2U7XHJcbiAgICAgICAgICAgIHNldHVwKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb25zdGFudHNfMS5pc0xhbmd1YWdlU2VydmVyVGVzdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNraXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBhcHBTaGVsbCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBjbWRNYW5hZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgcGxhdGZvcm1TZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIHB5dGhvblNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFuZ0ZvbGRlclNlcnZpY2VNb2NrID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9sZGVyVmVyID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb246IG5ldyBzZW12ZXJfMS5TZW1WZXIoJzEuMi4zJylcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKHcgPT4gdy5oYXNXb3Jrc3BhY2VGb2xkZXJzKS5yZXR1cm5zKCgpID0+IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAodyA9PiB3LndvcmtzcGFjZUZvbGRlcnMpLnJldHVybnMoKCkgPT4gW10pO1xyXG4gICAgICAgICAgICAgICAgY29uZmlnU2VydmljZS5zZXR1cChjID0+IGMuZ2V0U2V0dGluZ3MoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBweXRob25TZXR0aW5ncy5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgbGFuZ0ZvbGRlclNlcnZpY2VNb2NrLnNldHVwKGwgPT4gbC5nZXRDdXJyZW50TGFuZ3VhZ2VTZXJ2ZXJEaXJlY3RvcnkoKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoZm9sZGVyVmVyKSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXQgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzQuSU91dHB1dENoYW5uZWwpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IG91dHB1dC5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklXb3Jrc3BhY2VTZXJ2aWNlKSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18yLklBcHBsaWNhdGlvblNoZWxsKSkpLnJldHVybnMoKCkgPT4gYXBwU2hlbGwub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfNC5JRGlzcG9zYWJsZVJlZ2lzdHJ5KSkpLnJldHVybnMoKCkgPT4gW10pO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc180LklDb25maWd1cmF0aW9uU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IGNvbmZpZ1NlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfMi5JQ29tbWFuZE1hbmFnZXIpKSkucmV0dXJucygoKSA9PiBjbWRNYW5hZ2VyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzMuSVBsYXRmb3JtU2VydmljZSkpKS5yZXR1cm5zKCgpID0+IHBsYXRmb3JtU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklMYW5ndWFnZVNlcnZlckZvbGRlclNlcnZpY2UpKSkucmV0dXJucygoKSA9PiBsYW5nRm9sZGVyU2VydmljZU1vY2sub2JqZWN0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHRlc3RBY3RpdmF0aW9uKGFjdGl2YXRpb25TZXJ2aWNlLCBhY3RpdmF0b3IsIGxzU3VwcG9ydGVkID0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmF0b3JcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldHVwKGEgPT4gYS5hY3RpdmF0ZSgpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh0cnVlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhY3RpdmF0b3JOYW1lID0gdHlwZXNfMS5FeHRlbnNpb25BY3RpdmF0b3JzLkplZGk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxzU3VwcG9ydGVkICYmICFqZWRpSXNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2YXRvck5hbWUgPSB0eXBlc18xLkV4dGVuc2lvbkFjdGl2YXRvcnMuRG90TmV0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlQ29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklFeHRlbnNpb25BY3RpdmF0b3IpLCBUeXBlTW9xLkl0LmlzVmFsdWUoYWN0aXZhdG9yTmFtZSkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBhY3RpdmF0b3Iub2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgYWN0aXZhdGlvblNlcnZpY2UuYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmF0b3IudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VydmljZUNvbnRhaW5lci52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHN1cHBvcnRlZFRlc3RzID0gW1xyXG4gICAgICAgICAgICAgICAgWyd3aW4xMCcsIHRlc3RPU0luZm9zLldJTl8xMF0sXHJcbiAgICAgICAgICAgICAgICBbJ3dpbjcnLCB0ZXN0T1NJbmZvcy5XSU5fN10sXHJcbiAgICAgICAgICAgICAgICBbJ2hpZ2ggc2llcnJhJywgdGVzdE9TSW5mb3MuTUFDX0hJR0hfU0lFUlJBXSxcclxuICAgICAgICAgICAgICAgIFsnc2llcnJhJywgdGVzdE9TSW5mb3MuTUFDX1NJRVJSQV0sXHJcbiAgICAgICAgICAgICAgICBbJ3VidW50dSAxOC4wNCcsIHRlc3RPU0luZm9zLlVCVU5UVV9CSU9OSUNdLFxyXG4gICAgICAgICAgICAgICAgWyd1YnVudHUgMTQuMDQnLCB0ZXN0T1NJbmZvcy5VQlVOVFVfUFJFQ0lTRV0sXHJcbiAgICAgICAgICAgICAgICBbJ2ZlZG9yYSAyNCcsIHRlc3RPU0luZm9zLkZFRE9SQV0sXHJcbiAgICAgICAgICAgICAgICBbJ2FyY2gnLCB0ZXN0T1NJbmZvcy5BUkNIXVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtvc0lELCBpbmZvXSBvZiBzdXBwb3J0ZWRUZXN0cykge1xyXG4gICAgICAgICAgICAgICAgdGVzdChgTFMgaXMgc3VwcG9ydGVkICgke29zSUR9KWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBweXRob25TZXR0aW5ncy5zZXR1cChwID0+IHAuamVkaUVuYWJsZWQpLnJldHVybnMoKCkgPT4gamVkaUlzRW5hYmxlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm1TZXJ2aWNlLnNldHVwKHAgPT4gcC5pbmZvKS5yZXR1cm5zKCgpID0+IGluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2YXRvciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0aW9uU2VydmljZSA9IG5ldyBhY3RpdmF0aW9uU2VydmljZV8xLkV4dGVuc2lvbkFjdGl2YXRpb25TZXJ2aWNlKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXN0QWN0aXZhdGlvbihhY3RpdmF0aW9uU2VydmljZSwgYWN0aXZhdG9yLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB1bnN1cHBvcnRlZFRlc3RzID0gW1xyXG4gICAgICAgICAgICAgICAgWyd3aW5YUCcsIHRlc3RPU0luZm9zLldJTl9YUF0sXHJcbiAgICAgICAgICAgICAgICBbJ2VsIGNhcGl0YW4nLCB0ZXN0T1NJbmZvcy5NQUNfRUxfQ0FQSVRBTl1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBbb3NJRCwgaW5mb10gb2YgdW5zdXBwb3J0ZWRUZXN0cykge1xyXG4gICAgICAgICAgICAgICAgdGVzdChgTFMgaXMgbm90IHN1cHBvcnRlZCAoJHtvc0lEfSlgLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHl0aG9uU2V0dGluZ3Muc2V0dXAocCA9PiBwLmplZGlFbmFibGVkKS5yZXR1cm5zKCgpID0+IGplZGlJc0VuYWJsZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBsYXRmb3JtU2VydmljZS5zZXR1cChwID0+IHAuaW5mbykucmV0dXJucygoKSA9PiBpbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0b3IgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZhdGlvblNlcnZpY2UgPSBuZXcgYWN0aXZhdGlvblNlcnZpY2VfMS5FeHRlbnNpb25BY3RpdmF0aW9uU2VydmljZShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgdGVzdEFjdGl2YXRpb24oYWN0aXZhdGlvblNlcnZpY2UsIGFjdGl2YXRvciwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRlc3QoJ0FjdGl2YXRvcnkgbXVzdCBiZSBhY3RpdmF0ZWQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICBweXRob25TZXR0aW5ncy5zZXR1cChwID0+IHAuamVkaUVuYWJsZWQpLnJldHVybnMoKCkgPT4gamVkaUlzRW5hYmxlZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0b3IgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0aW9uU2VydmljZSA9IG5ldyBhY3RpdmF0aW9uU2VydmljZV8xLkV4dGVuc2lvbkFjdGl2YXRpb25TZXJ2aWNlKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHRlc3RBY3RpdmF0aW9uKGFjdGl2YXRpb25TZXJ2aWNlLCBhY3RpdmF0b3IpO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIHRlc3QoJ0FjdGl2YXRvcnkgbXVzdCBiZSBkZWFjdGl2YXRlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIHB5dGhvblNldHRpbmdzLnNldHVwKHAgPT4gcC5qZWRpRW5hYmxlZCkucmV0dXJucygoKSA9PiBqZWRpSXNFbmFibGVkKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2YXRvciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2YXRpb25TZXJ2aWNlID0gbmV3IGFjdGl2YXRpb25TZXJ2aWNlXzEuRXh0ZW5zaW9uQWN0aXZhdGlvblNlcnZpY2Uoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdGVzdEFjdGl2YXRpb24oYWN0aXZhdGlvblNlcnZpY2UsIGFjdGl2YXRvcik7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmF0b3JcclxuICAgICAgICAgICAgICAgICAgICAuc2V0dXAoYSA9PiBhLmRlYWN0aXZhdGUoKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoKSlcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmF0aW9uU2VydmljZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmF0b3IudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgdGVzdCgnUHJvbXB0IHVzZXIgdG8gcmVsb2FkIFZTIENvZGUgYW5kIHJlbG9hZCwgd2hlbiBzZXR0aW5nIGlzIHRvZ2dsZWQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2FsbGJhY2tIYW5kbGVyO1xyXG4gICAgICAgICAgICAgICAgbGV0IGplZGlJc0VuYWJsZWRWYWx1ZUluU2V0dGluZyA9IGplZGlJc0VuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldHVwKHcgPT4gdy5vbkRpZENoYW5nZUNvbmZpZ3VyYXRpb24oVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGxiYWNrKGNiID0+IGNhbGxiYWNrSGFuZGxlciA9IGNiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFR5cGVNb3EuTW9jay5vZlR5cGUoKS5vYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgcHl0aG9uU2V0dGluZ3Muc2V0dXAocCA9PiBwLmplZGlFbmFibGVkKS5yZXR1cm5zKCgpID0+IGplZGlJc0VuYWJsZWRWYWx1ZUluU2V0dGluZyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0b3IgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0aW9uU2VydmljZSA9IG5ldyBhY3RpdmF0aW9uU2VydmljZV8xLkV4dGVuc2lvbkFjdGl2YXRpb25TZXJ2aWNlKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2UudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCB0ZXN0QWN0aXZhdGlvbihhY3RpdmF0aW9uU2VydmljZSwgYWN0aXZhdG9yKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQuc2V0dXAoZSA9PiBlLmFmZmVjdHNDb25maWd1cmF0aW9uKFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uLmplZGlFbmFibGVkJyksIFR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgYXBwU2hlbGwuc2V0dXAoYSA9PiBhLnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzVmFsdWUoJ1JlbG9hZCcpKSlcclxuICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoJ1JlbG9hZCcpKVxyXG4gICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgIGNtZE1hbmFnZXIuc2V0dXAoYyA9PiBjLmV4ZWN1dGVDb21tYW5kKFR5cGVNb3EuSXQuaXNWYWx1ZSgnd29ya2JlbmNoLmFjdGlvbi5yZWxvYWRXaW5kb3cnKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgLy8gVG9nZ2xlIHRoZSB2YWx1ZSBpbiB0aGUgc2V0dGluZyBhbmQgaW52b2tlIHRoZSBjYWxsYmFjay5cclxuICAgICAgICAgICAgICAgIGplZGlJc0VuYWJsZWRWYWx1ZUluU2V0dGluZyA9ICFqZWRpSXNFbmFibGVkVmFsdWVJblNldHRpbmc7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCBjYWxsYmFja0hhbmRsZXIoZXZlbnQub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgYXBwU2hlbGwudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICBjbWRNYW5hZ2VyLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIHRlc3QoJ1Byb21wdCB1c2VyIHRvIHJlbG9hZCBWUyBDb2RlIGFuZCBkbyBub3QgcmVsb2FkLCB3aGVuIHNldHRpbmcgaXMgdG9nZ2xlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIGxldCBjYWxsYmFja0hhbmRsZXI7XHJcbiAgICAgICAgICAgICAgICBsZXQgamVkaUlzRW5hYmxlZFZhbHVlSW5TZXR0aW5nID0gamVkaUlzRW5hYmxlZDtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAuc2V0dXAodyA9PiB3Lm9uRGlkQ2hhbmdlQ29uZmlndXJhdGlvbihUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgICAgICAgICAuY2FsbGJhY2soY2IgPT4gY2FsbGJhY2tIYW5kbGVyID0gY2IpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpLm9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICBweXRob25TZXR0aW5ncy5zZXR1cChwID0+IHAuamVkaUVuYWJsZWQpLnJldHVybnMoKCkgPT4gamVkaUlzRW5hYmxlZFZhbHVlSW5TZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2YXRvciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2YXRpb25TZXJ2aWNlID0gbmV3IGFjdGl2YXRpb25TZXJ2aWNlXzEuRXh0ZW5zaW9uQWN0aXZhdGlvblNlcnZpY2Uoc2VydmljZUNvbnRhaW5lci5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgd29ya3NwYWNlU2VydmljZS52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHRlc3RBY3RpdmF0aW9uKGFjdGl2YXRpb25TZXJ2aWNlLCBhY3RpdmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBldmVudC5zZXR1cChlID0+IGUuYWZmZWN0c0NvbmZpZ3VyYXRpb24oVHlwZU1vcS5JdC5pc1ZhbHVlKCdweXRob24uamVkaUVuYWJsZWQnKSwgVHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICBhcHBTaGVsbC5zZXR1cChhID0+IGEuc2hvd0luZm9ybWF0aW9uTWVzc2FnZShUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZSgnUmVsb2FkJykpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICAgICAgICAgIGNtZE1hbmFnZXIuc2V0dXAoYyA9PiBjLmV4ZWN1dGVDb21tYW5kKFR5cGVNb3EuSXQuaXNWYWx1ZSgnd29ya2JlbmNoLmFjdGlvbi5yZWxvYWRXaW5kb3cnKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgICAgICAgICAgICAgIC8vIFRvZ2dsZSB0aGUgdmFsdWUgaW4gdGhlIHNldHRpbmcgYW5kIGludm9rZSB0aGUgY2FsbGJhY2suXHJcbiAgICAgICAgICAgICAgICBqZWRpSXNFbmFibGVkVmFsdWVJblNldHRpbmcgPSAhamVkaUlzRW5hYmxlZFZhbHVlSW5TZXR0aW5nO1xyXG4gICAgICAgICAgICAgICAgeWllbGQgY2FsbGJhY2tIYW5kbGVyKGV2ZW50Lm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICBldmVudC52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIGFwcFNoZWxsLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgY21kTWFuYWdlci52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB0ZXN0KCdEbyBub3QgcHJvbXB0IHVzZXIgdG8gcmVsb2FkIFZTIENvZGUgd2hlbiBzZXR0aW5nIGlzIG5vdCB0b2dnbGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGNhbGxiYWNrSGFuZGxlcjtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAuc2V0dXAodyA9PiB3Lm9uRGlkQ2hhbmdlQ29uZmlndXJhdGlvbihUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSlcclxuICAgICAgICAgICAgICAgICAgICAuY2FsbGJhY2soY2IgPT4gY2FsbGJhY2tIYW5kbGVyID0gY2IpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpLm9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICBweXRob25TZXR0aW5ncy5zZXR1cChwID0+IHAuamVkaUVuYWJsZWQpLnJldHVybnMoKCkgPT4gamVkaUlzRW5hYmxlZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0b3IgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmF0aW9uU2VydmljZSA9IG5ldyBhY3RpdmF0aW9uU2VydmljZV8xLkV4dGVuc2lvbkFjdGl2YXRpb25TZXJ2aWNlKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVNlcnZpY2UudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCB0ZXN0QWN0aXZhdGlvbihhY3RpdmF0aW9uU2VydmljZSwgYWN0aXZhdG9yKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQuc2V0dXAoZSA9PiBlLmFmZmVjdHNDb25maWd1cmF0aW9uKFR5cGVNb3EuSXQuaXNWYWx1ZSgncHl0aG9uLmplZGlFbmFibGVkJyksIFR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJldHVybnMoKCkgPT4gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLmF0TGVhc3RPbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgYXBwU2hlbGwuc2V0dXAoYSA9PiBhLnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzVmFsdWUoJ1JlbG9hZCcpKSlcclxuICAgICAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKSlcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm5ldmVyKCkpO1xyXG4gICAgICAgICAgICAgICAgY21kTWFuYWdlci5zZXR1cChjID0+IGMuZXhlY3V0ZUNvbW1hbmQoVHlwZU1vcS5JdC5pc1ZhbHVlKCd3b3JrYmVuY2guYWN0aW9uLnJlbG9hZFdpbmRvdycpKSlcclxuICAgICAgICAgICAgICAgICAgICAudmVyaWZpYWJsZShUeXBlTW9xLlRpbWVzLm5ldmVyKCkpO1xyXG4gICAgICAgICAgICAgICAgLy8gSW52b2tlIHRoZSBjb25maWcgY2hhbmdlZCBjYWxsYmFjay5cclxuICAgICAgICAgICAgICAgIHlpZWxkIGNhbGxiYWNrSGFuZGxlcihldmVudC5vYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgICAgICBhcHBTaGVsbC52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIGNtZE1hbmFnZXIudmVyaWZ5QWxsKCk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgdGVzdCgnRG8gbm90IHByb21wdCB1c2VyIHRvIHJlbG9hZCBWUyBDb2RlIHdoZW4gc2V0dGluZyBpcyBub3QgY2hhbmdlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIGxldCBjYWxsYmFja0hhbmRsZXI7XHJcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldHVwKHcgPT4gdy5vbkRpZENoYW5nZUNvbmZpZ3VyYXRpb24oVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhbGxiYWNrKGNiID0+IGNhbGxiYWNrSGFuZGxlciA9IGNiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFR5cGVNb3EuTW9jay5vZlR5cGUoKS5vYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgLnZlcmlmaWFibGUoVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgICAgICAgICAgICAgcHl0aG9uU2V0dGluZ3Muc2V0dXAocCA9PiBwLmplZGlFbmFibGVkKS5yZXR1cm5zKCgpID0+IGplZGlJc0VuYWJsZWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZhdG9yID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZhdGlvblNlcnZpY2UgPSBuZXcgYWN0aXZhdGlvblNlcnZpY2VfMS5FeHRlbnNpb25BY3RpdmF0aW9uU2VydmljZShzZXJ2aWNlQ29udGFpbmVyLm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdGVzdEFjdGl2YXRpb24oYWN0aXZhdGlvblNlcnZpY2UsIGFjdGl2YXRvcik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnNldHVwKGUgPT4gZS5hZmZlY3RzQ29uZmlndXJhdGlvbihUeXBlTW9xLkl0LmlzVmFsdWUoJ3B5dGhvbi5qZWRpRW5hYmxlZCcpLCBUeXBlTW9xLkl0LmlzQW55KCkpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgICAgICAgICBhcHBTaGVsbC5zZXR1cChhID0+IGEuc2hvd0luZm9ybWF0aW9uTWVzc2FnZShUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZSgnUmVsb2FkJykpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICAgICAgICAgICAgICBjbWRNYW5hZ2VyLnNldHVwKGMgPT4gYy5leGVjdXRlQ29tbWFuZChUeXBlTW9xLkl0LmlzVmFsdWUoJ3dvcmtiZW5jaC5hY3Rpb24ucmVsb2FkV2luZG93JykpKVxyXG4gICAgICAgICAgICAgICAgICAgIC52ZXJpZmlhYmxlKFR5cGVNb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICAgICAgICAgICAgICAvLyBJbnZva2UgdGhlIGNvbmZpZyBjaGFuZ2VkIGNhbGxiYWNrLlxyXG4gICAgICAgICAgICAgICAgeWllbGQgY2FsbGJhY2tIYW5kbGVyKGV2ZW50Lm9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICBldmVudC52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgICAgIGFwcFNoZWxsLnZlcmlmeUFsbCgpO1xyXG4gICAgICAgICAgICAgICAgY21kTWFuYWdlci52ZXJpZnlBbGwoKTtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hY3RpdmF0aW9uU2VydmljZS51bml0LnRlc3QuanMubWFwIl19