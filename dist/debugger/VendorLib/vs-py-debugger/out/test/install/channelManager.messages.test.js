"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const inversify_1 = require("inversify");

const TypeMoq = require("typemoq");

const types_1 = require("../../client/common/application/types");

const channelManager_1 = require("../../client/common/installer/channelManager");

const types_2 = require("../../client/common/installer/types");

const types_3 = require("../../client/common/platform/types");

const types_4 = require("../../client/common/types");

const platform_1 = require("../../client/common/utils/platform");

const contracts_1 = require("../../client/interpreter/contracts");

const container_1 = require("../../client/ioc/container");

const serviceManager_1 = require("../../client/ioc/serviceManager");

const info = {
  architecture: platform_1.Architecture.Unknown,
  companyDisplayName: '',
  displayName: '',
  envName: '',
  path: '',
  type: contracts_1.InterpreterType.Unknown,
  version: '',
  version_info: [0, 0, 0, 'alpha'],
  sysPrefix: '',
  sysVersion: ''
}; // tslint:disable-next-line:max-func-body-length

suite('Installation - channel messages', () => {
  let serviceContainer;
  let platform;
  let appShell;
  let interpreters;
  setup(() => {
    const cont = new inversify_1.Container();
    const serviceManager = new serviceManager_1.ServiceManager(cont);
    serviceContainer = new container_1.ServiceContainer(cont);
    platform = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(types_3.IPlatformService, platform.object);
    appShell = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(types_1.IApplicationShell, appShell.object);
    interpreters = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(contracts_1.IInterpreterService, interpreters.object);
    const moduleInstaller = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(types_2.IModuleInstaller, moduleInstaller.object);
  });
  test('No installers message: Unknown/Windows', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Unknown, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip'], ['Conda']);
      verifyUrl(url, ['Windows', 'Pip']);
    }));
  }));
  test('No installers message: Conda/Windows', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Conda, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip', 'Conda'], []);
      verifyUrl(url, ['Windows', 'Pip', 'Conda']);
    }));
  }));
  test('No installers message: Unknown/Mac', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => false);
    platform.setup(x => x.isMac).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Unknown, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip'], ['Conda']);
      verifyUrl(url, ['Mac', 'Pip']);
    }));
  }));
  test('No installers message: Conda/Mac', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => false);
    platform.setup(x => x.isMac).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Conda, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip', 'Conda'], []);
      verifyUrl(url, ['Mac', 'Pip', 'Conda']);
    }));
  }));
  test('No installers message: Unknown/Linux', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => false);
    platform.setup(x => x.isMac).returns(() => false);
    platform.setup(x => x.isLinux).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Unknown, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip'], ['Conda']);
      verifyUrl(url, ['Linux', 'Pip']);
    }));
  }));
  test('No installers message: Conda/Linux', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => false);
    platform.setup(x => x.isMac).returns(() => false);
    platform.setup(x => x.isLinux).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Conda, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip', 'Conda'], []);
      verifyUrl(url, ['Linux', 'Pip', 'Conda']);
    }));
  }));
  test('No channels message', () => __awaiter(void 0, void 0, void 0, function* () {
    platform.setup(x => x.isWindows).returns(() => true);
    yield testInstallerMissingMessage(contracts_1.InterpreterType.Unknown, (message, url) => __awaiter(this, void 0, void 0, function* () {
      verifyMessage(message, ['Pip'], ['Conda']);
      verifyUrl(url, ['Windows', 'Pip']);
    }), 'getInstallationChannel');
  }));

  function verifyMessage(message, present, missing) {
    for (const p of present) {
      assert.equal(message.indexOf(p) >= 0, true, `Message does not contain ${p}.`);
    }

    for (const m of missing) {
      assert.equal(message.indexOf(m) < 0, true, `Message incorrectly contains ${m}.`);
    }
  }

  function verifyUrl(url, terms) {
    assert.equal(url.indexOf('https://') >= 0, true, 'Search Url must be https.');

    for (const term of terms) {
      assert.equal(url.indexOf(term) >= 0, true, `Search Url does not contain ${term}.`);
    }
  }

  function testInstallerMissingMessage(interpreterType, verify, methodType = 'showNoInstallersMessage') {
    return __awaiter(this, void 0, void 0, function* () {
      const activeInterpreter = Object.assign({}, info, {
        type: interpreterType,
        path: ''
      });
      interpreters.setup(x => x.getActiveInterpreter(TypeMoq.It.isAny())).returns(() => new Promise((resolve, reject) => resolve(activeInterpreter)));
      const channels = new channelManager_1.InstallationChannelManager(serviceContainer);
      let url = '';
      let message = '';
      let search = '';
      appShell.setup(x => x.showErrorMessage(TypeMoq.It.isAnyString(), TypeMoq.It.isAnyString())).callback((m, s) => {
        message = m;
        search = s;
      }).returns(() => new Promise((resolve, reject) => resolve(search)));
      appShell.setup(x => x.openUrl(TypeMoq.It.isAnyString())).callback(s => {
        url = s;
      });

      if (methodType === 'showNoInstallersMessage') {
        yield channels.showNoInstallersMessage();
      } else {
        yield channels.getInstallationChannel(types_4.Product.pylint);
      }

      yield verify(message, url);
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYW5uZWxNYW5hZ2VyLm1lc3NhZ2VzLnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImFzc2VydCIsInJlcXVpcmUiLCJpbnZlcnNpZnlfMSIsIlR5cGVNb3EiLCJ0eXBlc18xIiwiY2hhbm5lbE1hbmFnZXJfMSIsInR5cGVzXzIiLCJ0eXBlc18zIiwidHlwZXNfNCIsInBsYXRmb3JtXzEiLCJjb250cmFjdHNfMSIsImNvbnRhaW5lcl8xIiwic2VydmljZU1hbmFnZXJfMSIsImluZm8iLCJhcmNoaXRlY3R1cmUiLCJBcmNoaXRlY3R1cmUiLCJVbmtub3duIiwiY29tcGFueURpc3BsYXlOYW1lIiwiZGlzcGxheU5hbWUiLCJlbnZOYW1lIiwicGF0aCIsInR5cGUiLCJJbnRlcnByZXRlclR5cGUiLCJ2ZXJzaW9uIiwidmVyc2lvbl9pbmZvIiwic3lzUHJlZml4Iiwic3lzVmVyc2lvbiIsInN1aXRlIiwic2VydmljZUNvbnRhaW5lciIsInBsYXRmb3JtIiwiYXBwU2hlbGwiLCJpbnRlcnByZXRlcnMiLCJzZXR1cCIsImNvbnQiLCJDb250YWluZXIiLCJzZXJ2aWNlTWFuYWdlciIsIlNlcnZpY2VNYW5hZ2VyIiwiU2VydmljZUNvbnRhaW5lciIsIk1vY2siLCJvZlR5cGUiLCJhZGRTaW5nbGV0b25JbnN0YW5jZSIsIklQbGF0Zm9ybVNlcnZpY2UiLCJvYmplY3QiLCJJQXBwbGljYXRpb25TaGVsbCIsIklJbnRlcnByZXRlclNlcnZpY2UiLCJtb2R1bGVJbnN0YWxsZXIiLCJJTW9kdWxlSW5zdGFsbGVyIiwidGVzdCIsIngiLCJpc1dpbmRvd3MiLCJyZXR1cm5zIiwidGVzdEluc3RhbGxlck1pc3NpbmdNZXNzYWdlIiwibWVzc2FnZSIsInVybCIsInZlcmlmeU1lc3NhZ2UiLCJ2ZXJpZnlVcmwiLCJDb25kYSIsImlzTWFjIiwiaXNMaW51eCIsInByZXNlbnQiLCJtaXNzaW5nIiwicCIsImVxdWFsIiwiaW5kZXhPZiIsIm0iLCJ0ZXJtcyIsInRlcm0iLCJpbnRlcnByZXRlclR5cGUiLCJ2ZXJpZnkiLCJtZXRob2RUeXBlIiwiYWN0aXZlSW50ZXJwcmV0ZXIiLCJhc3NpZ24iLCJnZXRBY3RpdmVJbnRlcnByZXRlciIsIkl0IiwiaXNBbnkiLCJjaGFubmVscyIsIkluc3RhbGxhdGlvbkNoYW5uZWxNYW5hZ2VyIiwic2VhcmNoIiwic2hvd0Vycm9yTWVzc2FnZSIsImlzQW55U3RyaW5nIiwiY2FsbGJhY2siLCJzIiwib3BlblVybCIsInNob3dOb0luc3RhbGxlcnNNZXNzYWdlIiwiZ2V0SW5zdGFsbGF0aW9uQ2hhbm5lbCIsIlByb2R1Y3QiLCJweWxpbnQiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzNGLGFBQVNDLFFBQVQsQ0FBa0JKLEtBQWxCLEVBQXlC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QU8sQ0FBQ3NFLEVBQVIsQ0FBV00sV0FBWCxFQUFuQixFQUE2QzVFLE9BQU8sQ0FBQ3NFLEVBQVIsQ0FBV00sV0FBWCxFQUE3QyxDQURoQixFQUVLQyxRQUZMLENBRWMsQ0FBQ2hCLENBQUQsRUFBSWlCLENBQUosS0FBVTtBQUNwQjdCLFFBQUFBLE9BQU8sR0FBR1ksQ0FBVjtBQUNBYSxRQUFBQSxNQUFNLEdBQUdJLENBQVQ7QUFDSCxPQUxELEVBTUsvQixPQU5MLENBTWEsTUFBTSxJQUFJbEUsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQkQsT0FBTyxDQUFDNEYsTUFBRCxDQUF4QyxDQU5uQjtBQU9BL0MsTUFBQUEsUUFBUSxDQUFDRSxLQUFULENBQWVnQixDQUFDLElBQUlBLENBQUMsQ0FBQ2tDLE9BQUYsQ0FBVS9FLE9BQU8sQ0FBQ3NFLEVBQVIsQ0FBV00sV0FBWCxFQUFWLENBQXBCLEVBQXlEQyxRQUF6RCxDQUFtRUMsQ0FBRCxJQUFPO0FBQ3JFNUIsUUFBQUEsR0FBRyxHQUFHNEIsQ0FBTjtBQUNILE9BRkQ7O0FBR0EsVUFBSVosVUFBVSxLQUFLLHlCQUFuQixFQUE4QztBQUMxQyxjQUFNTSxRQUFRLENBQUNRLHVCQUFULEVBQU47QUFDSCxPQUZELE1BR0s7QUFDRCxjQUFNUixRQUFRLENBQUNTLHNCQUFULENBQWdDNUUsT0FBTyxDQUFDNkUsT0FBUixDQUFnQkMsTUFBaEQsQ0FBTjtBQUNIOztBQUNELFlBQU1sQixNQUFNLENBQUNoQixPQUFELEVBQVVDLEdBQVYsQ0FBWjtBQUNILEtBMUJlLENBQWhCO0FBMkJIO0FBQ0osQ0FwSEksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcclxuY29uc3QgVHlwZU1vcSA9IHJlcXVpcmUoXCJ0eXBlbW9xXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IGNoYW5uZWxNYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9pbnN0YWxsZXIvY2hhbm5lbE1hbmFnZXJcIik7XHJcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9pbnN0YWxsZXIvdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9wbGF0Zm9ybS90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBwbGF0Zm9ybV8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vdXRpbHMvcGxhdGZvcm1cIik7XHJcbmNvbnN0IGNvbnRyYWN0c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9pbnRlcnByZXRlci9jb250cmFjdHNcIik7XHJcbmNvbnN0IGNvbnRhaW5lcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9pb2MvY29udGFpbmVyXCIpO1xyXG5jb25zdCBzZXJ2aWNlTWFuYWdlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9pb2Mvc2VydmljZU1hbmFnZXJcIik7XHJcbmNvbnN0IGluZm8gPSB7XHJcbiAgICBhcmNoaXRlY3R1cmU6IHBsYXRmb3JtXzEuQXJjaGl0ZWN0dXJlLlVua25vd24sXHJcbiAgICBjb21wYW55RGlzcGxheU5hbWU6ICcnLFxyXG4gICAgZGlzcGxheU5hbWU6ICcnLFxyXG4gICAgZW52TmFtZTogJycsXHJcbiAgICBwYXRoOiAnJyxcclxuICAgIHR5cGU6IGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5Vbmtub3duLFxyXG4gICAgdmVyc2lvbjogJycsXHJcbiAgICB2ZXJzaW9uX2luZm86IFswLCAwLCAwLCAnYWxwaGEnXSxcclxuICAgIHN5c1ByZWZpeDogJycsXHJcbiAgICBzeXNWZXJzaW9uOiAnJ1xyXG59O1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ0luc3RhbGxhdGlvbiAtIGNoYW5uZWwgbWVzc2FnZXMnLCAoKSA9PiB7XHJcbiAgICBsZXQgc2VydmljZUNvbnRhaW5lcjtcclxuICAgIGxldCBwbGF0Zm9ybTtcclxuICAgIGxldCBhcHBTaGVsbDtcclxuICAgIGxldCBpbnRlcnByZXRlcnM7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY29udCA9IG5ldyBpbnZlcnNpZnlfMS5Db250YWluZXIoKTtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlTWFuYWdlciA9IG5ldyBzZXJ2aWNlTWFuYWdlcl8xLlNlcnZpY2VNYW5hZ2VyKGNvbnQpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBuZXcgY29udGFpbmVyXzEuU2VydmljZUNvbnRhaW5lcihjb250KTtcclxuICAgICAgICBwbGF0Zm9ybSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18zLklQbGF0Zm9ybVNlcnZpY2UsIHBsYXRmb3JtLm9iamVjdCk7XHJcbiAgICAgICAgYXBwU2hlbGwgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMS5JQXBwbGljYXRpb25TaGVsbCwgYXBwU2hlbGwub2JqZWN0KTtcclxuICAgICAgICBpbnRlcnByZXRlcnMgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UoY29udHJhY3RzXzEuSUludGVycHJldGVyU2VydmljZSwgaW50ZXJwcmV0ZXJzLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgbW9kdWxlSW5zdGFsbGVyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzIuSU1vZHVsZUluc3RhbGxlciwgbW9kdWxlSW5zdGFsbGVyLm9iamVjdCk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ05vIGluc3RhbGxlcnMgbWVzc2FnZTogVW5rbm93bi9XaW5kb3dzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHBsYXRmb3JtLnNldHVwKHggPT4geC5pc1dpbmRvd3MpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgeWllbGQgdGVzdEluc3RhbGxlck1pc3NpbmdNZXNzYWdlKGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5Vbmtub3duLCAobWVzc2FnZSwgdXJsKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHZlcmlmeU1lc3NhZ2UobWVzc2FnZSwgWydQaXAnXSwgWydDb25kYSddKTtcclxuICAgICAgICAgICAgdmVyaWZ5VXJsKHVybCwgWydXaW5kb3dzJywgJ1BpcCddKTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdObyBpbnN0YWxsZXJzIG1lc3NhZ2U6IENvbmRhL1dpbmRvd3MnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgcGxhdGZvcm0uc2V0dXAoeCA9PiB4LmlzV2luZG93cykucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICB5aWVsZCB0ZXN0SW5zdGFsbGVyTWlzc2luZ01lc3NhZ2UoY29udHJhY3RzXzEuSW50ZXJwcmV0ZXJUeXBlLkNvbmRhLCAobWVzc2FnZSwgdXJsKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHZlcmlmeU1lc3NhZ2UobWVzc2FnZSwgWydQaXAnLCAnQ29uZGEnXSwgW10pO1xyXG4gICAgICAgICAgICB2ZXJpZnlVcmwodXJsLCBbJ1dpbmRvd3MnLCAnUGlwJywgJ0NvbmRhJ10pO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ05vIGluc3RhbGxlcnMgbWVzc2FnZTogVW5rbm93bi9NYWMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgcGxhdGZvcm0uc2V0dXAoeCA9PiB4LmlzV2luZG93cykucmV0dXJucygoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgcGxhdGZvcm0uc2V0dXAoeCA9PiB4LmlzTWFjKS5yZXR1cm5zKCgpID0+IHRydWUpO1xyXG4gICAgICAgIHlpZWxkIHRlc3RJbnN0YWxsZXJNaXNzaW5nTWVzc2FnZShjb250cmFjdHNfMS5JbnRlcnByZXRlclR5cGUuVW5rbm93biwgKG1lc3NhZ2UsIHVybCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB2ZXJpZnlNZXNzYWdlKG1lc3NhZ2UsIFsnUGlwJ10sIFsnQ29uZGEnXSk7XHJcbiAgICAgICAgICAgIHZlcmlmeVVybCh1cmwsIFsnTWFjJywgJ1BpcCddKTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdObyBpbnN0YWxsZXJzIG1lc3NhZ2U6IENvbmRhL01hYycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBwbGF0Zm9ybS5zZXR1cCh4ID0+IHguaXNXaW5kb3dzKS5yZXR1cm5zKCgpID0+IGZhbHNlKTtcclxuICAgICAgICBwbGF0Zm9ybS5zZXR1cCh4ID0+IHguaXNNYWMpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgeWllbGQgdGVzdEluc3RhbGxlck1pc3NpbmdNZXNzYWdlKGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5Db25kYSwgKG1lc3NhZ2UsIHVybCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB2ZXJpZnlNZXNzYWdlKG1lc3NhZ2UsIFsnUGlwJywgJ0NvbmRhJ10sIFtdKTtcclxuICAgICAgICAgICAgdmVyaWZ5VXJsKHVybCwgWydNYWMnLCAnUGlwJywgJ0NvbmRhJ10pO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ05vIGluc3RhbGxlcnMgbWVzc2FnZTogVW5rbm93bi9MaW51eCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBwbGF0Zm9ybS5zZXR1cCh4ID0+IHguaXNXaW5kb3dzKS5yZXR1cm5zKCgpID0+IGZhbHNlKTtcclxuICAgICAgICBwbGF0Zm9ybS5zZXR1cCh4ID0+IHguaXNNYWMpLnJldHVybnMoKCkgPT4gZmFsc2UpO1xyXG4gICAgICAgIHBsYXRmb3JtLnNldHVwKHggPT4geC5pc0xpbnV4KS5yZXR1cm5zKCgpID0+IHRydWUpO1xyXG4gICAgICAgIHlpZWxkIHRlc3RJbnN0YWxsZXJNaXNzaW5nTWVzc2FnZShjb250cmFjdHNfMS5JbnRlcnByZXRlclR5cGUuVW5rbm93biwgKG1lc3NhZ2UsIHVybCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICB2ZXJpZnlNZXNzYWdlKG1lc3NhZ2UsIFsnUGlwJ10sIFsnQ29uZGEnXSk7XHJcbiAgICAgICAgICAgIHZlcmlmeVVybCh1cmwsIFsnTGludXgnLCAnUGlwJ10pO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ05vIGluc3RhbGxlcnMgbWVzc2FnZTogQ29uZGEvTGludXgnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgcGxhdGZvcm0uc2V0dXAoeCA9PiB4LmlzV2luZG93cykucmV0dXJucygoKSA9PiBmYWxzZSk7XHJcbiAgICAgICAgcGxhdGZvcm0uc2V0dXAoeCA9PiB4LmlzTWFjKS5yZXR1cm5zKCgpID0+IGZhbHNlKTtcclxuICAgICAgICBwbGF0Zm9ybS5zZXR1cCh4ID0+IHguaXNMaW51eCkucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICB5aWVsZCB0ZXN0SW5zdGFsbGVyTWlzc2luZ01lc3NhZ2UoY29udHJhY3RzXzEuSW50ZXJwcmV0ZXJUeXBlLkNvbmRhLCAobWVzc2FnZSwgdXJsKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHZlcmlmeU1lc3NhZ2UobWVzc2FnZSwgWydQaXAnLCAnQ29uZGEnXSwgW10pO1xyXG4gICAgICAgICAgICB2ZXJpZnlVcmwodXJsLCBbJ0xpbnV4JywgJ1BpcCcsICdDb25kYSddKTtcclxuICAgICAgICB9KSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdObyBjaGFubmVscyBtZXNzYWdlJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHBsYXRmb3JtLnNldHVwKHggPT4geC5pc1dpbmRvd3MpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgeWllbGQgdGVzdEluc3RhbGxlck1pc3NpbmdNZXNzYWdlKGNvbnRyYWN0c18xLkludGVycHJldGVyVHlwZS5Vbmtub3duLCAobWVzc2FnZSwgdXJsKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHZlcmlmeU1lc3NhZ2UobWVzc2FnZSwgWydQaXAnXSwgWydDb25kYSddKTtcclxuICAgICAgICAgICAgdmVyaWZ5VXJsKHVybCwgWydXaW5kb3dzJywgJ1BpcCddKTtcclxuICAgICAgICB9KSwgJ2dldEluc3RhbGxhdGlvbkNoYW5uZWwnKTtcclxuICAgIH0pKTtcclxuICAgIGZ1bmN0aW9uIHZlcmlmeU1lc3NhZ2UobWVzc2FnZSwgcHJlc2VudCwgbWlzc2luZykge1xyXG4gICAgICAgIGZvciAoY29uc3QgcCBvZiBwcmVzZW50KSB7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChtZXNzYWdlLmluZGV4T2YocCkgPj0gMCwgdHJ1ZSwgYE1lc3NhZ2UgZG9lcyBub3QgY29udGFpbiAke3B9LmApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IG0gb2YgbWlzc2luZykge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwobWVzc2FnZS5pbmRleE9mKG0pIDwgMCwgdHJ1ZSwgYE1lc3NhZ2UgaW5jb3JyZWN0bHkgY29udGFpbnMgJHttfS5gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiB2ZXJpZnlVcmwodXJsLCB0ZXJtcykge1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh1cmwuaW5kZXhPZignaHR0cHM6Ly8nKSA+PSAwLCB0cnVlLCAnU2VhcmNoIFVybCBtdXN0IGJlIGh0dHBzLicpO1xyXG4gICAgICAgIGZvciAoY29uc3QgdGVybSBvZiB0ZXJtcykge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwodXJsLmluZGV4T2YodGVybSkgPj0gMCwgdHJ1ZSwgYFNlYXJjaCBVcmwgZG9lcyBub3QgY29udGFpbiAke3Rlcm19LmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHRlc3RJbnN0YWxsZXJNaXNzaW5nTWVzc2FnZShpbnRlcnByZXRlclR5cGUsIHZlcmlmeSwgbWV0aG9kVHlwZSA9ICdzaG93Tm9JbnN0YWxsZXJzTWVzc2FnZScpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBhY3RpdmVJbnRlcnByZXRlciA9IE9iamVjdC5hc3NpZ24oe30sIGluZm8sIHsgdHlwZTogaW50ZXJwcmV0ZXJUeXBlLCBwYXRoOiAnJyB9KTtcclxuICAgICAgICAgICAgaW50ZXJwcmV0ZXJzXHJcbiAgICAgICAgICAgICAgICAuc2V0dXAoeCA9PiB4LmdldEFjdGl2ZUludGVycHJldGVyKFR5cGVNb3EuSXQuaXNBbnkoKSkpXHJcbiAgICAgICAgICAgICAgICAucmV0dXJucygoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiByZXNvbHZlKGFjdGl2ZUludGVycHJldGVyKSkpO1xyXG4gICAgICAgICAgICBjb25zdCBjaGFubmVscyA9IG5ldyBjaGFubmVsTWFuYWdlcl8xLkluc3RhbGxhdGlvbkNoYW5uZWxNYW5hZ2VyKHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgICAgICAgICBsZXQgdXJsID0gJyc7XHJcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gJyc7XHJcbiAgICAgICAgICAgIGxldCBzZWFyY2ggPSAnJztcclxuICAgICAgICAgICAgYXBwU2hlbGxcclxuICAgICAgICAgICAgICAgIC5zZXR1cCh4ID0+IHguc2hvd0Vycm9yTWVzc2FnZShUeXBlTW9xLkl0LmlzQW55U3RyaW5nKCksIFR5cGVNb3EuSXQuaXNBbnlTdHJpbmcoKSkpXHJcbiAgICAgICAgICAgICAgICAuY2FsbGJhY2soKG0sIHMpID0+IHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtO1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoID0gcztcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5yZXR1cm5zKCgpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHJlc29sdmUoc2VhcmNoKSkpO1xyXG4gICAgICAgICAgICBhcHBTaGVsbC5zZXR1cCh4ID0+IHgub3BlblVybChUeXBlTW9xLkl0LmlzQW55U3RyaW5nKCkpKS5jYWxsYmFjaygocykgPT4ge1xyXG4gICAgICAgICAgICAgICAgdXJsID0gcztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChtZXRob2RUeXBlID09PSAnc2hvd05vSW5zdGFsbGVyc01lc3NhZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCBjaGFubmVscy5zaG93Tm9JbnN0YWxsZXJzTWVzc2FnZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgY2hhbm5lbHMuZ2V0SW5zdGFsbGF0aW9uQ2hhbm5lbCh0eXBlc180LlByb2R1Y3QucHlsaW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB5aWVsZCB2ZXJpZnkobWVzc2FnZSwgdXJsKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNoYW5uZWxNYW5hZ2VyLm1lc3NhZ2VzLnRlc3QuanMubWFwIl19