"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const path = require("path");

const vscode = require("vscode");

const common_1 = require("../common");

const constants_1 = require("../constants");

const initialize_1 = require("../initialize");

const serviceRegistry_1 = require("../unittests/serviceRegistry");

const autoCompPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'signature');

class SignatureHelpResult {
  constructor(line, index, signaturesCount, activeParameter, parameterName) {
    this.line = line;
    this.index = index;
    this.signaturesCount = signaturesCount;
    this.activeParameter = activeParameter;
    this.parameterName = parameterName;
  }

} // tslint:disable-next-line:max-func-body-length


suite('Signatures (Jedi)', () => {
  let isPython2;
  let ioc;
  suiteSetup(function () {
    return __awaiter(this, void 0, void 0, function* () {
      if (constants_1.IsLanguageServerTest()) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
      }

      yield initialize_1.initialize();
      initializeDI();
      isPython2 = (yield ioc.getPythonMajorVersion(common_1.rootWorkspaceUri)) === 2;
    });
  });
  setup(initialize_1.initializeTest);
  suiteTeardown(initialize_1.closeActiveWindows);
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.closeActiveWindows();
    ioc.dispose();
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerVariableTypes();
    ioc.registerProcessTypes();
  }

  test('For ctor', () => __awaiter(void 0, void 0, void 0, function* () {
    const expected = [new SignatureHelpResult(5, 11, 0, 0, null), new SignatureHelpResult(5, 12, 1, 0, 'name'), new SignatureHelpResult(5, 13, 0, 0, null), new SignatureHelpResult(5, 14, 0, 0, null), new SignatureHelpResult(5, 15, 0, 0, null), new SignatureHelpResult(5, 16, 0, 0, null), new SignatureHelpResult(5, 17, 0, 0, null), new SignatureHelpResult(5, 18, 1, 1, 'age'), new SignatureHelpResult(5, 19, 1, 1, 'age'), new SignatureHelpResult(5, 20, 0, 0, null)];
    const document = yield openDocument(path.join(autoCompPath, 'classCtor.py'));

    for (let i = 0; i < expected.length; i += 1) {
      yield checkSignature(expected[i], document.uri, i);
    }
  }));
  test('For intrinsic', () => __awaiter(void 0, void 0, void 0, function* () {
    const expected = [new SignatureHelpResult(0, 0, 0, 0, null), new SignatureHelpResult(0, 1, 0, 0, null), new SignatureHelpResult(0, 2, 0, 0, null), new SignatureHelpResult(0, 3, 0, 0, null), new SignatureHelpResult(0, 4, 0, 0, null), new SignatureHelpResult(0, 5, 0, 0, null), new SignatureHelpResult(0, 6, 1, 0, 'stop'), new SignatureHelpResult(0, 7, 1, 0, 'stop') // new SignatureHelpResult(0, 6, 1, 0, 'start'),
    // new SignatureHelpResult(0, 7, 1, 0, 'start'),
    // new SignatureHelpResult(0, 8, 1, 1, 'stop'),
    // new SignatureHelpResult(0, 9, 1, 1, 'stop'),
    // new SignatureHelpResult(0, 10, 1, 1, 'stop'),
    // new SignatureHelpResult(0, 11, 1, 2, 'step'),
    // new SignatureHelpResult(1, 0, 1, 2, 'step')
    ];
    const document = yield openDocument(path.join(autoCompPath, 'basicSig.py'));

    for (let i = 0; i < expected.length; i += 1) {
      yield checkSignature(expected[i], document.uri, i);
    }
  }));
  test('For ellipsis', function () {
    return __awaiter(this, void 0, void 0, function* () {
      if (isPython2) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
        return;
      }

      const expected = [new SignatureHelpResult(0, 5, 0, 0, null), new SignatureHelpResult(0, 6, 1, 0, 'value'), new SignatureHelpResult(0, 7, 1, 0, 'value'), new SignatureHelpResult(0, 8, 1, 1, '...'), new SignatureHelpResult(0, 9, 1, 1, '...'), new SignatureHelpResult(0, 10, 1, 1, '...'), new SignatureHelpResult(0, 11, 1, 2, 'sep'), new SignatureHelpResult(0, 12, 1, 2, 'sep')];
      const document = yield openDocument(path.join(autoCompPath, 'ellipsis.py'));

      for (let i = 0; i < expected.length; i += 1) {
        yield checkSignature(expected[i], document.uri, i);
      }
    });
  });
  test('For pow', () => __awaiter(void 0, void 0, void 0, function* () {
    let expected;

    if (isPython2) {
      expected = new SignatureHelpResult(0, 4, 1, 0, 'x');
    } else {
      expected = new SignatureHelpResult(0, 4, 1, 0, null);
    }

    const document = yield openDocument(path.join(autoCompPath, 'noSigPy3.py'));
    yield checkSignature(expected, document.uri, 0);
  }));
});

function openDocument(documentPath) {
  return __awaiter(this, void 0, void 0, function* () {
    const document = yield vscode.workspace.openTextDocument(documentPath);
    yield vscode.window.showTextDocument(document);
    return document;
  });
}

function checkSignature(expected, uri, caseIndex) {
  return __awaiter(this, void 0, void 0, function* () {
    const position = new vscode.Position(expected.line, expected.index);
    const actual = yield vscode.commands.executeCommand('vscode.executeSignatureHelpProvider', uri, position);
    assert.equal(actual.signatures.length, expected.signaturesCount, `Signature count does not match, case ${caseIndex}`);

    if (expected.signaturesCount > 0) {
      assert.equal(actual.activeParameter, expected.activeParameter, `Parameter index does not match, case ${caseIndex}`);

      if (expected.parameterName) {
        const parameter = actual.signatures[0].parameters[expected.activeParameter];
        assert.equal(parameter.label, expected.parameterName, `Parameter name is incorrect, case ${caseIndex}`);
      }
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNpZ25hdHVyZS5qZWRpLnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImFzc2VydCIsInJlcXVpcmUiLCJwYXRoIiwidnNjb2RlIiwiY29tbW9uXzEiLCJjb25zdGFudHNfMSIsImluaXRpYWxpemVfMSIsInNlcnZpY2VSZWdpc3RyeV8xIiwiYXV0b0NvbXBQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsIlNpZ25hdHVyZUhlbHBSZXN1bHQiLCJjb25zdHJ1Y3RvciIsImxpbmUiLCJpbmRleCIsInNpZ25hdHVyZXNDb3VudCIsImFjdGl2ZVBhcmFtZXRlciIsInBhcmFtZXRlck5hbWUiLCJzdWl0ZSIsImlzUHl0aG9uMiIsImlvYyIsInN1aXRlU2V0dXAiLCJJc0xhbmd1YWdlU2VydmVyVGVzdCIsInNraXAiLCJpbml0aWFsaXplIiwiaW5pdGlhbGl6ZURJIiwiZ2V0UHl0aG9uTWFqb3JWZXJzaW9uIiwicm9vdFdvcmtzcGFjZVVyaSIsInNldHVwIiwiaW5pdGlhbGl6ZVRlc3QiLCJzdWl0ZVRlYXJkb3duIiwiY2xvc2VBY3RpdmVXaW5kb3dzIiwidGVhcmRvd24iLCJkaXNwb3NlIiwiVW5pdFRlc3RJb2NDb250YWluZXIiLCJyZWdpc3RlckNvbW1vblR5cGVzIiwicmVnaXN0ZXJWYXJpYWJsZVR5cGVzIiwicmVnaXN0ZXJQcm9jZXNzVHlwZXMiLCJ0ZXN0IiwiZXhwZWN0ZWQiLCJkb2N1bWVudCIsIm9wZW5Eb2N1bWVudCIsImkiLCJsZW5ndGgiLCJjaGVja1NpZ25hdHVyZSIsInVyaSIsImRvY3VtZW50UGF0aCIsIndvcmtzcGFjZSIsIm9wZW5UZXh0RG9jdW1lbnQiLCJ3aW5kb3ciLCJzaG93VGV4dERvY3VtZW50IiwiY2FzZUluZGV4IiwicG9zaXRpb24iLCJQb3NpdGlvbiIsImFjdHVhbCIsImNvbW1hbmRzIiwiZXhlY3V0ZUNvbW1hbmQiLCJlcXVhbCIsInNpZ25hdHVyZXMiLCJwYXJhbWV0ZXIiLCJwYXJhbWV0ZXJzIiwibGFiZWwiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzNGLGFBQVNDLFFBQVQsQ0FBa0JKLEtBQWxCLEVBQXlCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQyxPQUFELENBQVQsQ0FBbUJLLEtBQW5CLENBQUQsQ0FBSjtBQUFrQyxPQUF4QyxDQUF5QyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUM5RixhQUFTRixJQUFULENBQWNJLE1BQWQsRUFBc0I7QUFBRUEsTUFBQUEsTUFBTSxDQUFDQyxJQUFQLEdBQWNULE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQXJCLEdBQXNDLElBQUlOLENBQUosQ0FBTSxVQUFVRyxP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b3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgdnNjb2RlID0gcmVxdWlyZShcInZzY29kZVwiKTtcclxuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uXCIpO1xyXG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XHJcbmNvbnN0IGluaXRpYWxpemVfMSA9IHJlcXVpcmUoXCIuLi9pbml0aWFsaXplXCIpO1xyXG5jb25zdCBzZXJ2aWNlUmVnaXN0cnlfMSA9IHJlcXVpcmUoXCIuLi91bml0dGVzdHMvc2VydmljZVJlZ2lzdHJ5XCIpO1xyXG5jb25zdCBhdXRvQ29tcFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAnc2lnbmF0dXJlJyk7XHJcbmNsYXNzIFNpZ25hdHVyZUhlbHBSZXN1bHQge1xyXG4gICAgY29uc3RydWN0b3IobGluZSwgaW5kZXgsIHNpZ25hdHVyZXNDb3VudCwgYWN0aXZlUGFyYW1ldGVyLCBwYXJhbWV0ZXJOYW1lKSB7XHJcbiAgICAgICAgdGhpcy5saW5lID0gbGluZTtcclxuICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgdGhpcy5zaWduYXR1cmVzQ291bnQgPSBzaWduYXR1cmVzQ291bnQ7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVQYXJhbWV0ZXIgPSBhY3RpdmVQYXJhbWV0ZXI7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJOYW1lID0gcGFyYW1ldGVyTmFtZTtcclxuICAgIH1cclxufVxyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ1NpZ25hdHVyZXMgKEplZGkpJywgKCkgPT4ge1xyXG4gICAgbGV0IGlzUHl0aG9uMjtcclxuICAgIGxldCBpb2M7XHJcbiAgICBzdWl0ZVNldHVwKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBpZiAoY29uc3RhbnRzXzEuSXNMYW5ndWFnZVNlcnZlclRlc3QoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpc1xyXG4gICAgICAgICAgICAgICAgdGhpcy5za2lwKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUoKTtcclxuICAgICAgICAgICAgaW5pdGlhbGl6ZURJKCk7XHJcbiAgICAgICAgICAgIGlzUHl0aG9uMiA9ICh5aWVsZCBpb2MuZ2V0UHl0aG9uTWFqb3JWZXJzaW9uKGNvbW1vbl8xLnJvb3RXb3Jrc3BhY2VVcmkpKSA9PT0gMjtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgc2V0dXAoaW5pdGlhbGl6ZV8xLmluaXRpYWxpemVUZXN0KTtcclxuICAgIHN1aXRlVGVhcmRvd24oaW5pdGlhbGl6ZV8xLmNsb3NlQWN0aXZlV2luZG93cyk7XHJcbiAgICB0ZWFyZG93bigoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmNsb3NlQWN0aXZlV2luZG93cygpO1xyXG4gICAgICAgIGlvYy5kaXNwb3NlKCk7XHJcbiAgICB9KSk7XHJcbiAgICBmdW5jdGlvbiBpbml0aWFsaXplREkoKSB7XHJcbiAgICAgICAgaW9jID0gbmV3IHNlcnZpY2VSZWdpc3RyeV8xLlVuaXRUZXN0SW9jQ29udGFpbmVyKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyQ29tbW9uVHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJWYXJpYWJsZVR5cGVzKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyUHJvY2Vzc1R5cGVzKCk7XHJcbiAgICB9XHJcbiAgICB0ZXN0KCdGb3IgY3RvcicsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBleHBlY3RlZCA9IFtcclxuICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoNSwgMTEsIDAsIDAsIG51bGwpLFxyXG4gICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCg1LCAxMiwgMSwgMCwgJ25hbWUnKSxcclxuICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoNSwgMTMsIDAsIDAsIG51bGwpLFxyXG4gICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCg1LCAxNCwgMCwgMCwgbnVsbCksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDUsIDE1LCAwLCAwLCBudWxsKSxcclxuICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoNSwgMTYsIDAsIDAsIG51bGwpLFxyXG4gICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCg1LCAxNywgMCwgMCwgbnVsbCksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDUsIDE4LCAxLCAxLCAnYWdlJyksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDUsIDE5LCAxLCAxLCAnYWdlJyksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDUsIDIwLCAwLCAwLCBudWxsKVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSB5aWVsZCBvcGVuRG9jdW1lbnQocGF0aC5qb2luKGF1dG9Db21wUGF0aCwgJ2NsYXNzQ3Rvci5weScpKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV4cGVjdGVkLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIHlpZWxkIGNoZWNrU2lnbmF0dXJlKGV4cGVjdGVkW2ldLCBkb2N1bWVudC51cmksIGkpO1xyXG4gICAgICAgIH1cclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0ZvciBpbnRyaW5zaWMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZXhwZWN0ZWQgPSBbXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDAsIDAsIDAsIG51bGwpLFxyXG4gICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCAxLCAwLCAwLCBudWxsKSxcclxuICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoMCwgMiwgMCwgMCwgbnVsbCksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDMsIDAsIDAsIG51bGwpLFxyXG4gICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCA0LCAwLCAwLCBudWxsKSxcclxuICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoMCwgNSwgMCwgMCwgbnVsbCksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDYsIDEsIDAsICdzdG9wJyksXHJcbiAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDcsIDEsIDAsICdzdG9wJylcclxuICAgICAgICAgICAgLy8gbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoMCwgNiwgMSwgMCwgJ3N0YXJ0JyksXHJcbiAgICAgICAgICAgIC8vIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDcsIDEsIDAsICdzdGFydCcpLFxyXG4gICAgICAgICAgICAvLyBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCA4LCAxLCAxLCAnc3RvcCcpLFxyXG4gICAgICAgICAgICAvLyBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCA5LCAxLCAxLCAnc3RvcCcpLFxyXG4gICAgICAgICAgICAvLyBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCAxMCwgMSwgMSwgJ3N0b3AnKSxcclxuICAgICAgICAgICAgLy8gbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoMCwgMTEsIDEsIDIsICdzdGVwJyksXHJcbiAgICAgICAgICAgIC8vIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDEsIDAsIDEsIDIsICdzdGVwJylcclxuICAgICAgICBdO1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0geWllbGQgb3BlbkRvY3VtZW50KHBhdGguam9pbihhdXRvQ29tcFBhdGgsICdiYXNpY1NpZy5weScpKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV4cGVjdGVkLmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgIHlpZWxkIGNoZWNrU2lnbmF0dXJlKGV4cGVjdGVkW2ldLCBkb2N1bWVudC51cmksIGkpO1xyXG4gICAgICAgIH1cclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0ZvciBlbGxpcHNpcycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBpZiAoaXNQeXRob24yKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNraXAoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBleHBlY3RlZCA9IFtcclxuICAgICAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDUsIDAsIDAsIG51bGwpLFxyXG4gICAgICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoMCwgNiwgMSwgMCwgJ3ZhbHVlJyksXHJcbiAgICAgICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCA3LCAxLCAwLCAndmFsdWUnKSxcclxuICAgICAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDgsIDEsIDEsICcuLi4nKSxcclxuICAgICAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDksIDEsIDEsICcuLi4nKSxcclxuICAgICAgICAgICAgICAgIG5ldyBTaWduYXR1cmVIZWxwUmVzdWx0KDAsIDEwLCAxLCAxLCAnLi4uJyksXHJcbiAgICAgICAgICAgICAgICBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCAxMSwgMSwgMiwgJ3NlcCcpLFxyXG4gICAgICAgICAgICAgICAgbmV3IFNpZ25hdHVyZUhlbHBSZXN1bHQoMCwgMTIsIDEsIDIsICdzZXAnKVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBjb25zdCBkb2N1bWVudCA9IHlpZWxkIG9wZW5Eb2N1bWVudChwYXRoLmpvaW4oYXV0b0NvbXBQYXRoLCAnZWxsaXBzaXMucHknKSk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwZWN0ZWQubGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIHlpZWxkIGNoZWNrU2lnbmF0dXJlKGV4cGVjdGVkW2ldLCBkb2N1bWVudC51cmksIGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ0ZvciBwb3cnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgbGV0IGV4cGVjdGVkO1xyXG4gICAgICAgIGlmIChpc1B5dGhvbjIpIHtcclxuICAgICAgICAgICAgZXhwZWN0ZWQgPSBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCA0LCAxLCAwLCAneCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZXhwZWN0ZWQgPSBuZXcgU2lnbmF0dXJlSGVscFJlc3VsdCgwLCA0LCAxLCAwLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSB5aWVsZCBvcGVuRG9jdW1lbnQocGF0aC5qb2luKGF1dG9Db21wUGF0aCwgJ25vU2lnUHkzLnB5JykpO1xyXG4gICAgICAgIHlpZWxkIGNoZWNrU2lnbmF0dXJlKGV4cGVjdGVkLCBkb2N1bWVudC51cmksIDApO1xyXG4gICAgfSkpO1xyXG59KTtcclxuZnVuY3Rpb24gb3BlbkRvY3VtZW50KGRvY3VtZW50UGF0aCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBkb2N1bWVudCA9IHlpZWxkIHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudChkb2N1bWVudFBhdGgpO1xyXG4gICAgICAgIHlpZWxkIHZzY29kZS53aW5kb3cuc2hvd1RleHREb2N1bWVudChkb2N1bWVudCk7XHJcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50O1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gY2hlY2tTaWduYXR1cmUoZXhwZWN0ZWQsIHVyaSwgY2FzZUluZGV4KSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IHZzY29kZS5Qb3NpdGlvbihleHBlY3RlZC5saW5lLCBleHBlY3RlZC5pbmRleCk7XHJcbiAgICAgICAgY29uc3QgYWN0dWFsID0geWllbGQgdnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKCd2c2NvZGUuZXhlY3V0ZVNpZ25hdHVyZUhlbHBQcm92aWRlcicsIHVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChhY3R1YWwuc2lnbmF0dXJlcy5sZW5ndGgsIGV4cGVjdGVkLnNpZ25hdHVyZXNDb3VudCwgYFNpZ25hdHVyZSBjb3VudCBkb2VzIG5vdCBtYXRjaCwgY2FzZSAke2Nhc2VJbmRleH1gKTtcclxuICAgICAgICBpZiAoZXhwZWN0ZWQuc2lnbmF0dXJlc0NvdW50ID4gMCkge1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoYWN0dWFsLmFjdGl2ZVBhcmFtZXRlciwgZXhwZWN0ZWQuYWN0aXZlUGFyYW1ldGVyLCBgUGFyYW1ldGVyIGluZGV4IGRvZXMgbm90IG1hdGNoLCBjYXNlICR7Y2FzZUluZGV4fWApO1xyXG4gICAgICAgICAgICBpZiAoZXhwZWN0ZWQucGFyYW1ldGVyTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVyID0gYWN0dWFsLnNpZ25hdHVyZXNbMF0ucGFyYW1ldGVyc1tleHBlY3RlZC5hY3RpdmVQYXJhbWV0ZXJdO1xyXG4gICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHBhcmFtZXRlci5sYWJlbCwgZXhwZWN0ZWQucGFyYW1ldGVyTmFtZSwgYFBhcmFtZXRlciBuYW1lIGlzIGluY29ycmVjdCwgY2FzZSAke2Nhc2VJbmRleH1gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNpZ25hdHVyZS5qZWRpLnRlc3QuanMubWFwIl19