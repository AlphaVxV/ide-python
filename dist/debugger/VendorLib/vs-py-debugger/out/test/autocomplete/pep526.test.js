'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const path = require("path");

const vscode = require("vscode");

const platform_1 = require("../../client/common/utils/platform");

const common_1 = require("../common");

const initialize_1 = require("../initialize");

const serviceRegistry_1 = require("../unittests/serviceRegistry");

const autoCompPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'autocomp');
const filePep526 = path.join(autoCompPath, 'pep526.py'); // tslint:disable-next-line:max-func-body-length

suite('Autocomplete PEP 526', () => {
  let isPython2;
  let ioc;
  suiteSetup(function () {
    return __awaiter(this, void 0, void 0, function* () {
      // https://github.com/Microsoft/PTVS/issues/3917
      if (initialize_1.IsLanguageServerTest()) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
      }

      yield initialize_1.initialize();
      initializeDI();
      isPython2 = (yield ioc.getPythonMajorVersion(common_1.rootWorkspaceUri)) === 2;

      if (isPython2) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
        return;
      }
    });
  });
  setup(initialize_1.initializeTest);
  suiteTeardown(initialize_1.closeActiveWindows);
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.closeActiveWindows();
    ioc.dispose();
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerVariableTypes();
    ioc.registerProcessTypes();
  }

  test('variable (abc:str)', function () {
    return __awaiter(this, void 0, void 0, function* () {
      // This test has not been working for many months in Python 3.4 and 3.5 under
      // Windows and macOS.Tracked by #2545.
      if (common_1.isOs(platform_1.OSType.Windows, platform_1.OSType.OSX)) {
        if (yield common_1.isPythonVersion('3.4', '3.5')) {
          // tslint:disable-next-line:no-invalid-this
          return this.skip();
        }
      }

      const textDocument = yield vscode.workspace.openTextDocument(filePep526);
      yield vscode.window.showTextDocument(textDocument);
      assert(vscode.window.activeTextEditor, 'No active editor');
      const position = new vscode.Position(9, 8);
      const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
      assert.notEqual(list.items.filter(item => item.label === 'capitalize').length, 0, 'capitalize not found');
      assert.notEqual(list.items.filter(item => item.label === 'upper').length, 0, 'upper not found');
      assert.notEqual(list.items.filter(item => item.label === 'lower').length, 0, 'lower not found');
    });
  });
  test('variable (abc: str = "")', function () {
    return __awaiter(this, void 0, void 0, function* () {
      // This test has not been working for many months in Python 3.4 and 3.5 under
      // Windows and macOS.Tracked by #2545.
      if (common_1.isOs(platform_1.OSType.Windows, platform_1.OSType.OSX)) {
        if (yield common_1.isPythonVersion('3.4', '3.5')) {
          // tslint:disable-next-line:no-invalid-this
          return this.skip();
        }
      }

      const textDocument = yield vscode.workspace.openTextDocument(filePep526);
      yield vscode.window.showTextDocument(textDocument);
      assert(vscode.window.activeTextEditor, 'No active editor');
      const position = new vscode.Position(8, 14);
      const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
      assert.notEqual(list.items.filter(item => item.label === 'capitalize').length, 0, 'capitalize not found');
      assert.notEqual(list.items.filter(item => item.label === 'upper').length, 0, 'upper not found');
      assert.notEqual(list.items.filter(item => item.label === 'lower').length, 0, 'lower not found');
    });
  });
  test('variable (abc = UNKNOWN # type: str)', function () {
    return __awaiter(this, void 0, void 0, function* () {
      // This test has not been working for many months in Python 3.4 and 3.5 under
      // Windows and macOS.Tracked by #2545.
      if (common_1.isOs(platform_1.OSType.Windows, platform_1.OSType.OSX)) {
        if (yield common_1.isPythonVersion('3.4', '3.5')) {
          // tslint:disable-next-line:no-invalid-this
          return this.skip();
        }
      }

      const textDocument = yield vscode.workspace.openTextDocument(filePep526);
      yield vscode.window.showTextDocument(textDocument);
      assert(vscode.window.activeTextEditor, 'No active editor');
      const position = new vscode.Position(7, 14);
      const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
      assert.notEqual(list.items.filter(item => item.label === 'capitalize').length, 0, 'capitalize not found');
      assert.notEqual(list.items.filter(item => item.label === 'upper').length, 0, 'upper not found');
      assert.notEqual(list.items.filter(item => item.label === 'lower').length, 0, 'lower not found');
    });
  });
  test('class methods', function () {
    return __awaiter(this, void 0, void 0, function* () {
      // This test has not been working for many months in Python 3.4 and 3.5 under
      // Windows and macOS.Tracked by #2545.
      if (common_1.isOs(platform_1.OSType.Windows, platform_1.OSType.OSX)) {
        if (yield common_1.isPythonVersion('3.4', '3.5')) {
          // tslint:disable-next-line:no-invalid-this
          return this.skip();
        }
      }

      const textDocument = yield vscode.workspace.openTextDocument(filePep526);
      yield vscode.window.showTextDocument(textDocument);
      assert(vscode.window.activeTextEditor, 'No active editor');
      let position = new vscode.Position(20, 4);
      let list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
      assert.notEqual(list.items.filter(item => item.label === 'a').length, 0, 'method a not found');
      position = new vscode.Position(21, 4);
      list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
      assert.notEqual(list.items.filter(item => item.label === 'b').length, 0, 'method b not found');
    });
  });
  test('class method types', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode.workspace.openTextDocument(filePep526);
    yield vscode.window.showTextDocument(textDocument);
    assert(vscode.window.activeTextEditor, 'No active editor');
    const position = new vscode.Position(21, 6);
    const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
    assert.notEqual(list.items.filter(item => item.label === 'bit_length').length, 0, 'bit_length not found');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBlcDUyNi50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJhc3NlcnQiLCJyZXF1aXJlIiwicGF0aCIsInZzY29kZSIsInBsYXRmb3JtXzEiLCJjb21tb25fMSIsImluaXRpYWxpemVfMSIsInNlcnZpY2VSZWdpc3RyeV8xIiwiYXV0b0NvbXBQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsImZpbGVQZXA1MjYiLCJzdWl0ZSIsImlzUHl0aG9uMiIsImlvYyIsInN1aXRlU2V0dXAiLCJJc0xhbmd1YWdlU2VydmVyVGVzdCIsInNraXAiLCJpbml0aWFsaXplIiwiaW5pdGlhbGl6ZURJIiwiZ2V0UHl0aG9uTWFqb3JWZXJzaW9uIiwicm9vdFdvcmtzcGFjZVVyaSIsInNldHVwIiwiaW5pdGlhbGl6ZVRlc3QiLCJzdWl0ZVRlYXJkb3duIiwiY2xvc2VBY3RpdmVXaW5kb3dzIiwidGVhcmRvd24iLCJkaXNwb3NlIiwiVW5pdFRlc3RJb2NDb250YWluZXIiLCJyZWdpc3RlckNvbW1vblR5cGVzIiwicmVnaXN0ZXJWYXJpYWJsZVR5cGVzIiwicmVnaXN0ZXJQcm9jZXNzVHlwZXMiLCJ0ZXN0IiwiaXNPcyIsIk9TVHlwZSIsIldpbmRvd3MiLCJPU1giLCJpc1B5dGhvblZlcnNpb24iLCJ0ZXh0RG9jdW1lbnQiLCJ3b3Jrc3BhY2UiLCJvcGVuVGV4dERvY3VtZW50Iiwid2luZG93Iiwic2hvd1RleHREb2N1bWVudCIsImFjdGl2ZVRleHRFZGl0b3IiLCJwb3NpdGlvbiIsIlBvc2l0aW9uIiwibGlzdCIsImNvbW1hbmRzIiwiZXhlY3V0ZUNvbW1hbmQiLCJ1cmkiLCJub3RFcXVhbCIsIml0ZW1zIiwiZmlsdGVyIiwiaXRlbSIsImxhYmVsIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUMzRixhQUFTQyxRQUFULENBQWtCSixLQUFsQixFQUF5QjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUMsT0FBRCxDQUFULENBQW1CSyxLQUFuQixDQUFELENBQUo7QUFBa0MsT0FBeEMsQ0FBeUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDOUYsYUFBU0YsSUFBVCxDQUFjSSxNQUFkLEVBQXNCO0FBQUVBLE1BQUFBLE1BQU0sQ0FBQ0MsSUFBUCxHQUFjVCxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFyQixHQUFzQyxJQUFJTixDQUFKLENBQU0sVUFBVUcsT0FBVixFQUFtQjtBQUFFQSxRQUFBQSxPQUFPLENBQUNRLE1BQU0sQ0FBQ0wsS0FBUixDQUFQO0FBQXdCLE9BQW5ELEVBQXFETyxJQUFyRCxDQUEwRFIsU0FBMUQsRUFBcUVLLFFBQXJFLENBQXRDO0FBQXVIOztBQUMvSUgs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RSxDQUEvRSxFQUFrRixzQkFBbEY7QUFDSCxHQVB5QyxDQUF0QyxDQUFKO0FBUUgsQ0F6SEksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBhc3NlcnQgPSByZXF1aXJlKFwiYXNzZXJ0XCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IHBsYXRmb3JtXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9wbGF0Zm9ybVwiKTtcclxuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi4vdW5pdHRlc3RzL3NlcnZpY2VSZWdpc3RyeVwiKTtcclxuY29uc3QgYXV0b0NvbXBQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJy4uJywgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ2F1dG9jb21wJyk7XHJcbmNvbnN0IGZpbGVQZXA1MjYgPSBwYXRoLmpvaW4oYXV0b0NvbXBQYXRoLCAncGVwNTI2LnB5Jyk7XHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5zdWl0ZSgnQXV0b2NvbXBsZXRlIFBFUCA1MjYnLCAoKSA9PiB7XHJcbiAgICBsZXQgaXNQeXRob24yO1xyXG4gICAgbGV0IGlvYztcclxuICAgIHN1aXRlU2V0dXAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvUFRWUy9pc3N1ZXMvMzkxN1xyXG4gICAgICAgICAgICBpZiAoaW5pdGlhbGl6ZV8xLklzTGFuZ3VhZ2VTZXJ2ZXJUZXN0KCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICAgICAgICAgIHRoaXMuc2tpcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5pbml0aWFsaXplKCk7XHJcbiAgICAgICAgICAgIGluaXRpYWxpemVESSgpO1xyXG4gICAgICAgICAgICBpc1B5dGhvbjIgPSAoeWllbGQgaW9jLmdldFB5dGhvbk1ham9yVmVyc2lvbihjb21tb25fMS5yb290V29ya3NwYWNlVXJpKSkgPT09IDI7XHJcbiAgICAgICAgICAgIGlmIChpc1B5dGhvbjIpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICAgICAgICAgIHRoaXMuc2tpcCgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHNldHVwKGluaXRpYWxpemVfMS5pbml0aWFsaXplVGVzdCk7XHJcbiAgICBzdWl0ZVRlYXJkb3duKGluaXRpYWxpemVfMS5jbG9zZUFjdGl2ZVdpbmRvd3MpO1xyXG4gICAgdGVhcmRvd24oKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5jbG9zZUFjdGl2ZVdpbmRvd3MoKTtcclxuICAgICAgICBpb2MuZGlzcG9zZSgpO1xyXG4gICAgfSkpO1xyXG4gICAgZnVuY3Rpb24gaW5pdGlhbGl6ZURJKCkge1xyXG4gICAgICAgIGlvYyA9IG5ldyBzZXJ2aWNlUmVnaXN0cnlfMS5Vbml0VGVzdElvY0NvbnRhaW5lcigpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlckNvbW1vblR5cGVzKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyVmFyaWFibGVUeXBlcygpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlclByb2Nlc3NUeXBlcygpO1xyXG4gICAgfVxyXG4gICAgdGVzdCgndmFyaWFibGUgKGFiYzpzdHIpJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgdGVzdCBoYXMgbm90IGJlZW4gd29ya2luZyBmb3IgbWFueSBtb250aHMgaW4gUHl0aG9uIDMuNCBhbmQgMy41IHVuZGVyXHJcbiAgICAgICAgICAgIC8vIFdpbmRvd3MgYW5kIG1hY09TLlRyYWNrZWQgYnkgIzI1NDUuXHJcbiAgICAgICAgICAgIGlmIChjb21tb25fMS5pc09zKHBsYXRmb3JtXzEuT1NUeXBlLldpbmRvd3MsIHBsYXRmb3JtXzEuT1NUeXBlLk9TWCkpIHtcclxuICAgICAgICAgICAgICAgIGlmICh5aWVsZCBjb21tb25fMS5pc1B5dGhvblZlcnNpb24oJzMuNCcsICczLjUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1pbnZhbGlkLXRoaXNcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5za2lwKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgdGV4dERvY3VtZW50ID0geWllbGQgdnNjb2RlLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVQZXA1MjYpO1xyXG4gICAgICAgICAgICB5aWVsZCB2c2NvZGUud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICAgICAgYXNzZXJ0KHZzY29kZS53aW5kb3cuYWN0aXZlVGV4dEVkaXRvciwgJ05vIGFjdGl2ZSBlZGl0b3InKTtcclxuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgdnNjb2RlLlBvc2l0aW9uKDksIDgpO1xyXG4gICAgICAgICAgICBjb25zdCBsaXN0ID0geWllbGQgdnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKCd2c2NvZGUuZXhlY3V0ZUNvbXBsZXRpb25JdGVtUHJvdmlkZXInLCB0ZXh0RG9jdW1lbnQudXJpLCBwb3NpdGlvbik7XHJcbiAgICAgICAgICAgIGFzc2VydC5ub3RFcXVhbChsaXN0Lml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdjYXBpdGFsaXplJykubGVuZ3RoLCAwLCAnY2FwaXRhbGl6ZSBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ3VwcGVyJykubGVuZ3RoLCAwLCAndXBwZXIgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIGFzc2VydC5ub3RFcXVhbChsaXN0Lml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdsb3dlcicpLmxlbmd0aCwgMCwgJ2xvd2VyIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCd2YXJpYWJsZSAoYWJjOiBzdHIgPSBcIlwiKScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIHRlc3QgaGFzIG5vdCBiZWVuIHdvcmtpbmcgZm9yIG1hbnkgbW9udGhzIGluIFB5dGhvbiAzLjQgYW5kIDMuNSB1bmRlclxyXG4gICAgICAgICAgICAvLyBXaW5kb3dzIGFuZCBtYWNPUy5UcmFja2VkIGJ5ICMyNTQ1LlxyXG4gICAgICAgICAgICBpZiAoY29tbW9uXzEuaXNPcyhwbGF0Zm9ybV8xLk9TVHlwZS5XaW5kb3dzLCBwbGF0Zm9ybV8xLk9TVHlwZS5PU1gpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeWllbGQgY29tbW9uXzEuaXNQeXRob25WZXJzaW9uKCczLjQnLCAnMy41JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2tpcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudChmaWxlUGVwNTI2KTtcclxuICAgICAgICAgICAgeWllbGQgdnNjb2RlLndpbmRvdy5zaG93VGV4dERvY3VtZW50KHRleHREb2N1bWVudCk7XHJcbiAgICAgICAgICAgIGFzc2VydCh2c2NvZGUud2luZG93LmFjdGl2ZVRleHRFZGl0b3IsICdObyBhY3RpdmUgZWRpdG9yJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IHZzY29kZS5Qb3NpdGlvbig4LCAxNCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3ZzY29kZS5leGVjdXRlQ29tcGxldGlvbkl0ZW1Qcm92aWRlcicsIHRleHREb2N1bWVudC51cmksIHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ2NhcGl0YWxpemUnKS5sZW5ndGgsIDAsICdjYXBpdGFsaXplIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICBhc3NlcnQubm90RXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAndXBwZXInKS5sZW5ndGgsIDAsICd1cHBlciBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ2xvd2VyJykubGVuZ3RoLCAwLCAnbG93ZXIgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ3ZhcmlhYmxlIChhYmMgPSBVTktOT1dOICMgdHlwZTogc3RyKScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIHRlc3QgaGFzIG5vdCBiZWVuIHdvcmtpbmcgZm9yIG1hbnkgbW9udGhzIGluIFB5dGhvbiAzLjQgYW5kIDMuNSB1bmRlclxyXG4gICAgICAgICAgICAvLyBXaW5kb3dzIGFuZCBtYWNPUy5UcmFja2VkIGJ5ICMyNTQ1LlxyXG4gICAgICAgICAgICBpZiAoY29tbW9uXzEuaXNPcyhwbGF0Zm9ybV8xLk9TVHlwZS5XaW5kb3dzLCBwbGF0Zm9ybV8xLk9TVHlwZS5PU1gpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeWllbGQgY29tbW9uXzEuaXNQeXRob25WZXJzaW9uKCczLjQnLCAnMy41JykpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2tpcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudChmaWxlUGVwNTI2KTtcclxuICAgICAgICAgICAgeWllbGQgdnNjb2RlLndpbmRvdy5zaG93VGV4dERvY3VtZW50KHRleHREb2N1bWVudCk7XHJcbiAgICAgICAgICAgIGFzc2VydCh2c2NvZGUud2luZG93LmFjdGl2ZVRleHRFZGl0b3IsICdObyBhY3RpdmUgZWRpdG9yJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IHZzY29kZS5Qb3NpdGlvbig3LCAxNCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3QgPSB5aWVsZCB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3ZzY29kZS5leGVjdXRlQ29tcGxldGlvbkl0ZW1Qcm92aWRlcicsIHRleHREb2N1bWVudC51cmksIHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ2NhcGl0YWxpemUnKS5sZW5ndGgsIDAsICdjYXBpdGFsaXplIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICBhc3NlcnQubm90RXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAndXBwZXInKS5sZW5ndGgsIDAsICd1cHBlciBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ2xvd2VyJykubGVuZ3RoLCAwLCAnbG93ZXIgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ2NsYXNzIG1ldGhvZHMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgLy8gVGhpcyB0ZXN0IGhhcyBub3QgYmVlbiB3b3JraW5nIGZvciBtYW55IG1vbnRocyBpbiBQeXRob24gMy40IGFuZCAzLjUgdW5kZXJcclxuICAgICAgICAgICAgLy8gV2luZG93cyBhbmQgbWFjT1MuVHJhY2tlZCBieSAjMjU0NS5cclxuICAgICAgICAgICAgaWYgKGNvbW1vbl8xLmlzT3MocGxhdGZvcm1fMS5PU1R5cGUuV2luZG93cywgcGxhdGZvcm1fMS5PU1R5cGUuT1NYKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHlpZWxkIGNvbW1vbl8xLmlzUHl0aG9uVmVyc2lvbignMy40JywgJzMuNScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNraXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB0ZXh0RG9jdW1lbnQgPSB5aWVsZCB2c2NvZGUud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQoZmlsZVBlcDUyNik7XHJcbiAgICAgICAgICAgIHlpZWxkIHZzY29kZS53aW5kb3cuc2hvd1RleHREb2N1bWVudCh0ZXh0RG9jdW1lbnQpO1xyXG4gICAgICAgICAgICBhc3NlcnQodnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yLCAnTm8gYWN0aXZlIGVkaXRvcicpO1xyXG4gICAgICAgICAgICBsZXQgcG9zaXRpb24gPSBuZXcgdnNjb2RlLlBvc2l0aW9uKDIwLCA0KTtcclxuICAgICAgICAgICAgbGV0IGxpc3QgPSB5aWVsZCB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3ZzY29kZS5leGVjdXRlQ29tcGxldGlvbkl0ZW1Qcm92aWRlcicsIHRleHREb2N1bWVudC51cmksIHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ2EnKS5sZW5ndGgsIDAsICdtZXRob2QgYSBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgcG9zaXRpb24gPSBuZXcgdnNjb2RlLlBvc2l0aW9uKDIxLCA0KTtcclxuICAgICAgICAgICAgbGlzdCA9IHlpZWxkIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgndnNjb2RlLmV4ZWN1dGVDb21wbGV0aW9uSXRlbVByb3ZpZGVyJywgdGV4dERvY3VtZW50LnVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgICAgICBhc3NlcnQubm90RXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnYicpLmxlbmd0aCwgMCwgJ21ldGhvZCBiIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdjbGFzcyBtZXRob2QgdHlwZXMnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dERvY3VtZW50ID0geWllbGQgdnNjb2RlLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVQZXA1MjYpO1xyXG4gICAgICAgIHlpZWxkIHZzY29kZS53aW5kb3cuc2hvd1RleHREb2N1bWVudCh0ZXh0RG9jdW1lbnQpO1xyXG4gICAgICAgIGFzc2VydCh2c2NvZGUud2luZG93LmFjdGl2ZVRleHRFZGl0b3IsICdObyBhY3RpdmUgZWRpdG9yJyk7XHJcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgdnNjb2RlLlBvc2l0aW9uKDIxLCA2KTtcclxuICAgICAgICBjb25zdCBsaXN0ID0geWllbGQgdnNjb2RlLmNvbW1hbmRzLmV4ZWN1dGVDb21tYW5kKCd2c2NvZGUuZXhlY3V0ZUNvbXBsZXRpb25JdGVtUHJvdmlkZXInLCB0ZXh0RG9jdW1lbnQudXJpLCBwb3NpdGlvbik7XHJcbiAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGxpc3QuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5sYWJlbCA9PT0gJ2JpdF9sZW5ndGgnKS5sZW5ndGgsIDAsICdiaXRfbGVuZ3RoIG5vdCBmb3VuZCcpO1xyXG4gICAgfSkpO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGVwNTI2LnRlc3QuanMubWFwIl19