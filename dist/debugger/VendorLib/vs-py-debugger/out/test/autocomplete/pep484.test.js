"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const path = require("path");

const vscode = require("vscode");

const common_1 = require("../common");

const constants_1 = require("../constants");

const initialize_1 = require("../initialize");

const serviceRegistry_1 = require("../unittests/serviceRegistry");

const autoCompPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'autocomp');
const filePep484 = path.join(autoCompPath, 'pep484.py');
suite('Autocomplete PEP 484', () => {
  let isPython2;
  let ioc;
  suiteSetup(function () {
    return __awaiter(this, void 0, void 0, function* () {
      // https://github.com/Microsoft/PTVS/issues/3917
      if (constants_1.IsLanguageServerTest()) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
      }

      yield initialize_1.initialize();
      initializeDI();
      isPython2 = (yield ioc.getPythonMajorVersion(common_1.rootWorkspaceUri)) === 2;

      if (isPython2) {
        // tslint:disable-next-line:no-invalid-this
        this.skip();
        return;
      }
    });
  });
  setup(initialize_1.initializeTest);
  suiteTeardown(initialize_1.closeActiveWindows);
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.closeActiveWindows();
    ioc.dispose();
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerVariableTypes();
    ioc.registerProcessTypes();
  }

  test('argument', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode.workspace.openTextDocument(filePep484);
    yield vscode.window.showTextDocument(textDocument);
    assert(vscode.window.activeTextEditor, 'No active editor');
    const position = new vscode.Position(2, 27);
    const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
    assert.notEqual(list.items.filter(item => item.label === 'capitalize').length, 0, 'capitalize not found');
    assert.notEqual(list.items.filter(item => item.label === 'upper').length, 0, 'upper not found');
    assert.notEqual(list.items.filter(item => item.label === 'lower').length, 0, 'lower not found');
  }));
  test('return value', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode.workspace.openTextDocument(filePep484);
    yield vscode.window.showTextDocument(textDocument);
    assert(vscode.window.activeTextEditor, 'No active editor');
    const position = new vscode.Position(8, 6);
    const list = yield vscode.commands.executeCommand('vscode.executeCompletionItemProvider', textDocument.uri, position);
    assert.notEqual(list.items.filter(item => item.label === 'bit_length').length, 0, 'bit_length not found');
    assert.notEqual(list.items.filter(item => item.label === 'from_bytes').length, 0, 'from_bytes not found');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBlcDQ4NC50ZXN0LmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJhc3NlcnQiLCJyZXF1aXJlIiwicGF0aCIsInZzY29kZSIsImNvbW1vbl8xIiwiY29uc3RhbnRzXzEiLCJpbml0aWFsaXplXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsImF1dG9Db21wUGF0aCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJmaWxlUGVwNDg0Iiwic3VpdGUiLCJpc1B5dGhvbjIiLCJpb2MiLCJzdWl0ZVNldHVwIiwiSXNMYW5ndWFnZVNlcnZlclRlc3QiLCJza2lwIiwiaW5pdGlhbGl6ZSIsImluaXRpYWxpemVESSIsImdldFB5dGhvbk1ham9yVmVyc2lvbiIsInJvb3RXb3Jrc3BhY2VVcmkiLCJzZXR1cCIsImluaXRpYWxpemVUZXN0Iiwic3VpdGVUZWFyZG93biIsImNsb3NlQWN0aXZlV2luZG93cyIsInRlYXJkb3duIiwiZGlzcG9zZSIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwicmVnaXN0ZXJDb21tb25UeXBlcyIsInJlZ2lzdGVyVmFyaWFibGVUeXBlcyIsInJlZ2lzdGVyUHJvY2Vzc1R5cGVzIiwidGVzdCIsInRleHREb2N1bWVudCIsIndvcmtzcGFjZSIsIm9wZW5UZXh0RG9jdW1lbnQiLCJ3aW5kb3ciLCJzaG93VGV4dERvY3VtZW50IiwiYWN0aXZlVGV4dEVkaXRvciIsInBvc2l0aW9uIiwiUG9zaXRpb24iLCJsaXN0IiwiY29tbWFuZHMiLCJleGVjdXRlQ29tbWFuZCIsInVyaSIsIm5vdEVxdWFsIiwiaXRlbXMiLCJmaWx0ZXIiLCJpdGVt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LENBQTNCO0FBQ0EsVUFBTVIsTUFBTSxDQUFDaUMsTUFBUCxDQUFjQyxnQkFBZCxDQUErQkosWUFBL0IsQ0FBTjtBQUNBakMsSUFBQUEsTUFBTSxDQUFDRyxNQUFNLENBQUNpQyxNQUFQLENBQWNFLGdCQUFmLEVBQWlDLGtCQUFqQyxDQUFOO0FBQ0EsVUFBTUMsUUFBUSxHQUFHLElBQUlwQyxNQUFNLENBQUNxQyxRQUFYLENBQW9CLENBQXBCLEVBQXVCLENBQXZCLENBQWpCO0FBQ0EsVUFBTUMsSUFBSSxHQUFHLE1BQU10QyxNQUFNLENBQUN1QyxRQUFQLENBQWdCQyxjQUFoQixDQUErQixzQ0FBL0IsRUFBdUVWLFlBQVksQ0FBQ1csR0FBcEYsRUFBeUZMLFFBQXpGLENBQW5CO0FBQ0F2QyxJQUFBQSxNQUFNLENBQUM2QyxRQUFQLENBQWdCSixJQUFJLENBQUNLLEtBQUwsQ0FBV0MsTUFBWCxDQUFrQkMsSUFBSSxJQUFJQSxJQUFJLENBQUNDLEtBQUwsS0FBZSxZQUF6QyxFQUF1REMsTUFBdkUsRUFBK0UsQ0FBL0UsRUFBa0Ysc0JBQWxGO0FBQ0FsRCxJQUFBQSxNQUFNLENBQUM2QyxRQUFQLENBQWdCSixJQUFJLENBQUNLLEtBQUwsQ0FBV0MsTUFBWCxDQUFrQkMsSUFBSSxJQUFJQSxJQUFJLENBQUNDLEtBQUwsS0FBZSxZQUF6QyxFQUF1REMsTUFBdkUsRUFBK0UsQ0FBL0UsRUFBa0Ysc0JBQWxGO0FBQ0gsR0FSbUMsQ0FBaEMsQ0FBSjtBQVNILENBbkRJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCBhc3NlcnQgPSByZXF1aXJlKFwiYXNzZXJ0XCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IGNvbW1vbl8xID0gcmVxdWlyZShcIi4uL2NvbW1vblwiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi4vY29uc3RhbnRzXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi4vdW5pdHRlc3RzL3NlcnZpY2VSZWdpc3RyeVwiKTtcclxuY29uc3QgYXV0b0NvbXBQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJy4uJywgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ2F1dG9jb21wJyk7XHJcbmNvbnN0IGZpbGVQZXA0ODQgPSBwYXRoLmpvaW4oYXV0b0NvbXBQYXRoLCAncGVwNDg0LnB5Jyk7XHJcbnN1aXRlKCdBdXRvY29tcGxldGUgUEVQIDQ4NCcsICgpID0+IHtcclxuICAgIGxldCBpc1B5dGhvbjI7XHJcbiAgICBsZXQgaW9jO1xyXG4gICAgc3VpdGVTZXR1cChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9QVFZTL2lzc3Vlcy8zOTE3XHJcbiAgICAgICAgICAgIGlmIChjb25zdGFudHNfMS5Jc0xhbmd1YWdlU2VydmVyVGVzdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNraXAoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB5aWVsZCBpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICBpbml0aWFsaXplREkoKTtcclxuICAgICAgICAgICAgaXNQeXRob24yID0gKHlpZWxkIGlvYy5nZXRQeXRob25NYWpvclZlcnNpb24oY29tbW9uXzEucm9vdFdvcmtzcGFjZVVyaSkpID09PSAyO1xyXG4gICAgICAgICAgICBpZiAoaXNQeXRob24yKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10aGlzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNraXAoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBzZXR1cChpbml0aWFsaXplXzEuaW5pdGlhbGl6ZVRlc3QpO1xyXG4gICAgc3VpdGVUZWFyZG93bihpbml0aWFsaXplXzEuY2xvc2VBY3RpdmVXaW5kb3dzKTtcclxuICAgIHRlYXJkb3duKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBpbml0aWFsaXplXzEuY2xvc2VBY3RpdmVXaW5kb3dzKCk7XHJcbiAgICAgICAgaW9jLmRpc3Bvc2UoKTtcclxuICAgIH0pKTtcclxuICAgIGZ1bmN0aW9uIGluaXRpYWxpemVESSgpIHtcclxuICAgICAgICBpb2MgPSBuZXcgc2VydmljZVJlZ2lzdHJ5XzEuVW5pdFRlc3RJb2NDb250YWluZXIoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJDb21tb25UeXBlcygpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlclZhcmlhYmxlVHlwZXMoKTtcclxuICAgICAgICBpb2MucmVnaXN0ZXJQcm9jZXNzVHlwZXMoKTtcclxuICAgIH1cclxuICAgIHRlc3QoJ2FyZ3VtZW50JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudChmaWxlUGVwNDg0KTtcclxuICAgICAgICB5aWVsZCB2c2NvZGUud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICBhc3NlcnQodnNjb2RlLndpbmRvdy5hY3RpdmVUZXh0RWRpdG9yLCAnTm8gYWN0aXZlIGVkaXRvcicpO1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IHZzY29kZS5Qb3NpdGlvbigyLCAyNyk7XHJcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgndnNjb2RlLmV4ZWN1dGVDb21wbGV0aW9uSXRlbVByb3ZpZGVyJywgdGV4dERvY3VtZW50LnVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgIGFzc2VydC5ub3RFcXVhbChsaXN0Lml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdjYXBpdGFsaXplJykubGVuZ3RoLCAwLCAnY2FwaXRhbGl6ZSBub3QgZm91bmQnKTtcclxuICAgICAgICBhc3NlcnQubm90RXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAndXBwZXInKS5sZW5ndGgsIDAsICd1cHBlciBub3QgZm91bmQnKTtcclxuICAgICAgICBhc3NlcnQubm90RXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnbG93ZXInKS5sZW5ndGgsIDAsICdsb3dlciBub3QgZm91bmQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ3JldHVybiB2YWx1ZScsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCB0ZXh0RG9jdW1lbnQgPSB5aWVsZCB2c2NvZGUud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQoZmlsZVBlcDQ4NCk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlLndpbmRvdy5zaG93VGV4dERvY3VtZW50KHRleHREb2N1bWVudCk7XHJcbiAgICAgICAgYXNzZXJ0KHZzY29kZS53aW5kb3cuYWN0aXZlVGV4dEVkaXRvciwgJ05vIGFjdGl2ZSBlZGl0b3InKTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5ldyB2c2NvZGUuUG9zaXRpb24oOCwgNik7XHJcbiAgICAgICAgY29uc3QgbGlzdCA9IHlpZWxkIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgndnNjb2RlLmV4ZWN1dGVDb21wbGV0aW9uSXRlbVByb3ZpZGVyJywgdGV4dERvY3VtZW50LnVyaSwgcG9zaXRpb24pO1xyXG4gICAgICAgIGFzc2VydC5ub3RFcXVhbChsaXN0Lml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0ubGFiZWwgPT09ICdiaXRfbGVuZ3RoJykubGVuZ3RoLCAwLCAnYml0X2xlbmd0aCBub3QgZm91bmQnKTtcclxuICAgICAgICBhc3NlcnQubm90RXF1YWwobGlzdC5pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmxhYmVsID09PSAnZnJvbV9ieXRlcycpLmxlbmd0aCwgMCwgJ2Zyb21fYnl0ZXMgbm90IGZvdW5kJyk7XHJcbiAgICB9KSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wZXA0ODQudGVzdC5qcy5tYXAiXX0=