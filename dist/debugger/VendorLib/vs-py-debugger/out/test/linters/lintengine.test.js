// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../client/common/application/types");

const constants_1 = require("../../client/common/constants");

require("../../client/common/extensions");

const types_2 = require("../../client/common/platform/types");

const types_3 = require("../../client/common/types");

const lintingEngine_1 = require("../../client/linters/lintingEngine");

const types_4 = require("../../client/linters/types");

const initialize_1 = require("../initialize"); // tslint:disable-next-line:max-func-body-length


suite('Linting - LintingEngine', () => {
  let serviceContainer;
  let lintManager;
  let settings;
  let lintSettings;
  let fileSystem;
  let lintingEngine;
  suiteSetup(initialize_1.initialize);
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    serviceContainer = TypeMoq.Mock.ofType();
    const docManager = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IDocumentManager), TypeMoq.It.isAny())).returns(() => docManager.object);
    const workspaceService = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_1.IWorkspaceService), TypeMoq.It.isAny())).returns(() => workspaceService.object);
    fileSystem = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_2.IFileSystem), TypeMoq.It.isAny())).returns(() => fileSystem.object);
    lintSettings = TypeMoq.Mock.ofType();
    settings = TypeMoq.Mock.ofType();
    const configService = TypeMoq.Mock.ofType();
    configService.setup(x => x.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
    configService.setup(x => x.isTestExecution()).returns(() => true);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IConfigurationService), TypeMoq.It.isAny())).returns(() => configService.object);
    const outputChannel = TypeMoq.Mock.ofType();
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_3.IOutputChannel), TypeMoq.It.isValue(constants_1.STANDARD_OUTPUT_CHANNEL))).returns(() => outputChannel.object);
    lintManager = TypeMoq.Mock.ofType();
    lintManager.setup(x => x.isLintingEnabled(TypeMoq.It.isAny())).returns(() => __awaiter(this, void 0, void 0, function* () {
      return true;
    }));
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.ILinterManager), TypeMoq.It.isAny())).returns(() => lintManager.object);
    lintingEngine = new lintingEngine_1.LintingEngine(serviceContainer.object);
    serviceContainer.setup(c => c.get(TypeMoq.It.isValue(types_4.ILintingEngine), TypeMoq.It.isAny())).returns(() => lintingEngine);
  }));
  test('Ensure document.uri is passed into isLintingEnabled', () => {
    const doc = mockTextDocument('a.py', constants_1.PYTHON_LANGUAGE, true);

    try {
      lintingEngine.lintDocument(doc, 'auto').ignoreErrors();
    } catch (_a) {
      lintManager.verify(l => l.isLintingEnabled(TypeMoq.It.isAny(), TypeMoq.It.isValue(doc.uri)), TypeMoq.Times.once());
    }
  });
  test('Ensure document.uri is passed into createLinter', () => {
    const doc = mockTextDocument('a.py', constants_1.PYTHON_LANGUAGE, true);

    try {
      lintingEngine.lintDocument(doc, 'auto').ignoreErrors();
    } catch (_a) {
      lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isValue(doc.uri)), TypeMoq.Times.atLeastOnce());
    }
  });
  test('Verify files that match ignore pattern are not linted', () => __awaiter(void 0, void 0, void 0, function* () {
    const doc = mockTextDocument('a1.py', constants_1.PYTHON_LANGUAGE, true, ['a*.py']);
    yield lintingEngine.lintDocument(doc, 'auto');
    lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
  }));
  test('Ensure non-Python files are not linted', () => __awaiter(void 0, void 0, void 0, function* () {
    const doc = mockTextDocument('a.ts', 'typescript', true);
    yield lintingEngine.lintDocument(doc, 'auto');
    lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
  }));
  test('Ensure files with git scheme are not linted', () => __awaiter(void 0, void 0, void 0, function* () {
    const doc = mockTextDocument('a1.py', constants_1.PYTHON_LANGUAGE, false, [], 'git');
    yield lintingEngine.lintDocument(doc, 'auto');
    lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
  }));
  test('Ensure files with showModifications scheme are not linted', () => __awaiter(void 0, void 0, void 0, function* () {
    const doc = mockTextDocument('a1.py', constants_1.PYTHON_LANGUAGE, false, [], 'showModifications');
    yield lintingEngine.lintDocument(doc, 'auto');
    lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
  }));
  test('Ensure files with svn scheme are not linted', () => __awaiter(void 0, void 0, void 0, function* () {
    const doc = mockTextDocument('a1.py', constants_1.PYTHON_LANGUAGE, false, [], 'svn');
    yield lintingEngine.lintDocument(doc, 'auto');
    lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
  }));
  test('Ensure non-existing files are not linted', () => __awaiter(void 0, void 0, void 0, function* () {
    const doc = mockTextDocument('file.py', constants_1.PYTHON_LANGUAGE, false, []);
    yield lintingEngine.lintDocument(doc, 'auto');
    lintManager.verify(l => l.createLinter(TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny(), TypeMoq.It.isAny()), TypeMoq.Times.never());
  }));

  function mockTextDocument(fileName, language, exists, ignorePattern = [], scheme) {
    fileSystem.setup(x => x.fileExists(TypeMoq.It.isAnyString())).returns(() => Promise.resolve(exists));
    lintSettings.setup(l => l.ignorePatterns).returns(() => ignorePattern);
    settings.setup(x => x.linting).returns(() => lintSettings.object);
    const doc = TypeMoq.Mock.ofType();

    if (scheme) {
      doc.setup(d => d.uri).returns(() => vscode_1.Uri.parse(`${scheme}:${fileName}`));
    } else {
      doc.setup(d => d.uri).returns(() => vscode_1.Uri.file(fileName));
    }

    doc.setup(d => d.fileName).returns(() => fileName);
    doc.setup(d => d.languageId).returns(() => language);
    return doc.object;
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpbnRlbmdpbmUudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiVHlwZU1vcSIsInJlcXVpcmUiLCJ2c2NvZGVfMSIsInR5cGVzXzEiLCJjb25zdGFudHNfMSIsInR5cGVzXzIiLCJ0eXBlc18zIiwibGludGluZ0VuZ2luZV8xIiwidHlwZXNfNCIsImluaXRpYWxpemVfMSIsInN1aXRlIiwic2VydmljZUNvbnRhaW5lciIsImxpbnRNYW5hZ2VyIiwic2V0dGluZ3MiLCJsaW50U2V0dGluZ3MiLCJmaWxlU3lzdGVtIiwibGludGluZ0VuZ2luZSIsInN1aXRlU2V0dXAiLCJpbml0aWFsaXplIiwic2V0dXAiLCJNb2NrIiwib2ZUeXBlIiwiZG9jTWFuYWdlciIsImMiLCJnZXQiLCJJdCIsImlzVmFsdWUiLCJJRG9jdW1lbnRNYW5hZ2VyIiwiaXNBbnkiLCJyZXR1cm5zIiwib2JqZWN0Iiwid29ya3NwYWNlU2VydmljZSIsIklXb3Jrc3BhY2VTZXJ2aWNlIiwiSUZpbGVTeXN0ZW0iLCJjb25maWdTZXJ2aWNlIiwieCIsImdldFNldHRpbmdzIiwiaXNUZXN0RXhlY3V0aW9uIiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwib3V0cHV0Q2hhbm5lbCIsIklPdXRwdXRDaGFubmVsIiwiU1RBTkRBUkRfT1VUUFVUX0NIQU5ORUwiLCJpc0xpbnRpbmdFbmFibGVkIiwiSUxpbnRlck1hbmFnZXIiLCJMaW50aW5nRW5naW5lIiwiSUxpbnRpbmdFbmdpbmUiLCJ0ZXN0IiwiZG9jIiwibW9ja1RleHREb2N1bWVudCIsIlBZVEhPTl9MQU5HVUFHRSIsImxpbnREb2N1bWVudCIsImlnbm9yZUVycm9ycyIsIl9hIiwidmVyaWZ5IiwibCIsInVyaSIsIlRpbWVzIiwib25jZSIsImNyZWF0ZUxpbnRlciIsImF0TGVhc3RPbmNlIiwibmV2ZXIiLCJmaWxlTmFtZSIsImxhbmd1YWdlIiwiZXhpc3RzIiwiaWdub3JlUGF0dGVybiIsInNjaGVtZSIsImZpbGVFeGlzdHMiLCJpc0FueVN0cmluZyIsImlnbm9yZVBhdHRlcm5zIiwibGludGluZyIsImQiLCJVcmkiLCJwYXJzZSIsImZpbGUiLCJsYW5ndWFnZUlkIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENB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QzVCLEtBQUosQ0FBVW1ELENBQUMsSUFBSUEsQ0FBQyxDQUFDVCxRQUFqQixFQUEyQmhDLE9BQTNCLENBQW1DLE1BQU1nQyxRQUF6QztBQUNBZCxJQUFBQSxHQUFHLENBQUM1QixLQUFKLENBQVVtRCxDQUFDLElBQUlBLENBQUMsQ0FBQ0ksVUFBakIsRUFBNkI3QyxPQUE3QixDQUFxQyxNQUFNaUMsUUFBM0M7QUFDQSxXQUFPZixHQUFHLENBQUNqQixNQUFYO0FBQ0g7QUFDSixDQTdGSSxDQUFMIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5yZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9leHRlbnNpb25zXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XHJcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi90eXBlc1wiKTtcclxuY29uc3QgbGludGluZ0VuZ2luZV8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9saW50ZXJzL2xpbnRpbmdFbmdpbmVcIik7XHJcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2xpbnRlcnMvdHlwZXNcIik7XHJcbmNvbnN0IGluaXRpYWxpemVfMSA9IHJlcXVpcmUoXCIuLi9pbml0aWFsaXplXCIpO1xyXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWZ1bmMtYm9keS1sZW5ndGhcclxuc3VpdGUoJ0xpbnRpbmcgLSBMaW50aW5nRW5naW5lJywgKCkgPT4ge1xyXG4gICAgbGV0IHNlcnZpY2VDb250YWluZXI7XHJcbiAgICBsZXQgbGludE1hbmFnZXI7XHJcbiAgICBsZXQgc2V0dGluZ3M7XHJcbiAgICBsZXQgbGludFNldHRpbmdzO1xyXG4gICAgbGV0IGZpbGVTeXN0ZW07XHJcbiAgICBsZXQgbGludGluZ0VuZ2luZTtcclxuICAgIHN1aXRlU2V0dXAoaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUpO1xyXG4gICAgc2V0dXAoKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3QgZG9jTWFuYWdlciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzEuSURvY3VtZW50TWFuYWdlciksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gZG9jTWFuYWdlci5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IHdvcmtzcGFjZVNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlKSwgVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiB3b3Jrc3BhY2VTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgZmlsZVN5c3RlbSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzIuSUZpbGVTeXN0ZW0pLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IGZpbGVTeXN0ZW0ub2JqZWN0KTtcclxuICAgICAgICBsaW50U2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25maWdTZXJ2aWNlLnNldHVwKHggPT4geC5nZXRTZXR0aW5ncyhUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHNldHRpbmdzLm9iamVjdCk7XHJcbiAgICAgICAgY29uZmlnU2VydmljZS5zZXR1cCh4ID0+IHguaXNUZXN0RXhlY3V0aW9uKCkpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18zLklDb25maWd1cmF0aW9uU2VydmljZSksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gY29uZmlnU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IG91dHB1dENoYW5uZWwgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lci5zZXR1cChjID0+IGMuZ2V0KFR5cGVNb3EuSXQuaXNWYWx1ZSh0eXBlc18zLklPdXRwdXRDaGFubmVsKSwgVHlwZU1vcS5JdC5pc1ZhbHVlKGNvbnN0YW50c18xLlNUQU5EQVJEX09VVFBVVF9DSEFOTkVMKSkpLnJldHVybnMoKCkgPT4gb3V0cHV0Q2hhbm5lbC5vYmplY3QpO1xyXG4gICAgICAgIGxpbnRNYW5hZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGxpbnRNYW5hZ2VyLnNldHVwKHggPT4geC5pc0xpbnRpbmdFbmFibGVkKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgeyByZXR1cm4gdHJ1ZTsgfSkpO1xyXG4gICAgICAgIHNlcnZpY2VDb250YWluZXIuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzVmFsdWUodHlwZXNfNC5JTGludGVyTWFuYWdlciksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gbGludE1hbmFnZXIub2JqZWN0KTtcclxuICAgICAgICBsaW50aW5nRW5naW5lID0gbmV3IGxpbnRpbmdFbmdpbmVfMS5MaW50aW5nRW5naW5lKHNlcnZpY2VDb250YWluZXIub2JqZWN0KTtcclxuICAgICAgICBzZXJ2aWNlQ29udGFpbmVyLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc1ZhbHVlKHR5cGVzXzQuSUxpbnRpbmdFbmdpbmUpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IGxpbnRpbmdFbmdpbmUpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIGRvY3VtZW50LnVyaSBpcyBwYXNzZWQgaW50byBpc0xpbnRpbmdFbmFibGVkJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IG1vY2tUZXh0RG9jdW1lbnQoJ2EucHknLCBjb25zdGFudHNfMS5QWVRIT05fTEFOR1VBR0UsIHRydWUpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGxpbnRpbmdFbmdpbmUubGludERvY3VtZW50KGRvYywgJ2F1dG8nKS5pZ25vcmVFcnJvcnMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIGxpbnRNYW5hZ2VyLnZlcmlmeShsID0+IGwuaXNMaW50aW5nRW5hYmxlZChUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZShkb2MudXJpKSksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBkb2N1bWVudC51cmkgaXMgcGFzc2VkIGludG8gY3JlYXRlTGludGVyJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IG1vY2tUZXh0RG9jdW1lbnQoJ2EucHknLCBjb25zdGFudHNfMS5QWVRIT05fTEFOR1VBR0UsIHRydWUpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGxpbnRpbmdFbmdpbmUubGludERvY3VtZW50KGRvYywgJ2F1dG8nKS5pZ25vcmVFcnJvcnMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIGxpbnRNYW5hZ2VyLnZlcmlmeShsID0+IGwuY3JlYXRlTGludGVyKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNWYWx1ZShkb2MudXJpKSksIFR5cGVNb3EuVGltZXMuYXRMZWFzdE9uY2UoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdWZXJpZnkgZmlsZXMgdGhhdCBtYXRjaCBpZ25vcmUgcGF0dGVybiBhcmUgbm90IGxpbnRlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBkb2MgPSBtb2NrVGV4dERvY3VtZW50KCdhMS5weScsIGNvbnN0YW50c18xLlBZVEhPTl9MQU5HVUFHRSwgdHJ1ZSwgWydhKi5weSddKTtcclxuICAgICAgICB5aWVsZCBsaW50aW5nRW5naW5lLmxpbnREb2N1bWVudChkb2MsICdhdXRvJyk7XHJcbiAgICAgICAgbGludE1hbmFnZXIudmVyaWZ5KGwgPT4gbC5jcmVhdGVMaW50ZXIoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBub24tUHl0aG9uIGZpbGVzIGFyZSBub3QgbGludGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IG1vY2tUZXh0RG9jdW1lbnQoJ2EudHMnLCAndHlwZXNjcmlwdCcsIHRydWUpO1xyXG4gICAgICAgIHlpZWxkIGxpbnRpbmdFbmdpbmUubGludERvY3VtZW50KGRvYywgJ2F1dG8nKTtcclxuICAgICAgICBsaW50TWFuYWdlci52ZXJpZnkobCA9PiBsLmNyZWF0ZUxpbnRlcihUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpLCBUeXBlTW9xLlRpbWVzLm5ldmVyKCkpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIGZpbGVzIHdpdGggZ2l0IHNjaGVtZSBhcmUgbm90IGxpbnRlZCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBkb2MgPSBtb2NrVGV4dERvY3VtZW50KCdhMS5weScsIGNvbnN0YW50c18xLlBZVEhPTl9MQU5HVUFHRSwgZmFsc2UsIFtdLCAnZ2l0Jyk7XHJcbiAgICAgICAgeWllbGQgbGludGluZ0VuZ2luZS5saW50RG9jdW1lbnQoZG9jLCAnYXV0bycpO1xyXG4gICAgICAgIGxpbnRNYW5hZ2VyLnZlcmlmeShsID0+IGwuY3JlYXRlTGludGVyKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSksIFR5cGVNb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdFbnN1cmUgZmlsZXMgd2l0aCBzaG93TW9kaWZpY2F0aW9ucyBzY2hlbWUgYXJlIG5vdCBsaW50ZWQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZG9jID0gbW9ja1RleHREb2N1bWVudCgnYTEucHknLCBjb25zdGFudHNfMS5QWVRIT05fTEFOR1VBR0UsIGZhbHNlLCBbXSwgJ3Nob3dNb2RpZmljYXRpb25zJyk7XHJcbiAgICAgICAgeWllbGQgbGludGluZ0VuZ2luZS5saW50RG9jdW1lbnQoZG9jLCAnYXV0bycpO1xyXG4gICAgICAgIGxpbnRNYW5hZ2VyLnZlcmlmeShsID0+IGwuY3JlYXRlTGludGVyKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSksIFR5cGVNb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdFbnN1cmUgZmlsZXMgd2l0aCBzdm4gc2NoZW1lIGFyZSBub3QgbGludGVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IG1vY2tUZXh0RG9jdW1lbnQoJ2ExLnB5JywgY29uc3RhbnRzXzEuUFlUSE9OX0xBTkdVQUdFLCBmYWxzZSwgW10sICdzdm4nKTtcclxuICAgICAgICB5aWVsZCBsaW50aW5nRW5naW5lLmxpbnREb2N1bWVudChkb2MsICdhdXRvJyk7XHJcbiAgICAgICAgbGludE1hbmFnZXIudmVyaWZ5KGwgPT4gbC5jcmVhdGVMaW50ZXIoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBub24tZXhpc3RpbmcgZmlsZXMgYXJlIG5vdCBsaW50ZWQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgZG9jID0gbW9ja1RleHREb2N1bWVudCgnZmlsZS5weScsIGNvbnN0YW50c18xLlBZVEhPTl9MQU5HVUFHRSwgZmFsc2UsIFtdKTtcclxuICAgICAgICB5aWVsZCBsaW50aW5nRW5naW5lLmxpbnREb2N1bWVudChkb2MsICdhdXRvJyk7XHJcbiAgICAgICAgbGludE1hbmFnZXIudmVyaWZ5KGwgPT4gbC5jcmVhdGVMaW50ZXIoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSwgVHlwZU1vcS5UaW1lcy5uZXZlcigpKTtcclxuICAgIH0pKTtcclxuICAgIGZ1bmN0aW9uIG1vY2tUZXh0RG9jdW1lbnQoZmlsZU5hbWUsIGxhbmd1YWdlLCBleGlzdHMsIGlnbm9yZVBhdHRlcm4gPSBbXSwgc2NoZW1lKSB7XHJcbiAgICAgICAgZmlsZVN5c3RlbS5zZXR1cCh4ID0+IHguZmlsZUV4aXN0cyhUeXBlTW9xLkl0LmlzQW55U3RyaW5nKCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShleGlzdHMpKTtcclxuICAgICAgICBsaW50U2V0dGluZ3Muc2V0dXAobCA9PiBsLmlnbm9yZVBhdHRlcm5zKS5yZXR1cm5zKCgpID0+IGlnbm9yZVBhdHRlcm4pO1xyXG4gICAgICAgIHNldHRpbmdzLnNldHVwKHggPT4geC5saW50aW5nKS5yZXR1cm5zKCgpID0+IGxpbnRTZXR0aW5ncy5vYmplY3QpO1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBpZiAoc2NoZW1lKSB7XHJcbiAgICAgICAgICAgIGRvYy5zZXR1cChkID0+IGQudXJpKS5yZXR1cm5zKCgpID0+IHZzY29kZV8xLlVyaS5wYXJzZShgJHtzY2hlbWV9OiR7ZmlsZU5hbWV9YCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZG9jLnNldHVwKGQgPT4gZC51cmkpLnJldHVybnMoKCkgPT4gdnNjb2RlXzEuVXJpLmZpbGUoZmlsZU5hbWUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZG9jLnNldHVwKGQgPT4gZC5maWxlTmFtZSkucmV0dXJucygoKSA9PiBmaWxlTmFtZSk7XHJcbiAgICAgICAgZG9jLnNldHVwKGQgPT4gZC5sYW5ndWFnZUlkKS5yZXR1cm5zKCgpID0+IGxhbmd1YWdlKTtcclxuICAgICAgICByZXR1cm4gZG9jLm9iamVjdDtcclxuICAgIH1cclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpbnRlbmdpbmUudGVzdC5qcy5tYXAiXX0=