// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const TypeMoq = require("typemoq");

const vscode = require("vscode");

const types_1 = require("../../client/common/application/types");

const types_2 = require("../../client/common/platform/types");

const types_3 = require("../../client/common/types");

const async_1 = require("../../client/common/utils/async");

const contracts_1 = require("../../client/interpreter/contracts");

const container_1 = require("../../client/ioc/container");

const serviceManager_1 = require("../../client/ioc/serviceManager");

const linterAvailability_1 = require("../../client/linters/linterAvailability");

const linterManager_1 = require("../../client/linters/linterManager");

const types_4 = require("../../client/linters/types");

const linterProvider_1 = require("../../client/providers/linterProvider");

const initialize_1 = require("../initialize"); // tslint:disable-next-line:max-func-body-length


suite('Linting - Provider', () => {
  let context;
  let interpreterService;
  let engine;
  let configService;
  let docManager;
  let settings;
  let lm;
  let serviceContainer;
  let emitter;
  let document;
  let fs;
  let appShell;
  let linterInstaller;
  let workspaceService;
  suiteSetup(initialize_1.initialize);
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    const cont = new inversify_1.Container();
    const serviceManager = new serviceManager_1.ServiceManager(cont);
    serviceContainer = new container_1.ServiceContainer(cont);
    context = TypeMoq.Mock.ofType();
    fs = TypeMoq.Mock.ofType();
    fs.setup(x => x.fileExists(TypeMoq.It.isAny())).returns(() => new Promise((resolve, reject) => resolve(true)));
    fs.setup(x => x.arePathsSame(TypeMoq.It.isAnyString(), TypeMoq.It.isAnyString())).returns(() => true);
    serviceManager.addSingletonInstance(types_2.IFileSystem, fs.object);
    interpreterService = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(contracts_1.IInterpreterService, interpreterService.object);
    engine = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(types_4.ILintingEngine, engine.object);
    docManager = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(types_1.IDocumentManager, docManager.object);
    const lintSettings = TypeMoq.Mock.ofType();
    lintSettings.setup(x => x.enabled).returns(() => true);
    lintSettings.setup(x => x.lintOnSave).returns(() => true);
    settings = TypeMoq.Mock.ofType();
    settings.setup(x => x.linting).returns(() => lintSettings.object);
    configService = TypeMoq.Mock.ofType();
    configService.setup(x => x.getSettings(TypeMoq.It.isAny())).returns(() => settings.object);
    serviceManager.addSingletonInstance(types_3.IConfigurationService, configService.object);
    appShell = TypeMoq.Mock.ofType();
    linterInstaller = TypeMoq.Mock.ofType();
    workspaceService = TypeMoq.Mock.ofType();
    serviceManager.addSingletonInstance(types_1.IApplicationShell, appShell.object);
    serviceManager.addSingletonInstance(types_3.IInstaller, linterInstaller.object);
    serviceManager.addSingletonInstance(types_1.IWorkspaceService, workspaceService.object);
    serviceManager.add(types_4.IAvailableLinterActivator, linterAvailability_1.AvailableLinterActivator);
    lm = new linterManager_1.LinterManager(serviceContainer, workspaceService.object);
    serviceManager.addSingletonInstance(types_4.ILinterManager, lm);
    emitter = new vscode.EventEmitter();
    document = TypeMoq.Mock.ofType();
  }));
  test('Lint on open file', () => {
    docManager.setup(x => x.onDidOpenTextDocument).returns(() => emitter.event);
    document.setup(x => x.uri).returns(() => vscode.Uri.file('test.py'));
    document.setup(x => x.languageId).returns(() => 'python'); // tslint:disable-next-line:no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    emitter.fire(document.object);
    engine.verify(x => x.lintDocument(document.object, 'auto'), TypeMoq.Times.once());
  });
  test('Lint on save file', () => __awaiter(void 0, void 0, void 0, function* () {
    docManager.setup(x => x.onDidSaveTextDocument).returns(() => emitter.event);
    document.setup(x => x.uri).returns(() => vscode.Uri.file('test.py'));
    document.setup(x => x.languageId).returns(() => 'python'); // tslint:disable-next-line:no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    emitter.fire(document.object);
    engine.verify(x => x.lintDocument(document.object, 'save'), TypeMoq.Times.once());
  }));
  test('No lint on open other files', () => {
    docManager.setup(x => x.onDidOpenTextDocument).returns(() => emitter.event);
    document.setup(x => x.uri).returns(() => vscode.Uri.file('test.cs'));
    document.setup(x => x.languageId).returns(() => 'csharp'); // tslint:disable-next-line:no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    emitter.fire(document.object);
    engine.verify(x => x.lintDocument(document.object, 'save'), TypeMoq.Times.never());
  });
  test('No lint on save other files', () => {
    docManager.setup(x => x.onDidSaveTextDocument).returns(() => emitter.event);
    document.setup(x => x.uri).returns(() => vscode.Uri.file('test.cs'));
    document.setup(x => x.languageId).returns(() => 'csharp'); // tslint:disable-next-line:no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    emitter.fire(document.object);
    engine.verify(x => x.lintDocument(document.object, 'save'), TypeMoq.Times.never());
  });
  test('Lint on change interpreters', () => {
    const e = new vscode.EventEmitter();
    interpreterService.setup(x => x.onDidChangeInterpreter).returns(() => e.event); // tslint:disable-next-line:no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    e.fire();
    engine.verify(x => x.lintOpenPythonFiles(), TypeMoq.Times.once());
  });
  test('Lint on save pylintrc', () => __awaiter(void 0, void 0, void 0, function* () {
    docManager.setup(x => x.onDidSaveTextDocument).returns(() => emitter.event);
    document.setup(x => x.uri).returns(() => vscode.Uri.file('.pylintrc'));
    yield lm.setActiveLintersAsync([types_3.Product.pylint]); // tslint:disable-next-line:no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    emitter.fire(document.object);
    const deferred = async_1.createDeferred();
    setTimeout(() => deferred.resolve(), 2000);
    yield deferred.promise;
    engine.verify(x => x.lintOpenPythonFiles(), TypeMoq.Times.once());
  }));
  test('Diagnostic cleared on file close', () => testClearDiagnosticsOnClose(true));
  test('Diagnostic not cleared on file opened in another tab', () => testClearDiagnosticsOnClose(false));

  function testClearDiagnosticsOnClose(closed) {
    docManager.setup(x => x.onDidCloseTextDocument).returns(() => emitter.event);
    const uri = vscode.Uri.file('test.py');
    document.setup(x => x.uri).returns(() => uri);
    document.setup(x => x.isClosed).returns(() => closed);
    docManager.setup(x => x.textDocuments).returns(() => closed ? [] : [document.object]); // tslint:disable-next-line:prefer-const no-unused-variable

    const provider = new linterProvider_1.LinterProvider(context.object, serviceContainer);
    emitter.fire(document.object);
    const timesExpected = closed ? TypeMoq.Times.once() : TypeMoq.Times.never();
    engine.verify(x => x.clearDiagnostics(TypeMoq.It.isAny()), timesExpected);
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpbnQucHJvdmlkZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwiVHlwZU1vcSIsInZzY29kZSIsInR5cGVzXzEiLCJ0eXBlc18yIiwidHlwZXNfMyIsImFzeW5jXzEiLCJjb250cmFjdHNfMSIsImNvbnRhaW5lcl8xIiwic2VydmljZU1hbmFnZXJfMSIsImxpbnRlckF2YWlsYWJpbGl0eV8xIiwibGludGVyTWFuYWdlcl8xIiwidHlwZXNfNCIsImxpbnRlclByb3ZpZGVyXzEiLCJpbml0aWFsaXplXzEiLCJzdWl0ZSIsImNvbnRleHQiLCJpbnRlcnByZXRlclNlcnZpY2UiLCJlbmdpbmUiLCJjb25maWdTZXJ2aWNlIiwiZG9jTWFuYWdlciIsInNldHRpbmdzIiwibG0iLCJzZXJ2aWNlQ29udGFpbmVyIiwiZW1pdHRlciIsImRvY3VtZW50IiwiZnMiLCJhcHBTaGVsbCIsImxpbnRlckluc3RhbGxlciIsIndvcmtzcGFjZVNlcnZpY2UiLCJzdWl0ZVNldHVwIiwiaW5pdGlhbGl6ZSIsInNldHVwIiwiY29udCIsIkNvbnRhaW5lciIsInNlcnZpY2VNYW5hZ2VyIiwiU2VydmljZU1hbmFnZXIiLCJTZXJ2aWNlQ29udGFpbmVyIiwiTW9jayIsIm9mVHlwZSIsIngiLCJmaWxlRXhpc3RzIiwiSXQiLCJpc0FueSIsInJldHVybnMiLCJhcmVQYXRoc1NhbWUiLCJpc0FueVN0cmluZyIsImFkZFNpbmdsZXRvbkluc3RhbmNlIiwiSUZpbGVTeXN0ZW0iLCJvYmplY3QiLCJJSW50ZXJwcmV0ZXJTZXJ2aWNlIiwiSUxpbnRpbmdFbmdpbmUiLCJJRG9jdW1lbnRNYW5hZ2VyIiwibGludFNldHRpbmdzIiwiZW5hYmxlZCIsImxpbnRPblNhdmUiLCJsaW50aW5nIiwiZ2V0U2V0dGluZ3MiLCJJQ29uZmlndXJhdGlvblNlcnZpY2UiLCJJQXBwbGljYXRpb25TaGVsbCIsIklJbnN0YWxsZXIiLCJJV29ya3NwYWNlU2VydmljZSIsImFkZCIsIklBdmFpbGFibGVMaW50ZXJBY3RpdmF0b3IiLCJBdmFpbGFibGVMaW50ZXJBY3RpdmF0b3IiLCJMaW50ZXJNYW5hZ2VyIiwiSUxpbnRlck1hbmFnZXIiLCJFdmVudEVtaXR0ZXIiLCJ0ZXN0Iiwib25EaWRPcGVuVGV4dERvY3VtZW50IiwiZXZlbnQiLCJ1cmkiLCJVcmkiLCJmaWxlIiwibGFuZ3VhZ2VJZCIsInByb3ZpZGVyIiwiTGludGVyUHJvdmlkZXIiLCJmaXJlIiwidmVyaWZ5IiwibGludERvY3VtZW50IiwiVGltZXMiLCJvbmNlIiwib25EaWRTYXZlVGV4dERvY3VtZW50IiwibmV2ZXIiLCJvbkRpZENoYW5nZUludGVycHJldGVyIiwibGludE9wZW5QeXRob25GaWxlcyIsInNldEFjdGl2ZUxpbnRlcnNBc3luYyIsIlByb2R1Y3QiLCJweWxpbnQiLCJkZWZlcnJlZCIsImNyZWF0ZURlZmVycmVkIiwic2V0VGltZW91dCIsInByb21pc2UiLCJ0ZXN0Q2xlYXJEaWFnbm9zdGljc09uQ2xvc2UiLCJjbG9zZWQiLCJvbkRpZENsb3NlVGV4dERvY3VtZW50IiwiaXNDbG9zZWQiLCJ0ZXh0RG9jdW1lbnRzIiwidGltZXNFeHBlY3RlZCIsImNsZWFyRGlhZ25vc3RpY3MiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENB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QUFQLENBQWN0QyxDQUFDLElBQUlBLENBQUMsQ0FBQzJELGdCQUFGLENBQW1CbEcsT0FBTyxDQUFDeUMsRUFBUixDQUFXQyxLQUFYLEVBQW5CLENBQW5CLEVBQTJEdUQsYUFBM0Q7QUFDSDtBQUNKLENBekhJLENBQUwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xyXG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XHJcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL3R5cGVzXCIpO1xyXG5jb25zdCB0eXBlc18zID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IGFzeW5jXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi91dGlscy9hc3luY1wiKTtcclxuY29uc3QgY29udHJhY3RzXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2ludGVycHJldGVyL2NvbnRyYWN0c1wiKTtcclxuY29uc3QgY29udGFpbmVyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2lvYy9jb250YWluZXJcIik7XHJcbmNvbnN0IHNlcnZpY2VNYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2lvYy9zZXJ2aWNlTWFuYWdlclwiKTtcclxuY29uc3QgbGludGVyQXZhaWxhYmlsaXR5XzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2xpbnRlcnMvbGludGVyQXZhaWxhYmlsaXR5XCIpO1xyXG5jb25zdCBsaW50ZXJNYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2xpbnRlcnMvbGludGVyTWFuYWdlclwiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvbGludGVycy90eXBlc1wiKTtcclxuY29uc3QgbGludGVyUHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvcHJvdmlkZXJzL2xpbnRlclByb3ZpZGVyXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1mdW5jLWJvZHktbGVuZ3RoXHJcbnN1aXRlKCdMaW50aW5nIC0gUHJvdmlkZXInLCAoKSA9PiB7XHJcbiAgICBsZXQgY29udGV4dDtcclxuICAgIGxldCBpbnRlcnByZXRlclNlcnZpY2U7XHJcbiAgICBsZXQgZW5naW5lO1xyXG4gICAgbGV0IGNvbmZpZ1NlcnZpY2U7XHJcbiAgICBsZXQgZG9jTWFuYWdlcjtcclxuICAgIGxldCBzZXR0aW5ncztcclxuICAgIGxldCBsbTtcclxuICAgIGxldCBzZXJ2aWNlQ29udGFpbmVyO1xyXG4gICAgbGV0IGVtaXR0ZXI7XHJcbiAgICBsZXQgZG9jdW1lbnQ7XHJcbiAgICBsZXQgZnM7XHJcbiAgICBsZXQgYXBwU2hlbGw7XHJcbiAgICBsZXQgbGludGVySW5zdGFsbGVyO1xyXG4gICAgbGV0IHdvcmtzcGFjZVNlcnZpY2U7XHJcbiAgICBzdWl0ZVNldHVwKGluaXRpYWxpemVfMS5pbml0aWFsaXplKTtcclxuICAgIHNldHVwKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBjb250ID0gbmV3IGludmVyc2lmeV8xLkNvbnRhaW5lcigpO1xyXG4gICAgICAgIGNvbnN0IHNlcnZpY2VNYW5hZ2VyID0gbmV3IHNlcnZpY2VNYW5hZ2VyXzEuU2VydmljZU1hbmFnZXIoY29udCk7XHJcbiAgICAgICAgc2VydmljZUNvbnRhaW5lciA9IG5ldyBjb250YWluZXJfMS5TZXJ2aWNlQ29udGFpbmVyKGNvbnQpO1xyXG4gICAgICAgIGNvbnRleHQgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgZnMgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgZnMuc2V0dXAoeCA9PiB4LmZpbGVFeGlzdHMoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiByZXNvbHZlKHRydWUpKSk7XHJcbiAgICAgICAgZnMuc2V0dXAoeCA9PiB4LmFyZVBhdGhzU2FtZShUeXBlTW9xLkl0LmlzQW55U3RyaW5nKCksIFR5cGVNb3EuSXQuaXNBbnlTdHJpbmcoKSkpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMi5JRmlsZVN5c3RlbSwgZnMub2JqZWN0KTtcclxuICAgICAgICBpbnRlcnByZXRlclNlcnZpY2UgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UoY29udHJhY3RzXzEuSUludGVycHJldGVyU2VydmljZSwgaW50ZXJwcmV0ZXJTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgZW5naW5lID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzQuSUxpbnRpbmdFbmdpbmUsIGVuZ2luZS5vYmplY3QpO1xyXG4gICAgICAgIGRvY01hbmFnZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMS5JRG9jdW1lbnRNYW5hZ2VyLCBkb2NNYW5hZ2VyLm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgbGludFNldHRpbmdzID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGxpbnRTZXR0aW5ncy5zZXR1cCh4ID0+IHguZW5hYmxlZCkucmV0dXJucygoKSA9PiB0cnVlKTtcclxuICAgICAgICBsaW50U2V0dGluZ3Muc2V0dXAoeCA9PiB4LmxpbnRPblNhdmUpLnJldHVybnMoKCkgPT4gdHJ1ZSk7XHJcbiAgICAgICAgc2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgc2V0dGluZ3Muc2V0dXAoeCA9PiB4LmxpbnRpbmcpLnJldHVybnMoKCkgPT4gbGludFNldHRpbmdzLm9iamVjdCk7XHJcbiAgICAgICAgY29uZmlnU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25maWdTZXJ2aWNlLnNldHVwKHggPT4geC5nZXRTZXR0aW5ncyhUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHNldHRpbmdzLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMy5JQ29uZmlndXJhdGlvblNlcnZpY2UsIGNvbmZpZ1NlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICBhcHBTaGVsbCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBsaW50ZXJJbnN0YWxsZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBzZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18xLklBcHBsaWNhdGlvblNoZWxsLCBhcHBTaGVsbC5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzMuSUluc3RhbGxlciwgbGludGVySW5zdGFsbGVyLm9iamVjdCk7XHJcbiAgICAgICAgc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSwgd29ya3NwYWNlU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VNYW5hZ2VyLmFkZCh0eXBlc180LklBdmFpbGFibGVMaW50ZXJBY3RpdmF0b3IsIGxpbnRlckF2YWlsYWJpbGl0eV8xLkF2YWlsYWJsZUxpbnRlckFjdGl2YXRvcik7XHJcbiAgICAgICAgbG0gPSBuZXcgbGludGVyTWFuYWdlcl8xLkxpbnRlck1hbmFnZXIoc2VydmljZUNvbnRhaW5lciwgd29ya3NwYWNlU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzQuSUxpbnRlck1hbmFnZXIsIGxtKTtcclxuICAgICAgICBlbWl0dGVyID0gbmV3IHZzY29kZS5FdmVudEVtaXR0ZXIoKTtcclxuICAgICAgICBkb2N1bWVudCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0xpbnQgb24gb3BlbiBmaWxlJywgKCkgPT4ge1xyXG4gICAgICAgIGRvY01hbmFnZXIuc2V0dXAoeCA9PiB4Lm9uRGlkT3BlblRleHREb2N1bWVudCkucmV0dXJucygoKSA9PiBlbWl0dGVyLmV2ZW50KTtcclxuICAgICAgICBkb2N1bWVudC5zZXR1cCh4ID0+IHgudXJpKS5yZXR1cm5zKCgpID0+IHZzY29kZS5VcmkuZmlsZSgndGVzdC5weScpKTtcclxuICAgICAgICBkb2N1bWVudC5zZXR1cCh4ID0+IHgubGFuZ3VhZ2VJZCkucmV0dXJucygoKSA9PiAncHl0aG9uJyk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVudXNlZC12YXJpYWJsZVxyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IGxpbnRlclByb3ZpZGVyXzEuTGludGVyUHJvdmlkZXIoY29udGV4dC5vYmplY3QsIHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgICAgIGVtaXR0ZXIuZmlyZShkb2N1bWVudC5vYmplY3QpO1xyXG4gICAgICAgIGVuZ2luZS52ZXJpZnkoeCA9PiB4LmxpbnREb2N1bWVudChkb2N1bWVudC5vYmplY3QsICdhdXRvJyksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnTGludCBvbiBzYXZlIGZpbGUnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgZG9jTWFuYWdlci5zZXR1cCh4ID0+IHgub25EaWRTYXZlVGV4dERvY3VtZW50KS5yZXR1cm5zKCgpID0+IGVtaXR0ZXIuZXZlbnQpO1xyXG4gICAgICAgIGRvY3VtZW50LnNldHVwKHggPT4geC51cmkpLnJldHVybnMoKCkgPT4gdnNjb2RlLlVyaS5maWxlKCd0ZXN0LnB5JykpO1xyXG4gICAgICAgIGRvY3VtZW50LnNldHVwKHggPT4geC5sYW5ndWFnZUlkKS5yZXR1cm5zKCgpID0+ICdweXRob24nKTtcclxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tdW51c2VkLXZhcmlhYmxlXHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgbGludGVyUHJvdmlkZXJfMS5MaW50ZXJQcm92aWRlcihjb250ZXh0Lm9iamVjdCwgc2VydmljZUNvbnRhaW5lcik7XHJcbiAgICAgICAgZW1pdHRlci5maXJlKGRvY3VtZW50Lm9iamVjdCk7XHJcbiAgICAgICAgZW5naW5lLnZlcmlmeSh4ID0+IHgubGludERvY3VtZW50KGRvY3VtZW50Lm9iamVjdCwgJ3NhdmUnKSwgVHlwZU1vcS5UaW1lcy5vbmNlKCkpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnTm8gbGludCBvbiBvcGVuIG90aGVyIGZpbGVzJywgKCkgPT4ge1xyXG4gICAgICAgIGRvY01hbmFnZXIuc2V0dXAoeCA9PiB4Lm9uRGlkT3BlblRleHREb2N1bWVudCkucmV0dXJucygoKSA9PiBlbWl0dGVyLmV2ZW50KTtcclxuICAgICAgICBkb2N1bWVudC5zZXR1cCh4ID0+IHgudXJpKS5yZXR1cm5zKCgpID0+IHZzY29kZS5VcmkuZmlsZSgndGVzdC5jcycpKTtcclxuICAgICAgICBkb2N1bWVudC5zZXR1cCh4ID0+IHgubGFuZ3VhZ2VJZCkucmV0dXJucygoKSA9PiAnY3NoYXJwJyk7XHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVudXNlZC12YXJpYWJsZVxyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IGxpbnRlclByb3ZpZGVyXzEuTGludGVyUHJvdmlkZXIoY29udGV4dC5vYmplY3QsIHNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgICAgIGVtaXR0ZXIuZmlyZShkb2N1bWVudC5vYmplY3QpO1xyXG4gICAgICAgIGVuZ2luZS52ZXJpZnkoeCA9PiB4LmxpbnREb2N1bWVudChkb2N1bWVudC5vYmplY3QsICdzYXZlJyksIFR5cGVNb3EuVGltZXMubmV2ZXIoKSk7XHJcbiAgICB9KTtcclxuICAgIHRlc3QoJ05vIGxpbnQgb24gc2F2ZSBvdGhlciBmaWxlcycsICgpID0+IHtcclxuICAgICAgICBkb2NNYW5hZ2VyLnNldHVwKHggPT4geC5vbkRpZFNhdmVUZXh0RG9jdW1lbnQpLnJldHVybnMoKCkgPT4gZW1pdHRlci5ldmVudCk7XHJcbiAgICAgICAgZG9jdW1lbnQuc2V0dXAoeCA9PiB4LnVyaSkucmV0dXJucygoKSA9PiB2c2NvZGUuVXJpLmZpbGUoJ3Rlc3QuY3MnKSk7XHJcbiAgICAgICAgZG9jdW1lbnQuc2V0dXAoeCA9PiB4Lmxhbmd1YWdlSWQpLnJldHVybnMoKCkgPT4gJ2NzaGFycCcpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnVzZWQtdmFyaWFibGVcclxuICAgICAgICBjb25zdCBwcm92aWRlciA9IG5ldyBsaW50ZXJQcm92aWRlcl8xLkxpbnRlclByb3ZpZGVyKGNvbnRleHQub2JqZWN0LCBzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgICAgICBlbWl0dGVyLmZpcmUoZG9jdW1lbnQub2JqZWN0KTtcclxuICAgICAgICBlbmdpbmUudmVyaWZ5KHggPT4geC5saW50RG9jdW1lbnQoZG9jdW1lbnQub2JqZWN0LCAnc2F2ZScpLCBUeXBlTW9xLlRpbWVzLm5ldmVyKCkpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdMaW50IG9uIGNoYW5nZSBpbnRlcnByZXRlcnMnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZSA9IG5ldyB2c2NvZGUuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlLnNldHVwKHggPT4geC5vbkRpZENoYW5nZUludGVycHJldGVyKS5yZXR1cm5zKCgpID0+IGUuZXZlbnQpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnVzZWQtdmFyaWFibGVcclxuICAgICAgICBjb25zdCBwcm92aWRlciA9IG5ldyBsaW50ZXJQcm92aWRlcl8xLkxpbnRlclByb3ZpZGVyKGNvbnRleHQub2JqZWN0LCBzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgICAgICBlLmZpcmUoKTtcclxuICAgICAgICBlbmdpbmUudmVyaWZ5KHggPT4geC5saW50T3BlblB5dGhvbkZpbGVzKCksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgIH0pO1xyXG4gICAgdGVzdCgnTGludCBvbiBzYXZlIHB5bGludHJjJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGRvY01hbmFnZXIuc2V0dXAoeCA9PiB4Lm9uRGlkU2F2ZVRleHREb2N1bWVudCkucmV0dXJucygoKSA9PiBlbWl0dGVyLmV2ZW50KTtcclxuICAgICAgICBkb2N1bWVudC5zZXR1cCh4ID0+IHgudXJpKS5yZXR1cm5zKCgpID0+IHZzY29kZS5VcmkuZmlsZSgnLnB5bGludHJjJykpO1xyXG4gICAgICAgIHlpZWxkIGxtLnNldEFjdGl2ZUxpbnRlcnNBc3luYyhbdHlwZXNfMy5Qcm9kdWN0LnB5bGludF0pO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bnVzZWQtdmFyaWFibGVcclxuICAgICAgICBjb25zdCBwcm92aWRlciA9IG5ldyBsaW50ZXJQcm92aWRlcl8xLkxpbnRlclByb3ZpZGVyKGNvbnRleHQub2JqZWN0LCBzZXJ2aWNlQ29udGFpbmVyKTtcclxuICAgICAgICBlbWl0dGVyLmZpcmUoZG9jdW1lbnQub2JqZWN0KTtcclxuICAgICAgICBjb25zdCBkZWZlcnJlZCA9IGFzeW5jXzEuY3JlYXRlRGVmZXJyZWQoKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGRlZmVycmVkLnJlc29sdmUoKSwgMjAwMCk7XHJcbiAgICAgICAgeWllbGQgZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICBlbmdpbmUudmVyaWZ5KHggPT4geC5saW50T3BlblB5dGhvbkZpbGVzKCksIFR5cGVNb3EuVGltZXMub25jZSgpKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0RpYWdub3N0aWMgY2xlYXJlZCBvbiBmaWxlIGNsb3NlJywgKCkgPT4gdGVzdENsZWFyRGlhZ25vc3RpY3NPbkNsb3NlKHRydWUpKTtcclxuICAgIHRlc3QoJ0RpYWdub3N0aWMgbm90IGNsZWFyZWQgb24gZmlsZSBvcGVuZWQgaW4gYW5vdGhlciB0YWInLCAoKSA9PiB0ZXN0Q2xlYXJEaWFnbm9zdGljc09uQ2xvc2UoZmFsc2UpKTtcclxuICAgIGZ1bmN0aW9uIHRlc3RDbGVhckRpYWdub3N0aWNzT25DbG9zZShjbG9zZWQpIHtcclxuICAgICAgICBkb2NNYW5hZ2VyLnNldHVwKHggPT4geC5vbkRpZENsb3NlVGV4dERvY3VtZW50KS5yZXR1cm5zKCgpID0+IGVtaXR0ZXIuZXZlbnQpO1xyXG4gICAgICAgIGNvbnN0IHVyaSA9IHZzY29kZS5VcmkuZmlsZSgndGVzdC5weScpO1xyXG4gICAgICAgIGRvY3VtZW50LnNldHVwKHggPT4geC51cmkpLnJldHVybnMoKCkgPT4gdXJpKTtcclxuICAgICAgICBkb2N1bWVudC5zZXR1cCh4ID0+IHguaXNDbG9zZWQpLnJldHVybnMoKCkgPT4gY2xvc2VkKTtcclxuICAgICAgICBkb2NNYW5hZ2VyLnNldHVwKHggPT4geC50ZXh0RG9jdW1lbnRzKS5yZXR1cm5zKCgpID0+IGNsb3NlZCA/IFtdIDogW2RvY3VtZW50Lm9iamVjdF0pO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3Qgbm8tdW51c2VkLXZhcmlhYmxlXHJcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgbGludGVyUHJvdmlkZXJfMS5MaW50ZXJQcm92aWRlcihjb250ZXh0Lm9iamVjdCwgc2VydmljZUNvbnRhaW5lcik7XHJcbiAgICAgICAgZW1pdHRlci5maXJlKGRvY3VtZW50Lm9iamVjdCk7XHJcbiAgICAgICAgY29uc3QgdGltZXNFeHBlY3RlZCA9IGNsb3NlZCA/IFR5cGVNb3EuVGltZXMub25jZSgpIDogVHlwZU1vcS5UaW1lcy5uZXZlcigpO1xyXG4gICAgICAgIGVuZ2luZS52ZXJpZnkoeCA9PiB4LmNsZWFyRGlhZ25vc3RpY3MoVHlwZU1vcS5JdC5pc0FueSgpKSwgdGltZXNFeHBlY3RlZCk7XHJcbiAgICB9XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1saW50LnByb3ZpZGVyLnRlc3QuanMubWFwIl19