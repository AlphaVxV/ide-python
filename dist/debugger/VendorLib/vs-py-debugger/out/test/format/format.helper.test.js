"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const TypeMoq = require("typemoq");

const configSettings_1 = require("../../client/common/configSettings");

const types_1 = require("../../client/common/types");

const EnumEx = require("../../client/common/utils/enum");

const helper_1 = require("../../client/formatters/helper");

const initialize_1 = require("../initialize");

const serviceRegistry_1 = require("../unittests/serviceRegistry"); // tslint:disable-next-line:max-func-body-length


suite('Formatting - Helper', () => {
  let ioc;
  let formatHelper;
  suiteSetup(initialize_1.initialize);
  setup(() => {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    const config = TypeMoq.Mock.ofType();
    config.setup(x => x.getSettings(TypeMoq.It.isAny())).returns(() => configSettings_1.PythonSettings.getInstance());
    ioc.serviceManager.addSingletonInstance(types_1.IConfigurationService, config.object);
    formatHelper = new helper_1.FormatterHelper(ioc.serviceManager);
  });
  test('Ensure product is set in Execution Info', () => __awaiter(void 0, void 0, void 0, function* () {
    [types_1.Product.autopep8, types_1.Product.black, types_1.Product.yapf].forEach(formatter => {
      const info = formatHelper.getExecutionInfo(formatter, []);
      assert.equal(info.product, formatter, `Incorrect products for ${formatHelper.translateToId(formatter)}`);
    });
  }));
  test('Ensure executable is set in Execution Info', () => __awaiter(void 0, void 0, void 0, function* () {
    const settings = configSettings_1.PythonSettings.getInstance();
    [types_1.Product.autopep8, types_1.Product.black, types_1.Product.yapf].forEach(formatter => {
      const info = formatHelper.getExecutionInfo(formatter, []);
      const names = formatHelper.getSettingsPropertyNames(formatter);
      const execPath = settings.formatting[names.pathName];
      assert.equal(info.execPath, execPath, `Incorrect executable paths for product ${formatHelper.translateToId(formatter)}`);
    });
  }));
  test('Ensure arguments are set in Execution Info', () => __awaiter(void 0, void 0, void 0, function* () {
    const settings = configSettings_1.PythonSettings.getInstance();
    const customArgs = ['1', '2', '3'];
    [types_1.Product.autopep8, types_1.Product.black, types_1.Product.yapf].forEach(formatter => {
      const names = formatHelper.getSettingsPropertyNames(formatter);
      const args = Array.isArray(settings.formatting[names.argsName]) ? settings.formatting[names.argsName] : [];
      const expectedArgs = args.concat(customArgs).join(',');
      assert.equal(expectedArgs.endsWith(customArgs.join(',')), true, `Incorrect custom arguments for product ${formatHelper.translateToId(formatter)}`);
    });
  }));
  test('Ensure correct setting names are returned', () => __awaiter(void 0, void 0, void 0, function* () {
    [types_1.Product.autopep8, types_1.Product.black, types_1.Product.yapf].forEach(formatter => {
      const translatedId = formatHelper.translateToId(formatter);
      const settings = {
        argsName: `${translatedId}Args`,
        pathName: `${translatedId}Path`
      };
      assert.deepEqual(formatHelper.getSettingsPropertyNames(formatter), settings, `Incorrect settings for product ${formatHelper.translateToId(formatter)}`);
    });
  }));
  test('Ensure translation of ids works', () => __awaiter(void 0, void 0, void 0, function* () {
    const formatterMapping = new Map();
    formatterMapping.set(types_1.Product.autopep8, 'autopep8');
    formatterMapping.set(types_1.Product.black, 'black');
    formatterMapping.set(types_1.Product.yapf, 'yapf');
    [types_1.Product.autopep8, types_1.Product.black, types_1.Product.yapf].forEach(formatter => {
      const translatedId = formatHelper.translateToId(formatter);
      assert.equal(translatedId, formatterMapping.get(formatter), `Incorrect translation for product ${formatHelper.translateToId(formatter)}`);
    });
  }));
  EnumEx.getValues(types_1.Product).forEach(product => {
    const formatterMapping = new Map();
    formatterMapping.set(types_1.Product.autopep8, 'autopep8');
    formatterMapping.set(types_1.Product.black, 'black');
    formatterMapping.set(types_1.Product.yapf, 'yapf');

    if (formatterMapping.has(product)) {
      return;
    }

    test(`Ensure translation of ids throws exceptions for unknown formatters (${product})`, () => __awaiter(void 0, void 0, void 0, function* () {
      assert.throws(() => formatHelper.translateToId(product));
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm1hdC5oZWxwZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwiYXNzZXJ0IiwicmVxdWlyZSIsIlR5cGVNb3EiLCJjb25maWdTZXR0aW5nc18xIiwidHlwZXNfMSIsIkVudW1FeCIsImhlbHBlcl8xIiwiaW5pdGlhbGl6ZV8xIiwic2VydmljZVJlZ2lzdHJ5XzEiLCJzdWl0ZSIsImlvYyIsImZvcm1hdEhlbHBlciIsInN1aXRlU2V0dXAiLCJpbml0aWFsaXplIiwic2V0dXAiLCJVbml0VGVzdElvY0NvbnRhaW5lciIsImNvbmZpZyIsIk1vY2siLCJvZlR5cGUiLCJ4IiwiZ2V0U2V0dGluZ3MiLCJJdCIsImlzQW55IiwicmV0dXJucyIsIlB5dGhvblNldHRpbmdzIiwiZ2V0SW5zdGFuY2UiLCJzZXJ2aWNlTWFuYWdlciIsImFkZFNpbmdsZXRvbkluc3RhbmNlIiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwib2JqZWN0IiwiRm9ybWF0dGVySGVscGVyIiwidGVzdCIsIlByb2R1Y3QiLCJhdXRvcGVwOCIsImJsYWNrIiwieWFwZiIsImZvckVhY2giLCJmb3JtYXR0ZXIiLCJpbmZvIiwiZ2V0RXhlY3V0aW9uSW5mbyIsImVxdWFsIiwicHJvZHVjdCIsInRyYW5zbGF0ZVRvSWQiLCJzZXR0aW5ncyIsIm5hbWVzIiwiZ2V0U2V0dGluZ3NQcm9wZXJ0eU5hbWVzIiwiZXhlY1BhdGgiLCJmb3JtYXR0aW5nIiwicGF0aE5hbWUiLCJjdXN0b21BcmdzIiwiYXJncyIsIkFycmF5IiwiaXNBcnJheSIsImFyZ3NOYW1lIiwiZXhwZWN0ZWRBcmdzIiwiY29uY2F0Iiwiam9pbiIsImVuZHNXaXRoIiwidHJhbnNsYXRlZElkIiwiZGVlcEVxdWFsIiwiZm9ybWF0dGVyTWFwcGluZyIsIk1hcCIsInNldCIsImdldCIsImdldFZhbHVlcyIsImhhcyIsInRocm93cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxVQUFuQixFQUErQkMsQ0FBL0IsRUFBa0NDLFNBQWxDLEVBQTZDO0FBQ3JGLFNBQU8sS0FBS0QsQ0FBQyxLQUFLQSxDQUFDLEdBQUdFLE9BQVQsQ0FBTixFQUF5QixVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUN2RCxhQUFTQyxTQUFULENBQW1CQyxLQUFuQixFQUEwQjtBQUFFLFVBQUk7QUFBRUMsUUFBQUEsSUFBSSxDQUFDTixTQUFTLENBQUNPLElBQVYsQ0FBZUYsS0FBZixDQUFELENBQUo7QUFBOEIsT0FBcEMsQ0FBcUMsT0FBT0csQ0FBUCxFQUFVO0FBQUVMLFFBQUFBLE1BQU0sQ0FBQ0ssQ0FBRCxDQUFOO0FBQVk7QUFBRTs7QUFDM0YsYUFBU0MsUUFBVCxDQUFrQkosS0FBbEIsRUFBeUI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDLE9BQUQsQ0FBVCxDQUFtQkssS0FBbkIsQ0FBRCxDQUFKO0FBQWtDLE9BQXhDLENBQXlDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzlGLGFBQVNGLElBQVQsQ0FBY0ksTUFBZCxFQUFzQjtBQUFFQSxNQUFBQSxNQUFNLENBQUNDLElBQVAsR0FBY1QsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBckIsR0FBc0MsSUFBSU4sQ0FBSixDQUFNLFVBQVVHLE9BQVYsRUFBbUI7QUFBRUEsUUFBQUEsT0FBTyxDQUFDUSxNQUFNLENBQUNMLEtBQVIsQ0FBUDtBQUF3QixPQUFu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QUMrQixhQUFiLENBQTJCTCxTQUEzQixDQUFzQyxFQUF2STtBQUNILEtBSEQ7QUFJSCxHQVRzRCxDQUFuRCxDQUFKO0FBVUFoQyxFQUFBQSxNQUFNLENBQUMyRCxTQUFQLENBQWlCNUQsT0FBTyxDQUFDNEIsT0FBekIsRUFBa0NJLE9BQWxDLENBQTBDSyxPQUFPLElBQUk7QUFDakQsVUFBTW1CLGdCQUFnQixHQUFHLElBQUlDLEdBQUosRUFBekI7QUFDQUQsSUFBQUEsZ0JBQWdCLENBQUNFLEdBQWpCLENBQXFCMUQsT0FBTyxDQUFDNEIsT0FBUixDQUFnQkMsUUFBckMsRUFBK0MsVUFBL0M7QUFDQTJCLElBQUFBLGdCQUFnQixDQUFDRSxHQUFqQixDQUFxQjFELE9BQU8sQ0FBQzRCLE9BQVIsQ0FBZ0JFLEtBQXJDLEVBQTRDLE9BQTVDO0FBQ0EwQixJQUFBQSxnQkFBZ0IsQ0FBQ0UsR0FBakIsQ0FBcUIxRCxPQUFPLENBQUM0QixPQUFSLENBQWdCRyxJQUFyQyxFQUEyQyxNQUEzQzs7QUFDQSxRQUFJeUIsZ0JBQWdCLENBQUNLLEdBQWpCLENBQXFCeEIsT0FBckIsQ0FBSixFQUFtQztBQUMvQjtBQUNIOztBQUNEVixJQUFBQSxJQUFJLENBQUUsdUVBQXNFVSxPQUFRLEdBQWhGLEVBQW9GLE1BQU05RCxTQUFTLFNBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ3ZJcUIsTUFBQUEsTUFBTSxDQUFDa0UsTUFBUCxDQUFjLE1BQU12RCxZQUFZLENBQUMrQixhQUFiLENBQTJCRCxPQUEzQixDQUFwQjtBQUNILEtBRnNHLENBQW5HLENBQUo7QUFHSCxHQVhEO0FBWUgsQ0FwRUksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgY29uZmlnU2V0dGluZ3NfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL2NvbmZpZ1NldHRpbmdzXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vdHlwZXNcIik7XHJcbmNvbnN0IEVudW1FeCA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL2VudW1cIik7XHJcbmNvbnN0IGhlbHBlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9mb3JtYXR0ZXJzL2hlbHBlclwiKTtcclxuY29uc3QgaW5pdGlhbGl6ZV8xID0gcmVxdWlyZShcIi4uL2luaXRpYWxpemVcIik7XHJcbmNvbnN0IHNlcnZpY2VSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4uL3VuaXR0ZXN0cy9zZXJ2aWNlUmVnaXN0cnlcIik7XHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5zdWl0ZSgnRm9ybWF0dGluZyAtIEhlbHBlcicsICgpID0+IHtcclxuICAgIGxldCBpb2M7XHJcbiAgICBsZXQgZm9ybWF0SGVscGVyO1xyXG4gICAgc3VpdGVTZXR1cChpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSk7XHJcbiAgICBzZXR1cCgoKSA9PiB7XHJcbiAgICAgICAgaW9jID0gbmV3IHNlcnZpY2VSZWdpc3RyeV8xLlVuaXRUZXN0SW9jQ29udGFpbmVyKCk7XHJcbiAgICAgICAgY29uc3QgY29uZmlnID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbmZpZy5zZXR1cCh4ID0+IHguZ2V0U2V0dGluZ3MoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBjb25maWdTZXR0aW5nc18xLlB5dGhvblNldHRpbmdzLmdldEluc3RhbmNlKCkpO1xyXG4gICAgICAgIGlvYy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18xLklDb25maWd1cmF0aW9uU2VydmljZSwgY29uZmlnLm9iamVjdCk7XHJcbiAgICAgICAgZm9ybWF0SGVscGVyID0gbmV3IGhlbHBlcl8xLkZvcm1hdHRlckhlbHBlcihpb2Muc2VydmljZU1hbmFnZXIpO1xyXG4gICAgfSk7XHJcbiAgICB0ZXN0KCdFbnN1cmUgcHJvZHVjdCBpcyBzZXQgaW4gRXhlY3V0aW9uIEluZm8nLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgW3R5cGVzXzEuUHJvZHVjdC5hdXRvcGVwOCwgdHlwZXNfMS5Qcm9kdWN0LmJsYWNrLCB0eXBlc18xLlByb2R1Y3QueWFwZl0uZm9yRWFjaChmb3JtYXR0ZXIgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbmZvID0gZm9ybWF0SGVscGVyLmdldEV4ZWN1dGlvbkluZm8oZm9ybWF0dGVyLCBbXSk7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbChpbmZvLnByb2R1Y3QsIGZvcm1hdHRlciwgYEluY29ycmVjdCBwcm9kdWN0cyBmb3IgJHtmb3JtYXRIZWxwZXIudHJhbnNsYXRlVG9JZChmb3JtYXR0ZXIpfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIGV4ZWN1dGFibGUgaXMgc2V0IGluIEV4ZWN1dGlvbiBJbmZvJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gY29uZmlnU2V0dGluZ3NfMS5QeXRob25TZXR0aW5ncy5nZXRJbnN0YW5jZSgpO1xyXG4gICAgICAgIFt0eXBlc18xLlByb2R1Y3QuYXV0b3BlcDgsIHR5cGVzXzEuUHJvZHVjdC5ibGFjaywgdHlwZXNfMS5Qcm9kdWN0LnlhcGZdLmZvckVhY2goZm9ybWF0dGVyID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW5mbyA9IGZvcm1hdEhlbHBlci5nZXRFeGVjdXRpb25JbmZvKGZvcm1hdHRlciwgW10pO1xyXG4gICAgICAgICAgICBjb25zdCBuYW1lcyA9IGZvcm1hdEhlbHBlci5nZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMoZm9ybWF0dGVyKTtcclxuICAgICAgICAgICAgY29uc3QgZXhlY1BhdGggPSBzZXR0aW5ncy5mb3JtYXR0aW5nW25hbWVzLnBhdGhOYW1lXTtcclxuICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKGluZm8uZXhlY1BhdGgsIGV4ZWNQYXRoLCBgSW5jb3JyZWN0IGV4ZWN1dGFibGUgcGF0aHMgZm9yIHByb2R1Y3QgJHtmb3JtYXRIZWxwZXIudHJhbnNsYXRlVG9JZChmb3JtYXR0ZXIpfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIGFyZ3VtZW50cyBhcmUgc2V0IGluIEV4ZWN1dGlvbiBJbmZvJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gY29uZmlnU2V0dGluZ3NfMS5QeXRob25TZXR0aW5ncy5nZXRJbnN0YW5jZSgpO1xyXG4gICAgICAgIGNvbnN0IGN1c3RvbUFyZ3MgPSBbJzEnLCAnMicsICczJ107XHJcbiAgICAgICAgW3R5cGVzXzEuUHJvZHVjdC5hdXRvcGVwOCwgdHlwZXNfMS5Qcm9kdWN0LmJsYWNrLCB0eXBlc18xLlByb2R1Y3QueWFwZl0uZm9yRWFjaChmb3JtYXR0ZXIgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuYW1lcyA9IGZvcm1hdEhlbHBlci5nZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMoZm9ybWF0dGVyKTtcclxuICAgICAgICAgICAgY29uc3QgYXJncyA9IEFycmF5LmlzQXJyYXkoc2V0dGluZ3MuZm9ybWF0dGluZ1tuYW1lcy5hcmdzTmFtZV0pID8gc2V0dGluZ3MuZm9ybWF0dGluZ1tuYW1lcy5hcmdzTmFtZV0gOiBbXTtcclxuICAgICAgICAgICAgY29uc3QgZXhwZWN0ZWRBcmdzID0gYXJncy5jb25jYXQoY3VzdG9tQXJncykuam9pbignLCcpO1xyXG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwoZXhwZWN0ZWRBcmdzLmVuZHNXaXRoKGN1c3RvbUFyZ3Muam9pbignLCcpKSwgdHJ1ZSwgYEluY29ycmVjdCBjdXN0b20gYXJndW1lbnRzIGZvciBwcm9kdWN0ICR7Zm9ybWF0SGVscGVyLnRyYW5zbGF0ZVRvSWQoZm9ybWF0dGVyKX1gKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Vuc3VyZSBjb3JyZWN0IHNldHRpbmcgbmFtZXMgYXJlIHJldHVybmVkJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIFt0eXBlc18xLlByb2R1Y3QuYXV0b3BlcDgsIHR5cGVzXzEuUHJvZHVjdC5ibGFjaywgdHlwZXNfMS5Qcm9kdWN0LnlhcGZdLmZvckVhY2goZm9ybWF0dGVyID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlZElkID0gZm9ybWF0SGVscGVyLnRyYW5zbGF0ZVRvSWQoZm9ybWF0dGVyKTtcclxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICBhcmdzTmFtZTogYCR7dHJhbnNsYXRlZElkfUFyZ3NgLFxyXG4gICAgICAgICAgICAgICAgcGF0aE5hbWU6IGAke3RyYW5zbGF0ZWRJZH1QYXRoYFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGZvcm1hdEhlbHBlci5nZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMoZm9ybWF0dGVyKSwgc2V0dGluZ3MsIGBJbmNvcnJlY3Qgc2V0dGluZ3MgZm9yIHByb2R1Y3QgJHtmb3JtYXRIZWxwZXIudHJhbnNsYXRlVG9JZChmb3JtYXR0ZXIpfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRW5zdXJlIHRyYW5zbGF0aW9uIG9mIGlkcyB3b3JrcycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBmb3JtYXR0ZXJNYXBwaW5nID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIGZvcm1hdHRlck1hcHBpbmcuc2V0KHR5cGVzXzEuUHJvZHVjdC5hdXRvcGVwOCwgJ2F1dG9wZXA4Jyk7XHJcbiAgICAgICAgZm9ybWF0dGVyTWFwcGluZy5zZXQodHlwZXNfMS5Qcm9kdWN0LmJsYWNrLCAnYmxhY2snKTtcclxuICAgICAgICBmb3JtYXR0ZXJNYXBwaW5nLnNldCh0eXBlc18xLlByb2R1Y3QueWFwZiwgJ3lhcGYnKTtcclxuICAgICAgICBbdHlwZXNfMS5Qcm9kdWN0LmF1dG9wZXA4LCB0eXBlc18xLlByb2R1Y3QuYmxhY2ssIHR5cGVzXzEuUHJvZHVjdC55YXBmXS5mb3JFYWNoKGZvcm1hdHRlciA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWRJZCA9IGZvcm1hdEhlbHBlci50cmFuc2xhdGVUb0lkKGZvcm1hdHRlcik7XHJcbiAgICAgICAgICAgIGFzc2VydC5lcXVhbCh0cmFuc2xhdGVkSWQsIGZvcm1hdHRlck1hcHBpbmcuZ2V0KGZvcm1hdHRlciksIGBJbmNvcnJlY3QgdHJhbnNsYXRpb24gZm9yIHByb2R1Y3QgJHtmb3JtYXRIZWxwZXIudHJhbnNsYXRlVG9JZChmb3JtYXR0ZXIpfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG4gICAgRW51bUV4LmdldFZhbHVlcyh0eXBlc18xLlByb2R1Y3QpLmZvckVhY2gocHJvZHVjdCA9PiB7XHJcbiAgICAgICAgY29uc3QgZm9ybWF0dGVyTWFwcGluZyA9IG5ldyBNYXAoKTtcclxuICAgICAgICBmb3JtYXR0ZXJNYXBwaW5nLnNldCh0eXBlc18xLlByb2R1Y3QuYXV0b3BlcDgsICdhdXRvcGVwOCcpO1xyXG4gICAgICAgIGZvcm1hdHRlck1hcHBpbmcuc2V0KHR5cGVzXzEuUHJvZHVjdC5ibGFjaywgJ2JsYWNrJyk7XHJcbiAgICAgICAgZm9ybWF0dGVyTWFwcGluZy5zZXQodHlwZXNfMS5Qcm9kdWN0LnlhcGYsICd5YXBmJyk7XHJcbiAgICAgICAgaWYgKGZvcm1hdHRlck1hcHBpbmcuaGFzKHByb2R1Y3QpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGVzdChgRW5zdXJlIHRyYW5zbGF0aW9uIG9mIGlkcyB0aHJvd3MgZXhjZXB0aW9ucyBmb3IgdW5rbm93biBmb3JtYXR0ZXJzICgke3Byb2R1Y3R9KWAsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LnRocm93cygoKSA9PiBmb3JtYXRIZWxwZXIudHJhbnNsYXRlVG9JZChwcm9kdWN0KSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1mb3JtYXQuaGVscGVyLnRlc3QuanMubWFwIl19