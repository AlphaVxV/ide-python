"use strict"; // Note: This example test is leveraging the Mocha test framework.
// Please refer to their documentation on https://mochajs.org/ for help.

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const path = require("path");

const vscode = require("vscode");

const initialize_1 = require("../initialize");

const formatFilesPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'formatting');
const unformattedFile = path.join(formatFilesPath, 'fileToFormatOnEnter.py');
suite('Formatting - OnEnter provider', () => {
  let document;
  let editor;
  suiteSetup(initialize_1.initialize);
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    document = yield vscode.workspace.openTextDocument(unformattedFile);
    editor = yield vscode.window.showTextDocument(document);
  }));
  suiteTeardown(initialize_1.closeActiveWindows);
  teardown(initialize_1.closeActiveWindows);
  test('Simple statement', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(1, 0);
    assert.equal(text, 'x = 1', 'Line was not formatted');
  }));
  test('No formatting inside strings', () => __awaiter(void 0, void 0, void 0, function* () {
    let text = yield formatAtPosition(2, 0);
    assert.equal(text, '"""x=1', 'Text inside string was formatted');
    text = yield formatAtPosition(3, 0);
    assert.equal(text, '"""', 'Text inside string was formatted');
  }));
  test('Whitespace before comment', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(4, 0);
    assert.equal(text, '  # comment', 'Whitespace before comment was not preserved');
  }));
  test('No formatting of comment', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(5, 0);
    assert.equal(text, '# x=1', 'Text inside comment was formatted');
  }));
  test('Formatting line ending in comment', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(6, 0);
    assert.equal(text, 'x + 1  # ', 'Line ending in comment was not formatted');
  }));
  test('Formatting line with @', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(7, 0);
    assert.equal(text, '@x', 'Line with @ was reformatted');
  }));
  test('Formatting line with @', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(8, 0);
    assert.equal(text, 'x.y', 'Line ending with period was reformatted');
  }));
  test('Formatting line with unknown neighboring tokens', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(9, 0);
    assert.equal(text, 'if x <= 1:', 'Line with unknown neighboring tokens was not formatted');
  }));
  test('Formatting line with unknown neighboring tokens', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(10, 0);
    assert.equal(text, 'if 1 <= x:', 'Line with unknown neighboring tokens was not formatted');
  }));
  test('Formatting method definition with arguments', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(11, 0);
    assert.equal(text, 'def __init__(self, age=23)', 'Method definition with arguments was not formatted');
  }));
  test('Formatting space after open brace', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(12, 0);
    assert.equal(text, 'while (1)', 'Space after open brace was not formatted');
  }));
  test('Formatting line ending in string', () => __awaiter(void 0, void 0, void 0, function* () {
    const text = yield formatAtPosition(13, 0);
    assert.equal(text, 'x + """', 'Line ending in multiline string was not formatted');
  }));

  function formatAtPosition(line, character) {
    return __awaiter(this, void 0, void 0, function* () {
      const edits = yield vscode.commands.executeCommand('vscode.executeFormatOnTypeProvider', document.uri, new vscode.Position(line, character), '\n', {
        insertSpaces: true,
        tabSize: 2
      });

      if (edits) {
        yield editor.edit(builder => edits.forEach(e => builder.replace(e.range, e.newText)));
      }

      return document.lineAt(line - 1).text;
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuc2lvbi5vbkVudGVyRm9ybWF0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImFzc2VydCIsInJlcXVpcmUiLCJwYXRoIiwidnNjb2RlIiwiaW5pdGlhbGl6ZV8xIiwiZm9ybWF0RmlsZXNQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsInVuZm9ybWF0dGVkRmlsZSIsInN1aXRlIiwiZG9jdW1lbnQiLCJlZGl0b3IiLCJzdWl0ZVNldHVwIiwiaW5pdGlhbGl6ZSIsInNldHVwIiwid29ya3NwYWNlIiwib3BlblRleHREb2N1bWVudCIsIndpbmRvdyIsInNob3dUZXh0RG9jdW1lbnQiLCJzdWl0ZVRlYXJkb3duIiwiY2xvc2VBY3RpdmVXaW5kb3dzIiwidGVhcmRvd24iLCJ0ZXN0IiwidGV4dCIsImZvcm1hdEF0UG9zaXRpb24iLCJlcXVhbCIsImxpbmUiLCJjaGFyYWN0ZXIiLCJlZGl0cyIsImNvbW1hbmRzIiwiZXhlY3V0ZUNvbW1hbmQiLCJ1cmkiLCJQb3NpdGlvbiIsImluc2VydFNwYWNlcyIsInRhYlNpemUiLCJlZGl0IiwiYnVpbGRlciIsImZvckVhY2giLCJyZXBsYWNlIiwicmFuZ2UiLCJuZXdUZXh0IiwibGluZUF0Il0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENB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dXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG4vLyBOb3RlOiBUaGlzIGV4YW1wbGUgdGVzdCBpcyBsZXZlcmFnaW5nIHRoZSBNb2NoYSB0ZXN0IGZyYW1ld29yay5cclxuLy8gUGxlYXNlIHJlZmVyIHRvIHRoZWlyIGRvY3VtZW50YXRpb24gb24gaHR0cHM6Ly9tb2NoYWpzLm9yZy8gZm9yIGhlbHAuXHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB2c2NvZGUgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3QgZm9ybWF0RmlsZXNQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJy4uJywgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ2Zvcm1hdHRpbmcnKTtcclxuY29uc3QgdW5mb3JtYXR0ZWRGaWxlID0gcGF0aC5qb2luKGZvcm1hdEZpbGVzUGF0aCwgJ2ZpbGVUb0Zvcm1hdE9uRW50ZXIucHknKTtcclxuc3VpdGUoJ0Zvcm1hdHRpbmcgLSBPbkVudGVyIHByb3ZpZGVyJywgKCkgPT4ge1xyXG4gICAgbGV0IGRvY3VtZW50O1xyXG4gICAgbGV0IGVkaXRvcjtcclxuICAgIHN1aXRlU2V0dXAoaW5pdGlhbGl6ZV8xLmluaXRpYWxpemUpO1xyXG4gICAgc2V0dXAoKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGRvY3VtZW50ID0geWllbGQgdnNjb2RlLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KHVuZm9ybWF0dGVkRmlsZSk7XHJcbiAgICAgICAgZWRpdG9yID0geWllbGQgdnNjb2RlLndpbmRvdy5zaG93VGV4dERvY3VtZW50KGRvY3VtZW50KTtcclxuICAgIH0pKTtcclxuICAgIHN1aXRlVGVhcmRvd24oaW5pdGlhbGl6ZV8xLmNsb3NlQWN0aXZlV2luZG93cyk7XHJcbiAgICB0ZWFyZG93bihpbml0aWFsaXplXzEuY2xvc2VBY3RpdmVXaW5kb3dzKTtcclxuICAgIHRlc3QoJ1NpbXBsZSBzdGF0ZW1lbnQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IHlpZWxkIGZvcm1hdEF0UG9zaXRpb24oMSwgMCk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHRleHQsICd4ID0gMScsICdMaW5lIHdhcyBub3QgZm9ybWF0dGVkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdObyBmb3JtYXR0aW5nIGluc2lkZSBzdHJpbmdzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGxldCB0ZXh0ID0geWllbGQgZm9ybWF0QXRQb3NpdGlvbigyLCAwKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGV4dCwgJ1wiXCJcIng9MScsICdUZXh0IGluc2lkZSBzdHJpbmcgd2FzIGZvcm1hdHRlZCcpO1xyXG4gICAgICAgIHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDMsIDApO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXh0LCAnXCJcIlwiJywgJ1RleHQgaW5zaWRlIHN0cmluZyB3YXMgZm9ybWF0dGVkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdXaGl0ZXNwYWNlIGJlZm9yZSBjb21tZW50JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDQsIDApO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXh0LCAnICAjIGNvbW1lbnQnLCAnV2hpdGVzcGFjZSBiZWZvcmUgY29tbWVudCB3YXMgbm90IHByZXNlcnZlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnTm8gZm9ybWF0dGluZyBvZiBjb21tZW50JywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDUsIDApO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXh0LCAnIyB4PTEnLCAnVGV4dCBpbnNpZGUgY29tbWVudCB3YXMgZm9ybWF0dGVkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdGb3JtYXR0aW5nIGxpbmUgZW5kaW5nIGluIGNvbW1lbnQnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IHlpZWxkIGZvcm1hdEF0UG9zaXRpb24oNiwgMCk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHRleHQsICd4ICsgMSAgIyAnLCAnTGluZSBlbmRpbmcgaW4gY29tbWVudCB3YXMgbm90IGZvcm1hdHRlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRm9ybWF0dGluZyBsaW5lIHdpdGggQCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCB0ZXh0ID0geWllbGQgZm9ybWF0QXRQb3NpdGlvbig3LCAwKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGV4dCwgJ0B4JywgJ0xpbmUgd2l0aCBAIHdhcyByZWZvcm1hdHRlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVzdCgnRm9ybWF0dGluZyBsaW5lIHdpdGggQCcsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCB0ZXh0ID0geWllbGQgZm9ybWF0QXRQb3NpdGlvbig4LCAwKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGV4dCwgJ3gueScsICdMaW5lIGVuZGluZyB3aXRoIHBlcmlvZCB3YXMgcmVmb3JtYXR0ZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Zvcm1hdHRpbmcgbGluZSB3aXRoIHVua25vd24gbmVpZ2hib3JpbmcgdG9rZW5zJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDksIDApO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXh0LCAnaWYgeCA8PSAxOicsICdMaW5lIHdpdGggdW5rbm93biBuZWlnaGJvcmluZyB0b2tlbnMgd2FzIG5vdCBmb3JtYXR0ZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Zvcm1hdHRpbmcgbGluZSB3aXRoIHVua25vd24gbmVpZ2hib3JpbmcgdG9rZW5zJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDEwLCAwKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGV4dCwgJ2lmIDEgPD0geDonLCAnTGluZSB3aXRoIHVua25vd24gbmVpZ2hib3JpbmcgdG9rZW5zIHdhcyBub3QgZm9ybWF0dGVkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdGb3JtYXR0aW5nIG1ldGhvZCBkZWZpbml0aW9uIHdpdGggYXJndW1lbnRzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDExLCAwKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGV4dCwgJ2RlZiBfX2luaXRfXyhzZWxmLCBhZ2U9MjMpJywgJ01ldGhvZCBkZWZpbml0aW9uIHdpdGggYXJndW1lbnRzIHdhcyBub3QgZm9ybWF0dGVkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdGb3JtYXR0aW5nIHNwYWNlIGFmdGVyIG9wZW4gYnJhY2UnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dCA9IHlpZWxkIGZvcm1hdEF0UG9zaXRpb24oMTIsIDApO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbCh0ZXh0LCAnd2hpbGUgKDEpJywgJ1NwYWNlIGFmdGVyIG9wZW4gYnJhY2Ugd2FzIG5vdCBmb3JtYXR0ZWQnKTtcclxuICAgIH0pKTtcclxuICAgIHRlc3QoJ0Zvcm1hdHRpbmcgbGluZSBlbmRpbmcgaW4gc3RyaW5nJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHQgPSB5aWVsZCBmb3JtYXRBdFBvc2l0aW9uKDEzLCAwKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwodGV4dCwgJ3ggKyBcIlwiXCInLCAnTGluZSBlbmRpbmcgaW4gbXVsdGlsaW5lIHN0cmluZyB3YXMgbm90IGZvcm1hdHRlZCcpO1xyXG4gICAgfSkpO1xyXG4gICAgZnVuY3Rpb24gZm9ybWF0QXRQb3NpdGlvbihsaW5lLCBjaGFyYWN0ZXIpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICBjb25zdCBlZGl0cyA9IHlpZWxkIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgndnNjb2RlLmV4ZWN1dGVGb3JtYXRPblR5cGVQcm92aWRlcicsIGRvY3VtZW50LnVyaSwgbmV3IHZzY29kZS5Qb3NpdGlvbihsaW5lLCBjaGFyYWN0ZXIpLCAnXFxuJywgeyBpbnNlcnRTcGFjZXM6IHRydWUsIHRhYlNpemU6IDIgfSk7XHJcbiAgICAgICAgICAgIGlmIChlZGl0cykge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgZWRpdG9yLmVkaXQoYnVpbGRlciA9PiBlZGl0cy5mb3JFYWNoKGUgPT4gYnVpbGRlci5yZXBsYWNlKGUucmFuZ2UsIGUubmV3VGV4dCkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQubGluZUF0KGxpbmUgLSAxKS50ZXh0O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXh0ZW5zaW9uLm9uRW50ZXJGb3JtYXQudGVzdC5qcy5tYXAiXX0=