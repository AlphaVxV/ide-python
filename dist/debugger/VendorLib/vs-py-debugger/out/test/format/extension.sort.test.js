"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const assert = require("assert");

const chai_1 = require("chai");

const fs = require("fs");

const os_1 = require("os");

const path = require("path");

const vscode_1 = require("vscode");

const constants_1 = require("../../client/common/constants");

const importSortProvider_1 = require("../../client/providers/importSortProvider");

const common_1 = require("../common");

const initialize_1 = require("../initialize");

const serviceRegistry_1 = require("../unittests/serviceRegistry");

const sortingPath = path.join(__dirname, '..', '..', '..', 'src', 'test', 'pythonFiles', 'sorting');
const fileToFormatWithoutConfig = path.join(sortingPath, 'noconfig', 'before.py');
const originalFileToFormatWithoutConfig = path.join(sortingPath, 'noconfig', 'original.py');
const fileToFormatWithConfig = path.join(sortingPath, 'withconfig', 'before.py');
const originalFileToFormatWithConfig = path.join(sortingPath, 'withconfig', 'original.py');
const fileToFormatWithConfig1 = path.join(sortingPath, 'withconfig', 'before.1.py');
const originalFileToFormatWithConfig1 = path.join(sortingPath, 'withconfig', 'original.1.py'); // tslint:disable-next-line:max-func-body-length

suite('Sortingx', () => {
  let ioc;
  let sorter;
  const configTarget = initialize_1.IS_MULTI_ROOT_TEST ? vscode_1.ConfigurationTarget.WorkspaceFolder : vscode_1.ConfigurationTarget.Workspace;
  suiteSetup(initialize_1.initialize);
  suiteTeardown(() => __awaiter(void 0, void 0, void 0, function* () {
    fs.writeFileSync(fileToFormatWithConfig, fs.readFileSync(originalFileToFormatWithConfig));
    fs.writeFileSync(fileToFormatWithConfig1, fs.readFileSync(originalFileToFormatWithConfig1));
    fs.writeFileSync(fileToFormatWithoutConfig, fs.readFileSync(originalFileToFormatWithoutConfig));
    yield common_1.updateSetting('sortImports.args', [], vscode_1.Uri.file(sortingPath), configTarget);
    yield initialize_1.closeActiveWindows();
  }));
  setup(() => __awaiter(void 0, void 0, void 0, function* () {
    yield initialize_1.initializeTest();
    initializeDI();
    fs.writeFileSync(fileToFormatWithConfig, fs.readFileSync(originalFileToFormatWithConfig));
    fs.writeFileSync(fileToFormatWithoutConfig, fs.readFileSync(originalFileToFormatWithoutConfig));
    fs.writeFileSync(fileToFormatWithConfig1, fs.readFileSync(originalFileToFormatWithConfig1));
    yield common_1.updateSetting('sortImports.args', [], vscode_1.Uri.file(sortingPath), configTarget);
    yield initialize_1.closeActiveWindows();
    sorter = new importSortProvider_1.SortImportsEditingProvider(ioc.serviceContainer);
  }));
  teardown(() => __awaiter(void 0, void 0, void 0, function* () {
    ioc.dispose();
    yield initialize_1.closeActiveWindows();
  }));

  function initializeDI() {
    ioc = new serviceRegistry_1.UnitTestIocContainer();
    ioc.registerCommonTypes();
    ioc.registerVariableTypes();
    ioc.registerProcessTypes();
  }

  test('Without Config', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode_1.workspace.openTextDocument(fileToFormatWithoutConfig);
    yield vscode_1.window.showTextDocument(textDocument);
    const edit = yield sorter.provideDocumentSortImportsEdits(textDocument.uri);
    chai_1.expect(edit.entries()).to.be.lengthOf(1);
    const edits = edit.entries()[0][1];
    assert.equal(edits.filter(value => value.newText === os_1.EOL && value.range.isEqual(new vscode_1.Range(2, 0, 2, 0))).length, 1, 'EOL not found');
    assert.equal(edits.filter(value => value.newText === '' && value.range.isEqual(new vscode_1.Range(3, 0, 4, 0))).length, 1, '"" not found');
    assert.equal(edits.filter(value => value.newText === `from rope.base import libutils${os_1.EOL}from rope.refactor.extract import ExtractMethod, ExtractVariable${os_1.EOL}from rope.refactor.rename import Rename${os_1.EOL}` && value.range.isEqual(new vscode_1.Range(6, 0, 6, 0))).length, 1, 'Text not found');
    assert.equal(edits.filter(value => value.newText === '' && value.range.isEqual(new vscode_1.Range(13, 0, 18, 0))).length, 1, '"" not found');
  }));
  test('Without Config (via Command)', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode_1.workspace.openTextDocument(fileToFormatWithoutConfig);
    const originalContent = textDocument.getText();
    yield vscode_1.window.showTextDocument(textDocument);
    yield vscode_1.commands.executeCommand(constants_1.Commands.Sort_Imports);
    assert.notEqual(originalContent, textDocument.getText(), 'Contents have not changed');
  }));
  test('With Config', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode_1.workspace.openTextDocument(fileToFormatWithConfig);
    yield vscode_1.window.showTextDocument(textDocument);
    const edit = yield sorter.provideDocumentSortImportsEdits(textDocument.uri);
    chai_1.expect(edit.entries()).to.be.lengthOf(1);
    const edits = edit.entries()[0][1];
    const newValue = `from third_party import lib2${os_1.EOL}from third_party import lib3${os_1.EOL}from third_party import lib4${os_1.EOL}from third_party import lib5${os_1.EOL}from third_party import lib6${os_1.EOL}from third_party import lib7${os_1.EOL}from third_party import lib8${os_1.EOL}from third_party import lib9${os_1.EOL}`;
    assert.equal(edits.filter(value => value.newText === newValue && value.range.isEqual(new vscode_1.Range(0, 0, 3, 0))).length, 1, 'New Text not found');
  }));
  test('With Config (via Command)', () => __awaiter(void 0, void 0, void 0, function* () {
    const textDocument = yield vscode_1.workspace.openTextDocument(fileToFormatWithConfig);
    const originalContent = textDocument.getText();
    yield vscode_1.window.showTextDocument(textDocument);
    yield vscode_1.commands.executeCommand(constants_1.Commands.Sort_Imports);
    assert.notEqual(originalContent, textDocument.getText(), 'Contents have not changed');
  }));
  test('With Changes and Config in Args', () => __awaiter(void 0, void 0, void 0, function* () {
    yield common_1.updateSetting('sortImports.args', ['-sp', path.join(sortingPath, 'withconfig')], vscode_1.Uri.file(sortingPath), vscode_1.ConfigurationTarget.Workspace);
    const textDocument = yield vscode_1.workspace.openTextDocument(fileToFormatWithConfig);
    const editor = yield vscode_1.window.showTextDocument(textDocument);
    yield editor.edit(builder => {
      builder.insert(new vscode_1.Position(0, 0), `from third_party import lib0${os_1.EOL}`);
    });
    const edit = yield sorter.provideDocumentSortImportsEdits(textDocument.uri);
    chai_1.expect(edit.entries()).to.be.lengthOf(1);
    const edits = edit.entries()[0][1];
    assert.notEqual(edits.length, 0, 'No edits');
  }));
  test('With Changes and Config in Args (via Command)', () => __awaiter(void 0, void 0, void 0, function* () {
    yield common_1.updateSetting('sortImports.args', ['-sp', path.join(sortingPath, 'withconfig')], vscode_1.Uri.file(sortingPath), configTarget);
    const textDocument = yield vscode_1.workspace.openTextDocument(fileToFormatWithConfig);
    const editor = yield vscode_1.window.showTextDocument(textDocument);
    yield editor.edit(builder => {
      builder.insert(new vscode_1.Position(0, 0), `from third_party import lib0${os_1.EOL}`);
    });
    const originalContent = textDocument.getText();
    yield vscode_1.commands.executeCommand(constants_1.Commands.Sort_Imports);
    assert.notEqual(originalContent, textDocument.getText(), 'Contents have not changed');
  }));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuc2lvbi5zb3J0LnRlc3QuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsImFzc2VydCIsInJlcXVpcmUiLCJjaGFpXzEiLCJmcyIsIm9zXzEiLCJwYXRoIiwidnNjb2RlXzEiLCJjb25zdGFudHNfMSIsImltcG9ydFNvcnRQcm92aWRlcl8xIiwiY29tbW9uXzEiLCJpbml0aWFsaXplXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsInNvcnRpbmdQYXRoIiwiam9pbiIsIl9fZGlybmFtZSIsImZpbGVUb0Zvcm1hdFdpdGhvdXRDb25maWciLCJvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhvdXRDb25maWciLCJmaWxlVG9Gb3JtYXRXaXRoQ29uZmlnIiwib3JpZ2luYWxGaWxlVG9Gb3JtYXRXaXRoQ29uZmlnIiwiZmlsZVRvRm9ybWF0V2l0aENvbmZpZzEiLCJvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhDb25maWcxIiwic3VpdGUiLCJpb2MiLCJzb3J0ZXIiLCJjb25maWdUYXJnZXQiLCJJU19NVUxUSV9ST09UX1RFU1QiLCJDb25maWd1cmF0aW9uVGFyZ2V0IiwiV29ya3NwYWNlRm9sZGVyIiwiV29ya3NwYWNlIiwic3VpdGVTZXR1cCIsImluaXRpYWxpemUiLCJzdWl0ZVRlYXJkb3duIiwid3JpdGVGaWxlU3luYyIsInJlYWRGaWxlU3luYyIsInVwZGF0ZVNldHRpbmciLCJVcmkiLCJmaWxlIiwiY2xvc2VBY3RpdmVXaW5kb3dzIiwic2V0dXAiLCJpbml0aWFsaXplVGVzdCIsImluaXRpYWxpemVESSIsIlNvcnRJbXBvcnRzRWRpdGluZ1Byb3ZpZGVyIiwic2VydmljZUNvbnRhaW5lciIsInRlYXJkb3duIiwiZGlzcG9zZSIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwicmVnaXN0ZXJDb21tb25UeXBlcyIsInJlZ2lzdGVyVmFyaWFibGVUeXBlcyIsInJlZ2lzdGVyUHJvY2Vzc1R5cGVzIiwidGVzdCIsInRleHREb2N1bWVudCIsIndvcmtzcGFjZSIsIm9wZW5UZXh0RG9jdW1lbnQiLCJ3aW5kb3ciLCJzaG93VGV4dERvY3VtZW50IiwiZWRpdCIsInByb3ZpZGVEb2N1bWVudFNvcnRJbXBvcnRzRWRpdHMiLCJ1cmkiLCJleHBlY3QiLCJlbnRyaWVzIiwidG8iLCJiZSIsImxlbmd0aE9mIiwiZWRpdHMiLCJlcXVhbCIsImZpbHRlciIsIm5ld1RleHQiLCJFT0wiLCJyYW5nZSIsImlzRXF1YWwiLCJSYW5nZSIsImxlbmd0aCIsIm9yaWdpbmFsQ29udGVudCIsImdldFRleHQiLCJjb21tYW5kcyIsImV4ZWN1dGVDb21tYW5kIiwiQ29tbWFuZHMiLCJTb3J0X0ltcG9ydHMiLCJub3RFcXVhbCIsIm5ld1ZhbHVlIiwiZWRpdG9yIiwiYnVpbGRlciIsImluc2VydCIsIlBvc2l0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxTQUFTLEdBQUksVUFBUSxTQUFLQSxTQUFkLElBQTRCLFVBQVVDLE9BQVYsRUFBbUJDLFVBQW5CLEVBQStCQyxDQUEvQixFQUFrQ0MsU0FBbEMsRUFBNkM7QUFDckYsU0FBTyxLQUFLRCxDQUFDLEtBQUtBLENBQUMsR0FBR0UsT0FBVCxDQUFOLEVBQXlCLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQ3ZELGFBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sSUFBVixDQUFlRixLQUFmLENBQUQsQ0FBSjtBQUE4QixPQUFwQyxDQUFxQyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxD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SCxHQVZvRSxDQUFqRSxDQUFKO0FBV0gsQ0F6RkksQ0FBTCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcbmNvbnN0IGNoYWlfMSA9IHJlcXVpcmUoXCJjaGFpXCIpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcclxuY29uc3Qgb3NfMSA9IHJlcXVpcmUoXCJvc1wiKTtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xyXG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xyXG5jb25zdCBpbXBvcnRTb3J0UHJvdmlkZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvcHJvdmlkZXJzL2ltcG9ydFNvcnRQcm92aWRlclwiKTtcclxuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uXCIpO1xyXG5jb25zdCBpbml0aWFsaXplXzEgPSByZXF1aXJlKFwiLi4vaW5pdGlhbGl6ZVwiKTtcclxuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi4vdW5pdHRlc3RzL3NlcnZpY2VSZWdpc3RyeVwiKTtcclxuY29uc3Qgc29ydGluZ1BhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nLCAnc3JjJywgJ3Rlc3QnLCAncHl0aG9uRmlsZXMnLCAnc29ydGluZycpO1xyXG5jb25zdCBmaWxlVG9Gb3JtYXRXaXRob3V0Q29uZmlnID0gcGF0aC5qb2luKHNvcnRpbmdQYXRoLCAnbm9jb25maWcnLCAnYmVmb3JlLnB5Jyk7XHJcbmNvbnN0IG9yaWdpbmFsRmlsZVRvRm9ybWF0V2l0aG91dENvbmZpZyA9IHBhdGguam9pbihzb3J0aW5nUGF0aCwgJ25vY29uZmlnJywgJ29yaWdpbmFsLnB5Jyk7XHJcbmNvbnN0IGZpbGVUb0Zvcm1hdFdpdGhDb25maWcgPSBwYXRoLmpvaW4oc29ydGluZ1BhdGgsICd3aXRoY29uZmlnJywgJ2JlZm9yZS5weScpO1xyXG5jb25zdCBvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhDb25maWcgPSBwYXRoLmpvaW4oc29ydGluZ1BhdGgsICd3aXRoY29uZmlnJywgJ29yaWdpbmFsLnB5Jyk7XHJcbmNvbnN0IGZpbGVUb0Zvcm1hdFdpdGhDb25maWcxID0gcGF0aC5qb2luKHNvcnRpbmdQYXRoLCAnd2l0aGNvbmZpZycsICdiZWZvcmUuMS5weScpO1xyXG5jb25zdCBvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhDb25maWcxID0gcGF0aC5qb2luKHNvcnRpbmdQYXRoLCAnd2l0aGNvbmZpZycsICdvcmlnaW5hbC4xLnB5Jyk7XHJcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtZnVuYy1ib2R5LWxlbmd0aFxyXG5zdWl0ZSgnU29ydGluZ3gnLCAoKSA9PiB7XHJcbiAgICBsZXQgaW9jO1xyXG4gICAgbGV0IHNvcnRlcjtcclxuICAgIGNvbnN0IGNvbmZpZ1RhcmdldCA9IGluaXRpYWxpemVfMS5JU19NVUxUSV9ST09UX1RFU1QgPyB2c2NvZGVfMS5Db25maWd1cmF0aW9uVGFyZ2V0LldvcmtzcGFjZUZvbGRlciA6IHZzY29kZV8xLkNvbmZpZ3VyYXRpb25UYXJnZXQuV29ya3NwYWNlO1xyXG4gICAgc3VpdGVTZXR1cChpbml0aWFsaXplXzEuaW5pdGlhbGl6ZSk7XHJcbiAgICBzdWl0ZVRlYXJkb3duKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVUb0Zvcm1hdFdpdGhDb25maWcsIGZzLnJlYWRGaWxlU3luYyhvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhDb25maWcpKTtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVUb0Zvcm1hdFdpdGhDb25maWcxLCBmcy5yZWFkRmlsZVN5bmMob3JpZ2luYWxGaWxlVG9Gb3JtYXRXaXRoQ29uZmlnMSkpO1xyXG4gICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZVRvRm9ybWF0V2l0aG91dENvbmZpZywgZnMucmVhZEZpbGVTeW5jKG9yaWdpbmFsRmlsZVRvRm9ybWF0V2l0aG91dENvbmZpZykpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3NvcnRJbXBvcnRzLmFyZ3MnLCBbXSwgdnNjb2RlXzEuVXJpLmZpbGUoc29ydGluZ1BhdGgpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5jbG9zZUFjdGl2ZVdpbmRvd3MoKTtcclxuICAgIH0pKTtcclxuICAgIHNldHVwKCgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICB5aWVsZCBpbml0aWFsaXplXzEuaW5pdGlhbGl6ZVRlc3QoKTtcclxuICAgICAgICBpbml0aWFsaXplREkoKTtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVUb0Zvcm1hdFdpdGhDb25maWcsIGZzLnJlYWRGaWxlU3luYyhvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhDb25maWcpKTtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVUb0Zvcm1hdFdpdGhvdXRDb25maWcsIGZzLnJlYWRGaWxlU3luYyhvcmlnaW5hbEZpbGVUb0Zvcm1hdFdpdGhvdXRDb25maWcpKTtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVUb0Zvcm1hdFdpdGhDb25maWcxLCBmcy5yZWFkRmlsZVN5bmMob3JpZ2luYWxGaWxlVG9Gb3JtYXRXaXRoQ29uZmlnMSkpO1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3NvcnRJbXBvcnRzLmFyZ3MnLCBbXSwgdnNjb2RlXzEuVXJpLmZpbGUoc29ydGluZ1BhdGgpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIHlpZWxkIGluaXRpYWxpemVfMS5jbG9zZUFjdGl2ZVdpbmRvd3MoKTtcclxuICAgICAgICBzb3J0ZXIgPSBuZXcgaW1wb3J0U29ydFByb3ZpZGVyXzEuU29ydEltcG9ydHNFZGl0aW5nUHJvdmlkZXIoaW9jLnNlcnZpY2VDb250YWluZXIpO1xyXG4gICAgfSkpO1xyXG4gICAgdGVhcmRvd24oKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGlvYy5kaXNwb3NlKCk7XHJcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZV8xLmNsb3NlQWN0aXZlV2luZG93cygpO1xyXG4gICAgfSkpO1xyXG4gICAgZnVuY3Rpb24gaW5pdGlhbGl6ZURJKCkge1xyXG4gICAgICAgIGlvYyA9IG5ldyBzZXJ2aWNlUmVnaXN0cnlfMS5Vbml0VGVzdElvY0NvbnRhaW5lcigpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlckNvbW1vblR5cGVzKCk7XHJcbiAgICAgICAgaW9jLnJlZ2lzdGVyVmFyaWFibGVUeXBlcygpO1xyXG4gICAgICAgIGlvYy5yZWdpc3RlclByb2Nlc3NUeXBlcygpO1xyXG4gICAgfVxyXG4gICAgdGVzdCgnV2l0aG91dCBDb25maWcnLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgdGV4dERvY3VtZW50ID0geWllbGQgdnNjb2RlXzEud29ya3NwYWNlLm9wZW5UZXh0RG9jdW1lbnQoZmlsZVRvRm9ybWF0V2l0aG91dENvbmZpZyk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlXzEud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICBjb25zdCBlZGl0ID0gKHlpZWxkIHNvcnRlci5wcm92aWRlRG9jdW1lbnRTb3J0SW1wb3J0c0VkaXRzKHRleHREb2N1bWVudC51cmkpKTtcclxuICAgICAgICBjaGFpXzEuZXhwZWN0KGVkaXQuZW50cmllcygpKS50by5iZS5sZW5ndGhPZigxKTtcclxuICAgICAgICBjb25zdCBlZGl0cyA9IGVkaXQuZW50cmllcygpWzBdWzFdO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChlZGl0cy5maWx0ZXIodmFsdWUgPT4gdmFsdWUubmV3VGV4dCA9PT0gb3NfMS5FT0wgJiYgdmFsdWUucmFuZ2UuaXNFcXVhbChuZXcgdnNjb2RlXzEuUmFuZ2UoMiwgMCwgMiwgMCkpKS5sZW5ndGgsIDEsICdFT0wgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGVkaXRzLmZpbHRlcih2YWx1ZSA9PiB2YWx1ZS5uZXdUZXh0ID09PSAnJyAmJiB2YWx1ZS5yYW5nZS5pc0VxdWFsKG5ldyB2c2NvZGVfMS5SYW5nZSgzLCAwLCA0LCAwKSkpLmxlbmd0aCwgMSwgJ1wiXCIgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGVkaXRzLmZpbHRlcih2YWx1ZSA9PiB2YWx1ZS5uZXdUZXh0ID09PSBgZnJvbSByb3BlLmJhc2UgaW1wb3J0IGxpYnV0aWxzJHtvc18xLkVPTH1mcm9tIHJvcGUucmVmYWN0b3IuZXh0cmFjdCBpbXBvcnQgRXh0cmFjdE1ldGhvZCwgRXh0cmFjdFZhcmlhYmxlJHtvc18xLkVPTH1mcm9tIHJvcGUucmVmYWN0b3IucmVuYW1lIGltcG9ydCBSZW5hbWUke29zXzEuRU9MfWAgJiYgdmFsdWUucmFuZ2UuaXNFcXVhbChuZXcgdnNjb2RlXzEuUmFuZ2UoNiwgMCwgNiwgMCkpKS5sZW5ndGgsIDEsICdUZXh0IG5vdCBmb3VuZCcpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChlZGl0cy5maWx0ZXIodmFsdWUgPT4gdmFsdWUubmV3VGV4dCA9PT0gJycgJiYgdmFsdWUucmFuZ2UuaXNFcXVhbChuZXcgdnNjb2RlXzEuUmFuZ2UoMTMsIDAsIDE4LCAwKSkpLmxlbmd0aCwgMSwgJ1wiXCIgbm90IGZvdW5kJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdXaXRob3V0IENvbmZpZyAodmlhIENvbW1hbmQpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZV8xLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVUb0Zvcm1hdFdpdGhvdXRDb25maWcpO1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IHRleHREb2N1bWVudC5nZXRUZXh0KCk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlXzEud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICB5aWVsZCB2c2NvZGVfMS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZChjb25zdGFudHNfMS5Db21tYW5kcy5Tb3J0X0ltcG9ydHMpO1xyXG4gICAgICAgIGFzc2VydC5ub3RFcXVhbChvcmlnaW5hbENvbnRlbnQsIHRleHREb2N1bWVudC5nZXRUZXh0KCksICdDb250ZW50cyBoYXZlIG5vdCBjaGFuZ2VkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdXaXRoIENvbmZpZycsICgpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCB0ZXh0RG9jdW1lbnQgPSB5aWVsZCB2c2NvZGVfMS53b3Jrc3BhY2Uub3BlblRleHREb2N1bWVudChmaWxlVG9Gb3JtYXRXaXRoQ29uZmlnKTtcclxuICAgICAgICB5aWVsZCB2c2NvZGVfMS53aW5kb3cuc2hvd1RleHREb2N1bWVudCh0ZXh0RG9jdW1lbnQpO1xyXG4gICAgICAgIGNvbnN0IGVkaXQgPSAoeWllbGQgc29ydGVyLnByb3ZpZGVEb2N1bWVudFNvcnRJbXBvcnRzRWRpdHModGV4dERvY3VtZW50LnVyaSkpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoZWRpdC5lbnRyaWVzKCkpLnRvLmJlLmxlbmd0aE9mKDEpO1xyXG4gICAgICAgIGNvbnN0IGVkaXRzID0gZWRpdC5lbnRyaWVzKClbMF1bMV07XHJcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBgZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliMiR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliMyR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliNCR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliNSR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliNiR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliNyR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliOCR7b3NfMS5FT0x9ZnJvbSB0aGlyZF9wYXJ0eSBpbXBvcnQgbGliOSR7b3NfMS5FT0x9YDtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoZWRpdHMuZmlsdGVyKHZhbHVlID0+IHZhbHVlLm5ld1RleHQgPT09IG5ld1ZhbHVlICYmIHZhbHVlLnJhbmdlLmlzRXF1YWwobmV3IHZzY29kZV8xLlJhbmdlKDAsIDAsIDMsIDApKSkubGVuZ3RoLCAxLCAnTmV3IFRleHQgbm90IGZvdW5kJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdXaXRoIENvbmZpZyAodmlhIENvbW1hbmQpJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZV8xLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVUb0Zvcm1hdFdpdGhDb25maWcpO1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IHRleHREb2N1bWVudC5nZXRUZXh0KCk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlXzEud2luZG93LnNob3dUZXh0RG9jdW1lbnQodGV4dERvY3VtZW50KTtcclxuICAgICAgICB5aWVsZCB2c2NvZGVfMS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZChjb25zdGFudHNfMS5Db21tYW5kcy5Tb3J0X0ltcG9ydHMpO1xyXG4gICAgICAgIGFzc2VydC5ub3RFcXVhbChvcmlnaW5hbENvbnRlbnQsIHRleHREb2N1bWVudC5nZXRUZXh0KCksICdDb250ZW50cyBoYXZlIG5vdCBjaGFuZ2VkJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdXaXRoIENoYW5nZXMgYW5kIENvbmZpZyBpbiBBcmdzJywgKCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLnVwZGF0ZVNldHRpbmcoJ3NvcnRJbXBvcnRzLmFyZ3MnLCBbJy1zcCcsIHBhdGguam9pbihzb3J0aW5nUGF0aCwgJ3dpdGhjb25maWcnKV0sIHZzY29kZV8xLlVyaS5maWxlKHNvcnRpbmdQYXRoKSwgdnNjb2RlXzEuQ29uZmlndXJhdGlvblRhcmdldC5Xb3Jrc3BhY2UpO1xyXG4gICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZV8xLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVUb0Zvcm1hdFdpdGhDb25maWcpO1xyXG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHlpZWxkIHZzY29kZV8xLndpbmRvdy5zaG93VGV4dERvY3VtZW50KHRleHREb2N1bWVudCk7XHJcbiAgICAgICAgeWllbGQgZWRpdG9yLmVkaXQoYnVpbGRlciA9PiB7XHJcbiAgICAgICAgICAgIGJ1aWxkZXIuaW5zZXJ0KG5ldyB2c2NvZGVfMS5Qb3NpdGlvbigwLCAwKSwgYGZyb20gdGhpcmRfcGFydHkgaW1wb3J0IGxpYjAke29zXzEuRU9MfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IGVkaXQgPSAoeWllbGQgc29ydGVyLnByb3ZpZGVEb2N1bWVudFNvcnRJbXBvcnRzRWRpdHModGV4dERvY3VtZW50LnVyaSkpO1xyXG4gICAgICAgIGNoYWlfMS5leHBlY3QoZWRpdC5lbnRyaWVzKCkpLnRvLmJlLmxlbmd0aE9mKDEpO1xyXG4gICAgICAgIGNvbnN0IGVkaXRzID0gZWRpdC5lbnRyaWVzKClbMF1bMV07XHJcbiAgICAgICAgYXNzZXJ0Lm5vdEVxdWFsKGVkaXRzLmxlbmd0aCwgMCwgJ05vIGVkaXRzJyk7XHJcbiAgICB9KSk7XHJcbiAgICB0ZXN0KCdXaXRoIENoYW5nZXMgYW5kIENvbmZpZyBpbiBBcmdzICh2aWEgQ29tbWFuZCknLCAoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgeWllbGQgY29tbW9uXzEudXBkYXRlU2V0dGluZygnc29ydEltcG9ydHMuYXJncycsIFsnLXNwJywgcGF0aC5qb2luKHNvcnRpbmdQYXRoLCAnd2l0aGNvbmZpZycpXSwgdnNjb2RlXzEuVXJpLmZpbGUoc29ydGluZ1BhdGgpLCBjb25maWdUYXJnZXQpO1xyXG4gICAgICAgIGNvbnN0IHRleHREb2N1bWVudCA9IHlpZWxkIHZzY29kZV8xLndvcmtzcGFjZS5vcGVuVGV4dERvY3VtZW50KGZpbGVUb0Zvcm1hdFdpdGhDb25maWcpO1xyXG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHlpZWxkIHZzY29kZV8xLndpbmRvdy5zaG93VGV4dERvY3VtZW50KHRleHREb2N1bWVudCk7XHJcbiAgICAgICAgeWllbGQgZWRpdG9yLmVkaXQoYnVpbGRlciA9PiB7XHJcbiAgICAgICAgICAgIGJ1aWxkZXIuaW5zZXJ0KG5ldyB2c2NvZGVfMS5Qb3NpdGlvbigwLCAwKSwgYGZyb20gdGhpcmRfcGFydHkgaW1wb3J0IGxpYjAke29zXzEuRU9MfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IHRleHREb2N1bWVudC5nZXRUZXh0KCk7XHJcbiAgICAgICAgeWllbGQgdnNjb2RlXzEuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoY29uc3RhbnRzXzEuQ29tbWFuZHMuU29ydF9JbXBvcnRzKTtcclxuICAgICAgICBhc3NlcnQubm90RXF1YWwob3JpZ2luYWxDb250ZW50LCB0ZXh0RG9jdW1lbnQuZ2V0VGV4dCgpLCAnQ29udGVudHMgaGF2ZSBub3QgY2hhbmdlZCcpO1xyXG4gICAgfSkpO1xyXG59KTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXh0ZW5zaW9uLnNvcnQudGVzdC5qcy5tYXAiXX0=