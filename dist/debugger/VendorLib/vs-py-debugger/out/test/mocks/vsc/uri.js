/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var vscUri;

(function (vscUri) {
  const platform = {
    isWindows: /^win/.test(process.platform)
  }; // tslint:disable:all

  function _encode(ch) {
    return '%' + ch.charCodeAt(0).toString(16).toUpperCase();
  } // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent


  function encodeURIComponent2(str) {
    return encodeURIComponent(str).replace(/[!'()*]/g, _encode);
  }

  function encodeNoop(str) {
    return str.replace(/[#?]/, _encode);
  }

  const _schemePattern = /^\w[\w\d+.-]*$/;
  const _singleSlashStart = /^\//;
  const _doubleSlashStart = /^\/\//;

  function _validateUri(ret) {
    // scheme, https://tools.ietf.org/html/rfc3986#section-3.1
    // ALPHA *( ALPHA / DIGIT / "+" / "-" / "." )
    if (ret.scheme && !_schemePattern.test(ret.scheme)) {
      throw new Error('[UriError]: Scheme contains illegal characters.');
    } // path, http://tools.ietf.org/html/rfc3986#section-3.3
    // If a URI contains an authority component, then the path component
    // must either be empty or begin with a slash ("/") character.  If a URI
    // does not contain an authority component, then the path cannot begin
    // with two slash characters ("//").


    if (ret.path) {
      if (ret.authority) {
        if (!_singleSlashStart.test(ret.path)) {
          throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character');
        }
      } else {
        if (_doubleSlashStart.test(ret.path)) {
          throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")');
        }
      }
    }
  }

  const _empty = '';
  const _slash = '/';
  const _regexp = /^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;
  const _driveLetterPath = /^\/[a-zA-Z]:/;
  const _upperCaseDrive = /^(\/)?([A-Z]:)/;
  const _driveLetter = /^[a-zA-Z]:/;
  /**
   * Uniform Resource Identifier (URI) http://tools.ietf.org/html/rfc3986.
   * This class is a simple parser which creates the basic component paths
   * (http://tools.ietf.org/html/rfc3986#section-3) with minimal validation
   * and encoding.
   *
   *       foo://example.com:8042/over/there?name=ferret#nose
   *       \_/   \______________/\_________/ \_________/ \__/
   *        |           |            |            |        |
   *     scheme     authority       path        query   fragment
   *        |   _____________________|__
   *       / \ /                        \
   *       urn:example:animal:ferret:nose
   *
   *
   */

  class URI {
    /**
     * @internal
     */
    constructor(schemeOrData, authority, path, query, fragment) {
      if (typeof schemeOrData === 'object') {
        this.scheme = schemeOrData.scheme || _empty;
        this.authority = schemeOrData.authority || _empty;
        this.path = schemeOrData.path || _empty;
        this.query = schemeOrData.query || _empty;
        this.fragment = schemeOrData.fragment || _empty; // no validation because it's this URI
        // that creates uri components.
        // _validateUri(this);
      } else {
        this.scheme = schemeOrData || _empty;
        this.authority = authority || _empty;
        this.path = path || _empty;
        this.query = query || _empty;
        this.fragment = fragment || _empty;

        _validateUri(this);
      }
    }

    static isUri(thing) {
      if (thing instanceof URI) {
        return true;
      }

      if (!thing) {
        return false;
      }

      return typeof thing.authority === 'string' && typeof thing.fragment === 'string' && typeof thing.path === 'string' && typeof thing.query === 'string' && typeof thing.scheme === 'string';
    } // ---- filesystem path -----------------------

    /**
     * Returns a string representing the corresponding file system path of this URI.
     * Will handle UNC paths and normalize windows drive letters to lower-case. Also
     * uses the platform specific path separator. Will *not* validate the path for
     * invalid characters and semantics. Will *not* look at the scheme of this URI.
     */


    get fsPath() {
      return _makeFsPath(this);
    } // ---- modify to new -------------------------


    with(change) {
      if (!change) {
        return this;
      }

      let {
        scheme,
        authority,
        path,
        query,
        fragment
      } = change;

      if (scheme === void 0) {
        scheme = this.scheme;
      } else if (scheme === null) {
        scheme = _empty;
      }

      if (authority === void 0) {
        authority = this.authority;
      } else if (authority === null) {
        authority = _empty;
      }

      if (path === void 0) {
        path = this.path;
      } else if (path === null) {
        path = _empty;
      }

      if (query === void 0) {
        query = this.query;
      } else if (query === null) {
        query = _empty;
      }

      if (fragment === void 0) {
        fragment = this.fragment;
      } else if (fragment === null) {
        fragment = _empty;
      }

      if (scheme === this.scheme && authority === this.authority && path === this.path && query === this.query && fragment === this.fragment) {
        return this;
      }

      return new _URI(scheme, authority, path, query, fragment);
    } // ---- parse & validate ------------------------


    static parse(value) {
      const match = _regexp.exec(value);

      if (!match) {
        return new _URI(_empty, _empty, _empty, _empty, _empty);
      }

      return new _URI(match[2] || _empty, decodeURIComponent(match[4] || _empty), decodeURIComponent(match[5] || _empty), decodeURIComponent(match[7] || _empty), decodeURIComponent(match[9] || _empty));
    }

    static file(path) {
      let authority = _empty; // normalize to fwd-slashes on windows,
      // on other systems bwd-slashes are valid
      // filename character, eg /f\oo/ba\r.txt

      if (platform.isWindows) {
        path = path.replace(/\\/g, _slash);
      } // check for authority as used in UNC shares
      // or use the path as given


      if (path[0] === _slash && path[1] === _slash) {
        let idx = path.indexOf(_slash, 2);

        if (idx === -1) {
          authority = path.substring(2);
          path = _slash;
        } else {
          authority = path.substring(2, idx);
          path = path.substring(idx) || _slash;
        }
      } // Ensure that path starts with a slash
      // or that it is at least a slash


      if (_driveLetter.test(path)) {
        path = _slash + path;
      } else if (path[0] !== _slash) {
        // tricky -> makes invalid paths
        // but otherwise we have to stop
        // allowing relative paths...
        path = _slash + path;
      }

      return new _URI('file', authority, path, _empty, _empty);
    }

    static from(components) {
      return new _URI(components.scheme, components.authority, components.path, components.query, components.fragment);
    } // ---- printing/externalize ---------------------------

    /**
     *
     * @param skipEncoding Do not encode the result, default is `false`
     */


    toString(skipEncoding = false) {
      return _asFormatted(this, skipEncoding);
    }

    toJSON() {
      const res = {
        $mid: 1,
        fsPath: this.fsPath,
        external: this.toString()
      };

      if (this.path) {
        res.path = this.path;
      }

      if (this.scheme) {
        res.scheme = this.scheme;
      }

      if (this.authority) {
        res.authority = this.authority;
      }

      if (this.query) {
        res.query = this.query;
      }

      if (this.fragment) {
        res.fragment = this.fragment;
      }

      return res;
    }

    static revive(data) {
      if (!data) {
        return data;
      } else if (data instanceof URI) {
        return data;
      } else {
        let result = new _URI(data);
        result._fsPath = data.fsPath;
        result._formatted = data.external;
        return result;
      }
    }

  }

  vscUri.URI = URI; // tslint:disable-next-line:class-name

  class _URI extends URI {
    constructor() {
      super(...arguments);
      this._formatted = null;
      this._fsPath = null;
    }

    get fsPath() {
      if (!this._fsPath) {
        this._fsPath = _makeFsPath(this);
      }

      return this._fsPath;
    }

    toString(skipEncoding = false) {
      if (!skipEncoding) {
        if (!this._formatted) {
          this._formatted = _asFormatted(this, false);
        }

        return this._formatted;
      } else {
        // we don't cache that
        return _asFormatted(this, true);
      }
    }

  }
  /**
   * Compute `fsPath` for the given uri
   * @param uri
   */


  function _makeFsPath(uri) {
    let value;

    if (uri.authority && uri.path && uri.scheme === 'file') {
      // unc path: file://shares/c$/far/boo
      value = `//${uri.authority}${uri.path}`;
    } else if (_driveLetterPath.test(uri.path)) {
      // windows drive letter: file:///c:/far/boo
      value = uri.path[1].toLowerCase() + uri.path.substr(2);
    } else {
      // other path
      value = uri.path;
    }

    if (platform.isWindows) {
      value = value.replace(/\//g, '\\');
    }

    return value;
  }
  /**
   * Create the external version of a uri
   */


  function _asFormatted(uri, skipEncoding) {
    const encoder = !skipEncoding ? encodeURIComponent2 : encodeNoop;
    const parts = [];
    let {
      scheme,
      authority,
      path,
      query,
      fragment
    } = uri;

    if (scheme) {
      parts.push(scheme, ':');
    }

    if (authority || scheme === 'file') {
      parts.push('//');
    }

    if (authority) {
      let idx = authority.indexOf('@');

      if (idx !== -1) {
        const userinfo = authority.substr(0, idx);
        authority = authority.substr(idx + 1);
        idx = userinfo.indexOf(':');

        if (idx === -1) {
          parts.push(encoder(userinfo));
        } else {
          parts.push(encoder(userinfo.substr(0, idx)), ':', encoder(userinfo.substr(idx + 1)));
        }

        parts.push('@');
      }

      authority = authority.toLowerCase();
      idx = authority.indexOf(':');

      if (idx === -1) {
        parts.push(encoder(authority));
      } else {
        parts.push(encoder(authority.substr(0, idx)), authority.substr(idx));
      }
    }

    if (path) {
      // lower-case windows drive letters in /C:/fff or C:/fff
      const m = _upperCaseDrive.exec(path);

      if (m) {
        if (m[1]) {
          path = '/' + m[2].toLowerCase() + path.substr(3); // "/c:".length === 3
        } else {
          path = m[2].toLowerCase() + path.substr(2); // // "c:".length === 2
        }
      } // encode every segement but not slashes
      // make sure that # and ? are always encoded
      // when occurring in paths - otherwise the result
      // cannot be parsed back again


      let lastIdx = 0;

      while (true) {
        let idx = path.indexOf(_slash, lastIdx);

        if (idx === -1) {
          parts.push(encoder(path.substring(lastIdx)));
          break;
        }

        parts.push(encoder(path.substring(lastIdx, idx)), _slash);
        lastIdx = idx + 1;
      }
    }

    if (query) {
      parts.push('?', encoder(query));
    }

    if (fragment) {
      parts.push('#', encoder(fragment));
    }

    return parts.join(_empty);
  }
})(vscUri = exports.vscUri || (exports.vscUri = {}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVyaS5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInZzY1VyaSIsInBsYXRmb3JtIiwiaXNXaW5kb3dzIiwidGVzdCIsInByb2Nlc3MiLCJfZW5jb2RlIiwiY2giLCJjaGFyQ29kZUF0IiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImVuY29kZVVSSUNvbXBvbmVudDIiLCJzdHIiLCJlbmNvZGVVUklDb21wb25lbnQiLCJyZXBsYWNlIiwiZW5jb2RlTm9vcCIsIl9zY2hlbWVQYXR0ZXJuIiwiX3NpbmdsZVNsYXNoU3RhcnQiLCJfZG91YmxlU2xhc2hTdGFydCIsIl92YWxpZGF0ZVVyaSIsInJldCIsInNjaGVtZSIsIkVycm9yIiwicGF0aCIsImF1dGhvcml0eSIsIl9lbXB0eSIsIl9zbGFzaCIsIl9yZWdleHAiLCJfZHJpdmVMZXR0ZXJQYXRoIiwiX3VwcGVyQ2FzZURyaXZlIiwiX2RyaXZlTGV0dGVyIiwiVVJJIiwiY29uc3RydWN0b3IiLCJzY2hlbWVPckRhdGEiLCJxdWVyeSIsImZyYWdtZW50IiwiaXNVcmkiLCJ0aGluZyIsImZzUGF0aCIsIl9tYWtlRnNQYXRoIiwid2l0aCIsImNoYW5nZSIsIl9VUkkiLCJwYXJzZSIsIm1hdGNoIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsImZpbGUiLCJpZHgiLCJpbmRleE9mIiwic3Vic3RyaW5nIiwiZnJvbSIsImNvbXBvbmVudHMiLCJza2lwRW5jb2RpbmciLCJfYXNGb3JtYXR0ZWQiLCJ0b0pTT04iLCJyZXMiLCIkbWlkIiwiZXh0ZXJuYWwiLCJyZXZpdmUiLCJkYXRhIiwicmVzdWx0IiwiX2ZzUGF0aCIsIl9mb3JtYXR0ZWQiLCJhcmd1bWVudHMiLCJ1cmkiLCJ0b0xvd2VyQ2FzZSIsInN1YnN0ciIsImVuY29kZXIiLCJwYXJ0cyIsInB1c2giLCJ1c2VyaW5mbyIsIm0iLCJsYXN0SWR4Iiwiam9pbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFD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QUFDLENBQWIsRUFBZ0I7QUFDWnFCLFVBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXRixPQUFPLENBQUM3QyxJQUFJLENBQUMyQixTQUFMLENBQWV1QixPQUFmLENBQUQsQ0FBbEI7QUFDQTtBQUNIOztBQUNESixRQUFBQSxLQUFLLENBQUNDLElBQU4sQ0FBV0YsT0FBTyxDQUFDN0MsSUFBSSxDQUFDMkIsU0FBTCxDQUFldUIsT0FBZixFQUF3QnpCLEdBQXhCLENBQUQsQ0FBbEIsRUFBa0R0QixNQUFsRDtBQUNBK0MsUUFBQUEsT0FBTyxHQUFHekIsR0FBRyxHQUFHLENBQWhCO0FBQ0g7QUFDSjs7QUFDRCxRQUFJZCxLQUFKLEVBQVc7QUFDUG1DLE1BQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLEdBQVgsRUFBZ0JGLE9BQU8sQ0FBQ2xDLEtBQUQsQ0FBdkI7QUFDSDs7QUFDRCxRQUFJQyxRQUFKLEVBQWM7QUFDVmtDLE1BQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLEdBQVgsRUFBZ0JGLE9BQU8sQ0FBQ2pDLFFBQUQsQ0FBdkI7QUFDSDs7QUFDRCxXQUFPa0MsS0FBSyxDQUFDSyxJQUFOLENBQVdqRCxNQUFYLENBQVA7QUFDSDtBQUNKLENBalhELEVBaVhHeEIsTUFBTSxHQUFHRixPQUFPLENBQUNFLE1BQVIsS0FBbUJGLE9BQU8sQ0FBQ0UsTUFBUixHQUFpQixFQUFwQyxDQWpYWiIsInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXHJcbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xyXG4ndXNlIHN0cmljdCc7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIHZzY1VyaTtcclxuKGZ1bmN0aW9uICh2c2NVcmkpIHtcclxuICAgIGNvbnN0IHBsYXRmb3JtID0ge1xyXG4gICAgICAgIGlzV2luZG93czogL153aW4vLnRlc3QocHJvY2Vzcy5wbGF0Zm9ybSlcclxuICAgIH07XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZTphbGxcclxuICAgIGZ1bmN0aW9uIF9lbmNvZGUoY2gpIHtcclxuICAgICAgICByZXR1cm4gJyUnICsgY2guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTtcclxuICAgIH1cclxuICAgIC8vIHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9lbmNvZGVVUklDb21wb25lbnRcclxuICAgIGZ1bmN0aW9uIGVuY29kZVVSSUNvbXBvbmVudDIoc3RyKSB7XHJcbiAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHIpLnJlcGxhY2UoL1shJygpKl0vZywgX2VuY29kZSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBlbmNvZGVOb29wKHN0cikge1xyXG4gICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvWyM/XS8sIF9lbmNvZGUpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgX3NjaGVtZVBhdHRlcm4gPSAvXlxcd1tcXHdcXGQrLi1dKiQvO1xyXG4gICAgY29uc3QgX3NpbmdsZVNsYXNoU3RhcnQgPSAvXlxcLy87XHJcbiAgICBjb25zdCBfZG91YmxlU2xhc2hTdGFydCA9IC9eXFwvXFwvLztcclxuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZVVyaShyZXQpIHtcclxuICAgICAgICAvLyBzY2hlbWUsIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzOTg2I3NlY3Rpb24tMy4xXHJcbiAgICAgICAgLy8gQUxQSEEgKiggQUxQSEEgLyBESUdJVCAvIFwiK1wiIC8gXCItXCIgLyBcIi5cIiApXHJcbiAgICAgICAgaWYgKHJldC5zY2hlbWUgJiYgIV9zY2hlbWVQYXR0ZXJuLnRlc3QocmV0LnNjaGVtZSkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbVXJpRXJyb3JdOiBTY2hlbWUgY29udGFpbnMgaWxsZWdhbCBjaGFyYWN0ZXJzLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBwYXRoLCBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzOTg2I3NlY3Rpb24tMy4zXHJcbiAgICAgICAgLy8gSWYgYSBVUkkgY29udGFpbnMgYW4gYXV0aG9yaXR5IGNvbXBvbmVudCwgdGhlbiB0aGUgcGF0aCBjb21wb25lbnRcclxuICAgICAgICAvLyBtdXN0IGVpdGhlciBiZSBlbXB0eSBvciBiZWdpbiB3aXRoIGEgc2xhc2ggKFwiL1wiKSBjaGFyYWN0ZXIuICBJZiBhIFVSSVxyXG4gICAgICAgIC8vIGRvZXMgbm90IGNvbnRhaW4gYW4gYXV0aG9yaXR5IGNvbXBvbmVudCwgdGhlbiB0aGUgcGF0aCBjYW5ub3QgYmVnaW5cclxuICAgICAgICAvLyB3aXRoIHR3byBzbGFzaCBjaGFyYWN0ZXJzIChcIi8vXCIpLlxyXG4gICAgICAgIGlmIChyZXQucGF0aCkge1xyXG4gICAgICAgICAgICBpZiAocmV0LmF1dGhvcml0eSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFfc2luZ2xlU2xhc2hTdGFydC50ZXN0KHJldC5wYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW1VyaUVycm9yXTogSWYgYSBVUkkgY29udGFpbnMgYW4gYXV0aG9yaXR5IGNvbXBvbmVudCwgdGhlbiB0aGUgcGF0aCBjb21wb25lbnQgbXVzdCBlaXRoZXIgYmUgZW1wdHkgb3IgYmVnaW4gd2l0aCBhIHNsYXNoIChcIi9cIikgY2hhcmFjdGVyJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2RvdWJsZVNsYXNoU3RhcnQudGVzdChyZXQucGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tVcmlFcnJvcl06IElmIGEgVVJJIGRvZXMgbm90IGNvbnRhaW4gYW4gYXV0aG9yaXR5IGNvbXBvbmVudCwgdGhlbiB0aGUgcGF0aCBjYW5ub3QgYmVnaW4gd2l0aCB0d28gc2xhc2ggY2hhcmFjdGVycyAoXCIvL1wiKScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgX2VtcHR5ID0gJyc7XHJcbiAgICBjb25zdCBfc2xhc2ggPSAnLyc7XHJcbiAgICBjb25zdCBfcmVnZXhwID0gL14oKFteOi8/I10rPyk6KT8oXFwvXFwvKFteLz8jXSopKT8oW14/I10qKShcXD8oW14jXSopKT8oIyguKikpPy87XHJcbiAgICBjb25zdCBfZHJpdmVMZXR0ZXJQYXRoID0gL15cXC9bYS16QS1aXTovO1xyXG4gICAgY29uc3QgX3VwcGVyQ2FzZURyaXZlID0gL14oXFwvKT8oW0EtWl06KS87XHJcbiAgICBjb25zdCBfZHJpdmVMZXR0ZXIgPSAvXlthLXpBLVpdOi87XHJcbiAgICAvKipcclxuICAgICAqIFVuaWZvcm0gUmVzb3VyY2UgSWRlbnRpZmllciAoVVJJKSBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzOTg2LlxyXG4gICAgICogVGhpcyBjbGFzcyBpcyBhIHNpbXBsZSBwYXJzZXIgd2hpY2ggY3JlYXRlcyB0aGUgYmFzaWMgY29tcG9uZW50IHBhdGhzXHJcbiAgICAgKiAoaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzk4NiNzZWN0aW9uLTMpIHdpdGggbWluaW1hbCB2YWxpZGF0aW9uXHJcbiAgICAgKiBhbmQgZW5jb2RpbmcuXHJcbiAgICAgKlxyXG4gICAgICogICAgICAgZm9vOi8vZXhhbXBsZS5jb206ODA0Mi9vdmVyL3RoZXJlP25hbWU9ZmVycmV0I25vc2VcclxuICAgICAqICAgICAgIFxcXy8gICBcXF9fX19fX19fX19fX19fL1xcX19fX19fX19fLyBcXF9fX19fX19fXy8gXFxfXy9cclxuICAgICAqICAgICAgICB8ICAgICAgICAgICB8ICAgICAgICAgICAgfCAgICAgICAgICAgIHwgICAgICAgIHxcclxuICAgICAqICAgICBzY2hlbWUgICAgIGF1dGhvcml0eSAgICAgICBwYXRoICAgICAgICBxdWVyeSAgIGZyYWdtZW50XHJcbiAgICAgKiAgICAgICAgfCAgIF9fX19fX19fX19fX19fX19fX19fX3xfX1xyXG4gICAgICogICAgICAgLyBcXCAvICAgICAgICAgICAgICAgICAgICAgICAgXFxcclxuICAgICAqICAgICAgIHVybjpleGFtcGxlOmFuaW1hbDpmZXJyZXQ6bm9zZVxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGNsYXNzIFVSSSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQGludGVybmFsXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc3RydWN0b3Ioc2NoZW1lT3JEYXRhLCBhdXRob3JpdHksIHBhdGgsIHF1ZXJ5LCBmcmFnbWVudCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNjaGVtZU9yRGF0YSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lID0gc2NoZW1lT3JEYXRhLnNjaGVtZSB8fCBfZW1wdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF1dGhvcml0eSA9IHNjaGVtZU9yRGF0YS5hdXRob3JpdHkgfHwgX2VtcHR5O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gc2NoZW1lT3JEYXRhLnBhdGggfHwgX2VtcHR5O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHNjaGVtZU9yRGF0YS5xdWVyeSB8fCBfZW1wdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZyYWdtZW50ID0gc2NoZW1lT3JEYXRhLmZyYWdtZW50IHx8IF9lbXB0eTtcclxuICAgICAgICAgICAgICAgIC8vIG5vIHZhbGlkYXRpb24gYmVjYXVzZSBpdCdzIHRoaXMgVVJJXHJcbiAgICAgICAgICAgICAgICAvLyB0aGF0IGNyZWF0ZXMgdXJpIGNvbXBvbmVudHMuXHJcbiAgICAgICAgICAgICAgICAvLyBfdmFsaWRhdGVVcmkodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVtZSA9IHNjaGVtZU9yRGF0YSB8fCBfZW1wdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF1dGhvcml0eSA9IGF1dGhvcml0eSB8fCBfZW1wdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGggPSBwYXRoIHx8IF9lbXB0eTtcclxuICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeSB8fCBfZW1wdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZ21lbnQgfHwgX2VtcHR5O1xyXG4gICAgICAgICAgICAgICAgX3ZhbGlkYXRlVXJpKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXRpYyBpc1VyaSh0aGluZykge1xyXG4gICAgICAgICAgICBpZiAodGhpbmcgaW5zdGFuY2VvZiBVUkkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdGhpbmcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRoaW5nLmF1dGhvcml0eSA9PT0gJ3N0cmluZydcclxuICAgICAgICAgICAgICAgICYmIHR5cGVvZiB0aGluZy5mcmFnbWVudCA9PT0gJ3N0cmluZydcclxuICAgICAgICAgICAgICAgICYmIHR5cGVvZiB0aGluZy5wYXRoID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICAgICAgJiYgdHlwZW9mIHRoaW5nLnF1ZXJ5ID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICAgICAgJiYgdHlwZW9mIHRoaW5nLnNjaGVtZSA9PT0gJ3N0cmluZyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIC0tLS0gZmlsZXN5c3RlbSBwYXRoIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGNvcnJlc3BvbmRpbmcgZmlsZSBzeXN0ZW0gcGF0aCBvZiB0aGlzIFVSSS5cclxuICAgICAgICAgKiBXaWxsIGhhbmRsZSBVTkMgcGF0aHMgYW5kIG5vcm1hbGl6ZSB3aW5kb3dzIGRyaXZlIGxldHRlcnMgdG8gbG93ZXItY2FzZS4gQWxzb1xyXG4gICAgICAgICAqIHVzZXMgdGhlIHBsYXRmb3JtIHNwZWNpZmljIHBhdGggc2VwYXJhdG9yLiBXaWxsICpub3QqIHZhbGlkYXRlIHRoZSBwYXRoIGZvclxyXG4gICAgICAgICAqIGludmFsaWQgY2hhcmFjdGVycyBhbmQgc2VtYW50aWNzLiBXaWxsICpub3QqIGxvb2sgYXQgdGhlIHNjaGVtZSBvZiB0aGlzIFVSSS5cclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQgZnNQYXRoKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX21ha2VGc1BhdGgodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIC0tLS0gbW9kaWZ5IHRvIG5ldyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAgICAgd2l0aChjaGFuZ2UpIHtcclxuICAgICAgICAgICAgaWYgKCFjaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCB7IHNjaGVtZSwgYXV0aG9yaXR5LCBwYXRoLCBxdWVyeSwgZnJhZ21lbnQgfSA9IGNoYW5nZTtcclxuICAgICAgICAgICAgaWYgKHNjaGVtZSA9PT0gdm9pZCAwKSB7XHJcbiAgICAgICAgICAgICAgICBzY2hlbWUgPSB0aGlzLnNjaGVtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChzY2hlbWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHNjaGVtZSA9IF9lbXB0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYXV0aG9yaXR5ID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgICAgIGF1dGhvcml0eSA9IHRoaXMuYXV0aG9yaXR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGF1dGhvcml0eSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgYXV0aG9yaXR5ID0gX2VtcHR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwYXRoID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgICAgIHBhdGggPSB0aGlzLnBhdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAocGF0aCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcGF0aCA9IF9lbXB0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocXVlcnkgPT09IHZvaWQgMCkge1xyXG4gICAgICAgICAgICAgICAgcXVlcnkgPSB0aGlzLnF1ZXJ5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHF1ZXJ5ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBxdWVyeSA9IF9lbXB0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZnJhZ21lbnQgPT09IHZvaWQgMCkge1xyXG4gICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGZyYWdtZW50ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmcmFnbWVudCA9IF9lbXB0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc2NoZW1lID09PSB0aGlzLnNjaGVtZVxyXG4gICAgICAgICAgICAgICAgJiYgYXV0aG9yaXR5ID09PSB0aGlzLmF1dGhvcml0eVxyXG4gICAgICAgICAgICAgICAgJiYgcGF0aCA9PT0gdGhpcy5wYXRoXHJcbiAgICAgICAgICAgICAgICAmJiBxdWVyeSA9PT0gdGhpcy5xdWVyeVxyXG4gICAgICAgICAgICAgICAgJiYgZnJhZ21lbnQgPT09IHRoaXMuZnJhZ21lbnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgX1VSSShzY2hlbWUsIGF1dGhvcml0eSwgcGF0aCwgcXVlcnksIGZyYWdtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gLS0tLSBwYXJzZSAmIHZhbGlkYXRlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgICAgIHN0YXRpYyBwYXJzZSh2YWx1ZSkge1xyXG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IF9yZWdleHAuZXhlYyh2YWx1ZSk7XHJcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgX1VSSShfZW1wdHksIF9lbXB0eSwgX2VtcHR5LCBfZW1wdHksIF9lbXB0eSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBfVVJJKG1hdGNoWzJdIHx8IF9lbXB0eSwgZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzRdIHx8IF9lbXB0eSksIGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFs1XSB8fCBfZW1wdHkpLCBkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbN10gfHwgX2VtcHR5KSwgZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzldIHx8IF9lbXB0eSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0aWMgZmlsZShwYXRoKSB7XHJcbiAgICAgICAgICAgIGxldCBhdXRob3JpdHkgPSBfZW1wdHk7XHJcbiAgICAgICAgICAgIC8vIG5vcm1hbGl6ZSB0byBmd2Qtc2xhc2hlcyBvbiB3aW5kb3dzLFxyXG4gICAgICAgICAgICAvLyBvbiBvdGhlciBzeXN0ZW1zIGJ3ZC1zbGFzaGVzIGFyZSB2YWxpZFxyXG4gICAgICAgICAgICAvLyBmaWxlbmFtZSBjaGFyYWN0ZXIsIGVnIC9mXFxvby9iYVxcci50eHRcclxuICAgICAgICAgICAgaWYgKHBsYXRmb3JtLmlzV2luZG93cykge1xyXG4gICAgICAgICAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXFxcXC9nLCBfc2xhc2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBhdXRob3JpdHkgYXMgdXNlZCBpbiBVTkMgc2hhcmVzXHJcbiAgICAgICAgICAgIC8vIG9yIHVzZSB0aGUgcGF0aCBhcyBnaXZlblxyXG4gICAgICAgICAgICBpZiAocGF0aFswXSA9PT0gX3NsYXNoICYmIHBhdGhbMV0gPT09IF9zbGFzaCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGlkeCA9IHBhdGguaW5kZXhPZihfc2xhc2gsIDIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRob3JpdHkgPSBwYXRoLnN1YnN0cmluZygyKTtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoID0gX3NsYXNoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXR5ID0gcGF0aC5zdWJzdHJpbmcoMiwgaWR4KTtcclxuICAgICAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHJpbmcoaWR4KSB8fCBfc2xhc2g7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gRW5zdXJlIHRoYXQgcGF0aCBzdGFydHMgd2l0aCBhIHNsYXNoXHJcbiAgICAgICAgICAgIC8vIG9yIHRoYXQgaXQgaXMgYXQgbGVhc3QgYSBzbGFzaFxyXG4gICAgICAgICAgICBpZiAoX2RyaXZlTGV0dGVyLnRlc3QocGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIHBhdGggPSBfc2xhc2ggKyBwYXRoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhbMF0gIT09IF9zbGFzaCkge1xyXG4gICAgICAgICAgICAgICAgLy8gdHJpY2t5IC0+IG1ha2VzIGludmFsaWQgcGF0aHNcclxuICAgICAgICAgICAgICAgIC8vIGJ1dCBvdGhlcndpc2Ugd2UgaGF2ZSB0byBzdG9wXHJcbiAgICAgICAgICAgICAgICAvLyBhbGxvd2luZyByZWxhdGl2ZSBwYXRocy4uLlxyXG4gICAgICAgICAgICAgICAgcGF0aCA9IF9zbGFzaCArIHBhdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBfVVJJKCdmaWxlJywgYXV0aG9yaXR5LCBwYXRoLCBfZW1wdHksIF9lbXB0eSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXRpYyBmcm9tKGNvbXBvbmVudHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBfVVJJKGNvbXBvbmVudHMuc2NoZW1lLCBjb21wb25lbnRzLmF1dGhvcml0eSwgY29tcG9uZW50cy5wYXRoLCBjb21wb25lbnRzLnF1ZXJ5LCBjb21wb25lbnRzLmZyYWdtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gLS0tLSBwcmludGluZy9leHRlcm5hbGl6ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgICAgICAvKipcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSBza2lwRW5jb2RpbmcgRG8gbm90IGVuY29kZSB0aGUgcmVzdWx0LCBkZWZhdWx0IGlzIGBmYWxzZWBcclxuICAgICAgICAgKi9cclxuICAgICAgICB0b1N0cmluZyhza2lwRW5jb2RpbmcgPSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gX2FzRm9ybWF0dGVkKHRoaXMsIHNraXBFbmNvZGluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRvSlNPTigpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0ge1xyXG4gICAgICAgICAgICAgICAgJG1pZDogMSxcclxuICAgICAgICAgICAgICAgIGZzUGF0aDogdGhpcy5mc1BhdGgsXHJcbiAgICAgICAgICAgICAgICBleHRlcm5hbDogdGhpcy50b1N0cmluZygpLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYXRoKSB7XHJcbiAgICAgICAgICAgICAgICByZXMucGF0aCA9IHRoaXMucGF0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgIHJlcy5zY2hlbWUgPSB0aGlzLnNjaGVtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5hdXRob3JpdHkpIHtcclxuICAgICAgICAgICAgICAgIHJlcy5hdXRob3JpdHkgPSB0aGlzLmF1dGhvcml0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5xdWVyeSkge1xyXG4gICAgICAgICAgICAgICAgcmVzLnF1ZXJ5ID0gdGhpcy5xdWVyeTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5mcmFnbWVudCkge1xyXG4gICAgICAgICAgICAgICAgcmVzLmZyYWdtZW50ID0gdGhpcy5mcmFnbWVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0aWMgcmV2aXZlKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChkYXRhIGluc3RhbmNlb2YgVVJJKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBuZXcgX1VSSShkYXRhKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5fZnNQYXRoID0gZGF0YS5mc1BhdGg7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuX2Zvcm1hdHRlZCA9IGRhdGEuZXh0ZXJuYWw7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdnNjVXJpLlVSSSA9IFVSSTtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjbGFzcy1uYW1lXHJcbiAgICBjbGFzcyBfVVJJIGV4dGVuZHMgVVJJIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybWF0dGVkID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5fZnNQYXRoID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZ2V0IGZzUGF0aCgpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl9mc1BhdGgpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2ZzUGF0aCA9IF9tYWtlRnNQYXRoKHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mc1BhdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRvU3RyaW5nKHNraXBFbmNvZGluZyA9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGlmICghc2tpcEVuY29kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2Zvcm1hdHRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1hdHRlZCA9IF9hc0Zvcm1hdHRlZCh0aGlzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZm9ybWF0dGVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gd2UgZG9uJ3QgY2FjaGUgdGhhdFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hc0Zvcm1hdHRlZCh0aGlzLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ29tcHV0ZSBgZnNQYXRoYCBmb3IgdGhlIGdpdmVuIHVyaVxyXG4gICAgICogQHBhcmFtIHVyaVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBfbWFrZUZzUGF0aCh1cmkpIHtcclxuICAgICAgICBsZXQgdmFsdWU7XHJcbiAgICAgICAgaWYgKHVyaS5hdXRob3JpdHkgJiYgdXJpLnBhdGggJiYgdXJpLnNjaGVtZSA9PT0gJ2ZpbGUnKSB7XHJcbiAgICAgICAgICAgIC8vIHVuYyBwYXRoOiBmaWxlOi8vc2hhcmVzL2MkL2Zhci9ib29cclxuICAgICAgICAgICAgdmFsdWUgPSBgLy8ke3VyaS5hdXRob3JpdHl9JHt1cmkucGF0aH1gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChfZHJpdmVMZXR0ZXJQYXRoLnRlc3QodXJpLnBhdGgpKSB7XHJcbiAgICAgICAgICAgIC8vIHdpbmRvd3MgZHJpdmUgbGV0dGVyOiBmaWxlOi8vL2M6L2Zhci9ib29cclxuICAgICAgICAgICAgdmFsdWUgPSB1cmkucGF0aFsxXS50b0xvd2VyQ2FzZSgpICsgdXJpLnBhdGguc3Vic3RyKDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gb3RoZXIgcGF0aFxyXG4gICAgICAgICAgICB2YWx1ZSA9IHVyaS5wYXRoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGxhdGZvcm0uaXNXaW5kb3dzKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFwvL2csICdcXFxcJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIHRoZSBleHRlcm5hbCB2ZXJzaW9uIG9mIGEgdXJpXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIF9hc0Zvcm1hdHRlZCh1cmksIHNraXBFbmNvZGluZykge1xyXG4gICAgICAgIGNvbnN0IGVuY29kZXIgPSAhc2tpcEVuY29kaW5nXHJcbiAgICAgICAgICAgID8gZW5jb2RlVVJJQ29tcG9uZW50MlxyXG4gICAgICAgICAgICA6IGVuY29kZU5vb3A7XHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBbXTtcclxuICAgICAgICBsZXQgeyBzY2hlbWUsIGF1dGhvcml0eSwgcGF0aCwgcXVlcnksIGZyYWdtZW50IH0gPSB1cmk7XHJcbiAgICAgICAgaWYgKHNjaGVtZSkge1xyXG4gICAgICAgICAgICBwYXJ0cy5wdXNoKHNjaGVtZSwgJzonKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGF1dGhvcml0eSB8fCBzY2hlbWUgPT09ICdmaWxlJykge1xyXG4gICAgICAgICAgICBwYXJ0cy5wdXNoKCcvLycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYXV0aG9yaXR5KSB7XHJcbiAgICAgICAgICAgIGxldCBpZHggPSBhdXRob3JpdHkuaW5kZXhPZignQCcpO1xyXG4gICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdXNlcmluZm8gPSBhdXRob3JpdHkuc3Vic3RyKDAsIGlkeCk7XHJcbiAgICAgICAgICAgICAgICBhdXRob3JpdHkgPSBhdXRob3JpdHkuc3Vic3RyKGlkeCArIDEpO1xyXG4gICAgICAgICAgICAgICAgaWR4ID0gdXNlcmluZm8uaW5kZXhPZignOicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZXIodXNlcmluZm8pKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goZW5jb2Rlcih1c2VyaW5mby5zdWJzdHIoMCwgaWR4KSksICc6JywgZW5jb2Rlcih1c2VyaW5mby5zdWJzdHIoaWR4ICsgMSkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goJ0AnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhdXRob3JpdHkgPSBhdXRob3JpdHkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgaWR4ID0gYXV0aG9yaXR5LmluZGV4T2YoJzonKTtcclxuICAgICAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goZW5jb2RlcihhdXRob3JpdHkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goZW5jb2RlcihhdXRob3JpdHkuc3Vic3RyKDAsIGlkeCkpLCBhdXRob3JpdHkuc3Vic3RyKGlkeCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXRoKSB7XHJcbiAgICAgICAgICAgIC8vIGxvd2VyLWNhc2Ugd2luZG93cyBkcml2ZSBsZXR0ZXJzIGluIC9DOi9mZmYgb3IgQzovZmZmXHJcbiAgICAgICAgICAgIGNvbnN0IG0gPSBfdXBwZXJDYXNlRHJpdmUuZXhlYyhwYXRoKTtcclxuICAgICAgICAgICAgaWYgKG0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChtWzFdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9ICcvJyArIG1bMl0udG9Mb3dlckNhc2UoKSArIHBhdGguc3Vic3RyKDMpOyAvLyBcIi9jOlwiLmxlbmd0aCA9PT0gM1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IG1bMl0udG9Mb3dlckNhc2UoKSArIHBhdGguc3Vic3RyKDIpOyAvLyAvLyBcImM6XCIubGVuZ3RoID09PSAyXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gZW5jb2RlIGV2ZXJ5IHNlZ2VtZW50IGJ1dCBub3Qgc2xhc2hlc1xyXG4gICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCAjIGFuZCA/IGFyZSBhbHdheXMgZW5jb2RlZFxyXG4gICAgICAgICAgICAvLyB3aGVuIG9jY3VycmluZyBpbiBwYXRocyAtIG90aGVyd2lzZSB0aGUgcmVzdWx0XHJcbiAgICAgICAgICAgIC8vIGNhbm5vdCBiZSBwYXJzZWQgYmFjayBhZ2FpblxyXG4gICAgICAgICAgICBsZXQgbGFzdElkeCA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaWR4ID0gcGF0aC5pbmRleE9mKF9zbGFzaCwgbGFzdElkeCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goZW5jb2RlcihwYXRoLnN1YnN0cmluZyhsYXN0SWR4KSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcGFydHMucHVzaChlbmNvZGVyKHBhdGguc3Vic3RyaW5nKGxhc3RJZHgsIGlkeCkpLCBfc2xhc2gpO1xyXG4gICAgICAgICAgICAgICAgbGFzdElkeCA9IGlkeCArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHF1ZXJ5KSB7XHJcbiAgICAgICAgICAgIHBhcnRzLnB1c2goJz8nLCBlbmNvZGVyKHF1ZXJ5KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmcmFnbWVudCkge1xyXG4gICAgICAgICAgICBwYXJ0cy5wdXNoKCcjJywgZW5jb2RlcihmcmFnbWVudCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGFydHMuam9pbihfZW1wdHkpO1xyXG4gICAgfVxyXG59KSh2c2NVcmkgPSBleHBvcnRzLnZzY1VyaSB8fCAoZXhwb3J0cy52c2NVcmkgPSB7fSkpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD11cmkuanMubWFwIl19