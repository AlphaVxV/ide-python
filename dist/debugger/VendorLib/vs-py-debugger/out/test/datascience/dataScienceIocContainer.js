// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../client/common/application/types");

const currentProcess_1 = require("../../client/common/process/currentProcess");

const types_2 = require("../../client/common/process/types");

const types_3 = require("../../client/common/types");

const codeCssGenerator_1 = require("../../client/datascience/codeCssGenerator");

const history_1 = require("../../client/datascience/history");

const historyProvider_1 = require("../../client/datascience/historyProvider");

const jupyterExecution_1 = require("../../client/datascience/jupyterExecution");

const jupyterImporter_1 = require("../../client/datascience/jupyterImporter");

const jupyterProcess_1 = require("../../client/datascience/jupyterProcess");

const jupyterServer_1 = require("../../client/datascience/jupyterServer");

const statusProvider_1 = require("../../client/datascience/statusProvider");

const types_4 = require("../../client/datascience/types");

const contracts_1 = require("../../client/interpreter/contracts");

const serviceRegistry_1 = require("../unittests/serviceRegistry");

const executionServiceMock_1 = require("./executionServiceMock");

class DataScienceIocContainer extends serviceRegistry_1.UnitTestIocContainer {
  constructor() {
    super();
  }

  registerDataScienceTypes() {
    this.registerFileSystemTypes();
    this.serviceManager.addSingleton(types_4.IJupyterExecution, jupyterExecution_1.JupyterExecution);
    this.serviceManager.addSingleton(types_4.IHistoryProvider, historyProvider_1.HistoryProvider);
    this.serviceManager.add(types_4.IHistory, history_1.History);
    this.serviceManager.add(types_4.INotebookImporter, jupyterImporter_1.JupyterImporter);
    this.serviceManager.add(types_4.INotebookServer, jupyterServer_1.JupyterServer);
    this.serviceManager.add(types_4.INotebookProcess, jupyterProcess_1.JupyterProcess);
    this.serviceManager.addSingleton(types_4.ICodeCssGenerator, codeCssGenerator_1.CodeCssGenerator);
    this.serviceManager.addSingleton(types_4.IStatusProvider, statusProvider_1.StatusProvider); // Also setup a mock execution service and interpreter service

    const logger = TypeMoq.Mock.ofType();
    const pythonExecutionService = new executionServiceMock_1.MockPythonExecutionService();
    const factory = TypeMoq.Mock.ofType();
    const interpreterService = TypeMoq.Mock.ofType();
    const condaService = TypeMoq.Mock.ofType();
    const appShell = TypeMoq.Mock.ofType();
    const documentManager = TypeMoq.Mock.ofType();
    const workspaceService = TypeMoq.Mock.ofType();
    const configurationService = TypeMoq.Mock.ofType();
    const currentProcess = new currentProcess_1.CurrentProcess();
    const pythonSettings = TypeMoq.Mock.ofType();
    const workspaceConfig = TypeMoq.Mock.ofType();
    this.serviceManager.addSingletonInstance(types_3.ILogger, logger.object);
    this.serviceManager.addSingletonInstance(types_2.IPythonExecutionFactory, factory.object);
    this.serviceManager.addSingletonInstance(contracts_1.IInterpreterService, interpreterService.object);
    this.serviceManager.addSingletonInstance(contracts_1.ICondaService, condaService.object);
    this.serviceManager.addSingletonInstance(types_1.IApplicationShell, appShell.object);
    this.serviceManager.addSingletonInstance(types_1.IDocumentManager, documentManager.object);
    this.serviceManager.addSingletonInstance(types_1.IWorkspaceService, workspaceService.object);
    this.serviceManager.addSingletonInstance(types_3.IConfigurationService, configurationService.object);
    this.serviceManager.addSingletonInstance(types_3.ICurrentProcess, currentProcess);
    const dummyDisposable = {
      dispose: () => {
        return;
      }
    };
    appShell.setup(a => a.showErrorMessage(TypeMoq.It.isAnyString())).returns(() => Promise.resolve(''));
    appShell.setup(a => a.showInformationMessage(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve(''));
    appShell.setup(a => a.showSaveDialog(TypeMoq.It.isAny())).returns(() => Promise.resolve(vscode_1.Uri.file('')));
    appShell.setup(a => a.setStatusBarMessage(TypeMoq.It.isAny())).returns(() => dummyDisposable);
    factory.setup(f => f.create(TypeMoq.It.isAny())).returns(() => Promise.resolve(pythonExecutionService));
    const e = new vscode_1.EventEmitter();
    interpreterService.setup(x => x.onDidChangeInterpreter).returns(() => e.event);
    configurationService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => pythonSettings.object);
    workspaceService.setup(c => c.getConfiguration(TypeMoq.It.isAny())).returns(() => workspaceConfig.object);
    workspaceService.setup(c => c.getConfiguration(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => workspaceConfig.object);
    workspaceConfig.setup(c => c.get(TypeMoq.It.isAny())).returns(() => undefined); // tslint:disable-next-line:no-empty

    logger.setup(l => l.logInformation(TypeMoq.It.isAny())).returns(m => {}); // console.log(m)); // REnable this to debug the server
  }

}

exports.DataScienceIocContainer = DataScienceIocContainer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFTY2llbmNlSW9jQ29udGFpbmVyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiVHlwZU1vcSIsInJlcXVpcmUiLCJ2c2NvZGVfMSIsInR5cGVzXzEiLCJjdXJyZW50UHJvY2Vzc18xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJjb2RlQ3NzR2VuZXJhdG9yXzEiLCJoaXN0b3J5XzEiLCJoaXN0b3J5UHJvdmlkZXJfMSIsImp1cHl0ZXJFeGVjdXRpb25fMSIsImp1cHl0ZXJJbXBvcnRlcl8xIiwianVweXRlclByb2Nlc3NfMSIsImp1cHl0ZXJTZXJ2ZXJfMSIsInN0YXR1c1Byb3ZpZGVyXzEiLCJ0eXBlc180IiwiY29udHJhY3RzXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsImV4ZWN1dGlvblNlcnZpY2VNb2NrXzEiLCJEYXRhU2NpZW5jZUlvY0NvbnRhaW5lciIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwiY29uc3RydWN0b3IiLCJyZWdpc3RlckRhdGFTY2llbmNlVHlwZXMiLCJyZWdpc3RlckZpbGVTeXN0ZW1UeXBlcyIsInNlcnZpY2VNYW5hZ2VyIiwiYWRkU2luZ2xldG9uIiwiSUp1cHl0ZXJFeGVjdXRpb24iLCJKdXB5dGVyRXhlY3V0aW9uIiwiSUhpc3RvcnlQcm92aWRlciIsIkhpc3RvcnlQcm92aWRlciIsImFkZCIsIklIaXN0b3J5IiwiSGlzdG9yeSIsIklOb3RlYm9va0ltcG9ydGVyIiwiSnVweXRlckltcG9ydGVyIiwiSU5vdGVib29rU2VydmVyIiwiSnVweXRlclNlcnZlciIsIklOb3RlYm9va1Byb2Nlc3MiLCJKdXB5dGVyUHJvY2VzcyIsIklDb2RlQ3NzR2VuZXJhdG9yIiwiQ29kZUNzc0dlbmVyYXRvciIsIklTdGF0dXNQcm92aWRlciIsIlN0YXR1c1Byb3ZpZGVyIiwibG9nZ2VyIiwiTW9jayIsIm9mVHlwZSIsInB5dGhvbkV4ZWN1dGlvblNlcnZpY2UiLCJNb2NrUHl0aG9uRXhlY3V0aW9uU2VydmljZSIsImZhY3RvcnkiLCJpbnRlcnByZXRlclNlcnZpY2UiLCJjb25kYVNlcnZpY2UiLCJhcHBTaGVsbCIsImRvY3VtZW50TWFuYWdlciIsIndvcmtzcGFjZVNlcnZpY2UiLCJjb25maWd1cmF0aW9uU2VydmljZSIsImN1cnJlbnRQcm9jZXNzIiwiQ3VycmVudFByb2Nlc3MiLCJweXRob25TZXR0aW5ncyIsIndvcmtzcGFjZUNvbmZpZyIsImFkZFNpbmdsZXRvbkluc3RhbmNlIiwiSUxvZ2dlciIsIm9iamVjdCIsIklQeXRob25FeGVjdXRpb25GYWN0b3J5IiwiSUludGVycHJldGVyU2VydmljZSIsIklDb25kYVNlcnZpY2UiLCJJQXBwbGljYXRpb25TaGVsbCIsIklEb2N1bWVudE1hbmFnZXIiLCJJV29ya3NwYWNlU2VydmljZSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsIklDdXJyZW50UHJvY2VzcyIsImR1bW15RGlzcG9zYWJsZSIsImRpc3Bvc2UiLCJzZXR1cCIsImEiLCJzaG93RXJyb3JNZXNzYWdlIiwiSXQiLCJpc0FueVN0cmluZyIsInJldHVybnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNob3dJbmZvcm1hdGlvbk1lc3NhZ2UiLCJpc0FueSIsInNob3dTYXZlRGlhbG9nIiwiVXJpIiwiZmlsZSIsInNldFN0YXR1c0Jhck1lc3NhZ2UiLCJmIiwiY3JlYXRlIiwiZSIsIkV2ZW50RW1pdHRlciIsIngiLCJvbkRpZENoYW5nZUludGVycHJldGVyIiwiZXZlbnQiLCJjIiwiZ2V0U2V0dGluZ3MiLCJnZXRDb25maWd1cmF0aW9uIiwiZ2V0IiwidW5kZWZpbmVkIiwibCIsImxvZ0luZm9ybWF0aW9uIiwibSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQUQsQ0FBdkI7O0FBQ0EsTUFBTUMsUUFBUSxHQUFHRCxPQUFPLENBQUMsUUFBRCxDQUF4Qjs7QUFDQSxNQUFNRSxPQUFPLEdBQUdGLE9BQU8sQ0FBQyx1Q0FBRCxDQUF2Qjs7QUFDQSxNQUFNRyxnQkFBZ0IsR0FBR0gsT0FBTyxDQUFDLDRDQUFELENBQWhDOztBQUNBLE1BQU1JLE9BQU8sR0FBR0osT0FBTyxDQUFDLG1DQUFELENBQXZCOztBQUNBLE1BQU1LLE9BQU8sR0FBR0wsT0FBTyxDQUFDLDJCQUFELENBQXZCOztBQUNBLE1BQU1NLGtCQUFrQixHQUFHTixPQUFPLENBQUMsMkNBQUQsQ0FBbEM7O0FBQ0EsTUFBTU8sU0FBUyxHQUFHUCxPQUFPLENBQUMsa0NBQUQsQ0FBekI7O0FBQ0EsTUFBTVEsaUJBQWlCLEdBQUdSLE9BQU8sQ0FBQywwQ0FBRCxDQUFqQzs7QUFDQSxNQUFNUyxrQkFBa0IsR0FBR1QsT0FBTyxDQUFDLDJDQUFELENBQWxDOztBQUNBLE1BQU1VLGlCQUFpQixHQUFHVixPQUFPLENBQUMsMENBQUQsQ0FBakM7O0FBQ0EsTUFBTVcsZ0JBQWdCLEdBQUdYLE9BQU8sQ0FBQyx5Q0FBRCxDQUFoQzs7QUFDQSxNQUFNWSxlQUFlLEdBQUdaLE9BQU8sQ0FBQyx3Q0FBRCxDQUEvQjs7QUFDQSxNQUFNYSxnQkFBZ0IsR0FBR2IsT0FBTyxDQUFDLHlDQUFELENBQWhDOztBQUNBLE1BQU1jLE9BQU8sR0FBR2QsT0FBTyxDQUFDLGdDQUFELENBQXZCOztBQUNBLE1BQU1lLFdBQVcsR0FBR2YsT0FBTyxDQUFDLG9DQUFELENBQTNCOztBQUNBLE1BQU1nQixpQkFBaUIsR0FBR2hCLE9BQU8sQ0FBQyw4QkFBRCxDQUFqQzs7QUFDQSxNQUFNaUIsc0JBQXNCLEdBQUdqQixPQUFPLENBQUMsd0JBQUQsQ0FBdEM7O0FBQ0EsTUFBTWtCLHVCQUFOLFNBQXNDRixpQkFBaUIsQ0FBQ0csb0JBQXhELENBQTZFO0FBQ3pFQyxFQUFBQSxXQUFXLEdBQUc7QUFDVjtBQUNIOztBQUNEQyxFQUFBQSx3QkFBd0IsR0FBRztBQUN2QixTQUFLQyx1QkFBTDtBQUNBLFNBQUtDLGNBQUwsQ0FBb0JDLFlBQXBCLENBQWlDVixPQUFPLENBQUNXLGlCQUF6QyxFQUE0RGhCLGtCQUFrQixDQUFDaUIsZ0JBQS9FO0FBQ0EsU0FBS0gsY0FBTCxDQUFvQkMsWUFBcEIsQ0FBaUNWLE9BQU8sQ0FBQ2EsZ0JBQXpDLEVBQTJEbkIsaUJBQWlCLENBQUNvQixlQUE3RTtBQUNBLFNBQUtMLGNBQUwsQ0FBb0JNLEdBQXBCLENBQXdCZixPQUFPLENBQUNnQixRQUFoQyxFQUEwQ3ZCLFNBQVMsQ0FBQ3dCLE9BQXBEO0FBQ0EsU0FBS1IsY0FBTCxDQUFvQk0sR0FBcEIsQ0FBd0JmLE9BQU8sQ0FBQ2tCLGlCQUFoQyxFQUFtRHRCLGlCQUFpQixDQUFDdUIsZUFBckU7QUFDQSxTQUFLVixjQUFMLENBQW9CTSxHQUFwQixDQUF3QmYsT0FBTyxDQUFDb0IsZUFBaEMsRUFBaUR0QixlQUFlLENBQUN1QixhQUFqRTtBQUNBLFNBQUtaLGNBQUwsQ0FBb0JNLEdBQXBCLENBQXdCZixPQUFPLENBQUNzQixnQkFBaEMsRUFBa0R6QixnQkFBZ0IsQ0FBQzBCLGNBQW5FO0FBQ0EsU0FBS2QsY0FBTCxDQUFvQkMsWUFBcEIsQ0FBaUNWLE9BQU8sQ0FBQ3dCLGlCQUF6QyxFQUE0RGhDLGtCQUFrQixDQUFDaUMsZ0JBQS9FO0FBQ0EsU0FBS2hCLGNBQUwsQ0FBb0JDLFlBQXBCLENBQWlDVixPQUFPLENBQUMwQixlQUF6QyxFQUEwRDNCLGdCQUFnQixDQUFDNEIsY0FBM0UsRUFUdUIsQ0FVdkI7O0FBQ0EsVUFBTUMsTUFBTSxHQUFHM0MsT0FBTyxDQUFDNEMsSUFBUixDQUFhQyxNQUFiLEVBQWY7QUFDQSxVQUFNQyxzQkFBc0IsR0FBRyxJQUFJNUIsc0JBQXNCLENBQUM2QiwwQkFBM0IsRUFBL0I7QUFDQSxVQUFNQyxPQUFPLEdBQUdoRCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBaEI7QUFDQSxVQUFNSSxrQkFBa0IsR0FBR2pELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUEzQjtBQUNBLFVBQU1LLFlBQVksR0FBR2xELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUFyQjtBQUNBLFVBQU1NLFFBQVEsR0FBR25ELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUFqQjtBQUNBLFVBQU1PLGVBQWUsR0FBR3BELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUF4QjtBQUNBLFVBQU1RLGdCQUFnQixHQUFHckQsT0FBTyxDQUFDNEMsSUFBUixDQUFhQyxNQUFiLEVBQXpCO0FBQ0EsVUFBTVMsb0JBQW9CLEdBQUd0RCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBN0I7QUFDQSxVQUFNVSxjQUFjLEdBQUcsSUFBSW5ELGdCQUFnQixDQUFDb0QsY0FBckIsRUFBdkI7QUFDQSxVQUFNQyxjQUFjLEdBQUd6RCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBdkI7QUFDQSxVQUFNYSxlQUFlLEdBQUcxRCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBeEI7QUFDQSxTQUFLckIsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3JELE9BQU8sQ0FBQ3NELE9BQWpELEVBQTBEakIsTUFBTSxDQUFDa0IsTUFBakU7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3RELE9BQU8sQ0FBQ3lELHVCQUFqRCxFQUEwRWQsT0FBTyxDQUFDYSxNQUFsRjtBQUNBLFNBQUtyQyxjQUFMLENBQW9CbUMsb0JBQXBCLENBQXlDM0MsV0FBVyxDQUFDK0MsbUJBQXJELEVBQTBFZCxrQkFBa0IsQ0FBQ1ksTUFBN0Y7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5QzNDLFdBQVcsQ0FBQ2dELGFBQXJELEVBQW9FZCxZQUFZLENBQUNXLE1BQWpGO0FBQ0EsU0FBS3JDLGNBQUwsQ0FBb0JtQyxvQkFBcEIsQ0FBeUN4RCxPQUFPLENBQUM4RCxpQkFBakQsRUFBb0VkLFFBQVEsQ0FBQ1UsTUFBN0U7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3hELE9BQU8sQ0FBQytELGdCQUFqRCxFQUFtRWQsZUFBZSxDQUFDUyxNQUFuRjtBQUNBLFNBQUtyQyxjQUFMLENBQW9CbUMsb0JBQXBCLENBQXlDeEQsT0FBTyxDQUFDZ0UsaUJBQWpELEVBQW9FZCxnQkFBZ0IsQ0FBQ1EsTUFBckY7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3JELE9BQU8sQ0FBQzhELHFCQUFqRCxFQUF3RWQsb0JBQW9CLENBQUNPLE1BQTdGO0FBQ0EsU0FBS3JDLGNBQUwsQ0FBb0JtQyxvQkFBcEIsQ0FBeUNyRCxPQUFPLENBQUMrRCxlQUFqRCxFQUFrRWQsY0FBbEU7QUFDQSxVQUFNZSxlQUFlLEdBQUc7QUFDcEJDLE1BQUFBLE9BQU8sRUFBRSxNQUFNO0FBQUU7QUFBUztBQUROLEtBQXhCO0FBR0FwQixJQUFBQSxRQUFRLENBQUNxQixLQUFULENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxnQkFBRixDQUFtQjFFLE9BQU8sQ0FBQzJFLEVBQVIsQ0FBV0MsV0FBWCxFQUFuQixDQUFwQixFQUFrRUMsT0FBbEUsQ0FBMEUsTUFBTUMsT0FBTyxDQUFDQyxPQUFSLENBQWdCLEVBQWhCLENBQWhGO0FBQ0E1QixJQUFBQSxRQUFRLENBQUNxQixLQUFULENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDTyxzQkFBRixDQUF5QmhGLE9BQU8sQ0FBQzJFLEVBQVIsQ0FBV00sS0FBWCxFQUF6QixFQUE2Q2pGLE9BQU8sQ0FBQzJFLEVBQVIsQ0FBV00sS0FBWCxFQUE3QyxDQUFwQixFQUFzRkosT0FBdEYsQ0FBOEYsTUFBTUMsT0FBTyxDQUFDQyxPQUFSLENBQWdCLEVBQWhCLENBQXBHO0FBQ0E1QixJQUFBQSxRQUFRLENBQUNxQixLQUFULENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDUyxjQUFGLENBQWlCbEYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQWpCLENBQXBCLEVBQTBESixPQUExRCxDQUFrRSxNQUFNQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0I3RSxRQUFRLENBQUNpRixHQUFULENBQWFDLElBQWIsQ0FBa0IsRUFBbEIsQ0FBaEIsQ0FBeEU7QUFDQWpDLElBQUFBLFFBQVEsQ0FBQ3FCLEtBQVQsQ0FBZUMsQ0FBQyxJQUFJQSxDQUFDLENBQUNZLG1CQUFGLENBQXNCckYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQXRCLENBQXBCLEVBQStESixPQUEvRCxDQUF1RSxNQUFNUCxlQUE3RTtBQUNBdEIsSUFBQUEsT0FBTyxDQUFDd0IsS0FBUixDQUFjYyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsTUFBRixDQUFTdkYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQVQsQ0FBbkIsRUFBaURKLE9BQWpELENBQXlELE1BQU1DLE9BQU8sQ0FBQ0MsT0FBUixDQUFnQmpDLHNCQUFoQixDQUEvRDtBQUNBLFVBQU0wQyxDQUFDLEdBQUcsSUFBSXRGLFFBQVEsQ0FBQ3VGLFlBQWIsRUFBVjtBQUNBeEMsSUFBQUEsa0JBQWtCLENBQUN1QixLQUFuQixDQUF5QmtCLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxzQkFBaEMsRUFBd0RkLE9BQXhELENBQWdFLE1BQU1XLENBQUMsQ0FBQ0ksS0FBeEU7QUFDQXRDLElBQUFBLG9CQUFvQixDQUFDa0IsS0FBckIsQ0FBMkJxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0MsV0FBRixDQUFjOUYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQWQsQ0FBaEMsRUFBbUVKLE9BQW5FLENBQTJFLE1BQU1wQixjQUFjLENBQUNJLE1BQWhHO0FBQ0FSLElBQUFBLGdCQUFnQixDQUFDbUIsS0FBakIsQ0FBdUJxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0UsZ0JBQUYsQ0FBbUIvRixPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBbkIsQ0FBNUIsRUFBb0VKLE9BQXBFLENBQTRFLE1BQU1uQixlQUFlLENBQUNHLE1BQWxHO0FBQ0FSLElBQUFBLGdCQUFnQixDQUFDbUIsS0FBakIsQ0FBdUJxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0UsZ0JBQUYsQ0FBbUIvRixPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBbkIsRUFBdUNqRixPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBdkMsQ0FBNUIsRUFBd0ZKLE9BQXhGLENBQWdHLE1BQU1uQixlQUFlLENBQUNHLE1BQXRIO0FBQ0FILElBQUFBLGVBQWUsQ0FBQ2MsS0FBaEIsQ0FBc0JxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0csR0FBRixDQUFNaEcsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQU4sQ0FBM0IsRUFBc0RKLE9BQXRELENBQThELE1BQU1vQixTQUFwRSxFQTdDdUIsQ0E4Q3ZCOztBQUNBdEQsSUFBQUEsTUFBTSxDQUFDNkIsS0FBUCxDQUFhMEIsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLGNBQUYsQ0FBaUJuRyxPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBakIsQ0FBbEIsRUFBd0RKLE9BQXhELENBQWlFdUIsQ0FBRCxJQUFPLENBQUcsQ0FBMUUsRUEvQ3VCLENBK0NzRDtBQUNoRjs7QUFwRHdFOztBQXNEN0V0RyxPQUFPLENBQUNxQix1QkFBUixHQUFrQ0EsdUJBQWxDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuJ3VzZSBzdHJpY3QnO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcclxuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xyXG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XHJcbmNvbnN0IGN1cnJlbnRQcm9jZXNzXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL2N1cnJlbnRQcm9jZXNzXCIpO1xyXG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy90eXBlc1wiKTtcclxuY29uc3QgdHlwZXNfMyA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xyXG5jb25zdCBjb2RlQ3NzR2VuZXJhdG9yXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2RhdGFzY2llbmNlL2NvZGVDc3NHZW5lcmF0b3JcIik7XHJcbmNvbnN0IGhpc3RvcnlfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGF0YXNjaWVuY2UvaGlzdG9yeVwiKTtcclxuY29uc3QgaGlzdG9yeVByb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2RhdGFzY2llbmNlL2hpc3RvcnlQcm92aWRlclwiKTtcclxuY29uc3QganVweXRlckV4ZWN1dGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9qdXB5dGVyRXhlY3V0aW9uXCIpO1xyXG5jb25zdCBqdXB5dGVySW1wb3J0ZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGF0YXNjaWVuY2UvanVweXRlckltcG9ydGVyXCIpO1xyXG5jb25zdCBqdXB5dGVyUHJvY2Vzc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9qdXB5dGVyUHJvY2Vzc1wiKTtcclxuY29uc3QganVweXRlclNlcnZlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9qdXB5dGVyU2VydmVyXCIpO1xyXG5jb25zdCBzdGF0dXNQcm92aWRlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9zdGF0dXNQcm92aWRlclwiKTtcclxuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGF0YXNjaWVuY2UvdHlwZXNcIik7XHJcbmNvbnN0IGNvbnRyYWN0c18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9pbnRlcnByZXRlci9jb250cmFjdHNcIik7XHJcbmNvbnN0IHNlcnZpY2VSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4uL3VuaXR0ZXN0cy9zZXJ2aWNlUmVnaXN0cnlcIik7XHJcbmNvbnN0IGV4ZWN1dGlvblNlcnZpY2VNb2NrXzEgPSByZXF1aXJlKFwiLi9leGVjdXRpb25TZXJ2aWNlTW9ja1wiKTtcclxuY2xhc3MgRGF0YVNjaWVuY2VJb2NDb250YWluZXIgZXh0ZW5kcyBzZXJ2aWNlUmVnaXN0cnlfMS5Vbml0VGVzdElvY0NvbnRhaW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgfVxyXG4gICAgcmVnaXN0ZXJEYXRhU2NpZW5jZVR5cGVzKCkge1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJGaWxlU3lzdGVtVHlwZXMoKTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc180LklKdXB5dGVyRXhlY3V0aW9uLCBqdXB5dGVyRXhlY3V0aW9uXzEuSnVweXRlckV4ZWN1dGlvbik7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfNC5JSGlzdG9yeVByb3ZpZGVyLCBoaXN0b3J5UHJvdmlkZXJfMS5IaXN0b3J5UHJvdmlkZXIpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkKHR5cGVzXzQuSUhpc3RvcnksIGhpc3RvcnlfMS5IaXN0b3J5KTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZCh0eXBlc180LklOb3RlYm9va0ltcG9ydGVyLCBqdXB5dGVySW1wb3J0ZXJfMS5KdXB5dGVySW1wb3J0ZXIpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkKHR5cGVzXzQuSU5vdGVib29rU2VydmVyLCBqdXB5dGVyU2VydmVyXzEuSnVweXRlclNlcnZlcik7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGQodHlwZXNfNC5JTm90ZWJvb2tQcm9jZXNzLCBqdXB5dGVyUHJvY2Vzc18xLkp1cHl0ZXJQcm9jZXNzKTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc180LklDb2RlQ3NzR2VuZXJhdG9yLCBjb2RlQ3NzR2VuZXJhdG9yXzEuQ29kZUNzc0dlbmVyYXRvcik7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfNC5JU3RhdHVzUHJvdmlkZXIsIHN0YXR1c1Byb3ZpZGVyXzEuU3RhdHVzUHJvdmlkZXIpO1xyXG4gICAgICAgIC8vIEFsc28gc2V0dXAgYSBtb2NrIGV4ZWN1dGlvbiBzZXJ2aWNlIGFuZCBpbnRlcnByZXRlciBzZXJ2aWNlXHJcbiAgICAgICAgY29uc3QgbG9nZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IHB5dGhvbkV4ZWN1dGlvblNlcnZpY2UgPSBuZXcgZXhlY3V0aW9uU2VydmljZU1vY2tfMS5Nb2NrUHl0aG9uRXhlY3V0aW9uU2VydmljZSgpO1xyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3QgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIGNvbnN0IGNvbmRhU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBhcHBTaGVsbCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBkb2N1bWVudE1hbmFnZXIgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBjb25maWd1cmF0aW9uU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50UHJvY2VzcyA9IG5ldyBjdXJyZW50UHJvY2Vzc18xLkN1cnJlbnRQcm9jZXNzKCk7XHJcbiAgICAgICAgY29uc3QgcHl0aG9uU2V0dGluZ3MgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XHJcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMy5JTG9nZ2VyLCBsb2dnZXIub2JqZWN0KTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzIuSVB5dGhvbkV4ZWN1dGlvbkZhY3RvcnksIGZhY3Rvcnkub2JqZWN0KTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKGNvbnRyYWN0c18xLklJbnRlcnByZXRlclNlcnZpY2UsIGludGVycHJldGVyU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UoY29udHJhY3RzXzEuSUNvbmRhU2VydmljZSwgY29uZGFTZXJ2aWNlLm9iamVjdCk7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18xLklBcHBsaWNhdGlvblNoZWxsLCBhcHBTaGVsbC5vYmplY3QpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMS5JRG9jdW1lbnRNYW5hZ2VyLCBkb2N1bWVudE1hbmFnZXIub2JqZWN0KTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzEuSVdvcmtzcGFjZVNlcnZpY2UsIHdvcmtzcGFjZVNlcnZpY2Uub2JqZWN0KTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzMuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlLCBjb25maWd1cmF0aW9uU2VydmljZS5vYmplY3QpO1xyXG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMy5JQ3VycmVudFByb2Nlc3MsIGN1cnJlbnRQcm9jZXNzKTtcclxuICAgICAgICBjb25zdCBkdW1teURpc3Bvc2FibGUgPSB7XHJcbiAgICAgICAgICAgIGRpc3Bvc2U6ICgpID0+IHsgcmV0dXJuOyB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBhcHBTaGVsbC5zZXR1cChhID0+IGEuc2hvd0Vycm9yTWVzc2FnZShUeXBlTW9xLkl0LmlzQW55U3RyaW5nKCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSgnJykpO1xyXG4gICAgICAgIGFwcFNoZWxsLnNldHVwKGEgPT4gYS5zaG93SW5mb3JtYXRpb25NZXNzYWdlKFR5cGVNb3EuSXQuaXNBbnkoKSwgVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoJycpKTtcclxuICAgICAgICBhcHBTaGVsbC5zZXR1cChhID0+IGEuc2hvd1NhdmVEaWFsb2coVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodnNjb2RlXzEuVXJpLmZpbGUoJycpKSk7XHJcbiAgICAgICAgYXBwU2hlbGwuc2V0dXAoYSA9PiBhLnNldFN0YXR1c0Jhck1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBkdW1teURpc3Bvc2FibGUpO1xyXG4gICAgICAgIGZhY3Rvcnkuc2V0dXAoZiA9PiBmLmNyZWF0ZShUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShweXRob25FeGVjdXRpb25TZXJ2aWNlKSk7XHJcbiAgICAgICAgY29uc3QgZSA9IG5ldyB2c2NvZGVfMS5FdmVudEVtaXR0ZXIoKTtcclxuICAgICAgICBpbnRlcnByZXRlclNlcnZpY2Uuc2V0dXAoeCA9PiB4Lm9uRGlkQ2hhbmdlSW50ZXJwcmV0ZXIpLnJldHVybnMoKCkgPT4gZS5ldmVudCk7XHJcbiAgICAgICAgY29uZmlndXJhdGlvblNlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldFNldHRpbmdzKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gcHl0aG9uU2V0dGluZ3Mub2JqZWN0KTtcclxuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKGMgPT4gYy5nZXRDb25maWd1cmF0aW9uKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlQ29uZmlnLm9iamVjdCk7XHJcbiAgICAgICAgd29ya3NwYWNlU2VydmljZS5zZXR1cChjID0+IGMuZ2V0Q29uZmlndXJhdGlvbihUeXBlTW9xLkl0LmlzQW55KCksIFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlQ29uZmlnLm9iamVjdCk7XHJcbiAgICAgICAgd29ya3NwYWNlQ29uZmlnLnNldHVwKGMgPT4gYy5nZXQoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiB1bmRlZmluZWQpO1xyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1lbXB0eVxyXG4gICAgICAgIGxvZ2dlci5zZXR1cChsID0+IGwubG9nSW5mb3JtYXRpb24oVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygobSkgPT4geyB9KTsgLy8gY29uc29sZS5sb2cobSkpOyAvLyBSRW5hYmxlIHRoaXMgdG8gZGVidWcgdGhlIHNlcnZlclxyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMuRGF0YVNjaWVuY2VJb2NDb250YWluZXIgPSBEYXRhU2NpZW5jZUlvY0NvbnRhaW5lcjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YVNjaWVuY2VJb2NDb250YWluZXIuanMubWFwIl19